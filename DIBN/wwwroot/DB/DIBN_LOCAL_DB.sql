USE [master]
GO
/****** Object:  Database [DIBN_Staging_DB]    Script Date: 30-10-2024 15:05:41 ******/
CREATE DATABASE [DIBN_Staging_DB]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'DIBN_DB', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\DATA\DIBN_Staging_DB.mdf' , SIZE = 5906432KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB ), 
 FILEGROUP [FG_DIBN_DB_Account] 
( NAME = N'FG_DIBN_DB_Account', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\DATA\FG_DIBN_Staging_DB_Account.ndf' , SIZE = 73728KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB ), 
 FILEGROUP [FG_DIBN_DB_Invoices] 
( NAME = N'FG_DIBN_DB_Invoices', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\DATA\FG_DIBN_Staging_DB_Invoices.ndf' , SIZE = 1122304KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB ), 
 FILEGROUP [FG_DIBN_DB_Service] 
( NAME = N'FG_DIBN_DB_Service', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\DATA\FG_DIBN_Staging_DB_Service.ndf' , SIZE = 10690560KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB ), 
 FILEGROUP [FG_DIBN_DB_SupportTicket] 
( NAME = N'FG_DIBN_DB_SupportTicket', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\DATA\FG_DIBN_Staging_DB_SupportTicket.ndf' , SIZE = 73728KB , MAXSIZE = UNLIMITED, FILEGROWTH = 65536KB )
 LOG ON 
( NAME = N'DIBN_DB_log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL16.MSSQLSERVER\MSSQL\DATA\DIBN_Staging_DB_new1_log.ldf' , SIZE = 16850944KB , MAXSIZE = 2048GB , FILEGROWTH = 65536KB )
 WITH CATALOG_COLLATION = DATABASE_DEFAULT, LEDGER = OFF
GO
ALTER DATABASE [DIBN_Staging_DB] ADD FILEGROUP [FG_DIBN_DB_Invoice]
GO
ALTER DATABASE [DIBN_Staging_DB] ADD FILEGROUP [FG_DIBN_DB_Services]
GO
ALTER DATABASE [DIBN_Staging_DB] SET COMPATIBILITY_LEVEL = 160
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [DIBN_Staging_DB].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [DIBN_Staging_DB] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET ARITHABORT OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [DIBN_Staging_DB] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [DIBN_Staging_DB] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET  DISABLE_BROKER 
GO
ALTER DATABASE [DIBN_Staging_DB] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [DIBN_Staging_DB] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET RECOVERY FULL 
GO
ALTER DATABASE [DIBN_Staging_DB] SET  MULTI_USER 
GO
ALTER DATABASE [DIBN_Staging_DB] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [DIBN_Staging_DB] SET DB_CHAINING OFF 
GO
ALTER DATABASE [DIBN_Staging_DB] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [DIBN_Staging_DB] SET TARGET_RECOVERY_TIME = 60 SECONDS 
GO
ALTER DATABASE [DIBN_Staging_DB] SET DELAYED_DURABILITY = DISABLED 
GO
ALTER DATABASE [DIBN_Staging_DB] SET ACCELERATED_DATABASE_RECOVERY = OFF  
GO
EXEC sys.sp_db_vardecimal_storage_format N'DIBN_Staging_DB', N'ON'
GO
ALTER DATABASE [DIBN_Staging_DB] SET QUERY_STORE = ON
GO
ALTER DATABASE [DIBN_Staging_DB] SET QUERY_STORE (OPERATION_MODE = READ_WRITE, CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 30), DATA_FLUSH_INTERVAL_SECONDS = 900, INTERVAL_LENGTH_MINUTES = 60, MAX_STORAGE_SIZE_MB = 1000, QUERY_CAPTURE_MODE = AUTO, SIZE_BASED_CLEANUP_MODE = AUTO, MAX_PLANS_PER_QUERY = 200, WAIT_STATS_CAPTURE_MODE = ON)
GO
USE [DIBN_Staging_DB]
GO
/****** Object:  Schema [History]    Script Date: 30-10-2024 15:05:48 ******/
CREATE SCHEMA [History]
GO
/****** Object:  UserDefinedFunction [dbo].[Splitchars]    Script Date: 30-10-2024 15:05:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[Splitchars]
(
   @List      VARCHAR(MAX),
   @Delimiter VARCHAR(255)
)
RETURNS TABLE
AS
  RETURN ( SELECT Item = CONVERT(nvarchar(mAx), Item) FROM
      ( SELECT Item = x.i.value('(./text())[1]', 'varchar(max)')
        FROM ( SELECT [XML] = CONVERT(XML, '<i>'
        + REPLACE(@List, @Delimiter, '</i><i>') + '</i>').query('.')
          ) AS a CROSS APPLY [XML].nodes('i') AS x(i) ) AS y
      WHERE Item IS NOT NULL
  );
GO
/****** Object:  UserDefinedFunction [dbo].[SplitInts]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[SplitInts]
(
   @List      VARCHAR(MAX),
   @Delimiter VARCHAR(255)
)
RETURNS TABLE
AS
  RETURN ( SELECT Item = CONVERT(INT, Item) FROM
      ( SELECT Item = x.i.value('(./text())[1]', 'varchar(max)')
        FROM ( SELECT [XML] = CONVERT(XML, '<i>'
        + REPLACE(@List, @Delimiter, '</i><i>') + '</i>').query('.')
          ) AS a CROSS APPLY [XML].nodes('i') AS x(i) ) AS y
      WHERE Item IS NOT NULL
  );
GO
/****** Object:  Table [dbo].[Tbl_AccountHistory]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_AccountHistory](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[TransactionId] [nvarchar](100) NULL,
	[Description] [nvarchar](max) NULL,
	[Amount] [nvarchar](50) NULL,
	[Quantity] [int] NULL,
	[TotalAmount] [nvarchar](50) NULL,
	[Vat] [nvarchar](10) NULL,
	[VatAmount] [nvarchar](50) NULL,
	[GrandTotal] [nvarchar](50) NULL,
	[PaymentMethod] [nvarchar](50) NULL,
	[ExpenseType] [nvarchar](50) NULL,
	[TransactionDate] [datetime2](7) NULL,
	[CompanyId] [int] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_AccountHistory] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Account]
) ON [FG_DIBN_DB_Account] TEXTIMAGE_ON [FG_DIBN_DB_Account]
GO
/****** Object:  Table [dbo].[Tbl_AccountManagementStaging]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_AccountManagementStaging](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[CompanyId] [int] NULL,
	[TransactionType] [nvarchar](50) NULL,
	[Description] [nvarchar](max) NULL,
	[PaymentMode] [nvarchar](100) NULL,
	[Amount] [decimal](18, 2) NULL,
	[Quantity] [int] NULL,
	[TotalAmount] [decimal](18, 2) NULL,
	[Vat] [decimal](18, 2) NULL,
	[VatAmount] [decimal](18, 2) NULL,
	[GrandTotal] [decimal](18, 2) NULL,
	[CreatedOn] [nvarchar](50) NULL,
	[PaymentStatus] [nvarchar](50) NULL,
	[IsDeleted] [bit] NULL,
	[IsProcessing] [bit] NULL,
	[TransactionId] [nvarchar](50) NULL,
 CONSTRAINT [PK_Tbl_AccountManagementStaging] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_AssignEnquiryRequests]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_AssignEnquiryRequests](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[RequestId] [int] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_AssignEnquiryRequests] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_AssignServiceRequest]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_AssignServiceRequest](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[ServiceId] [int] NULL,
	[SerialNumber] [nvarchar](500) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[MarkAsRead] [bit] NULL,
 CONSTRAINT [PK_Tbl_AssignServiceRequest] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_AssignSupportTicket]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_AssignSupportTicket](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[TrackingNumber] [nvarchar](500) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[MarkAsRead] [bit] NULL,
 CONSTRAINT [PK_Tbl_AssignSupportTicket] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_SupportTicket]
) ON [FG_DIBN_DB_SupportTicket]
GO
/****** Object:  Table [dbo].[Tbl_Banner]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Banner](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](max) NULL,
	[Extension] [nvarchar](50) NULL,
	[PictureBinary] [varbinary](max) NULL,
	[Path] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Banner] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Company]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Company](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[AccountNumber] [nvarchar](100) NULL,
	[DibnUserNumber] [nvarchar](max) NULL,
	[CompanyName] [nvarchar](max) NULL,
	[ShareCapital] [nvarchar](50) NULL,
	[CompanyRegistrationNumber] [nvarchar](100) NULL,
	[MCountryCode] [nvarchar](max) NULL,
	[MobileNumber] [nvarchar](max) NULL,
	[ECountryCode] [nvarchar](max) NULL,
	[EmergencyNumber] [nvarchar](max) NULL,
	[EmailID] [nvarchar](max) NULL,
	[SecondEmailID] [nvarchar](max) NULL,
	[CompanyType] [nvarchar](max) NULL,
	[LicenseType] [nvarchar](50) NULL,
	[LicenseStatus] [nvarchar](50) NULL,
	[LicenseIssueDate] [datetime2](7) NULL,
	[LicenseExpiryDate] [datetime2](7) NULL,
	[LeaseFacilityType] [nvarchar](50) NULL,
	[LeaseStartDate] [datetime2](7) NULL,
	[LeaseExpiryDate] [datetime2](7) NULL,
	[LeaseStatus] [nvarchar](50) NULL,
	[CompanyStartingDate] [datetime2](7) NULL,
	[City] [nvarchar](100) NULL,
	[Country] [nvarchar](100) NULL,
	[UnitLocation] [nvarchar](max) NULL,
	[Cmp_Pass] [nvarchar](max) NULL,
	[IsTRN] [bit] NULL,
	[TRN] [nvarchar](100) NULL,
	[TRNCreationDate] [datetime2](7) NULL,
	[IsCorportaeText] [bit] NULL,
	[CorporateText] [nvarchar](max) NULL,
	[SubCompanyType] [nvarchar](max) NULL,
	[CompanySubTypeUpdated] [datetime2](7) NULL,
	[LabourFileNo] [nvarchar](200) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ValidFrom] [datetime2](7) NOT NULL,
	[ValidTo] [datetime2](7) NOT NULL,
 CONSTRAINT [PK_tbl_Company] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Company_Document_Mapping]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Company_Document_Mapping](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](max) NULL,
	[Extension] [nvarchar](max) NULL,
	[Title] [nvarchar](max) NULL,
	[Description] [nvarchar](max) NULL,
	[DataBinary] [varbinary](max) NULL,
	[CompanyId] [int] NULL,
	[IssueDate] [datetime2](7) NULL,
	[ExpiryDate] [datetime2](7) NULL,
	[AuthorityName] [nvarchar](max) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[IsDeleted] [bit] NULL,
	[DocumentTypeId] [int] NULL,
 CONSTRAINT [PK_Tbl_Company_Document_Mapping_1] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Company_User_Document_Mapping]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Company_User_Document_Mapping](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[DocumentId] [int] NULL,
	[UserId] [int] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Company_Document_Mapping] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Company_User_Mapping]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Company_User_Mapping](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[UserId] [int] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Company_User_Mapping] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_CompanyDocumentType]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanyDocumentType](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Name] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_CompanyDocumentType] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_CompanyInvoiceDetail]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanyInvoiceDetail](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ProductName] [nvarchar](max) NULL,
	[Quantity] [int] NULL,
	[Amount] [decimal](18, 2) NULL,
	[TotalAmount] [decimal](18, 2) NULL,
	[Vat] [decimal](18, 2) NULL,
	[VatAmount] [decimal](18, 2) NULL,
	[GrandTotal] [decimal](18, 2) NULL,
	[InvoiceNumber] [nvarchar](500) NULL,
	[CompanyId] [int] NULL,
	[Services] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[InvoiceCreatedOn] [datetime2](7) NULL,
	[Currency] [nvarchar](50) NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_CompanyInvoiceDetail] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Invoices]
) ON [FG_DIBN_DB_Invoices] TEXTIMAGE_ON [FG_DIBN_DB_Invoices]
GO
/****** Object:  Table [dbo].[Tbl_CompanyInvoicePdf]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanyInvoicePdf](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[PdfName] [nvarchar](100) NULL,
	[Extension] [nvarchar](50) NULL,
	[DataBinary] [varbinary](max) NULL,
	[InvoiceNumber] [nvarchar](500) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_CompanyInvoicePdf] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Invoices]
) ON [FG_DIBN_DB_Invoices] TEXTIMAGE_ON [FG_DIBN_DB_Invoices]
GO
/****** Object:  Table [dbo].[Tbl_CompanyPermission]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanyPermission](
	[CompanyPermissionId] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[ModuleId] [int] NULL,
	[PermissionId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_CompanyPermission] PRIMARY KEY CLUSTERED 
(
	[CompanyPermissionId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_CompanyServiceRequests]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanyServiceRequests](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[SerialNumber] [nvarchar](500) NULL,
	[SerialCode] [int] NULL,
	[ServiceId] [int] NULL,
	[RequestedService] [nvarchar](max) NULL,
	[CompanyId] [int] NULL,
	[CompanyName] [nvarchar](max) NULL,
	[RequestedBy] [nvarchar](max) NULL,
	[CreatedOn] [datetime2](7) NULL,
	[StatusId] [int] NULL,
	[Status] [nvarchar](500) NULL,
	[AssignedUser] [nvarchar](max) NULL,
	[AssignOn] [datetime2](7) NULL,
	[SalesPerson] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_CompanyServiceRequests] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_CompanyServices]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanyServices](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[SerialNumber] [nvarchar](max) NULL,
	[ParentId] [int] NULL,
	[CompanyType] [nvarchar](max) NULL,
	[ServiceName] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_CompanyServices] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_CompanySubType]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_CompanySubType](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[MainType] [nvarchar](250) NULL,
	[SubType] [nvarchar](250) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_CompanySubType] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Documents]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Documents](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](max) NULL,
	[Extension] [nvarchar](50) NULL,
	[Title] [nvarchar](max) NULL,
	[Description] [nvarchar](max) NULL,
	[DataBinary] [varbinary](max) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[IsDelete] [bit] NULL,
	[DocumentTypeId] [int] NULL,
 CONSTRAINT [PK_Tbl_Documents] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_DownloadDocument]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_DownloadDocument](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](max) NULL,
	[FileExtension] [nvarchar](50) NULL,
	[EmailAddress] [nvarchar](150) NULL,
	[ActionMethod] [nvarchar](max) NULL,
	[Controller] [nvarchar](max) NULL,
	[FromDate] [datetime2](7) NULL,
	[ToDate] [datetime2](7) NULL,
	[Month] [nchar](50) NULL,
	[Year] [nchar](10) NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[IsSended] [bit] NULL,
	[SendedOnUtc] [datetime2](7) NULL,
	[Status] [nvarchar](50) NULL,
 CONSTRAINT [PK_Tbl_DownloadDocument] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Email]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Email](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[MailFrom] [nvarchar](max) NULL,
	[MailFromPassword] [nvarchar](max) NULL,
	[MailTo] [nvarchar](max) NULL,
	[Subject] [nvarchar](max) NULL,
	[MailBody] [nvarchar](max) NULL,
	[CompanyId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Email] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_EmailDocument]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_EmailDocument](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[EmailId] [int] NULL,
	[Filename] [nvarchar](50) NULL,
	[Extension] [nvarchar](50) NULL,
	[DataBinary] [varbinary](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_EmailDocument] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_EmployeeServiceRequests]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_EmployeeServiceRequests](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[SerialNumber] [nvarchar](500) NULL,
	[SerialCode] [int] NULL,
	[ApplicantName] [nvarchar](max) NULL,
	[ServiceId] [int] NULL,
	[RequestedService] [nvarchar](max) NULL,
	[CompanyId] [int] NULL,
	[CompanyName] [nvarchar](max) NULL,
	[RequestedBy] [nvarchar](max) NULL,
	[CreatedOn] [datetime2](7) NULL,
	[StatusId] [int] NULL,
	[Status] [nvarchar](max) NULL,
	[AssignedUser] [nvarchar](max) NULL,
	[AssignOn] [datetime2](7) NULL,
	[SalesPerson] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_EmployeeServiceRequests] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_EmployeeServices]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_EmployeeServices](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CompanyType] [nvarchar](max) NULL,
	[SerialNumber] [nvarchar](max) NULL,
	[ParentId] [int] NULL,
	[ServiceName] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_EmployeeServices] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_EnquiryFormDetails]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_EnquiryFormDetails](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[EnquiryNumber] [nvarchar](100) NULL,
	[ClientEnquiryNumber] [nvarchar](100) NULL,
	[FromEmail] [nvarchar](200) NULL,
	[ToEmail] [nvarchar](200) NULL,
	[Name] [nvarchar](100) NULL,
	[ContactNumber] [nvarchar](50) NULL,
	[Description] [nvarchar](max) NULL,
	[EnquiryFor] [nvarchar](200) NULL,
	[Status] [nvarchar](50) NULL,
	[CreatedOn] [datetime2](7) NULL,
	[IsDelete] [bit] NULL,
 CONSTRAINT [PK_Tbl_EnquiryFormDetails] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Expense_Receipt]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Expense_Receipt](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](max) NULL,
	[Extension] [nvarchar](50) NULL,
	[DataBinary] [varbinary](max) NULL,
	[RecieptId] [int] NULL,
	[CompanyId] [int] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
 CONSTRAINT [PK_Tbl_Expense_Reciept] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Account]
) ON [FG_DIBN_DB_Account] TEXTIMAGE_ON [FG_DIBN_DB_Account]
GO
/****** Object:  Table [dbo].[Tbl_Log]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Log](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Message] [nvarchar](max) NULL,
	[MessageTemplate] [nvarchar](max) NULL,
	[Level] [nvarchar](250) NULL,
	[TimeStamp] [nvarchar](max) NULL,
	[Exception] [nvarchar](max) NULL,
	[Properties] [xml] NULL,
	[LogEvent] [nvarchar](max) NULL,
	[Username] [nvarchar](max) NULL,
	[IP] [nvarchar](250) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
 CONSTRAINT [PK_Tbl_Log] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_MessageTemplate]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_MessageTemplate](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Name] [nvarchar](max) NULL,
	[Subject] [nvarchar](max) NULL,
	[MailFrom] [nvarchar](max) NULL,
	[Body] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_MessageTemplate] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Module]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Module](
	[ModuleId] [int] IDENTITY(1,1) NOT NULL,
	[ModuleName] [nvarchar](500) NULL,
	[ModuleKeyword] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Module] PRIMARY KEY CLUSTERED 
(
	[ModuleId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_NewCompanyInvoiceDetails]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_NewCompanyInvoiceDetails](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[CompanyName] [nvarchar](max) NULL,
	[Address] [nvarchar](max) NULL,
	[City] [nvarchar](max) NULL,
	[Country] [nvarchar](max) NULL,
	[ContactNumber] [nvarchar](max) NULL,
	[Service] [nvarchar](max) NULL,
	[ProductName] [nvarchar](max) NULL,
	[Quantity] [int] NULL,
	[Amount] [decimal](18, 2) NULL,
	[TotalAmount] [decimal](18, 2) NULL,
	[Vat] [decimal](18, 2) NULL,
	[VatAmount] [decimal](18, 2) NULL,
	[GrandTotal] [decimal](18, 2) NULL,
	[InvoiceNumber] [nvarchar](500) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[InvoiceCreationDate] [datetime2](7) NULL,
	[Currency] [nvarchar](50) NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_NewCompanyInvoiceDetails] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Invoices]
) ON [FG_DIBN_DB_Invoices] TEXTIMAGE_ON [FG_DIBN_DB_Invoices]
GO
/****** Object:  Table [dbo].[Tbl_Notifications]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Notifications](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[CompanyName] [nvarchar](max) NULL,
	[UserId] [int] NULL,
	[Username] [nvarchar](max) NULL,
	[Service] [nvarchar](max) NULL,
	[ExpiryDate] [datetime2](7) NULL,
	[LeftDayToExpire] [int] NULL,
	[SendNotificationAfter] [int] NULL,
	[MarkAsRead] [bit] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Notifications] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Password]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Password](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[SalesPersonId] [int] NULL,
	[Password] [nvarchar](max) NULL,
 CONSTRAINT [PK_Tbl_Password] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_PaymentReceipt]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_PaymentReceipt](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[SerialNumber] [nvarchar](500) NULL,
	[CompanyId] [int] NULL,
	[PaymentId] [int] NULL,
	[Through] [nvarchar](max) NULL,
	[OnAccount] [nvarchar](max) NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[IsDelete] [bit] NULL,
 CONSTRAINT [PK_Tbl_PaymentReceipt] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Account]
) ON [FG_DIBN_DB_Account] TEXTIMAGE_ON [FG_DIBN_DB_Account]
GO
/****** Object:  Table [dbo].[Tbl_PaymentTransection]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_PaymentTransection](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[CompanyId] [int] NULL,
	[TransactionId] [nvarchar](500) NULL,
	[Amount] [nvarchar](50) NULL,
	[PaymentMode] [nvarchar](50) NULL,
	[Description] [nvarchar](max) NULL,
	[PaymentStatus] [nvarchar](50) NULL,
	[TransectionDate] [datetime2](7) NULL,
	[Quantity] [int] NULL,
	[TotalAmount] [nvarchar](50) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
 CONSTRAINT [PK_PaymentTransection] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Account]
) ON [FG_DIBN_DB_Account] TEXTIMAGE_ON [FG_DIBN_DB_Account]
GO
/****** Object:  Table [dbo].[Tbl_Permission]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Permission](
	[PermissionId] [int] IDENTITY(1,1) NOT NULL,
	[PermissionName] [nvarchar](50) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Permission] PRIMARY KEY CLUSTERED 
(
	[PermissionId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_PortalBalance]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_PortalBalance](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[CompanyId] [int] NULL,
	[BalanceAmount] [nvarchar](50) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[IsCompletelyUsed] [bit] NULL,
 CONSTRAINT [PK_Tbl_PortalBalanace] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Account]
) ON [FG_DIBN_DB_Account]
GO
/****** Object:  Table [dbo].[Tbl_PortalBalanceExpenses]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_PortalBalanceExpenses](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[TransactionId] [nvarchar](500) NULL,
	[ExpensesTitle] [nvarchar](max) NULL,
	[ExpensesAmount] [nvarchar](50) NULL,
	[Quantity] [int] NULL,
	[TotalAmount] [nvarchar](50) NULL,
	[Vat] [nvarchar](10) NULL,
	[VatAmount] [nvarchar](50) NULL,
	[GrandTotal] [nvarchar](50) NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[TransactionCreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_PortalBalanaceExpenses] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Account]
) ON [FG_DIBN_DB_Account] TEXTIMAGE_ON [FG_DIBN_DB_Account]
GO
/****** Object:  Table [dbo].[Tbl_RequestNotification]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_RequestNotification](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Type] [nvarchar](50) NULL,
	[RequestCreatedOn] [datetime2](7) NULL,
	[AssignedUserId] [int] NULL,
	[AssignedOn] [datetime2](7) NULL,
	[AssignedBy] [int] NULL,
	[SerialNumber] [nvarchar](100) NULL,
	[TrackingNumber] [nvarchar](100) NULL,
	[EnquiryNumber] [nvarchar](100) NULL,
	[Title] [nvarchar](max) NULL,
	[Description] [nvarchar](max) NULL,
	[ResponseType] [nvarchar](50) NULL,
	[ServiceCreatedBy] [int] NULL,
	[SupportTicketCreatedBy] [int] NULL,
	[ResponseCreatedBy] [int] NULL,
	[ServiceCreatedBySalesPerson] [int] NULL,
	[SupportTicketCreatedBySalesPerson] [int] NULL,
	[CompanyId] [int] NULL,
	[MarkAsRead] [bit] NULL,
	[AssignedUserMarkAsRead] [bit] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_RequestNotification] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_RMTeam]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_RMTeam](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Firstname] [nvarchar](250) NULL,
	[Lastname] [nvarchar](250) NULL,
	[EmailAddress] [nvarchar](250) NULL,
	[MobileCode] [nvarchar](100) NULL,
	[MobileNumber] [nvarchar](50) NULL,
	[CountryofResidence] [nvarchar](max) NULL,
	[Password] [nvarchar](max) NULL,
	[PassportNumber] [nvarchar](100) NULL,
	[PassportExpiryDate] [datetime2](7) NULL,
	[VisaExpiryDate] [datetime2](7) NULL,
	[Designation] [nvarchar](max) NULL,
	[InsuranceCompany] [nvarchar](max) NULL,
	[InsuranceExpiryDate] [datetime2](7) NULL,
	[IsLoginAllowed] [bit] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_RMTeam] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_RMTeam_Company_Mapping]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_RMTeam_Company_Mapping](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[RMTeamId] [int] NULL,
	[CompanyId] [int] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_RMTeam_Company_Mapping] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Role]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Role](
	[RoleID] [int] IDENTITY(1,1) NOT NULL,
	[RoleName] [nvarchar](50) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_Role] PRIMARY KEY CLUSTERED 
(
	[RoleID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_RolePermission]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_RolePermission](
	[RolePermissionId] [int] IDENTITY(1,1) NOT NULL,
	[RoleID] [int] NULL,
	[ModuleId] [int] NULL,
	[PermissionId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_RolePermission] PRIMARY KEY CLUSTERED 
(
	[RolePermissionId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_SalesPerson_Company_Mapping]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_SalesPerson_Company_Mapping](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[SalesPersonId] [int] NULL,
	[CompanyId] [int] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_SalesPerson_Company_Mapping] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_SalesPersons]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_SalesPersons](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FirstName] [nvarchar](100) NULL,
	[LastName] [nvarchar](100) NULL,
	[EmailId] [nvarchar](100) NULL,
	[MCode] [nvarchar](max) NULL,
	[PhoneNumber] [nvarchar](30) NULL,
	[CountryOfRecidence] [nvarchar](100) NULL,
	[PassportNumber] [nvarchar](max) NULL,
	[PassportExpiryDate] [datetime2](7) NULL,
	[Designation] [int] NULL,
	[VisaExpiryDate] [datetime2](7) NULL,
	[InsuranceCompany] [nvarchar](max) NULL,
	[InsuarnceExpiryDate] [datetime2](7) NULL,
	[IsLogin] [bit] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [nvarchar](500) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [nvarchar](max) NULL,
 CONSTRAINT [PK_Tbl_SalesPersons] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_Service]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_Service](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ServiceId] [int] NULL,
	[IsCompanyService] [bit] NULL,
	[IsEmployeeService] [bit] NULL,
	[AllowDisplay] [bit] NULL,
	[DisplayName] [nvarchar](max) NULL,
	[HasMultipleForms] [bit] NULL,
	[FormConstrains] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_Service] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ServiceFormDataField]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ServiceFormDataField](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ServiceId] [int] NULL,
	[FormId] [int] NULL,
	[FieldName] [nvarchar](max) NULL,
	[IsRequired] [bit] NULL,
	[IsRequiredMessage] [nvarchar](max) NULL,
	[IsDocumentUpload] [bit] NULL,
	[StepNumber] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_ServiceFormDataField] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ServiceFormFieldValue]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ServiceFormFieldValue](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ServiceId] [int] NULL,
	[FormId] [int] NULL,
	[FieldId] [int] NULL,
	[FieldValue] [nvarchar](max) NULL,
	[FileName] [nvarchar](max) NULL,
	[FieldFileValue] [varbinary](max) NULL,
	[CompanyId] [int] NULL,
	[UserId] [int] NULL,
	[SalesPersonId] [int] NULL,
	[RMTeamId] [int] NULL,
	[SerialNumber] [nvarchar](max) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_ServiceFormFieldValue] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ServiceForms]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ServiceForms](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[FormName] [nvarchar](max) NULL,
	[ServiceId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_ServiceForms] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ServiceRequest]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ServiceRequest](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[SerialNumber] [nvarchar](500) NULL,
	[ServiceId] [int] NULL,
	[FormId] [int] NULL,
	[CompanyId] [int] NULL,
	[UserId] [int] NULL,
	[SalesPersonId] [int] NULL,
	[RMTeamId] [int] NULL,
	[Title] [nvarchar](max) NULL,
	[Description] [nvarchar](max) NULL,
	[AssignedTo] [int] NULL,
	[Status] [int] NULL,
	[StepId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_ServiceRequest] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ServiceRequestDocument]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ServiceRequestDocument](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ServiceResponseId] [int] NULL,
	[FileName] [nvarchar](max) NULL,
	[DataBinary] [varbinary](max) NULL,
	[CompanyId] [int] NULL,
	[ServiceId] [int] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_ServiceRequestDocument] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service] TEXTIMAGE_ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ServiceRequestStatus]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ServiceRequestStatus](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Status] [nvarchar](50) NULL,
	[DisplayId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_ServiceRequestStatus] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Table [dbo].[Tbl_ShareholderDocuments]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ShareholderDocuments](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[Title] [nvarchar](max) NULL,
	[FileName] [nvarchar](100) NULL,
	[Extension] [nvarchar](50) NULL,
	[DataBinary] [varbinary](max) NULL,
	[ShareholderId] [int] NULL,
	[CompanyId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_ShareholderDocuments] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_ShareholdersOrDirectors]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_ShareholdersOrDirectors](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[FirstName] [nvarchar](100) NULL,
	[LastName] [nvarchar](100) NULL,
	[Passport_Number] [nvarchar](max) NULL,
	[PassportExpiryDate] [datetime2](7) NULL,
	[Nationality] [nvarchar](100) NULL,
	[Designation] [nvarchar](100) NULL,
	[VisaExpiryDate] [datetime2](7) NULL,
	[InsuranceCompany] [nvarchar](max) NULL,
	[InsuranceExpiryDate] [datetime2](7) NULL,
	[SharePercentage] [nvarchar](50) NULL,
	[CompanyId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_ShareholdersOrDirectors] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_SupportTicket]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_SupportTicket](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[UserId] [int] NULL,
	[SalesPersonId] [int] NULL,
	[TrackingNumber] [nvarchar](500) NULL,
	[Title] [nvarchar](max) NULL,
	[Description] [nvarchar](max) NULL,
	[TicketStatus] [int] NULL,
	[ParentId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_SupportTicket] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_SupportTicket]
) ON [FG_DIBN_DB_SupportTicket] TEXTIMAGE_ON [FG_DIBN_DB_SupportTicket]
GO
/****** Object:  Table [dbo].[Tbl_SupportTicketDocument]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_SupportTicketDocument](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[FileName] [nvarchar](max) NULL,
	[Extension] [nvarchar](max) NULL,
	[DataBinary] [varbinary](max) NULL,
	[TicketId] [nvarchar](500) NULL,
	[ReplyId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_SupportTicketDocument] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_SupportTicket]
) ON [FG_DIBN_DB_SupportTicket] TEXTIMAGE_ON [FG_DIBN_DB_SupportTicket]
GO
/****** Object:  Table [dbo].[Tbl_TempAccountManagement]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_TempAccountManagement](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[CompanyId] [int] NULL,
	[TransactionId] [nvarchar](100) NULL,
	[TransactionIdNo] [int] NULL,
	[Description] [nvarchar](max) NULL,
	[Amount] [decimal](18, 2) NULL,
	[Quantity] [int] NULL,
	[TotalAmount] [decimal](18, 2) NULL,
	[Vat] [decimal](18, 2) NULL,
	[VatAmount] [decimal](18, 2) NULL,
	[GrandTotal] [decimal](18, 2) NULL,
	[EntryType] [nvarchar](50) NULL,
	[PaymentMode] [nvarchar](50) NULL,
	[TransactionDate] [datetime2](7) NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[IsApproved] [bit] NULL,
	[ApprovedBy] [int] NULL,
	[ApprovedOnUtc] [datetime2](7) NULL,
	[IsRejected] [bit] NULL,
	[RejectedBy] [int] NULL,
	[RejectedOnUtc] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_TempAccountManagement] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_TemporaryAccountManagementLog]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_TemporaryAccountManagementLog](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[TransactionId] [nvarchar](50) NULL,
	[TransactionDate] [datetime2](7) NULL,
	[CompanyId] [int] NULL,
	[Description] [nvarchar](max) NULL,
	[EntryType] [nvarchar](50) NULL,
	[Amount] [decimal](18, 2) NULL,
	[Quantity] [int] NULL,
	[TotalAmount] [decimal](18, 2) NULL,
	[Vat] [decimal](18, 2) NULL,
	[VatAmount] [decimal](18, 2) NULL,
	[GrandTotal] [decimal](18, 2) NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[IsApproved] [bit] NULL,
	[ApprovedBy] [int] NULL,
	[ApprovedOn] [datetime2](7) NULL,
	[IsRejected] [bit] NULL,
	[RejectedBy] [int] NULL,
	[RejectedOn] [datetime2](7) NULL,
	[IsDelete] [bit] NULL,
 CONSTRAINT [PK_Tbl_TemporaryAccountManagementLog] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_User]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_User](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[AccountNumber] [nvarchar](500) NULL,
	[FirstName] [nvarchar](100) NULL,
	[LastName] [nvarchar](100) NULL,
	[Nationality] [nvarchar](50) NULL,
	[EmailID] [nvarchar](max) NULL,
	[MCode] [nvarchar](50) NULL,
	[PhoneNumber] [nvarchar](30) NULL,
	[CountryOfRecidence] [nvarchar](100) NULL,
	[TelephoneNumber] [nvarchar](50) NULL,
	[PassportNumber] [nvarchar](max) NULL,
	[PassportExpiryDate] [datetime2](7) NULL,
	[Designation] [nvarchar](max) NULL,
	[VisaExpiryDate] [datetime2](7) NULL,
	[InsuranceCompany] [nvarchar](max) NULL,
	[InsuranceExpiryDate] [datetime2](7) NULL,
	[EmployeementCardExpiryDate] [datetime2](7) NULL,
	[IsLogin] [bit] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOnUTC] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOnUTC] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_User] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_User_Role_Mapping]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_User_Role_Mapping](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[RoleID] [int] NULL,
	[UserId] [int] NULL,
	[IsDelete] [bit] NULL,
	[CreatedOnUtc] [datetime2](7) NULL,
	[CreatedBy] [int] NULL,
	[ModifyOnUtc] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
 CONSTRAINT [PK_Tbl_User_Role_Mapping] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tbl_UserPermission]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tbl_UserPermission](
	[UserPermissionId] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [int] NULL,
	[ModuleId] [int] NULL,
	[PermissionId] [int] NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
 CONSTRAINT [PK_Tbl_UserPermission] PRIMARY KEY CLUSTERED 
(
	[UserPermissionId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [History].[Tbl_CompanyHistory]    Script Date: 30-10-2024 15:05:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [History].[Tbl_CompanyHistory](
	[Id] [int] NOT NULL,
	[AccountNumber] [nvarchar](100) NULL,
	[DibnUserNumber] [nvarchar](max) NULL,
	[CompanyName] [nvarchar](max) NULL,
	[ShareCapital] [nvarchar](50) NULL,
	[CompanyRegistrationNumber] [nvarchar](100) NULL,
	[MCountryCode] [nvarchar](max) NULL,
	[MobileNumber] [nvarchar](max) NULL,
	[ECountryCode] [nvarchar](max) NULL,
	[EmergencyNumber] [nvarchar](max) NULL,
	[EmailID] [nvarchar](max) NULL,
	[SecondEmailID] [nvarchar](max) NULL,
	[CompanyType] [nvarchar](max) NULL,
	[LicenseType] [nvarchar](50) NULL,
	[LicenseStatus] [nvarchar](50) NULL,
	[LicenseIssueDate] [datetime2](7) NULL,
	[LicenseExpiryDate] [datetime2](7) NULL,
	[LeaseFacilityType] [nvarchar](50) NULL,
	[LeaseStartDate] [datetime2](7) NULL,
	[LeaseExpiryDate] [datetime2](7) NULL,
	[LeaseStatus] [nvarchar](50) NULL,
	[CompanyStartingDate] [datetime2](7) NULL,
	[City] [nvarchar](100) NULL,
	[Country] [nvarchar](100) NULL,
	[UnitLocation] [nvarchar](max) NULL,
	[Cmp_Pass] [nvarchar](max) NULL,
	[IsTRN] [bit] NULL,
	[TRN] [nvarchar](100) NULL,
	[TRNCreationDate] [datetime2](7) NULL,
	[LabourFileNo] [nvarchar](200) NULL,
	[IsActive] [bit] NULL,
	[IsDelete] [bit] NULL,
	[CreatedBy] [int] NULL,
	[CreatedOn] [datetime2](7) NULL,
	[ModifyBy] [int] NULL,
	[ModifyOn] [datetime2](7) NULL,
	[ValidFrom] [datetime2](7) NOT NULL,
	[ValidTo] [datetime2](7) NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
WITH
(
DATA_COMPRESSION = PAGE
)
GO
/****** Object:  Index [ix_InsurancePolicy]    Script Date: 30-10-2024 15:05:50 ******/
CREATE CLUSTERED INDEX [ix_InsurancePolicy] ON [History].[Tbl_CompanyHistory]
(
	[ValidTo] ASC,
	[ValidFrom] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF, DATA_COMPRESSION = PAGE) ON [PRIMARY]
GO
SET IDENTITY_INSERT [dbo].[Tbl_AssignServiceRequest] ON 
GO
INSERT [dbo].[Tbl_AssignServiceRequest] ([Id], [UserId], [ServiceId], [SerialNumber], [CreatedBy], [CreatedOn], [MarkAsRead]) VALUES (1, 6, 1, N'SR101', 2, CAST(N'2024-10-16T13:33:06.7669179' AS DateTime2), 0)
GO
INSERT [dbo].[Tbl_AssignServiceRequest] ([Id], [UserId], [ServiceId], [SerialNumber], [CreatedBy], [CreatedOn], [MarkAsRead]) VALUES (2, 6, 93, N'SR102', 2, CAST(N'2024-10-16T13:33:15.0324254' AS DateTime2), 0)
GO
SET IDENTITY_INSERT [dbo].[Tbl_AssignServiceRequest] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Company] ON 
GO
INSERT [dbo].[Tbl_Company] ([Id], [AccountNumber], [DibnUserNumber], [CompanyName], [ShareCapital], [CompanyRegistrationNumber], [MCountryCode], [MobileNumber], [ECountryCode], [EmergencyNumber], [EmailID], [SecondEmailID], [CompanyType], [LicenseType], [LicenseStatus], [LicenseIssueDate], [LicenseExpiryDate], [LeaseFacilityType], [LeaseStartDate], [LeaseExpiryDate], [LeaseStatus], [CompanyStartingDate], [City], [Country], [UnitLocation], [Cmp_Pass], [IsTRN], [TRN], [TRNCreationDate], [IsCorportaeText], [CorporateText], [SubCompanyType], [CompanySubTypeUpdated], [LabourFileNo], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn], [ValidFrom], [ValidTo]) VALUES (1, N'DIBN101', N'DCS1', N'DIBN', N'AED 450,000.0', N'DIBN1901', NULL, N'7894561230', NULL, N'12136120021', N'dibn.info@gmail.com', N'dibn.support@gmail.com', NULL, N'Trading', N'Active', CAST(N'2020-12-30T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-01T00:00:00.0000000' AS DateTime2), N'Trading', CAST(N'2021-12-01T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-01T00:00:00.0000000' AS DateTime2), N'Active', NULL, NULL, NULL, N'Dubai', N'FhBrFTcYJX6rmTFnPLGPpG73EA2TdZjSN52Jvt6MYWI=', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 0, NULL, CAST(N'2022-01-13T07:51:00.9466667' AS DateTime2), NULL, CAST(N'2022-01-13T07:51:00.9466667' AS DateTime2), CAST(N'2024-09-30T07:10:01.7464311' AS DateTime2), CAST(N'9999-12-31T23:59:59.9999999' AS DateTime2))
GO
INSERT [dbo].[Tbl_Company] ([Id], [AccountNumber], [DibnUserNumber], [CompanyName], [ShareCapital], [CompanyRegistrationNumber], [MCountryCode], [MobileNumber], [ECountryCode], [EmergencyNumber], [EmailID], [SecondEmailID], [CompanyType], [LicenseType], [LicenseStatus], [LicenseIssueDate], [LicenseExpiryDate], [LeaseFacilityType], [LeaseStartDate], [LeaseExpiryDate], [LeaseStatus], [CompanyStartingDate], [City], [Country], [UnitLocation], [Cmp_Pass], [IsTRN], [TRN], [TRNCreationDate], [IsCorportaeText], [CorporateText], [SubCompanyType], [CompanySubTypeUpdated], [LabourFileNo], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn], [ValidFrom], [ValidTo]) VALUES (2763, N'DIBN102', N'DIBN3', N'The Bridge Code', NULL, NULL, NULL, N'N/A', NULL, NULL, NULL, NULL, N'Dubai Mainland', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), N'N/A', NULL, NULL, N'', NULL, NULL, NULL, NULL, NULL, N'Dubai Mainland', CAST(N'2024-10-11T17:56:44.2965124' AS DateTime2), NULL, 1, 0, 2, CAST(N'2024-10-11T17:56:44.2912989' AS DateTime2), 2, CAST(N'2024-10-11T17:57:37.6287715' AS DateTime2), CAST(N'2024-10-11T13:56:44.2922989' AS DateTime2), CAST(N'9999-12-31T23:59:59.9999999' AS DateTime2))
GO
SET IDENTITY_INSERT [dbo].[Tbl_Company] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Company_User_Mapping] ON 
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (1, 1, 1, 0, 1, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (2, 1, 2, 0, 1, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (4, 2763, 4, 0, 2, CAST(N'2024-10-11T17:56:44.2942991' AS DateTime2), 2, CAST(N'2024-10-30T11:20:49.8834296' AS DateTime2))
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (5, 2763, 5, 0, 2, CAST(N'2024-10-11T17:58:27.0545456' AS DateTime2), 2, CAST(N'2024-10-30T11:21:00.7270990' AS DateTime2))
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (6, 1, 6, 0, 2, CAST(N'2024-10-16T13:31:57.5804405' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (10, 0, 7, 0, 2, CAST(N'2024-10-30T10:37:54.7433820' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (14, 0, 8, 0, 2, CAST(N'2024-10-30T10:53:06.1573479' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (18, 0, 9, 0, 2, CAST(N'2024-10-30T11:02:07.3557134' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (20, 0, 10, 0, 2, CAST(N'2024-10-30T11:05:53.5412062' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_Company_User_Mapping] ([Id], [CompanyId], [UserId], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (22, 0, 11, 0, 2, CAST(N'2024-10-30T11:09:32.6856848' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_Company_User_Mapping] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanyDocumentType] ON 
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (1, N'Trade License/Incorporation Certificate', 1, 0, NULL, CAST(N'2022-02-07T11:56:31.3866667' AS DateTime2), NULL, CAST(N'2022-02-07T11:56:31.3866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (2, N'Trade Name Reservation Certificate', 1, 0, NULL, CAST(N'2022-02-07T12:15:07.3700000' AS DateTime2), NULL, CAST(N'2022-02-07T12:15:07.3700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (3, N'Initial Approval Certificate', 1, 0, NULL, CAST(N'2022-02-07T12:16:28.5800000' AS DateTime2), NULL, CAST(N'2022-02-07T12:16:28.5800000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (4, N'Share Certificate', 1, 0, NULL, CAST(N'2022-02-07T12:16:38.6933333' AS DateTime2), NULL, CAST(N'2022-02-07T12:16:38.6933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (5, N'Certificate of Good Standing', 1, 0, NULL, CAST(N'2022-02-07T12:16:46.9333333' AS DateTime2), NULL, CAST(N'2022-02-07T12:16:46.9333333' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (6, N'Partnership - Civil Agreement', 1, 0, NULL, CAST(N'2022-02-07T12:16:54.2566667' AS DateTime2), NULL, CAST(N'2022-02-07T12:16:54.2566667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (7, N'Local Service Agent Agreement-LSA', 1, 0, NULL, CAST(N'2022-02-07T12:16:59.9600000' AS DateTime2), NULL, CAST(N'2022-02-07T12:16:59.9600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (8, N'Memorandum of Association', 1, 0, NULL, CAST(N'2022-02-07T12:17:06.5233333' AS DateTime2), 317, CAST(N'2023-12-15T10:37:16.1334753' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (9, N'Article of Association', 1, 0, NULL, CAST(N'2022-02-07T12:17:12.9800000' AS DateTime2), NULL, CAST(N'2022-02-07T12:17:12.9800000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (10, N'Establishment Card(Immigration Card)', 1, 0, NULL, CAST(N'2022-02-07T12:17:22.7700000' AS DateTime2), NULL, CAST(N'2022-02-07T12:17:22.7700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (11, N'Ministry of Labour File', 1, 0, NULL, CAST(N'2022-02-07T12:18:11.0066667' AS DateTime2), NULL, CAST(N'2022-02-07T12:18:11.0066667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (12, N'Certificate of VAT', 1, 0, NULL, CAST(N'2022-02-07T12:18:19.7200000' AS DateTime2), NULL, CAST(N'2022-02-07T12:18:19.7200000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (13, N'Office Lease Agreement(Flexi Desk)', 1, 0, NULL, CAST(N'2022-02-07T12:18:25.7066667' AS DateTime2), NULL, CAST(N'2022-02-07T12:18:25.7066667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (15, N'Ejari Certificate', 1, 0, NULL, CAST(N'2022-02-07T12:19:32.8233333' AS DateTime2), NULL, CAST(N'2022-02-07T12:19:32.8233333' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (16, N'Membership Certificate', 1, 0, 317, CAST(N'2023-03-23T10:36:41.1888169' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (17, N'Incumbency Certificate ', 1, 0, 317, CAST(N'2023-03-23T11:06:22.5710262' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (18, N'Company certificate of formation ', 1, 0, 317, CAST(N'2023-07-31T18:11:56.2128298' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (19, N'SIRA Govt. NOC', 1, 0, 317, CAST(N'2024-01-02T13:37:44.7731566' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (20, N'Real Estate Office Registration Certificate ', 1, 0, 317, CAST(N'2024-01-02T20:29:55.6242643' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (21, N'Other Document ', 1, 0, 317, CAST(N'2024-01-04T19:04:37.4055778' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (22, N'VAT Registration Certificate', 1, 0, 317, CAST(N'2024-01-04T19:31:47.0335613' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (23, N'Liquidation Certificate', 1, 0, 317, CAST(N'2024-01-11T14:50:26.1258137' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (24, N'E - signature', 1, 0, 317, CAST(N'2024-01-11T20:34:54.9561986' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyDocumentType] ([ID], [Name], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (25, N'TESTING DOCUMENT TYPE', 1, 0, 285, CAST(N'2024-09-30T13:43:16.8129654' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanyDocumentType] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanyInvoiceDetail] ON 
GO
INSERT [dbo].[Tbl_CompanyInvoiceDetail] ([Id], [ProductName], [Quantity], [Amount], [TotalAmount], [Vat], [VatAmount], [GrandTotal], [InvoiceNumber], [CompanyId], [Services], [IsActive], [IsDelete], [InvoiceCreatedOn], [Currency], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1, N'TEST', 1, CAST(100.00 AS Decimal(18, 2)), CAST(100.00 AS Decimal(18, 2)), CAST(0.00 AS Decimal(18, 2)), CAST(0.00 AS Decimal(18, 2)), CAST(100.00 AS Decimal(18, 2)), N'DIBN101', 2763, N'TEST', 1, 0, CAST(N'2024-10-01T00:00:00.0000000' AS DateTime2), N'AED', CAST(N'2024-10-11T17:59:26.4789890' AS DateTime2), 2, NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanyInvoiceDetail] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanyServices] ON 
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (1, NULL, 0, N'Dubai Mainland', N'Licensing Services ', 1, 0, NULL, CAST(N'2022-03-05T06:26:25.9133333' AS DateTime2), 2170, CAST(N'2023-10-10T18:26:57.7029798' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (2, NULL, 1, N'Dubai Mainland', N'Renewal of License', 1, 0, NULL, CAST(N'2022-03-05T06:26:57.1300000' AS DateTime2), 2170, CAST(N'2023-10-10T18:27:34.9370288' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (3, NULL, 1, N'Dubai Mainland', N'Change Location', 1, 0, NULL, CAST(N'2022-03-05T06:27:04.7400000' AS DateTime2), NULL, CAST(N'2022-04-05T11:06:09.8746453' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (4, NULL, 1, N'Dubai Mainland', N'Renewal of License with Location change ', 1, 0, NULL, CAST(N'2022-03-05T06:27:26.2933333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (5, NULL, 1, N'Dubai Mainland', N'Cancellation Of License (Company Closure)', 1, 0, NULL, CAST(N'2022-03-05T06:27:39.1100000' AS DateTime2), NULL, CAST(N'2022-05-12T09:35:45.4501136' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (6, NULL, 1, N'Dubai Mainland', N'Renewal of License with Add Shareholder', 1, 0, NULL, CAST(N'2022-03-05T06:28:09.4800000' AS DateTime2), NULL, CAST(N'2022-04-06T11:54:35.4553607' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (7, NULL, 1, N'Dubai Mainland', N'Renewal of License with Remove Shareholder', 1, 0, NULL, CAST(N'2022-03-05T06:28:32.7533333' AS DateTime2), NULL, CAST(N'2022-04-06T11:54:43.8619473' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (8, NULL, 1, N'Dubai Mainland', N'Renewal of License with Change Shareholder', 1, 0, NULL, CAST(N'2022-03-05T06:29:10.8766667' AS DateTime2), 2170, CAST(N'2023-10-10T18:26:23.0941116' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (9, NULL, 1, N'Dubai Mainland', N'Freezing License', 1, 0, NULL, CAST(N'2022-03-05T06:29:24.6066667' AS DateTime2), NULL, CAST(N'2022-05-12T09:36:30.1657624' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (10, NULL, 0, N'Dubai Mainland', N'Company Amendment Services ', 1, 0, NULL, CAST(N'2022-03-05T06:29:38.9366667' AS DateTime2), NULL, CAST(N'2022-03-14T06:36:10.0100000' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (11, NULL, 10, N'Dubai Mainland', N'Update (Addition) Shareholder & Share transfer', 1, 0, NULL, CAST(N'2022-03-05T06:30:46.6500000' AS DateTime2), NULL, CAST(N'2022-04-06T11:55:12.1967821' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (12, NULL, 10, N'Dubai Mainland', N'Update (Change) Shareholder & Share transfer', 1, 0, NULL, CAST(N'2022-03-05T06:31:02.3200000' AS DateTime2), NULL, CAST(N'2022-04-06T11:55:27.6880673' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (13, NULL, 10, N'Dubai Mainland', N'Update (Removal) Shareholder & Share transfer', 1, 0, NULL, CAST(N'2022-03-05T06:31:22.7533333' AS DateTime2), NULL, CAST(N'2022-04-06T11:55:41.7802671' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (14, NULL, 10, N'Dubai Mainland', N'Update (Addition) Manager', 1, 0, NULL, CAST(N'2022-03-05T06:39:27.5500000' AS DateTime2), NULL, CAST(N'2022-04-06T11:56:01.0065255' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (15, NULL, 10, N'Dubai Mainland', N'Update (Change) Manager', 1, 0, NULL, CAST(N'2022-03-05T06:39:38.4666667' AS DateTime2), NULL, CAST(N'2022-04-06T11:56:14.1179099' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (16, NULL, 10, N'Dubai Mainland', N'Update (Remove) Manager', 1, 0, NULL, CAST(N'2022-03-05T06:39:50.8033333' AS DateTime2), NULL, CAST(N'2022-04-06T11:56:24.7200451' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (17, NULL, 10, N'Dubai Mainland', N'Update (Change-Removal-Addition)Activity in License', 1, 0, NULL, CAST(N'2022-03-05T06:40:11.6000000' AS DateTime2), NULL, CAST(N'2022-03-26T12:25:35.5166667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (18, NULL, 10, N'Dubai Mainland', N'Update (Change) Activity in License ', 1, 1, NULL, CAST(N'2022-03-05T06:40:23.1200000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (19, NULL, 10, N'Dubai Mainland', N'Update (Removal) Activity in License ', 1, 1, NULL, CAST(N'2022-03-05T06:40:38.8733333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (20, NULL, 10, N'Dubai Mainland', N'Update Contact Details on License', 1, 0, NULL, CAST(N'2022-03-05T06:40:49.2800000' AS DateTime2), NULL, CAST(N'2022-03-26T14:08:09.8633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (21, NULL, 10, N'Dubai Mainland', N'Change Company Name ', 1, 0, NULL, CAST(N'2022-03-05T06:40:57.2800000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (22, NULL, 10, N'Dubai Mainland', N'Change Share Capital', 1, 0, NULL, CAST(N'2022-03-05T06:41:07.8066667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (23, NULL, 0, N'Dubai Mainland', N'Establishment Card ', 1, 0, NULL, CAST(N'2022-03-05T06:41:18.9466667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (24, NULL, 23, N'Dubai Mainland', N'Apply New Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-05T06:41:40.5566667' AS DateTime2), NULL, CAST(N'2022-04-06T11:56:45.3211228' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (25, NULL, 23, N'Dubai Mainland', N'Add Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-05T06:41:54.7500000' AS DateTime2), NULL, CAST(N'2022-04-06T11:57:02.4932856' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (26, NULL, 23, N'Dubai Mainland', N' Renew Establishment card (Immigration)', 1, 1, NULL, CAST(N'2022-03-05T06:42:08.6733333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (27, NULL, 23, N'Dubai Mainland', N'Modification Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-05T06:42:26.2200000' AS DateTime2), NULL, CAST(N'2022-04-06T11:57:18.2991544' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (28, NULL, 23, N'Dubai Mainland', N'Remove Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-05T06:42:43.0000000' AS DateTime2), NULL, CAST(N'2022-04-06T11:57:31.7481996' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (29, NULL, 23, N'Dubai Mainland', N'Cancel Establishment card (Immigration) ', 1, 0, NULL, CAST(N'2022-03-05T06:42:53.8833333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (30, NULL, 23, N'Dubai Mainland', N'Apply New Establishment card (Mohre)', 1, 0, NULL, CAST(N'2022-03-05T06:43:36.6766667' AS DateTime2), NULL, CAST(N'2022-04-06T11:57:44.7994920' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (31, NULL, 23, N'Dubai Mainland', N'Add Establishment card (Mohre)', 1, 0, NULL, CAST(N'2022-03-05T06:43:47.5600000' AS DateTime2), NULL, CAST(N'2022-04-06T11:57:56.6023453' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (32, NULL, 23, N'Dubai Mainland', N'Renew Establishment card (Mohre)', 1, 1, NULL, CAST(N'2022-03-05T06:44:05.7666667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (33, NULL, 23, N'Dubai Mainland', N'Modification Establishment card (Mohre)', 1, 0, NULL, CAST(N'2022-03-05T06:44:21.7766667' AS DateTime2), NULL, CAST(N'2022-04-06T11:58:09.0059522' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (34, NULL, 23, N'Dubai Mainland', N'Remove Establishment card (Mohre)', 1, 0, NULL, CAST(N'2022-03-05T06:44:34.5866667' AS DateTime2), NULL, CAST(N'2022-04-06T11:58:23.5301723' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (35, NULL, 23, N'Dubai Mainland', N'Cancel Establishment card (Mohre) ', 1, 0, NULL, CAST(N'2022-03-05T06:44:45.5900000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (36, NULL, 23, N'Dubai Mainland', N'Apply New E -Signature Card', 1, 0, NULL, CAST(N'2022-03-05T06:45:01.2666667' AS DateTime2), NULL, CAST(N'2022-04-06T11:58:36.7220981' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (37, NULL, 23, N'Dubai Mainland', N'Add E -Signature Card', 1, 0, NULL, CAST(N'2022-03-05T06:45:16.6666667' AS DateTime2), NULL, CAST(N'2022-04-06T11:58:48.8839772' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (38, NULL, 23, N'Dubai Mainland', N'Renew  E -Signature Card', 1, 0, NULL, CAST(N'2022-03-05T06:45:35.8200000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (39, NULL, 23, N'Dubai Mainland', N' Modification  E -Signature Card', 1, 0, NULL, CAST(N'2022-03-05T06:45:56.2400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (40, NULL, 23, N'Dubai Mainland', N'Remove E -Signature Card', 1, 0, NULL, CAST(N'2022-03-05T06:46:13.6766667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (41, NULL, 23, N'Dubai Mainland', N'Issue PRO Card ', 1, 0, NULL, CAST(N'2022-03-05T06:46:25.4400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (42, NULL, 23, N'Dubai Mainland', N'Renew PRO Card', 1, 0, NULL, CAST(N'2022-03-05T06:46:34.2533333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (43, NULL, 0, N'Dubai Mainland', N'Ministry of human Resources Services (Mohre)', 1, 0, NULL, CAST(N'2022-03-05T06:46:47.9366667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (44, NULL, 43, N'Dubai Mainland', N'Quota Apply ', 1, 0, NULL, CAST(N'2022-03-05T06:46:57.0133333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (45, NULL, 43, N'Dubai Mainland', N'License information Update ', 1, 0, NULL, CAST(N'2022-03-05T06:47:09.4300000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (46, NULL, 43, N'Dubai Mainland', N'Open Personal File of Shareholder', 1, 0, NULL, CAST(N'2022-03-05T06:47:21.0233333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (47, NULL, 43, N'Dubai Mainland', N'WPS Registration ', 1, 0, NULL, CAST(N'2022-03-05T06:47:29.7866667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (48, NULL, 0, N'Dubai Mainland', N'Refund Services (Guarantees)', 1, 0, NULL, CAST(N'2022-03-05T06:47:50.0233333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (49, NULL, 48, N'Dubai Mainland', N'Apply for Refund (Immigration)', 1, 0, NULL, CAST(N'2022-03-05T06:47:59.8366667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (50, NULL, 48, N'Dubai Mainland', N'Apply for Refund (Mohre)', 1, 0, NULL, CAST(N'2022-03-05T06:48:08.0300000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (51, NULL, 0, N'Dubai Mainland', N'Federal Tax Services ', 1, 0, NULL, CAST(N'2022-03-05T06:48:21.3600000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (52, NULL, 51, N'Dubai Mainland', N'Registration of VAT', 1, 0, NULL, CAST(N'2022-03-05T06:48:33.0000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (53, NULL, 51, N'Dubai Mainland', N'Deregistration of VAT', 1, 0, NULL, CAST(N'2022-03-05T06:48:42.2466667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (54, NULL, 51, N'Dubai Mainland', N'Registration of Excise', 1, 0, NULL, CAST(N'2022-03-05T06:48:50.9366667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (55, NULL, 51, N'Dubai Mainland', N'Deregistration of Excise', 1, 0, NULL, CAST(N'2022-03-05T06:48:58.9033333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (56, NULL, 0, N'Dubai Mainland', N'Other Services ', 1, 0, NULL, CAST(N'2022-03-05T06:49:06.9266667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (57, NULL, 56, N'Dubai Mainland', N'Corporate Bank Account ', 1, 0, NULL, CAST(N'2022-03-05T06:49:17.2100000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (58, NULL, 56, N'Dubai Mainland', N'Import/Export Code ', 1, 0, NULL, CAST(N'2022-03-05T06:49:26.2866667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (59, NULL, 56, N'Dubai Mainland', N'Power of Attorney ', 1, 0, NULL, CAST(N'2022-03-05T06:49:37.2566667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (60, NULL, 56, N'Dubai Mainland', N'NOC of UAE National (sponsor)', 1, 0, NULL, CAST(N'2022-03-05T06:49:48.9133333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (61, NULL, 1, N'Freezone', N'Renewal of License ', 1, 0, NULL, CAST(N'2022-03-14T06:22:26.7700000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (62, NULL, 1, N'Freezone', N'Change Location ', 1, 0, NULL, CAST(N'2022-03-14T06:22:36.3600000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (63, NULL, 1, N'Freezone', N'Renewal of License with Location change ', 1, 0, NULL, CAST(N'2022-03-14T06:22:54.7000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (64, NULL, 1, N'Freezone', N'Good Standing Certificate ', 1, 0, NULL, CAST(N'2022-03-14T06:23:31.6433333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (65, NULL, 1, N'Freezone', N' Incumbancy Certificate ', 1, 0, NULL, CAST(N'2022-03-14T06:23:41.2900000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (66, NULL, 1, N'Freezone', N' Share certificate ', 1, 0, NULL, CAST(N'2022-03-14T06:23:57.0600000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (67, NULL, 1, N'Freezone', N'Cancellation Of License (Company Closure)', 1, 0, NULL, CAST(N'2022-03-14T06:24:05.3966667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (68, NULL, 1, N'Freezone', N'Renewal of License with Add Shareholder', 1, 0, NULL, CAST(N'2022-03-14T06:30:10.9566667' AS DateTime2), NULL, CAST(N'2022-03-14T10:43:51.1466667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (69, NULL, 1, N'Freezone', N'Freezing License', 1, 0, NULL, CAST(N'2022-03-14T06:34:56.7133333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (70, NULL, 10, N'Freezone', N'Update (Change) Shareholder & Share transfer', 1, 0, NULL, CAST(N'2022-03-14T06:36:58.0600000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (71, NULL, 10, N'Freezone', N'Update (Removal) Shareholder & Share transfer', 1, 0, NULL, CAST(N'2022-03-14T06:37:13.7433333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (72, NULL, 10, N'Freezone', N'Update (Addition) Shareholder & Share transfer', 1, 0, NULL, CAST(N'2022-03-14T06:37:25.1200000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (73, NULL, 10, N'Freezone', N'Update (Change) Manager', 1, 0, NULL, CAST(N'2022-03-14T06:37:39.0900000' AS DateTime2), NULL, CAST(N'2022-04-11T12:34:39.2816599' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (74, NULL, 10, N'Freezone', N'Update (Removal) Manager', 1, 0, NULL, CAST(N'2022-03-14T06:37:54.6000000' AS DateTime2), NULL, CAST(N'2022-04-11T12:34:53.2370280' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (75, NULL, 10, N'Freezone', N'Update (Addition) Manager', 1, 0, NULL, CAST(N'2022-03-14T06:38:05.2200000' AS DateTime2), NULL, CAST(N'2022-04-11T12:34:24.0159760' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (76, NULL, 10, N'Freezone', N'Update (Change)Activity in License', 1, 0, NULL, CAST(N'2022-03-14T06:38:19.8666667' AS DateTime2), NULL, CAST(N'2022-04-11T12:35:20.1305978' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (77, NULL, 10, N'Freezone', N'Update (Removal)Activity in License', 1, 0, NULL, CAST(N'2022-03-14T06:38:37.2833333' AS DateTime2), NULL, CAST(N'2022-04-11T12:35:31.3958842' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (78, NULL, 10, N'Freezone', N'Update (Addition)Activity in License', 1, 0, NULL, CAST(N'2022-03-14T06:38:46.3700000' AS DateTime2), NULL, CAST(N'2022-04-11T12:35:05.3931257' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (79, NULL, 10, N'Freezone', N'Update Contact Details ', 1, 0, NULL, CAST(N'2022-03-14T06:39:01.5233333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (80, NULL, 10, N'Freezone', N'Change Company Name ', 1, 0, NULL, CAST(N'2022-03-14T06:39:08.8566667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (81, NULL, 10, N'Freezone', N'Change Share Capital', 1, 0, NULL, CAST(N'2022-03-14T06:39:18.4900000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (82, NULL, 23, N'Freezone', N'Apply New Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-14T06:39:45.0633333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (83, NULL, 23, N'Freezone', N'Renew Establishment card (Immigration)', 1, 1, NULL, CAST(N'2022-03-14T06:40:01.3400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (84, NULL, 23, N'Freezone', N'Add  Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-14T06:40:19.7066667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (85, NULL, 23, N'Freezone', N'Remove Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-14T06:40:40.2400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (86, NULL, 23, N'Freezone', N'Modification  Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-03-14T06:40:53.7300000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (87, NULL, 23, N'Freezone', N'Cancel Establishment card (Immigration) ', 1, 0, NULL, CAST(N'2022-03-14T06:41:18.2433333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (88, NULL, 0, N'Freezone', N'E channel Services ', 1, 0, NULL, CAST(N'2022-03-14T06:41:41.6500000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (89, NULL, 88, N'Freezone', N'Apply E channel Services', 1, 0, NULL, CAST(N'2022-03-14T06:41:55.7333333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (90, NULL, 88, N'Freezone', N'Renew E channel ', 1, 0, NULL, CAST(N'2022-03-14T06:42:05.4933333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (91, NULL, 48, N'Freezone', N'Apply for Refund (Immigration)', 1, 0, NULL, CAST(N'2022-03-14T06:42:24.1500000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (92, NULL, 48, N'Freezone', N'Apply for E channel Refund ', 1, 0, NULL, CAST(N'2022-03-14T06:42:34.3300000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (93, NULL, 51, N'Freezone', N'Registration of VAT', 1, 0, NULL, CAST(N'2022-03-14T06:42:45.6866667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (94, NULL, 51, N'Freezone', N'Deregistration of VAT', 1, 0, NULL, CAST(N'2022-03-14T06:42:58.4900000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (95, NULL, 51, N'Freezone', N'Registration of Excise', 1, 0, NULL, CAST(N'2022-03-14T06:43:07.3133333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (96, NULL, 51, N'Freezone', N'Deregistration of Excise', 1, 0, NULL, CAST(N'2022-03-14T06:43:19.1200000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (97, NULL, 56, N'Freezone', N'Corporate Bank Account ', 1, 0, NULL, CAST(N'2022-03-14T06:43:29.2000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (98, NULL, 56, N'Freezone', N'Import/Export Code ', 1, 0, NULL, CAST(N'2022-03-14T06:43:38.5100000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (99, NULL, 56, N'Freezone', N'Power of Attorney ', 1, 0, NULL, CAST(N'2022-03-14T06:43:51.6466667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (100, NULL, 56, N'Freezone', N'Authorisation letter ', 1, 0, NULL, CAST(N'2022-03-14T06:44:01.4033333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (101, NULL, 1, N'Freezone', N'Renewal of License with Remove Shareholder', 1, 1, NULL, CAST(N'2022-03-14T10:44:14.1933333' AS DateTime2), NULL, CAST(N'2022-03-14T10:44:37.4966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (102, NULL, 1, N'Freezone', N'Renewal of License with Change Shareholder', 1, 0, NULL, CAST(N'2022-03-14T10:44:26.9966667' AS DateTime2), NULL, CAST(N'2022-03-14T10:44:53.9066667' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (103, NULL, 1, N'Dubai Mainland', N'Renewal of License with Add/Remove Shareholder', 1, 1, NULL, CAST(N'2022-03-26T07:03:13.0600000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (104, NULL, 1, N'Freezone', N'Renewal of License with Remove Shareholder', 1, 0, NULL, CAST(N'2022-04-11T12:36:31.1555514' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (105, NULL, 1, N'Dubai Mainland', N'New Company Established', 1, 1, NULL, CAST(N'2022-04-27T13:17:17.5122861' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (106, NULL, 1, N'Dubai Mainland', N'New Company Established', 1, 1, NULL, CAST(N'2022-05-06T10:39:08.6549115' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (107, NULL, 1, N'Dubai Mainland', N'New Company Established', 1, 1, NULL, CAST(N'2022-05-06T10:42:11.3181129' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (108, NULL, 1, N'Dubai Mainland', N'New Company Established', 1, 1, NULL, CAST(N'2022-05-06T15:30:15.5633366' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (109, NULL, 1, N'Freezone', N'New Company Established', 1, 1, NULL, CAST(N'2022-05-06T15:34:31.5866613' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (110, NULL, 1, N'Dubai Mainland', N'New Company Established', 1, 0, NULL, CAST(N'2022-05-10T19:49:33.8313956' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (111, NULL, 1, N'Freezone', N'New Company Established', 1, 0, NULL, CAST(N'2022-05-10T19:51:42.3497778' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (112, NULL, 23, N'Dubai Mainland', N'Immigration card Modification', 1, 0, NULL, CAST(N'2022-06-13T21:22:32.5079696' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (113, NULL, 23, N'Dubai Mainland', N'Renew Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-06-24T14:58:26.6000424' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (114, NULL, 23, N'Freezone', N'Renew Establishment card (Immigration)', 1, 0, NULL, CAST(N'2022-06-24T15:00:12.4300292' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (115, NULL, 23, N'Dubai Mainland', N'Renew Establishment card (Mohre)', 1, 0, NULL, CAST(N'2022-06-24T15:01:37.5714405' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (116, NULL, 23, N'Freezone', N'Renew Establishment card (Mohre)', 1, 1, NULL, CAST(N'2022-06-24T15:01:45.6180980' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (117, NULL, 23, N'Dubai Mainland', N'New Establishment Card Apply ', 1, 0, NULL, CAST(N'2022-07-27T17:16:54.1327481' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (118, NULL, 56, N'Dubai Mainland', N'Trademark Registration', 1, 0, NULL, CAST(N'2022-10-03T10:25:15.9076530' AS DateTime2), NULL, CAST(N'2022-10-03T10:27:21.5217349' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (119, NULL, 43, N'Dubai Mainland', N'Quota Modification ', 1, 0, 317, CAST(N'2023-08-26T14:02:27.9091576' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (120, NULL, 56, N'Dubai Mainland', N'Trade Mark Registration Process', 1, 0, 2170, CAST(N'2023-10-10T18:05:32.6649925' AS DateTime2), 2170, CAST(N'2023-10-10T18:07:07.7272892' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (121, NULL, 56, N'Dubai Mainland', N'Dubai Municipality registration ', 1, 0, 2170, CAST(N'2023-10-16T17:15:45.7063599' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (122, NULL, 56, N'Dubai Mainland', N'Personal File Open ( Mohre)', 1, 0, 2170, CAST(N'2023-10-20T11:27:31.9329829' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (123, NULL, 56, N'Dubai Mainland', N'WAREHOUSE PROCESS', 1, 1, 2170, CAST(N'2023-12-11T16:38:34.1042721' AS DateTime2), 317, CAST(N'2023-12-11T18:51:47.8224101' AS DateTime2))
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (124, NULL, 56, N'Dubai Mainland', N' WAREHOUSE PERMIT ', 1, 0, 2170, CAST(N'2023-12-11T16:46:44.7349596' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (125, NULL, 56, N'Dubai Mainland', N' INDUSTRIAL LICENSE', 1, 0, 2170, CAST(N'2023-12-11T16:51:26.2192878' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_CompanyServices] ([ID], [SerialNumber], [ParentId], [CompanyType], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (126, NULL, 1, N'Dubai Mainland', N'TESTING COMPANY SERVICE', 1, 0, 285, CAST(N'2024-09-30T13:43:53.7605433' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanyServices] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanySubType] ON 
GO
INSERT [dbo].[Tbl_CompanySubType] ([Id], [MainType], [SubType], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (1, N'Dubai Mainland', N'Sharjah', 1, 0, 2, CAST(N'2024-10-16T12:35:37.6121579' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_CompanySubType] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_EmployeeServices] ON 
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (1, N'Dubai Mainland', NULL, 0, N'Visa Services ', 1, 0, NULL, CAST(N'2022-03-14T06:55:47.1333333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (2, N'Dubai Mainland', NULL, 1, N'Golden Visa (10 Years)', 1, 0, NULL, CAST(N'2022-03-14T06:55:56.8800000' AS DateTime2), NULL, CAST(N'2022-03-14T07:02:35.3100000' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (3, N'Dubai Mainland', NULL, 1, N'Partner/Investor Visa (2 years)', 1, 0, NULL, CAST(N'2022-03-14T07:02:55.4066667' AS DateTime2), NULL, CAST(N'2022-11-23T18:06:32.9508888' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (4, N'Dubai Mainland', NULL, 1, N'Employment visa - Dubai Mainland (2 Years) ', 1, 0, NULL, CAST(N'2022-03-14T07:03:05.0900000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (5, N'Dubai Mainland', NULL, 1, N'Family visa (Dependent Visa)', 1, 0, NULL, CAST(N'2022-03-14T07:03:13.7133333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (6, N'Dubai Mainland', NULL, 1, N'Freelance Visa for 2 Years - Dubai Mainland', 1, 0, NULL, CAST(N'2022-03-14T07:03:22.2633333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (7, N'Dubai Mainland', NULL, 1, N'Visa for Housemaid  (Tadbeer) ', 1, 0, NULL, CAST(N'2022-03-14T07:03:31.3433333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (8, N'Dubai Mainland', NULL, 1, N'Visa for Driver (Tadbeer)', 1, 0, NULL, CAST(N'2022-03-14T07:03:43.1600000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (9, N'Dubai Mainland', NULL, 1, N'Visa for Coock (Tadbeer) ', 1, 0, NULL, CAST(N'2022-03-14T07:03:51.7300000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (10, N'Dubai Mainland', NULL, 1, N'Short visit visa for Single Entry (30 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:04:00.0933333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (11, N'Dubai Mainland', NULL, 1, N'Long visit visa for Single Entry (90 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:04:08.5333333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (12, N'Dubai Mainland', NULL, 1, N'Long visit visa for Multiple Entry (90 Days) ', 1, 0, NULL, CAST(N'2022-03-14T07:04:16.3166667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (13, N'Dubai Mainland', NULL, 1, N'Extenation short visit visa inside country (30 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:04:23.7900000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (14, N'Dubai Mainland', NULL, 1, N'Extenation Long visit visa inside country (90 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:04:32.3333333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (15, N'Dubai Mainland', NULL, 0, N'Visa Amendment Services ', 1, 0, NULL, CAST(N'2022-03-14T07:04:40.8500000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (16, N'Dubai Mainland', NULL, 15, N'Change Profession (Designation)', 1, 0, NULL, CAST(N'2022-03-14T07:04:49.0233333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (17, N'Dubai Mainland', NULL, 15, N'Amendment Employment contract', 1, 0, NULL, CAST(N'2022-03-14T07:04:58.2400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (18, N'Dubai Mainland', NULL, 15, N'Transfer Residence Lost passport to new', 1, 0, NULL, CAST(N'2022-03-14T07:05:06.7866667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (19, N'Dubai Mainland', NULL, 15, N'Transfer Residence Old passport to new', 1, 0, NULL, CAST(N'2022-03-14T07:05:15.2000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (20, N'Dubai Mainland', NULL, 0, N'Other Services ', 1, 0, NULL, CAST(N'2022-03-14T07:05:25.1400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (21, N'Dubai Mainland', NULL, 20, N'Police Clearance Certificate ', 1, 0, NULL, CAST(N'2022-03-14T07:05:33.4533333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (22, N'Freezone', NULL, 1, N'Partner/Investor Visa (3 years)', 1, 0, NULL, CAST(N'2022-03-14T07:05:50.7133333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (23, N'Freezone', NULL, 1, N'Employment visa - Freezone  (3 Years) ', 1, 1, NULL, CAST(N'2022-03-14T07:05:58.3400000' AS DateTime2), 317, CAST(N'2023-10-10T18:16:19.9738271' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (24, N'Freezone', NULL, 1, N'Family visa (Dependent Visa)', 1, 0, NULL, CAST(N'2022-03-14T07:06:06.5300000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (25, N'Freezone', NULL, 1, N'Short visit visa for Single Entry (30 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:06:17.4866667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (26, N'Freezone', NULL, 1, N'Long visit visa for Single Entry (90 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:06:32.0200000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (27, N'Freezone', NULL, 15, N'Long visit visa for Multiple Entry (90 Days) ', 1, 0, NULL, CAST(N'2022-03-14T07:06:41.6433333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (28, N'Freezone', NULL, 1, N'Extenation short visit visa inside country (30 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:06:55.3733333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (29, N'Freezone', NULL, 1, N'Extenation Long visit visa inside country (90 Days)', 1, 0, NULL, CAST(N'2022-03-14T07:07:09.2000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (30, N'Freezone', NULL, 15, N'Change Profession (Designation)', 1, 0, NULL, CAST(N'2022-03-14T07:07:20.6400000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (31, N'Freezone', NULL, 15, N'Amendment Employment contract', 1, 0, NULL, CAST(N'2022-03-14T07:07:32.4066667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (32, N'Freezone', NULL, 15, N'Transfer Residence Lost passport to new', 1, 0, NULL, CAST(N'2022-03-14T07:07:41.4666667' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (33, N'Freezone', NULL, 15, N'Transfer Residence Old passport to new', 1, 0, NULL, CAST(N'2022-03-14T07:07:50.2733333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (34, N'Freezone', NULL, 0, N'Certificate ', 1, 0, NULL, CAST(N'2022-03-14T07:07:59.9033333' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (35, N'Freezone', NULL, 34, N'Salary Certificate of Freezone Company ', 1, 0, NULL, CAST(N'2022-03-14T07:08:09.7500000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (36, N'Freezone', NULL, 20, N'Police Clearance Certificate ', 1, 0, NULL, CAST(N'2022-03-14T07:08:20.3500000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (37, N'Freezone', NULL, 1, N'Test Service', 1, 1, NULL, CAST(N'2022-04-11T18:48:35.7347598' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (38, N'Dubai Mainland', NULL, 1, N'Employement card Process (Only card) ', 1, 0, NULL, CAST(N'2022-06-13T21:16:41.5569026' AS DateTime2), NULL, CAST(N'2022-06-13T21:18:39.3583262' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (39, N'Dubai Mainland', NULL, 1, N'Employment Visa Cancellation ', 1, 0, NULL, CAST(N'2022-08-22T10:30:48.0647361' AS DateTime2), NULL, CAST(N'2022-08-22T10:37:32.6113312' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (40, N'Freezone', NULL, 1, N' Employment Visa Cancellation', 1, 0, NULL, CAST(N'2022-08-22T10:31:21.9408037' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (41, N'Freezone', NULL, 1, N'Employment Visa Cancellation', 1, 0, NULL, CAST(N'2022-08-22T17:24:29.3126019' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (42, N'Dubai Mainland', NULL, 1, N'Partner Visa Cancellation', 1, 0, NULL, CAST(N'2022-11-23T18:07:47.6159580' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (43, N'Freezone', NULL, 1, N'Partner Visa Cancellation', 1, 0, NULL, CAST(N'2022-11-23T18:13:06.9127296' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (44, N'Dubai Mainland', NULL, 1, N'Employment Visa renew process. ', 1, 1, 317, CAST(N'2023-08-23T11:23:21.5623266' AS DateTime2), 317, CAST(N'2023-10-10T18:15:41.9587546' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (45, N'Dubai Mainland', NULL, 1, N're-entry permit process ', 1, 1, 317, CAST(N'2023-09-22T11:32:12.4779093' AS DateTime2), 317, CAST(N'2023-10-10T18:14:24.4903642' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (46, N'Dubai Mainland', NULL, 1, N'Re-Entry Permit process', 1, 1, 2170, CAST(N'2023-10-10T18:10:50.9449522' AS DateTime2), 317, CAST(N'2023-10-10T18:13:39.0849701' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (47, N'Freezone', NULL, 1, N'Re-Entry Permit process', 1, 1, 2170, CAST(N'2023-10-10T18:13:00.3055194' AS DateTime2), 317, CAST(N'2023-10-10T18:16:03.9895841' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (48, N'Freezone', NULL, 1, N'Re-Entry Permit process', 1, 1, 2170, CAST(N'2023-10-10T18:14:19.2091410' AS DateTime2), 317, CAST(N'2023-10-10T18:16:41.4111488' AS DateTime2))
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (49, N'Freezone', NULL, 1, N'Re-entry permit process ', 1, 0, 317, CAST(N'2023-10-10T18:15:34.1929728' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (50, N'Dubai Mainland', NULL, 1, N'Re-Entry Permit process', 1, 0, 2170, CAST(N'2023-10-10T18:17:03.2078626' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (51, N'Dubai Mainland', NULL, 1, N'Employment Renewal Visa', 1, 0, 2170, CAST(N'2023-10-11T10:57:16.3208720' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (52, N'Freezone', NULL, 1, N'Employment Renewal Visa', 1, 0, 2170, CAST(N'2023-10-11T11:02:20.7562327' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (53, N'Freezone', NULL, 1, N'Employment Visa 2 Years', 1, 0, 2170, CAST(N'2023-10-13T10:37:23.5268464' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (54, N'Freezone', NULL, 1, N'Employment Visa 2 Years', 1, 0, 2170, CAST(N'2023-10-13T10:38:59.4478908' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (55, N'Dubai Mainland', NULL, 1, N'Partner Visa Renewal', 1, 0, 2170, CAST(N'2023-10-17T13:39:23.5270750' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (56, N'Dubai Mainland', NULL, 1, N'Renewal Family (dependent ) visa', 1, 0, 2170, CAST(N'2023-10-25T15:56:30.4598852' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (57, N'Freezone', NULL, 1, N'Partner Visa Renewal', 1, 0, 2170, CAST(N'2023-10-30T13:29:04.6421452' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (58, N'Dubai Mainland', NULL, 20, N'EMPLOYEE LABOUR CARD ', 1, 0, 2170, CAST(N'2023-10-30T18:01:15.2287680' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (59, N'Dubai Mainland', NULL, 1, N'Data Modification', 1, 0, 2170, CAST(N'2023-12-06T15:40:54.7351568' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (60, N'Dubai Mainland', NULL, 20, N'Immigration  Absconding', 1, 0, 2170, CAST(N'2024-01-23T15:19:50.4465197' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (61, N'Dubai Mainland', NULL, 20, N'Only new Emirates ID Apply', 1, 0, 2170, CAST(N'2024-02-08T17:39:01.9120038' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (62, N'Dubai Mainland', NULL, 20, N'Others Services ', 1, 0, 2170, CAST(N'2024-02-08T17:47:48.9251738' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_EmployeeServices] ([ID], [CompanyType], [SerialNumber], [ParentId], [ServiceName], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUtc], [ModifyBy], [ModifyOnUtc]) VALUES (63, N'Dubai Mainland', NULL, 34, N'TESTING EMPLOYEE SERVICE', 1, 0, 285, CAST(N'2024-09-30T13:45:55.9437785' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_EmployeeServices] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Module] ON 
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (1, N'HomePage', N'Home Page', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (3, N'RoleManagement', N'Role Management', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (4, N'RolePermission', N'Role Permission', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (5, N'CompanyPermission', N'Company Permission', 1, 1, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (6, N'UserPermission', N'User Permission', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (7, N'Company', N'Company(s)', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (8, N'Employees', N'Employee(s)', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (9, N'MyRequests', N'Service Request(s)', 1, 0, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (10, N'MyAccount', N'My Account', 1, 1, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (11, N'SupportTickets', N'Support Tickets', 1, 1, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (12, N'PortalBalance', N'Portal Balance', 1, 1, CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2), CAST(N'2021-12-28T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (13, N'MyDocuments', N'My Documents', 1, 0, CAST(N'2022-04-01T00:00:00.0000000' AS DateTime2), CAST(N'2022-04-01T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (14, N'Banner', N'Banner(s)', 1, 1, CAST(N'2022-05-01T00:00:00.0000000' AS DateTime2), CAST(N'2022-05-01T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (15, N'Services', N'Services', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (16, N'EmployeeServices', N'Employee Services', 1, 0, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (17, N'CompanyServices', N'Company Services', 1, 0, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (18, N'MemberServices', N'Member Services', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (19, N'PropertyServices', N'Property Services', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (20, N'ValueAddedServices', N'Value Added Services', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (21, N'ComplianceServices', N'Compliance Services', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (22, N'OnlineBooking', N'Online Booking', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (23, N'PromotionPackages', N'Promotion Packages', 1, 1, CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2), CAST(N'2022-01-22T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (24, N'MyServiceRequest', N'My Service Request', 1, 1, CAST(N'2022-02-01T00:00:00.0000000' AS DateTime2), CAST(N'2022-02-01T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (25, N'Shareholders', N'Shareholders/Director
', 1, 0, CAST(N'2022-02-01T00:00:00.0000000' AS DateTime2), CAST(N'2022-02-01T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (26, N'Notification', N'Notification', 1, 0, CAST(N'2022-03-21T00:00:00.0000000' AS DateTime2), CAST(N'2022-03-21T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (27, N'Invoice', N'Invoice', 1, 0, CAST(N'2022-03-21T00:00:00.0000000' AS DateTime2), CAST(N'2022-03-21T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (28, N'MessageTemplate', N'MessageTemplate', 1, 1, CAST(N'2022-03-21T00:00:00.0000000' AS DateTime2), CAST(N'2022-03-21T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (29, N'AccountManagement', N'Account Management', 1, 1, CAST(N'2022-04-04T00:00:00.0000000' AS DateTime2), CAST(N'2022-04-04T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (30, N'Logs', N'Logs', 1, 1, CAST(N'2022-04-09T00:00:00.0000000' AS DateTime2), CAST(N'2022-04-08T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (31, N'PaymentReceipt', N'Payment Receipt(s)', 1, 1, CAST(N'2022-05-02T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (32, N'DocumentChecklist', N'Document Checklist', 1, 0, CAST(N'2022-05-16T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (33, N'ServiceRequestStatus', N'Service Request Status', 1, 0, CAST(N'2022-06-24T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (34, N'Enquiry', N'Enquiry', 1, 1, CAST(N'2022-07-13T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (35, N'SalesPerson', N'Sales Team', 1, 0, CAST(N'2022-10-07T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (36, N'CompanyDocumentType', N'Company Document Type(s)', 1, 0, CAST(N'2022-11-18T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (37, N'GeneratePI', N'Generate PI', 1, 0, CAST(N'2022-11-18T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (38, N'OtherCompanyEmployee', N'Other Company(s) Employees', 1, 0, CAST(N'2022-11-18T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (39, N'DIBNEmployee', N'Operational Team', 1, 0, CAST(N'2023-02-10T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (40, N'OtherCompanyOwner', N'Other Company(s) Owner', 1, 0, CAST(N'2023-02-10T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (41, N'ReportManagement', N'Report(s)', 1, 1, CAST(N'2023-07-21T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (42, N'RMTeam', N'RM Team', 1, 0, CAST(N'2024-10-10T00:00:00.0000000' AS DateTime2), NULL)
GO
INSERT [dbo].[Tbl_Module] ([ModuleId], [ModuleName], [ModuleKeyword], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (44, N'CompanySubType', N'Company Type(s)', 1, 0, CAST(N'2024-10-16T00:00:00.0000000' AS DateTime2), NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_Module] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Password] ON 
GO
INSERT [dbo].[Tbl_Password] ([ID], [UserId], [SalesPersonId], [Password]) VALUES (1, 1, NULL, N'FhBrFTcYJX6rmTFnPLGPpG73EA2TdZjSN52Jvt6MYWI=')
GO
INSERT [dbo].[Tbl_Password] ([ID], [UserId], [SalesPersonId], [Password]) VALUES (2, 2, NULL, N'rxPCiD7SNs5GaZ93qUasMqqvwBxN0OsNWK4xyk/+vsk=')
GO
SET IDENTITY_INSERT [dbo].[Tbl_Password] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Permission] ON 
GO
INSERT [dbo].[Tbl_Permission] ([PermissionId], [PermissionName], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (1, N'Insert', 1, 0, CAST(N'2021-12-25T10:15:00.7966667' AS DateTime2), CAST(N'2021-12-25T10:15:00.7966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_Permission] ([PermissionId], [PermissionName], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (2, N'Update', 1, 0, CAST(N'2021-12-25T10:15:06.7133333' AS DateTime2), CAST(N'2021-12-25T10:15:06.7133333' AS DateTime2))
GO
INSERT [dbo].[Tbl_Permission] ([PermissionId], [PermissionName], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (3, N'View', 1, 0, CAST(N'2021-12-25T10:15:10.3066667' AS DateTime2), CAST(N'2021-12-25T10:15:10.3066667' AS DateTime2))
GO
INSERT [dbo].[Tbl_Permission] ([PermissionId], [PermissionName], [IsActive], [IsDelete], [CreatedOn], [ModifyOn]) VALUES (4, N'Delete', 1, 0, CAST(N'2021-12-25T10:15:14.2900000' AS DateTime2), CAST(N'2021-12-25T10:15:14.2900000' AS DateTime2))
GO
SET IDENTITY_INSERT [dbo].[Tbl_Permission] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_RequestNotification] ON 
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (1, N'Service Request', CAST(N'2024-10-11T18:03:25.8342776' AS DateTime2), NULL, NULL, NULL, N'SR101', NULL, NULL, N' Renewal of License ', NULL, N'Created', 0, NULL, NULL, 0, NULL, 2763, 1, 0, 1, 0, NULL, CAST(N'2024-10-11T18:03:25.8412858' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (2, N'Service Request', CAST(N'2024-10-11T18:04:00.4993022' AS DateTime2), NULL, NULL, NULL, N'SR102', NULL, NULL, N' Golden Visa (10 Years)', NULL, N'Created', 0, NULL, NULL, 0, NULL, 2763, 1, 0, 1, 0, NULL, CAST(N'2024-10-11T18:04:00.5005503' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (3, N'Service Request', CAST(N'2024-10-16T13:33:06.7825392' AS DateTime2), 6, CAST(N'2024-10-16T13:33:06.7825392' AS DateTime2), 2, N'SR101', NULL, NULL, N' Renewal of License ', N'Your request is now assigned to DIBN Employee.', N'Response', NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, 1, 0, NULL, CAST(N'2024-10-16T13:33:06.7981619' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (4, N'Service Request', CAST(N'2024-10-16T13:33:06.9075439' AS DateTime2), NULL, NULL, NULL, N'SR101', NULL, NULL, N' Renewal of License ', N'Your request is now assigned to DIBN Employee.', N'Response', 2, NULL, NULL, NULL, NULL, NULL, 1, 0, 1, 0, NULL, CAST(N'2024-10-16T13:33:06.9075439' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (5, N'Service Request', CAST(N'2024-10-16T13:33:15.0324254' AS DateTime2), 6, CAST(N'2024-10-16T13:33:15.0324254' AS DateTime2), 2, N'SR102', NULL, NULL, N' Golden Visa (10 Years)', N'Your request is now assigned to DIBN Employee.', N'Response', NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, 1, 0, NULL, CAST(N'2024-10-16T13:33:15.0324254' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (6, N'Service Request', CAST(N'2024-10-16T13:33:15.0480786' AS DateTime2), NULL, NULL, NULL, N'SR102', NULL, NULL, N' Golden Visa (10 Years)', N'Your request is now assigned to DIBN Employee.', N'Response', 2, NULL, NULL, NULL, NULL, NULL, 1, 0, 1, 0, NULL, CAST(N'2024-10-16T13:33:15.0480786' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (7, N'Service Request', CAST(N'2024-10-16T13:36:35.9675603' AS DateTime2), NULL, NULL, NULL, N'SR103', NULL, NULL, N' Renewal of License ', NULL, N'Created', 0, NULL, NULL, 1, NULL, 2763, 1, 0, 1, 0, NULL, CAST(N'2024-10-16T13:36:35.9675603' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (8, N'Service Request', CAST(N'2024-10-16T13:37:25.1233317' AS DateTime2), NULL, NULL, NULL, N'SR104', NULL, NULL, N' Golden Visa (10 Years)', NULL, N'Created', 0, NULL, NULL, 1, NULL, 2763, 1, 0, 1, 0, NULL, CAST(N'2024-10-16T13:37:25.1233317' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (9, N'Service Request', CAST(N'2024-10-16T13:39:14.6848102' AS DateTime2), NULL, NULL, NULL, N'SR105', NULL, NULL, N' Renewal of License ', NULL, N'Created', 0, NULL, NULL, 0, NULL, 2763, 1, 0, 1, 0, NULL, CAST(N'2024-10-16T13:39:14.6848102' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RequestNotification] ([Id], [Type], [RequestCreatedOn], [AssignedUserId], [AssignedOn], [AssignedBy], [SerialNumber], [TrackingNumber], [EnquiryNumber], [Title], [Description], [ResponseType], [ServiceCreatedBy], [SupportTicketCreatedBy], [ResponseCreatedBy], [ServiceCreatedBySalesPerson], [SupportTicketCreatedBySalesPerson], [CompanyId], [MarkAsRead], [AssignedUserMarkAsRead], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (10, N'Service Request', CAST(N'2024-10-16T13:39:41.9345705' AS DateTime2), NULL, NULL, NULL, N'SR106', NULL, NULL, N' Golden Visa (10 Years)', NULL, N'Created', 0, NULL, NULL, 0, NULL, 2763, 1, 0, 1, 0, NULL, CAST(N'2024-10-16T13:39:41.9345705' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_RequestNotification] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Role] ON 
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (1, N'DIBN', 1, 0, NULL, CAST(N'2022-01-13T00:00:00.0000000' AS DateTime2), NULL, CAST(N'2022-01-13T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (2, N'Company Owner', 1, 0, NULL, CAST(N'2022-01-13T00:00:00.0000000' AS DateTime2), 285, CAST(N'2024-10-10T10:25:23.1035637' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (3, N'Employee', 1, 0, NULL, CAST(N'2022-01-13T00:00:00.0000000' AS DateTime2), NULL, CAST(N'2022-01-13T00:00:00.0000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (4, N'Agent', 1, 0, NULL, CAST(N'2022-02-19T11:46:07.8566667' AS DateTime2), NULL, CAST(N'2022-02-19T11:46:07.8566667' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (5, N'Manager', 1, 0, NULL, CAST(N'2022-02-19T11:46:19.3100000' AS DateTime2), NULL, CAST(N'2022-02-19T11:46:19.3100000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (6, N'Sales Person', 1, 0, NULL, CAST(N'2022-03-15T05:28:45.4800000' AS DateTime2), NULL, CAST(N'2022-03-15T05:28:45.4800000' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (7, N'TESTING ROLE', 0, 1, 285, CAST(N'2024-10-10T10:25:33.8396751' AS DateTime2), 285, CAST(N'2024-10-10T10:26:26.0403151' AS DateTime2))
GO
INSERT [dbo].[Tbl_Role] ([RoleID], [RoleName], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (8, N'RM Team', 1, 0, 285, CAST(N'2024-10-10T16:44:40.4571891' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_Role] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_RolePermission] ON 
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (53, 2, 1, 1, 1, 1, NULL, CAST(N'2022-01-13T07:32:11.9600000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (54, 2, 7, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (55, 2, 8, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (56, 2, 9, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (57, 2, 10, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (58, 2, 11, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (59, 2, 12, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (60, 2, 13, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (61, 2, 1, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (62, 2, 7, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (63, 2, 8, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (64, 2, 9, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (65, 2, 10, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (66, 2, 11, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (67, 2, 12, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (68, 2, 13, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (69, 2, 1, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (70, 2, 7, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (71, 2, 8, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (72, 2, 9, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (73, 2, 10, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (74, 2, 11, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (75, 2, 12, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (76, 2, 13, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (77, 2, 1, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (78, 2, 7, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (79, 2, 8, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (80, 2, 9, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (81, 2, 10, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (82, 2, 11, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (83, 2, 12, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (84, 2, 13, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:11.9700000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (85, 3, 1, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0833333' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0833333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (86, 3, 7, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (87, 3, 8, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (88, 3, 9, 1, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (89, 3, 1, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (90, 3, 7, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (91, 3, 8, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (92, 3, 9, 2, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (93, 3, 1, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (94, 3, 7, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (95, 3, 8, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (96, 3, 9, 3, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (97, 3, 1, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (98, 3, 7, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (99, 3, 8, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (100, 3, 9, 4, 1, 0, NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2), NULL, CAST(N'2022-01-13T07:32:43.0900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (137, 2, 15, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8600000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (138, 2, 16, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8900000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (139, 2, 17, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (140, 2, 18, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (141, 2, 19, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (142, 2, 20, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (143, 2, 21, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (144, 2, 22, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (145, 2, 23, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (146, 2, 15, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (147, 2, 16, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (148, 2, 17, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (149, 2, 18, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (150, 2, 19, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (151, 2, 20, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (152, 2, 21, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (153, 2, 22, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (154, 2, 23, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (155, 2, 15, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (156, 2, 16, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (157, 2, 17, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (158, 2, 18, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (159, 2, 19, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (160, 2, 20, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (161, 2, 21, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (162, 2, 22, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (163, 2, 23, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (164, 2, 15, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (165, 2, 16, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (166, 2, 17, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (167, 2, 18, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9000000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (168, 2, 19, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (169, 2, 20, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (170, 2, 21, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (171, 2, 22, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (172, 2, 23, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:18.9033333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (173, 3, 15, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5300000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5300000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (174, 3, 16, 1, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5566667' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5566667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (175, 3, 15, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (176, 3, 16, 2, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (177, 3, 15, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (178, 3, 16, 3, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (179, 3, 15, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5633333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (180, 3, 16, 4, 1, 0, NULL, CAST(N'2022-01-22T06:45:38.5633333' AS DateTime2), NULL, CAST(N'2022-01-22T06:45:38.5633333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (181, 2, 24, 1, 1, 1, NULL, CAST(N'2022-02-01T08:22:06.7233333' AS DateTime2), NULL, CAST(N'2022-02-01T08:22:06.7233333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (182, 2, 24, 2, 1, 1, NULL, CAST(N'2022-02-01T08:22:06.7300000' AS DateTime2), NULL, CAST(N'2022-02-01T08:22:06.7300000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (183, 2, 24, 3, 1, 1, NULL, CAST(N'2022-02-01T08:22:06.7300000' AS DateTime2), NULL, CAST(N'2022-02-01T08:22:06.7300000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (184, 2, 24, 4, 1, 1, NULL, CAST(N'2022-02-01T08:22:06.7333333' AS DateTime2), NULL, CAST(N'2022-02-01T08:22:06.7333333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (189, 2, 25, 1, 1, 1, NULL, CAST(N'2022-02-02T06:48:11.2100000' AS DateTime2), NULL, CAST(N'2022-02-02T06:48:11.2100000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (190, 2, 25, 2, 1, 1, NULL, CAST(N'2022-02-02T06:48:11.2166667' AS DateTime2), NULL, CAST(N'2022-02-02T06:48:11.2166667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (191, 2, 25, 3, 1, 1, NULL, CAST(N'2022-02-02T06:48:11.2200000' AS DateTime2), NULL, CAST(N'2022-02-02T06:48:11.2200000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (192, 2, 25, 4, 1, 1, NULL, CAST(N'2022-02-02T06:48:11.2200000' AS DateTime2), NULL, CAST(N'2022-02-02T06:48:11.2200000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (193, 2, 25, 1, 1, 1, NULL, CAST(N'2022-02-02T07:02:59.1200000' AS DateTime2), NULL, CAST(N'2022-02-02T07:02:59.1200000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (194, 2, 25, 2, 1, 1, NULL, CAST(N'2022-02-02T07:02:59.1566667' AS DateTime2), NULL, CAST(N'2022-02-02T07:02:59.1566667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (195, 2, 25, 3, 1, 1, NULL, CAST(N'2022-02-02T07:02:59.1600000' AS DateTime2), NULL, CAST(N'2022-02-02T07:02:59.1600000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (196, 2, 25, 4, 1, 1, NULL, CAST(N'2022-02-02T07:02:59.1666667' AS DateTime2), NULL, CAST(N'2022-02-02T07:02:59.1666667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (197, 2, 25, 1, 1, 0, NULL, CAST(N'2022-02-04T10:12:58.8866667' AS DateTime2), NULL, CAST(N'2022-02-04T10:12:58.8866667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (198, 2, 25, 2, 1, 0, NULL, CAST(N'2022-02-04T10:12:58.8933333' AS DateTime2), NULL, CAST(N'2022-02-04T10:12:58.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (199, 2, 25, 3, 1, 0, NULL, CAST(N'2022-02-04T10:12:58.8933333' AS DateTime2), NULL, CAST(N'2022-02-04T10:12:58.8933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (200, 2, 25, 4, 1, 0, NULL, CAST(N'2022-02-04T10:12:58.8966667' AS DateTime2), NULL, CAST(N'2022-02-04T10:12:58.8966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (229, 2, 27, 1, 1, 0, NULL, CAST(N'2022-03-21T12:17:33.2900000' AS DateTime2), NULL, CAST(N'2022-03-21T12:17:33.2900000' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (230, 2, 27, 2, 1, 0, NULL, CAST(N'2022-03-21T12:17:33.2933333' AS DateTime2), NULL, CAST(N'2022-03-21T12:17:33.2933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (231, 2, 27, 3, 1, 0, NULL, CAST(N'2022-03-21T12:17:33.2933333' AS DateTime2), NULL, CAST(N'2022-03-21T12:17:33.2933333' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (232, 2, 27, 4, 1, 0, NULL, CAST(N'2022-03-21T12:17:33.2966667' AS DateTime2), NULL, CAST(N'2022-03-21T12:17:33.2966667' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (253, 5, 1, 1, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (254, 5, 8, 1, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (255, 5, 1, 2, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (256, 5, 8, 2, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (257, 5, 1, 3, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (258, 5, 8, 3, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (259, 5, 1, 4, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (260, 5, 8, 4, 1, 0, NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2), NULL, CAST(N'2022-04-23T21:19:12.4796414' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (284, 2, 31, 3, 1, 0, NULL, CAST(N'2022-05-06T09:53:45.1287193' AS DateTime2), NULL, CAST(N'2022-05-06T09:53:45.1287193' AS DateTime2))
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (756, 8, 16, 1, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (757, 8, 17, 1, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (758, 8, 1, 3, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (759, 8, 7, 3, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (760, 8, 9, 3, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (761, 8, 16, 3, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (762, 8, 17, 3, 1, 0, 285, CAST(N'2024-10-10T16:49:38.1178441' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (763, 1, 1, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1278977' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (764, 1, 3, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (765, 1, 4, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (766, 1, 6, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (767, 1, 7, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (768, 1, 9, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (769, 1, 13, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (770, 1, 16, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (771, 1, 17, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (772, 1, 25, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (773, 1, 26, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (774, 1, 27, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (775, 1, 32, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (776, 1, 33, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1435259' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (777, 1, 35, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (778, 1, 36, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (779, 1, 37, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (780, 1, 38, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (781, 1, 39, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (782, 1, 40, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (783, 1, 42, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (784, 1, 44, 1, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1591558' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (785, 1, 1, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (786, 1, 3, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (787, 1, 4, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (788, 1, 6, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (789, 1, 7, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (790, 1, 9, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (791, 1, 13, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (792, 1, 16, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (793, 1, 17, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (794, 1, 25, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (795, 1, 26, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (796, 1, 27, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (797, 1, 32, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (798, 1, 33, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (799, 1, 35, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1748763' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (800, 1, 36, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (801, 1, 37, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (802, 1, 38, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (803, 1, 39, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (804, 1, 40, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (805, 1, 42, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (806, 1, 44, 2, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (807, 1, 1, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (808, 1, 3, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (809, 1, 4, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (810, 1, 6, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (811, 1, 7, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (812, 1, 9, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (813, 1, 13, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (814, 1, 16, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (815, 1, 17, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (816, 1, 25, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (817, 1, 26, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (818, 1, 27, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.1903947' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (819, 1, 32, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (820, 1, 33, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (821, 1, 35, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (822, 1, 36, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (823, 1, 37, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (824, 1, 38, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (825, 1, 39, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (826, 1, 40, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (827, 1, 42, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (828, 1, 44, 3, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (829, 1, 1, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (830, 1, 3, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (831, 1, 4, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (832, 1, 6, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (833, 1, 7, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (834, 1, 9, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (835, 1, 13, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (836, 1, 16, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (837, 1, 17, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (838, 1, 25, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2060226' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (839, 1, 26, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (840, 1, 27, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (841, 1, 32, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (842, 1, 33, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (843, 1, 35, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (844, 1, 36, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (845, 1, 37, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (846, 1, 38, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (847, 1, 39, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (848, 1, 40, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (849, 1, 42, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (850, 1, 44, 4, 1, 0, 2, CAST(N'2024-10-16T12:35:25.2216488' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (889, 6, 16, 1, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (890, 6, 17, 1, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (891, 6, 1, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (892, 6, 7, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (893, 6, 8, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (894, 6, 9, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (895, 6, 13, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (896, 6, 16, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.7950193' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_RolePermission] ([RolePermissionId], [RoleID], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (897, 6, 17, 3, 1, 0, 2, CAST(N'2024-10-16T13:37:44.8106351' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_RolePermission] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_Service] ON 
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1, 2, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:26:57.1300000' AS DateTime2), 1, CAST(N'2023-10-10T18:27:34.9370288' AS DateTime2), 2170)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (2, 3, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:27:04.7400000' AS DateTime2), 1, CAST(N'2022-04-05T11:06:09.8756434' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (3, 4, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:27:26.2933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (4, 5, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:27:39.1100000' AS DateTime2), 1, CAST(N'2022-05-12T09:35:45.4521177' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (5, 6, 1, 0, 1, N'Renewal of License with Add/Remove Shareholder', 1, N'Renewal of License with Add Shareholder+Renewal of License with Remove Shareholder', 1, 0, CAST(N'2022-03-05T06:28:09.4800000' AS DateTime2), 1, CAST(N'2022-04-06T11:54:35.4563596' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (6, 7, 1, 0, 0, N'Renewal of License with Add/Remove Shareholder', 0, N'Renewal of License with Add Shareholder+Renewal of License with Remove Shareholder', 1, 0, CAST(N'2022-03-05T06:28:32.7700000' AS DateTime2), 1, CAST(N'2022-04-06T11:54:43.8619473' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (7, 8, 1, 0, 0, N'Renewal of License with Add/Remove Shareholder', 0, N'Renewal of License with Add Shareholder+Renewal of License with Remove Shareholder', 1, 0, CAST(N'2022-03-05T06:29:10.8866667' AS DateTime2), 1, CAST(N'2023-10-10T18:26:23.1097629' AS DateTime2), 2170)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (8, 9, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:29:24.6066667' AS DateTime2), 1, CAST(N'2022-05-12T09:36:30.1657624' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (9, 11, 1, 0, 1, N'Update (Addition-Remove-Change) Shareholder & Share transfer ', 1, N'Update (Addition) Shareholder & Share transfer+Update (Change) Shareholder & Share transfer+Update (Removal) Shareholder & Share transfer', 1, 0, CAST(N'2022-03-05T06:30:46.6500000' AS DateTime2), 1, CAST(N'2022-04-06T11:55:12.1977778' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (10, 12, 1, 0, 0, N'Update (Addition-Remove-Change) Shareholder & Share transfer ', 0, N'Update (Addition) Shareholder & Share transfer+Update (Change) Shareholder & Share transfer+Update (Removal) Shareholder & Share transfer', 1, 0, CAST(N'2022-03-05T06:31:02.3400000' AS DateTime2), 1, CAST(N'2022-04-06T11:55:27.6880673' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (11, 13, 1, 0, 0, N'Update (Addition-Remove-Change) Shareholder & Share transfer ', 0, N'Update (Addition) Shareholder & Share transfer+Update (Change) Shareholder & Share transfer+Update (Removal) Shareholder & Share transfer', 1, 0, CAST(N'2022-03-05T06:31:22.7666667' AS DateTime2), 1, CAST(N'2022-04-06T11:55:41.7812706' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (12, 14, 1, 0, 1, N'Update (Change-Removal-Addition) Manager  ', 1, N'Update (Addition) Manager+Update (Change) Manager+Update (Remove) Manager', 1, 0, CAST(N'2022-03-05T06:39:27.5533333' AS DateTime2), 1, CAST(N'2022-04-06T11:56:01.0075212' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (13, 15, 1, 0, 0, N'Update (Change-Removal-Addition) Manager  ', 0, N'Update (Addition) Manager+Update (Change) Manager+Update (Remove) Manager', 1, 0, CAST(N'2022-03-05T06:39:38.4666667' AS DateTime2), 1, CAST(N'2022-04-06T11:56:14.1476973' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (14, 16, 1, 0, 0, N'Update (Change-Removal-Addition) Manager  ', 0, N'Update (Addition) Manager+Update (Change) Manager+Update (Remove) Manager', 1, 0, CAST(N'2022-03-05T06:39:50.8033333' AS DateTime2), 1, CAST(N'2022-04-06T11:56:24.7509646' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (15, 17, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:40:11.6000000' AS DateTime2), 1, CAST(N'2022-03-26T12:25:35.5166667' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (16, 18, 1, 0, 1, NULL, NULL, NULL, 1, 1, CAST(N'2022-03-05T06:40:23.1200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (17, 19, 1, 0, 1, NULL, NULL, NULL, 1, 1, CAST(N'2022-03-05T06:40:38.8766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (18, 20, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:40:49.2800000' AS DateTime2), 1, CAST(N'2022-03-26T14:08:09.8800000' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (19, 21, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:40:57.2800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (20, 22, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:41:07.8066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (21, 24, 1, 0, 1, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 1, N'Apply New Establishment card (Immigration)+Renew Establishment card (Immigration)+Add Establishment card (Immigration)+Modification Establishment card (Immigration)+Remove Establishment card (Immigration)', 1, 0, CAST(N'2022-03-05T06:41:40.5566667' AS DateTime2), 1, CAST(N'2022-04-06T11:56:45.3655098' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (22, 25, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Renew Establishment card (Immigration)+Add Establishment card (Immigration)+Modification Establishment card (Immigration)+Remove Establishment card (Immigration)', 1, 0, CAST(N'2022-03-05T06:41:54.7500000' AS DateTime2), 1, CAST(N'2022-04-06T11:57:02.5172284' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (23, 26, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Renew Establishment card (Immigration)+Add Establishment card (Immigration)+Modification Establishment card (Immigration)+Remove Establishment card (Immigration)', 1, 1, CAST(N'2022-03-05T06:42:08.6733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (24, 27, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Renew Establishment card (Immigration)+Add Establishment card (Immigration)+Modification Establishment card (Immigration)+Remove Establishment card (Immigration)', 1, 0, CAST(N'2022-03-05T06:42:26.2200000' AS DateTime2), 1, CAST(N'2022-04-06T11:57:18.3001745' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (25, 28, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Renew Establishment card (Immigration)+Add Establishment card (Immigration)+Modification Establishment card (Immigration)+Remove Establishment card (Immigration)', 1, 0, CAST(N'2022-03-05T06:42:43.0000000' AS DateTime2), 1, CAST(N'2022-04-06T11:57:31.7481996' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (26, 29, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:42:53.8833333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (27, 30, 1, 0, 1, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Mohre)', 1, N'Apply New Establishment card (Mohre)+Renew Establishment card (Mohre)+Add Establishment card (Mohre)+Modification Establishment card (Mohre)+Remove Establishment card (Mohre)', 1, 0, CAST(N'2022-03-05T06:43:36.6766667' AS DateTime2), 1, CAST(N'2022-04-06T11:57:44.7994920' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (28, 31, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Mohre)', 0, N'Apply New Establishment card (Mohre)+Renew Establishment card (Mohre)+Add Establishment card (Mohre)+Modification Establishment card (Mohre)+Remove Establishment card (Mohre)', 1, 0, CAST(N'2022-03-05T06:43:47.5600000' AS DateTime2), 1, CAST(N'2022-04-06T11:57:56.6073317' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (29, 32, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Mohre)', 0, N'Apply New Establishment card (Mohre)+Renew Establishment card (Mohre)+Add Establishment card (Mohre)+Modification Establishment card (Mohre)+Remove Establishment card (Mohre)', 1, 1, CAST(N'2022-03-05T06:44:05.7666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (30, 33, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Mohre)', 0, N'Apply New Establishment card (Mohre)+Renew Establishment card (Mohre)+Add Establishment card (Mohre)+Modification Establishment card (Mohre)+Remove Establishment card (Mohre)', 1, 0, CAST(N'2022-03-05T06:44:21.7766667' AS DateTime2), 1, CAST(N'2022-04-06T11:58:09.0069503' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (31, 34, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Mohre)', 0, N'Apply New Establishment card (Mohre)+Renew Establishment card (Mohre)+Add Establishment card (Mohre)+Modification Establishment card (Mohre)+Remove Establishment card (Mohre)', 1, 0, CAST(N'2022-03-05T06:44:34.5900000' AS DateTime2), 1, CAST(N'2022-04-06T11:58:23.5611783' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (32, 35, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:44:45.5900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (33, 36, 1, 0, 1, N'Apply New / Renew / Add / Remove / Modification E -Signature Card', 1, N'Apply New E -Signature Card+Add E -Signature Card+Renew E -Signature Card+Modification E -Signature Card+Remove E -Signature Card', 1, 0, CAST(N'2022-03-05T06:45:01.2666667' AS DateTime2), 1, CAST(N'2022-04-06T11:58:36.7450894' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (34, 37, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification E -Signature Card', 0, N'Apply New E -Signature Card+Add E -Signature Card+Renew E -Signature Card+Modification E -Signature Card+Remove E -Signature Card', 1, 0, CAST(N'2022-03-05T06:45:16.6666667' AS DateTime2), 1, CAST(N'2022-04-06T11:58:48.8849738' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (35, 38, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification E -Signature Card', 0, N'Apply New E -Signature Card+Add E -Signature Card+Renew E -Signature Card+Modification E -Signature Card+Remove E -Signature Card', 1, 0, CAST(N'2022-03-05T06:45:35.8200000' AS DateTime2), 1, CAST(N'2022-06-13T21:18:39.3583262' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (36, 39, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification E -Signature Card', 0, N'Apply New E -Signature Card+Add E -Signature Card+Renew E -Signature Card+Modification E -Signature Card+Remove E -Signature Card', 1, 0, CAST(N'2022-03-05T06:45:56.2433333' AS DateTime2), 1, CAST(N'2022-08-22T10:37:32.6113312' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (37, 40, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification E -Signature Card', 0, N'Apply New E -Signature Card+Add E -Signature Card+Renew E -Signature Card+Modification E -Signature Card+Remove E -Signature Card', 1, 0, CAST(N'2022-03-05T06:46:13.6766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (38, 41, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:46:25.4400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (39, 42, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:46:34.2533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (40, 44, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:46:57.0133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (41, 45, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:47:09.4300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (42, 46, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:47:21.0233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (43, 47, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:47:29.7866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (44, 49, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:47:59.8366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (45, 50, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:48:08.0300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (46, 52, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:48:33.0000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (47, 53, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:48:42.2466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (48, 54, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:48:50.9366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (49, 55, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:48:58.9066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (50, 57, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:49:17.2100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (51, 58, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:49:26.2866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (52, 59, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:49:37.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (53, 60, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-05T06:49:48.9133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (54, 61, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:22:26.7866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (55, 62, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:22:36.3766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (56, 63, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:22:54.7200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (57, 64, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:23:31.6433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (58, 65, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:23:41.2900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (59, 66, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:23:57.0766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (60, 67, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:24:05.3966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (61, 68, 1, 0, 1, N'Renewal of License with Add/Remove Shareholder', 1, N'Renewal of License with Add Shareholder+Renewal of License with Remove Shareholder', 1, 0, CAST(N'2022-03-14T06:30:10.9766667' AS DateTime2), 1, CAST(N'2022-03-14T10:43:51.1466667' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (62, 69, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:34:56.7133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (63, 70, 1, 0, 1, N'Update (Change-Removal-Addition) Share holder & Share transfer', 1, N'Update (Addition) Shareholder & Share transfer+Update (Change) Shareholder & Share transfer+Update (Removal) Shareholder & Share transfer', 1, 0, CAST(N'2022-03-14T06:36:58.0600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (64, 71, 1, 0, 0, N'Update (Change-Removal-Addition) Share holder & Share transfer', 0, N'Update (Addition) Shareholder & Share transfer+Update (Change) Shareholder & Share transfer+Update (Removal) Shareholder & Share transfer', 1, 0, CAST(N'2022-03-14T06:37:13.7433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (65, 72, 1, 0, 0, N'Update (Change-Removal-Addition) Share holder & Share transfer', 0, N'Update (Addition) Shareholder & Share transfer+Update (Change) Shareholder & Share transfer+Update (Removal) Shareholder & Share transfer', 1, 0, CAST(N'2022-03-14T06:37:25.1200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (66, 73, 1, 0, 1, N'Update (Change-Removal-Addition) Manager', 1, N'Update (Addition) Manager+Update (Change) Manager+Update (Removal) Manager', 1, 0, CAST(N'2022-03-14T06:37:39.0900000' AS DateTime2), 1, CAST(N'2022-04-11T12:34:39.2816599' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (67, 74, 1, 0, 0, N'Update (Change-Removal-Addition) Manager', 0, N'Update (Addition) Manager+Update (Change) Manager+Update (Removal) Manager', 1, 0, CAST(N'2022-03-14T06:37:54.6000000' AS DateTime2), 1, CAST(N'2022-04-11T12:34:53.2370280' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (68, 75, 1, 0, 0, N'Update (Change-Removal-Addition) Manager', 0, N'Update (Addition) Manager+Update (Change) Manager+Update (Removal) Manager', 1, 0, CAST(N'2022-03-14T06:38:05.2200000' AS DateTime2), 1, CAST(N'2022-04-11T12:34:24.0169730' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (69, 76, 1, 0, 1, N'Update (Change-Removal-Addition)Activity in License', 1, N'Update (Addition)Activity in License+Update (Change)Activity in License+Update (Removal)Activity in License', 1, 0, CAST(N'2022-03-14T06:38:19.8666667' AS DateTime2), 1, CAST(N'2022-04-11T12:35:20.1305978' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (70, 77, 1, 0, 0, N'Update (Change-Removal-Addition)Activity in License', 0, N'Update (Addition)Activity in License+Update (Change)Activity in License+Update (Removal)Activity in License', 1, 0, CAST(N'2022-03-14T06:38:37.2833333' AS DateTime2), 1, CAST(N'2022-04-11T12:35:31.3968825' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (71, 78, 1, 0, 0, N'Update (Change-Removal-Addition)Activity in License', 0, N'Update (Addition)Activity in License+Update (Change)Activity in License+Update (Removal)Activity in License', 1, 0, CAST(N'2022-03-14T06:38:46.3700000' AS DateTime2), 1, CAST(N'2022-04-11T12:35:05.3941236' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (72, 79, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:39:01.5233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (73, 80, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:39:08.8566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (74, 81, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:39:18.4900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (75, 82, 1, 0, 1, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 1, N'Apply New Establishment card (Immigration)+Add  Establishment card (Immigration)+Remove Establishment card (Immigration)+Modification  Establishment card (Immigration)+Renew Establishment card (Immigration)', 1, 0, CAST(N'2022-03-14T06:39:45.0633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (76, 83, 1, 0, 1, NULL, NULL, NULL, 1, 1, CAST(N'2022-03-14T06:40:01.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (77, 84, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Add  Establishment card (Immigration)+Remove Establishment card (Immigration)+Modification  Establishment card (Immigration)+Renew Establishment card (Immigration)', 1, 0, CAST(N'2022-03-14T06:40:19.7066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (78, 85, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Add  Establishment card (Immigration)+Remove Establishment card (Immigration)+Modification  Establishment card (Immigration)+Renew Establishment card (Immigration)', 1, 0, CAST(N'2022-03-14T06:40:40.2400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (79, 86, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Add  Establishment card (Immigration)+Remove Establishment card (Immigration)+Modification  Establishment card (Immigration)+Renew Establishment card (Immigration)', 1, 0, CAST(N'2022-03-14T06:40:53.7300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (80, 87, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:41:18.2466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (81, 89, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:41:55.7333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (82, 90, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:42:05.4933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (83, 91, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:42:24.1500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (84, 92, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:42:34.3300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (85, 93, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:42:45.6866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (86, 94, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:42:58.4900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (87, 95, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:43:07.3133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (88, 96, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:43:19.1200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (89, 97, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:43:29.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (90, 98, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:43:38.5100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (91, 99, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:43:51.6466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (92, 100, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:44:01.4033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (93, 2, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T06:55:56.8800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (94, 3, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:02:55.4066667' AS DateTime2), 1, CAST(N'2022-11-23T18:06:32.9518967' AS DateTime2), 285)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (95, 4, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:03:05.0900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (96, 5, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:03:13.7133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (97, 6, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:03:22.2633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (98, 7, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:03:31.3433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (99, 8, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:03:43.1600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (100, 9, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:03:51.7300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (101, 10, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:00.0933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (102, 11, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:08.5333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (103, 12, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:16.3166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (104, 13, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:23.7900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (105, 14, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:32.3566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (106, 16, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:49.0233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (107, 17, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:04:58.2400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (108, 18, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:05:06.8100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (109, 19, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:05:15.2233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (110, 21, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:05:33.4700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (111, 22, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:05:50.7133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (112, 23, 0, 1, 1, NULL, NULL, NULL, 1, 1, CAST(N'2022-03-14T07:05:58.3400000' AS DateTime2), 1, CAST(N'2023-10-10T18:16:19.9738271' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (113, 24, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:06:06.5300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (114, 25, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:06:17.4866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (115, 26, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:06:32.0200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (116, 27, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:06:41.6433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (117, 28, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:06:55.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (118, 29, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:07:09.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (119, 30, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:07:20.6400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (120, 31, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:07:32.4066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (121, 32, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:07:41.4666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (122, 33, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:07:50.2733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (123, 35, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:08:09.7500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (124, 36, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-03-14T07:08:20.3500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (125, 102, 1, 0, 0, N'Renewal of License with Add/Remove Shareholder', 0, N'Renewal of License with Add Shareholder+Renewal of License with Remove Shareholder', 1, 0, CAST(N'2022-03-14T10:44:27.0000000' AS DateTime2), 1, CAST(N'2022-03-14T10:44:53.9100000' AS DateTime2), 1)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (126, 103, 1, 0, 1, NULL, NULL, NULL, 1, 1, CAST(N'2022-03-26T07:03:13.0633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (127, 104, 1, 0, 0, N'Renewal of License with Add/Remove Shareholder', 0, N'Renewal of License with Add Shareholder+Renewal of License with Remove Shareholder', 1, 0, CAST(N'2022-04-11T12:36:31.1565460' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (128, 37, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-04-11T18:48:35.7522820' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (129, 105, 1, 0, NULL, NULL, NULL, NULL, 1, 1, CAST(N'2022-04-27T13:17:17.5122861' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (130, 106, 1, 0, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-05-10T11:22:02.6630143' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (131, 107, 1, 0, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-05-10T11:23:13.3516028' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (132, 108, 1, 0, 1, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (133, 109, 1, 0, 1, NULL, NULL, NULL, 1, 1, NULL, NULL, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (134, 110, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-05-10T19:49:33.8334365' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (135, 111, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2022-05-10T19:51:42.3513075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (136, 38, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-06-13T21:16:41.5569026' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (137, 112, 1, 0, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-06-13T21:22:32.5079696' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (138, 113, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Renew Establishment card (Immigration)+Add Establishment card (Immigration)+Modification Establishment card (Immigration)+Remove Establishment card (Immigration)', 1, 0, CAST(N'2022-06-24T14:58:26.6000424' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (139, 114, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Immigration)', 0, N'Apply New Establishment card (Immigration)+Add  Establishment card (Immigration)+Remove Establishment card (Immigration)+Modification  Establishment card (Immigration)+Renew Establishment card (Immigration)', 1, 0, CAST(N'2022-06-24T15:00:12.4300292' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (140, 115, 1, 0, 0, N'Apply New / Renew / Add / Remove / Modification /  Establishment card (Mohre)', 0, N'Apply New Establishment card (Mohre)+Renew Establishment card (Mohre)+Add Establishment card (Mohre)+Modification Establishment card (Mohre)+Remove Establishment card (Mohre)', 1, 0, CAST(N'2022-06-24T15:01:37.5714405' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (141, 116, 1, 0, NULL, NULL, NULL, NULL, 1, 1, CAST(N'2022-06-24T15:01:45.6180980' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (142, 117, 1, 0, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-07-27T17:16:54.1327481' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (143, 39, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-08-22T10:30:48.0647361' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (144, 40, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-08-22T10:31:21.9408037' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (145, 41, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-08-22T17:24:29.3126019' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (146, 118, 1, 0, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-10-03T10:25:15.9076530' AS DateTime2), 421, CAST(N'2022-10-03T10:27:21.5217349' AS DateTime2), 421)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (147, 42, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-11-23T18:07:47.6169666' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (148, 43, 0, 1, NULL, NULL, NULL, NULL, 1, 0, CAST(N'2022-11-23T18:13:06.9137345' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (149, 44, 0, 1, 1, NULL, NULL, NULL, 1, 1, CAST(N'2023-08-23T11:23:21.5623266' AS DateTime2), 317, CAST(N'2023-10-10T18:15:41.9587546' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (150, 119, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-08-26T14:02:27.9091576' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (151, 45, 0, 1, 1, NULL, NULL, NULL, 1, 1, CAST(N'2023-09-22T11:32:12.4925936' AS DateTime2), 317, CAST(N'2023-10-10T18:14:24.5083400' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (152, 120, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-10T18:05:32.6806241' AS DateTime2), 2170, CAST(N'2023-10-10T18:07:07.7272892' AS DateTime2), 2170)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (153, 46, 0, 1, 1, NULL, NULL, NULL, 1, 1, CAST(N'2023-10-10T18:10:50.9605687' AS DateTime2), 2170, CAST(N'2023-10-10T18:13:39.1020449' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (154, 47, 0, 1, 1, NULL, NULL, NULL, 1, 1, CAST(N'2023-10-10T18:13:00.3055194' AS DateTime2), 2170, CAST(N'2023-10-10T18:16:03.9895841' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (155, 48, 0, 1, 1, NULL, NULL, NULL, 1, 1, CAST(N'2023-10-10T18:14:19.2091410' AS DateTime2), 2170, CAST(N'2023-10-10T18:16:41.4111488' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (156, 49, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-10T18:15:34.1929728' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (157, 50, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-10T18:17:03.2078626' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (158, 51, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-11T10:57:16.3208720' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (159, 52, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-11T11:02:20.7562327' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (160, 53, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-13T10:37:23.5268464' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (161, 54, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-13T10:38:59.4478908' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (162, 121, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-16T17:15:45.7063599' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (163, 55, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-17T13:39:23.5426976' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (164, 122, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-20T11:27:31.9486087' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (165, 56, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-25T15:56:30.4755186' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (166, 57, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-30T13:29:04.6578085' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (167, 58, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-10-30T18:01:15.2287680' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (168, 59, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-12-06T15:40:54.7351568' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (169, 123, 1, 0, 1, NULL, NULL, NULL, 1, 1, CAST(N'2023-12-11T16:38:34.1042721' AS DateTime2), 2170, CAST(N'2023-12-11T18:51:47.8224101' AS DateTime2), 317)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (170, 124, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-12-11T16:46:44.7349596' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (171, 125, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2023-12-11T16:51:26.2192878' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (172, 60, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2024-01-23T15:19:50.4465197' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (173, 61, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2024-02-08T17:39:01.9276213' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (174, 62, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2024-02-08T17:47:48.9251738' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (175, 126, 1, 0, 1, NULL, NULL, NULL, 1, 0, CAST(N'2024-09-30T13:43:53.7635255' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_Service] ([Id], [ServiceId], [IsCompanyService], [IsEmployeeService], [AllowDisplay], [DisplayName], [HasMultipleForms], [FormConstrains], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (176, 63, 0, 1, 1, NULL, NULL, NULL, 1, 0, CAST(N'2024-09-30T13:45:55.9454987' AS DateTime2), 285, NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_Service] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_ServiceFormDataField] ON 
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1, 1, 1, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T07:19:26.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (2, 1, 1, N'Email Address (For correspondence)', 1, N'Please Provide Email Address.', 0, 3, 0, 0, CAST(N'2022-03-14T07:19:26.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (3, 1, 1, N'Comment (If any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-03-14T07:19:26.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (4, 1, 1, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Upload latest Ejari.', 1, 1, 1, 0, CAST(N'2022-03-14T07:19:26.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (119, 110, 20, N'Upload Additional Document (If any)', 0, NULL, 1, 5, 1, 0, CAST(N'2022-03-14T08:39:10.1800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (120, 110, 20, N'Reason for PCC', 1, N'Please Provide Reason for PCC.', 0, 4, 1, 0, CAST(N'2022-03-14T08:39:10.1966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (121, 110, 20, N'Emirats id copy', 1, N'Please Upload Emirats Id copy', 1, 2, 1, 0, CAST(N'2022-03-14T08:39:10.2033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (122, 110, 20, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 6, 0, 0, CAST(N'2022-03-14T08:39:10.2066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (123, 110, 20, N'Comment (If any)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-14T08:39:10.2133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (124, 110, 20, N'Passport size Image', 1, N'Please Upload Passport size Image.', 1, 3, 1, 0, CAST(N'2022-03-14T08:39:10.2166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (178, 124, 29, N'Emirates id copy', 1, N'Please Upload Emirates id copy.', 1, 2, 1, 0, CAST(N'2022-03-14T08:53:15.1400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (179, 124, 29, N'Upload Additional Document (If any)', 0, NULL, 1, 5, 1, 0, CAST(N'2022-03-14T08:53:15.1433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (180, 124, 29, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 6, 0, 0, CAST(N'2022-03-14T08:53:15.1433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (181, 124, 29, N'Comment (If any)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-14T08:53:15.1433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (182, 124, 29, N'Passport size Image', 1, N'Please Upload Passport size Image', 1, 3, 1, 0, CAST(N'2022-03-14T08:53:15.1433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (183, 124, 29, N'Reason for PCC', 1, N'Please Provide Reason for PCC.', 0, 4, 1, 0, CAST(N'2022-03-14T08:53:15.1433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (206, 123, 33, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 1, 3, 0, 0, CAST(N'2022-03-14T08:59:10.0300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (207, 123, 33, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T08:59:10.0300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (208, 123, 33, N'Upload Additional Document (If any)', 0, NULL, 0, 2, 1, 0, CAST(N'2022-03-14T08:59:10.0300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (209, 2, 34, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Upload Upload latest Ejari (Must).', 1, 1, 1, 0, CAST(N'2022-03-14T09:00:31.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (210, 2, 34, N'Comment (If any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-03-14T09:00:31.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (211, 2, 34, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T09:00:31.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (212, 2, 34, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 3, 0, 0, CAST(N'2022-03-14T09:00:31.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (213, 3, 35, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Upload Upload latest Ejari.', 1, 1, 1, 0, CAST(N'2022-03-14T09:01:31.5800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (214, 3, 35, N'Comment (If any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-03-14T09:01:31.5800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (215, 3, 35, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T09:01:31.5800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (216, 3, 35, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 3, 0, 0, CAST(N'2022-03-14T09:01:31.5800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (217, 4, 36, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:02:19.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (218, 4, 36, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T09:02:19.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (219, 4, 36, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:02:19.6933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (248, 8, 40, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:31:37.6933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (249, 8, 40, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 0, 2, 0, 0, CAST(N'2022-03-14T09:31:37.6933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (250, 8, 40, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:31:37.6933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (251, 40, 41, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:32:29.3100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (252, 40, 41, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T09:32:29.3100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (253, 40, 41, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:32:29.3100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (254, 41, 42, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T09:33:14.4566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (255, 41, 42, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:33:14.4566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (256, 41, 42, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:33:14.4566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (257, 42, 43, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:34:11.0933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (258, 42, 43, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:34:11.0966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (259, 42, 43, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T09:34:11.0966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (260, 43, 44, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:39:29.7100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (261, 43, 44, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:39:29.7100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (262, 43, 44, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 0, 2, 0, 0, CAST(N'2022-03-14T09:39:29.7100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (263, 50, 45, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:40:56.3600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (264, 50, 45, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 0, 2, 0, 0, CAST(N'2022-03-14T09:40:56.3600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (265, 50, 45, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:40:56.3700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (266, 51, 46, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:42:01.8133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (267, 51, 46, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:42:01.8133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (268, 51, 46, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T09:42:01.8133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (269, 52, 47, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T09:42:36.8100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (270, 52, 47, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T09:42:36.8100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (271, 52, 47, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T09:42:36.8200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (323, 16, 55, N'Emirat ID of owner or shareholder/Partner', 1, N'Please Upload Emirat ID of owner or shareholder/Partner.', 1, 2, 1, 0, CAST(N'2022-03-14T09:58:01.9966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (324, 16, 55, N'Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, N'Please Upload passport copy of owner or shareholder/Partner (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T09:58:01.9966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (325, 16, 55, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T09:58:02.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (326, 16, 55, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T09:58:02.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (327, 16, 55, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T09:58:02.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (328, 17, 56, N'Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, N'Please Upload passport copy of owner or shareholder/Partner (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T09:59:07.2866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (329, 17, 56, N'Emirat ID of owner or shareholder/Partner', 1, N'Please Upload Emirat ID of owner or shareholder/Partner.', 1, 2, 1, 0, CAST(N'2022-03-14T09:59:07.2966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (330, 17, 56, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T09:59:07.2966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (331, 17, 56, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T09:59:07.2966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (332, 17, 56, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T09:59:07.2966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (344, 20, 59, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:02:34.1800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (345, 20, 59, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:02:34.1800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (346, 20, 59, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:02:34.1800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (347, 44, 60, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:03:19.9933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (348, 44, 60, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:03:19.9933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (349, 44, 60, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:03:19.9933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (350, 45, 61, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:03:54.1133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (351, 45, 61, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:03:54.1133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (352, 45, 61, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:03:54.1133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (353, 21, 62, N'Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, N'Please provide Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, 1, 1, 0, CAST(N'2022-03-14T10:05:46.9800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (354, 21, 62, N'Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, N'Please provide Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card).', 1, 3, 1, 0, CAST(N'2022-03-14T10:05:46.9800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (355, 21, 62, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T10:05:46.9900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (356, 21, 62, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T10:05:46.9900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (357, 21, 62, N'Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, N'Please provide Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card).', 1, 2, 1, 0, CAST(N'2022-03-14T10:05:46.9900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (358, 21, 62, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T10:05:46.9966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (365, 22, 63, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:10:16.9666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (366, 22, 63, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:10:16.9666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (367, 22, 63, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:10:16.9666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (368, 24, 65, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:11:42.3666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (369, 24, 65, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:11:42.3666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (370, 24, 65, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:11:42.3666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (371, 25, 66, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:12:13.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (372, 25, 66, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:12:13.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (373, 25, 66, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:12:13.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (374, 26, 67, N'Upload passport copy of immigrant (Four corner proper visible)', 1, N'Please Upload passport copy of immigrant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:13:29.0700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (375, 26, 67, N'Emirat ID of immigrant', 1, N'Please Upload Emirat ID of immigrant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:13:29.0700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (376, 26, 67, N'Comment if any', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:13:29.0733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (377, 26, 67, N'Email Address', 1, N'Please Provide Email Address.', 0, 4, 1, 0, CAST(N'2022-03-14T10:13:29.0733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (378, 26, 67, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:13:29.0733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (379, 27, 68, N'Person 1: Passport copy (Four corner proper visible) (Name will be in Mohre)', 1, N'Please Upload Person 1: Passport copy (Four corner proper visible) (Name will be in Mohre).', 1, 1, 1, 0, CAST(N'2022-03-14T10:15:15.5100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (380, 27, 68, N'Person 2: Passport copy (Four corner proper visible) (Name will be in Mohre)', 1, N'Please Upload Person 2: Passport copy (Four corner proper visible) (Name will be in Mohre).', 1, 2, 1, 0, CAST(N'2022-03-14T10:15:15.5133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (381, 27, 68, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T10:15:15.5133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (382, 27, 68, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T10:15:15.5133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (383, 27, 68, N'Person 3: Passport copy (Four corner proper visible) (Name will be in Mohre)', 1, N'Please Upload Person 3: Passport copy (Four corner proper visible) (Name will be in Mohre).', 1, 3, 1, 0, CAST(N'2022-03-14T10:15:15.5266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (384, 27, 68, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T10:15:15.5400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (385, 28, 69, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:15:55.8900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (386, 28, 69, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:15:55.8900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (387, 28, 69, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:15:55.8900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (388, 30, 70, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:16:26.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (389, 30, 70, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:16:26.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (390, 30, 70, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:16:26.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (391, 31, 71, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:17:00.0966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (392, 31, 71, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:17:00.0966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (393, 31, 71, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:17:00.1000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (394, 32, 72, N'Email Address', 1, N'Please Provide Email Address.', 0, 4, 1, 0, CAST(N'2022-03-14T10:18:27.1333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (395, 32, 72, N'Comment if any', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:18:27.1333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (396, 32, 72, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:18:27.1333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (397, 32, 72, N'Upload passport copy of immigrant (Four corner proper visible)', 1, N'Please Upload passport copy of immigrant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:18:27.1333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (398, 32, 72, N'Emirat ID of immigrant', 1, N'Please Provide Emirat ID of immigrant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:18:27.1333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (399, 33, 73, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:25:59.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (400, 33, 73, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:25:59.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (401, 33, 73, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:25:59.4566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (402, 33, 73, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:25:59.4566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (403, 33, 73, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:25:59.4600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (404, 34, 74, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:27:06.2300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (405, 34, 74, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:27:06.2300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (406, 34, 74, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:27:06.2366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (407, 34, 74, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:27:06.2366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (408, 34, 74, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:27:06.2433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (409, 35, 75, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:28:05.8633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (410, 35, 75, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:28:05.8633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (411, 35, 75, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:28:05.8766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (412, 35, 75, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:28:05.8766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (413, 35, 75, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:28:05.8766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (419, 36, 76, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:31:40.7366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (420, 36, 76, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:31:40.7366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (421, 36, 76, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:31:40.7433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (422, 36, 76, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:31:40.7433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (423, 36, 76, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:31:40.7433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (424, 37, 77, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:32:47.4633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (425, 37, 77, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:32:47.4633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (426, 37, 77, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:32:47.4766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (427, 37, 77, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:32:47.4766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (428, 37, 77, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:32:47.4766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (429, 38, 78, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:33:51.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (430, 38, 78, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:33:51.4500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (431, 38, 78, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:33:51.4633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (432, 38, 78, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:33:51.4633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (433, 38, 78, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:33:51.4633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (434, 39, 79, N'Upload passport copy of applicant (Four corner proper visible)', 1, N'Please Upload passport copy of applicant (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T10:34:49.8566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (435, 39, 79, N'Emirat ID of applicant', 1, N'Please Upload Emirat ID of applicant.', 1, 2, 1, 0, CAST(N'2022-03-14T10:34:49.8566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (436, 39, 79, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T10:34:49.8733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (437, 39, 79, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T10:34:49.8733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (438, 39, 79, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T10:34:49.8733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (439, 46, 80, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:35:36.5233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (440, 46, 80, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:35:36.5233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (441, 46, 80, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:35:36.5233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (442, 47, 81, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:36:33.6333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (443, 47, 81, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:36:33.6333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (444, 47, 81, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:36:33.6333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (445, 48, 82, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:37:09.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (446, 48, 82, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:37:09.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (447, 48, 82, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:37:09.8500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (448, 49, 83, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:37:41.0400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (449, 49, 83, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:37:41.0400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (450, 49, 83, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:37:41.0400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (451, 54, 84, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 3, 0, 0, CAST(N'2022-03-14T10:38:53.6966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (452, 54, 84, N'Comment (If any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-03-14T10:38:53.6966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (453, 54, 84, N'Upload Latest Ejari (Tenancy Contract)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:38:53.6966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (454, 54, 84, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T10:38:53.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (455, 55, 85, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T10:39:46.6800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (456, 55, 85, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 0, 3, 0, 0, CAST(N'2022-03-14T10:39:46.6800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (457, 55, 85, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Upload latest Ejari .', 1, 1, 1, 0, CAST(N'2022-03-14T10:39:46.6800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (458, 55, 85, N'Comment (If any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-03-14T10:39:46.6800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (459, 56, 86, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Upload latest Ejari .', 1, 1, 1, 0, CAST(N'2022-03-14T10:40:37.8600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (460, 56, 86, N'Upload Additional Document (If any)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T10:40:37.8633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (461, 56, 86, N'Comment (If any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-03-14T10:40:37.8633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (462, 56, 86, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 3, 0, 0, CAST(N'2022-03-14T10:40:37.8633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (463, 57, 87, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:41:09.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (464, 57, 87, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:41:09.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (465, 57, 87, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:41:09.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (466, 58, 88, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:41:44.7900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (467, 58, 88, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:41:44.7900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (468, 58, 88, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:41:44.7900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (469, 59, 89, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:42:22.9133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (470, 59, 89, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 0, 2, 0, 0, CAST(N'2022-03-14T10:42:22.9133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (471, 59, 89, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:42:22.9133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (472, 60, 90, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:42:55.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (473, 60, 90, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:42:55.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (474, 60, 90, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:42:55.6966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (475, 61, 91, N'New Partner : Upload Passport Copy of person (Four corner proper visible)', 1, N'Please Upload Passport Copy of New Partner', 1, 1, 1, 0, CAST(N'2022-03-14T10:50:34.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (476, 61, 91, N'Share Percentage (Existing - Partner ) 2', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-14T10:50:34.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (477, 61, 91, N'Share Percentage (Existing - Partner ) 3', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-14T10:50:34.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (478, 61, 91, N'New Partner : Old Visit/ Resi.Visa Copy', 1, N'Please Upload Old Visit/Resi Visa Copy.', 1, 4, 1, 0, CAST(N'2022-03-14T10:50:34.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (479, 61, 91, N'New Partner : Position for the new shareholder ', 1, N'Please provide position of new Shareholder.', 0, 3, 1, 0, CAST(N'2022-03-14T10:50:34.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (480, 61, 91, N'Upload Additional Document (If any)', 0, NULL, 1, 9, 1, 0, CAST(N'2022-03-14T10:50:34.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (481, 61, 91, N'Share percentage  ( New - Partner ) 1', 1, N'Please Provide Share Percentage of new Partner.', 0, 5, 1, 0, CAST(N'2022-03-14T10:50:34.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (482, 61, 91, N'New Partner : Emirates ID of New partner (If already have)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T10:50:34.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (483, 61, 91, N'Share Percentage  (Existing - Partner ) 1', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T10:50:34.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (484, 61, 91, N'Comment (If any)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-14T10:50:34.6333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (485, 61, 91, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 10, 0, 0, CAST(N'2022-03-14T10:50:34.6400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (486, 0, 92, N'Comment (If any)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-14T10:53:08.7466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (487, 0, 92, N'Share Percentage (Existing - Partner ) 1', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T10:53:08.7600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (488, 0, 92, N'Old Partner : Position for the new shareholder ', 1, N'Please Provide Position of Old Parnter', 0, 3, 1, 0, CAST(N'2022-03-14T10:53:08.7600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (489, 0, 92, N'Old Partner : Old Visit/ Resi.Visa Copy', 1, N'Please Upload Old Visit/Resi. Visa Copy.', 1, 4, 1, 0, CAST(N'2022-03-14T10:53:08.7600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (490, 0, 92, N'Upload Additional Document (If any)', 0, NULL, 1, 9, 1, 0, CAST(N'2022-03-14T10:53:08.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (491, 0, 92, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 10, 0, 0, CAST(N'2022-03-14T10:53:08.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (492, 0, 92, N'Share percentage  ( Old - Partner ) 1', 1, N'Please Provide Share percentage  ( Old - Partner ) 1', 0, 5, 1, 0, CAST(N'2022-03-14T10:53:08.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (493, 0, 92, N'Share Percentage (Existing - Partner ) 2', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-14T10:53:08.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (494, 0, 92, N'Old Partner : Emirates id of New partner (if already have)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T10:53:08.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (495, 0, 92, N'Old Partner : Passport copy (Four corner proper visible)', 1, N'Please Upload Passport Copy of Old partner.', 1, 1, 1, 0, CAST(N'2022-03-14T10:53:08.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (496, 0, 92, N'Share Percentage (Existing - Partner ) 3', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-14T10:53:08.7766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (497, 125, 93, N'Share Percentage (Existing - Partner ) 1', 0, NULL, 0, 1, 1, 0, CAST(N'2022-03-14T10:54:20.3433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (498, 125, 93, N'Share Percentage (Existing - Partner ) 2', 0, NULL, 0, 2, 1, 0, CAST(N'2022-03-14T10:54:20.3466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (499, 125, 93, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T10:54:20.3466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (500, 125, 93, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T10:54:20.3466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (501, 125, 93, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T10:54:20.3466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (502, 125, 93, N'Share Percentage (Existing - Partner ) 3', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:54:20.3466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (503, 62, 94, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:54:55.9300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (504, 62, 94, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:54:55.9333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (505, 62, 94, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:54:55.9333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (506, 81, 95, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:55:35.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (507, 81, 95, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:55:35.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (508, 81, 95, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:55:35.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (509, 82, 96, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:56:09.7233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (510, 82, 96, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:56:09.7233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (511, 82, 96, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:56:09.7233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (512, 89, 97, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:56:41.3266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (513, 89, 97, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:56:41.3266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (514, 89, 97, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:56:41.3266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (515, 90, 98, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:57:18.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (516, 90, 98, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:57:18.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (517, 90, 98, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:57:18.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (518, 91, 99, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:57:49.7633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (519, 91, 99, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:57:49.7633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (520, 91, 99, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:57:49.7633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (521, 92, 100, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T10:58:24.4933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (522, 92, 100, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T10:58:24.4933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (523, 92, 100, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T10:58:24.4933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (524, 65, 101, N'New Partner : Upload Passport Copy of person (Four corner proper visible)', 1, N'Please New Partner : Upload Passport Copy of person (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (525, 65, 101, N'New Partner : Emirates ID of New partner (If already have)', 1, N'Please Upload New Partner : Emirates ID of New partner (If already have).', 1, 2, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (526, 65, 101, N'Share Percentage (Existing - Partner ) 3', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (527, 65, 101, N'Share percentage  ( New - Partner ) 1', 1, N'Please Provide Share percentage  ( New - Partner ) 1', 0, 5, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (528, 65, 101, N'Upload Additional Document (If any)', 0, NULL, 1, 9, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (529, 65, 101, N'Share Percentage  (Existing - Partner ) 1', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (530, 65, 101, N'Comment (If any)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (531, 65, 101, N'New Partner : Old Visit/ Resi.Visa Copy', 1, N'Please Upload Old Visit/ Resi.Visa Copy', 1, 4, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (532, 65, 101, N'Share Percentage (Existing - Partner ) 2', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (533, 65, 101, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 10, 0, 0, CAST(N'2022-03-14T11:09:52.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (534, 65, 101, N'New Partner : Position for the new shareholder ', 1, N'Please Provide Position of New Shareholder.', 0, 3, 1, 0, CAST(N'2022-03-14T11:09:52.3766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (535, 63, 102, N'Share Percentage (Existing - Partner ) 1', 0, NULL, 0, 1, 1, 0, CAST(N'2022-03-14T11:11:08.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (536, 63, 102, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T11:11:08.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (537, 63, 102, N'Share Percentage (Existing - Partner ) 2', 0, NULL, 0, 2, 1, 0, CAST(N'2022-03-14T11:11:08.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (538, 63, 102, N'Share Percentage (Existing - Partner ) 3', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:11:08.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (539, 63, 102, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:11:08.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (540, 63, 102, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T11:11:08.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (541, 64, 103, N'Old Partner : Upload Passport Copy of person (Four corner proper visible)', 1, N'Please Old Partner : Upload Passport Copy of person (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T11:14:43.1700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (542, 64, 103, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 10, 0, 0, CAST(N'2022-03-14T11:14:43.1966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (543, 64, 103, N'Old Partner : Position for the new shareholder ', 1, N'Please Provide Position of new Shareholder.', 0, 3, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (544, 64, 103, N'Share Percentage (Existing - Partner ) 3', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (545, 64, 103, N'Share percentage  ( Old - Partner ) 1', 1, N'Please Provide Share percentage  ( Old - Partner ) 1', 1, 5, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (546, 64, 103, N'Upload Additional Document (If any)', 0, NULL, 1, 9, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (547, 64, 103, N'Old Partner : Emirates id of old partner (if already have)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (548, 64, 103, N'Old Partner : Old Visit/ Resi.Visa Copy', 1, N'Please Upload Old Visit/Resi. Visa Copy.', 1, 4, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (549, 64, 103, N'Share Percentage (Existing - Partner ) 2', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (550, 64, 103, N'Comment (If any)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (551, 64, 103, N'Share Percentage (Existing - Partner ) 1', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:14:43.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (552, 68, 104, N'Upload Passport Copy of manager (Four corner proper visible)', 1, N'Please Upload Passport Copy of manager (Four corner proper visible)', 1, 1, 1, 0, CAST(N'2022-03-14T11:16:50.2766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (553, 68, 104, N'Emirat ID of manager', 1, N'Please Upload Emirat ID of manager.', 1, 2, 1, 0, CAST(N'2022-03-14T11:16:50.2766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (554, 68, 104, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T11:16:50.2833333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (555, 68, 104, N'Upload offer letter ', 1, N'Please Upload offer letter ', 1, 3, 1, 0, CAST(N'2022-03-14T11:16:50.2833333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (556, 68, 104, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:16:50.3000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (557, 68, 104, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T11:16:50.3000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (558, 66, 105, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T11:17:57.9033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (559, 66, 105, N'Upload Passport Copy of manager (Four corner proper visible)', 1, N'Please Upload Passport Copy of manager (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T11:17:57.9033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (560, 66, 105, N'Upload offer letter', 1, N'Please Upload offer letter.', 1, 3, 1, 0, CAST(N'2022-03-14T11:17:57.9033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (561, 66, 105, N'Emirat ID of manager', 1, N'Please Upload Emirat ID of manager.', 1, 2, 1, 0, CAST(N'2022-03-14T11:17:57.9033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (562, 66, 105, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T11:17:57.9033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (563, 66, 105, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:17:57.9166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (564, 67, 106, N'Upload offer letter (Optional)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T11:19:06.4100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (565, 67, 106, N'Upload Passport Copy of manager (Four corner proper visible)', 1, N'Please Upload Passport Copy of manager (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T11:19:06.4100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (566, 67, 106, N'Emirat ID of manager', 1, N'Please Upload Emirat ID of manager.', 1, 2, 1, 0, CAST(N'2022-03-14T11:19:06.4100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (567, 67, 106, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T11:19:06.4166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (568, 67, 106, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T11:19:06.4166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (569, 67, 106, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:19:06.4166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (570, 69, 107, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T11:20:36.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (571, 69, 107, N'Emirat ID of owner or shareholder/Partner', 1, N'Please Upload Emirat ID of owner or shareholder/Partner.', 1, 2, 1, 0, CAST(N'2022-03-14T11:20:36.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (572, 69, 107, N'Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, N'Please Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, 1, 1, 0, CAST(N'2022-03-14T11:20:36.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (573, 69, 107, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T11:20:36.0200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (574, 69, 107, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T11:20:36.0200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (575, 70, 108, N'Emirat ID of owner or shareholder/Partner', 1, N'Please Upload Emirat ID of owner or shareholder/Partner.', 1, 2, 1, 0, CAST(N'2022-03-14T11:21:35.2100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (576, 70, 108, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T11:21:35.2166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (577, 70, 108, N'Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, N'Please Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, 1, 1, 0, CAST(N'2022-03-14T11:21:35.2166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (578, 70, 108, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T11:21:35.2166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (579, 70, 108, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence)', 0, 4, 0, 0, CAST(N'2022-03-14T11:21:35.2166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (580, 71, 109, N'Upload passport copy of owner or shareholder/Partner (Four corner proper visible)', 1, N'Please Upload passport copy of owner or shareholder/Partner (Four corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-14T11:22:46.8133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (581, 71, 109, N'Emirat ID of owner or shareholder/Partner', 1, N'Please Upload Emirat ID of owner or shareholder/Partner.', 0, 2, 1, 0, CAST(N'2022-03-14T11:22:46.8133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (582, 71, 109, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T11:22:46.8266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (583, 71, 109, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T11:22:46.8266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (584, 71, 109, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T11:22:46.8266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (585, 72, 110, N'New Email Address (NEW) ', 1, N'Please provide New Email Address (NEW) .', 0, 1, 1, 0, CAST(N'2022-03-14T11:23:52.1166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (586, 72, 110, N'Upload Additional Document (If any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-14T11:23:52.1166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (587, 72, 110, N'Mobile Number (NEW) ', 1, N'Please Provide Mobile Number (NEW) .', 0, 2, 1, 0, CAST(N'2022-03-14T11:23:52.1166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (588, 72, 110, N'Comment (If any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-14T11:23:52.1166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (589, 72, 110, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 4, 0, 0, CAST(N'2022-03-14T11:23:52.1166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (590, 73, 111, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T11:25:02.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (591, 73, 111, N'Proposed Company Name2', 1, N'Please Provide Proposed Company Name 2.', 0, 2, 1, 0, CAST(N'2022-03-14T11:25:02.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (592, 73, 111, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T11:25:02.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (593, 73, 111, N'Proposed Company Name3', 1, N'Please Provide Proposed Company Name 3.', 0, 3, 1, 0, CAST(N'2022-03-14T11:25:02.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (594, 73, 111, N'Proposed Company Name1', 1, N'Please Provide Proposed Company Name 1.', 0, 1, 1, 0, CAST(N'2022-03-14T11:25:02.9433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (595, 73, 111, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:25:02.9500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (596, 74, 112, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:25:52.2900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (597, 74, 112, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:25:52.2900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (598, 74, 112, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:25:52.2900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (599, 83, 113, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:26:24.4033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (600, 83, 113, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:26:24.4033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (601, 83, 113, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:26:24.4033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (602, 84, 114, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:27:00.0800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (603, 84, 114, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:27:00.0933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (604, 84, 114, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:27:00.0933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (605, 75, 115, N'Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, N'Please Upload Passport Copy.', 1, 2, 1, 0, CAST(N'2022-03-14T11:29:45.9133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (606, 75, 115, N'Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, N'Please Upload Passport Copy.', 1, 1, 1, 0, CAST(N'2022-03-14T11:29:45.9133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (607, 75, 115, N'Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, N'Please Upload Passport Copy.', 1, 3, 1, 0, CAST(N'2022-03-14T11:29:45.9200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (608, 75, 115, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 5, 0, 0, CAST(N'2022-03-14T11:29:45.9200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (609, 75, 115, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-14T11:29:45.9200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (610, 75, 115, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-14T11:29:45.9333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (611, 77, 116, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:30:23.7466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (612, 77, 116, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:30:23.7466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (613, 77, 116, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:30:23.7466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (614, 78, 117, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:30:56.0433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (615, 78, 117, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:30:56.0433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (616, 78, 117, N'Email Address (For correspondence)', 1, N'Please provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:30:56.0433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (617, 79, 118, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:31:34.4600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (618, 79, 118, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:31:34.4666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (619, 79, 118, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:31:34.4666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (620, 80, 119, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:32:26.4333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (621, 80, 119, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:32:26.4333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (622, 80, 119, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:32:26.4333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (623, 85, 120, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:34:16.8300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (624, 85, 120, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:34:16.8300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (625, 85, 120, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:34:16.8300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (626, 86, 121, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:35:02.7066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (627, 86, 121, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:35:02.7066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (628, 86, 121, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:35:02.7066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (629, 87, 122, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:36:03.5266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (630, 87, 122, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:36:03.5266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (631, 87, 122, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:36:03.5266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (632, 88, 123, N'Upload Additional Document (If any)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-03-14T11:36:46.2733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (633, 88, 123, N'Comment (If any)', 0, NULL, 0, 3, 1, 0, CAST(N'2022-03-14T11:36:46.2766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (634, 88, 123, N'Email Address (For correspondence)', 1, N'Please Provide Email Address (For correspondence).', 0, 2, 0, 0, CAST(N'2022-03-14T11:36:46.2766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (635, 5, 37, N'Existing Shareholder Name', 0, NULL, 0, 10, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (636, 5, 37, N'Existing Shareholder Share (%)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (637, 5, 37, N'Emirates ID of New Partner/Shareholder', 1, N'Please Provide Emirates ID of New Partner/Shareholder.', 1, 3, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (638, 5, 37, N'Existing Shareholder Share (%)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (639, 5, 37, N'New Shareholder Name', 1, N'Please Provide New Shareholder Name.', 1, 4, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (640, 5, 37, N'Existing Shareholder Name', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (641, 5, 37, N'New Shareholder Share (%)', 1, N'Please Provide New Shareholder Share (%).', 0, 5, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (642, 5, 37, N'New Shareholder Name', 1, N'Please Provide New Shareholder Name.', 0, 4, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (643, 5, 37, N'Passport of New Partner/Shareholder (all corner proper visible)', 1, N'Please Provide Passport of New Partner/Shareholder (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (644, 5, 37, N'Visit / Resident visa of New Partner/Shareholder', 1, N'Please Provide Visit / Resident visa of New Partner/Shareholder.', 1, 2, 1, 0, CAST(N'2022-03-26T13:17:29.8866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (645, 5, 37, N'Existing Shareholder Share (%)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-03-26T13:17:29.8900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (646, 5, 37, N'Upload Latest Ejari (Tenancy Contract) 		', 1, N'Please Provide Upload Latest Ejari (Tenancy Contract).', 1, 12, 1, 0, CAST(N'2022-03-26T13:17:29.8900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (647, 5, 37, N'Existing Shareholder Name', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-26T13:17:29.8900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (648, 6, 38, N'Passport of Remove Partner/Shareholder (all corner proper visible)	', 1, N'Please Provide Passport of Remove Partner/Shareholder (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (649, 6, 38, N'Remove Shareholder Share (%)', 1, N'Please Provide Remove Shareholder Share (%).', 0, 5, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (650, 6, 38, N'Existing Shareholder Share (%)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (651, 6, 38, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Provide Upload Latest Ejari (Tenancy Contract).', 1, 12, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (652, 6, 38, N'Visit / Resident visa of Remove Partner/Shareholder', 1, N'Please Provide Visit / Resident visa of Remove Partner/Shareholder.', 1, 2, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (653, 6, 38, N'Existing Shareholder Name', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (654, 6, 38, N'Upload Additional Document (If any)', 0, NULL, 1, 13, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (655, 6, 38, N'Remove Shareholder Name', 1, N'Please Provide Name of Shareholder which you want to Remove.', 0, 4, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (656, 6, 38, N'Existing Shareholder Share (%)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (657, 6, 38, N'Emirates ID of Remove Partner/Shareholder', 1, N'Please Provide Emirates ID of Remove Partner/Shareholder.', 1, 3, 1, 0, CAST(N'2022-03-26T13:26:42.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (658, 6, 38, N'Existing Shareholder Name', 0, NULL, 0, 10, 1, 0, CAST(N'2022-03-26T13:26:42.6633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (659, 6, 38, N'Existing Shareholder Name', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-26T13:26:42.6633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (660, 6, 38, N'Existing Shareholder Share (%)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-03-26T13:26:42.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (661, 11, 50, N'Existing Shareholder Share (%)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-26T13:35:09.6600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (662, 11, 50, N'Existing Shareholder Name', 0, NULL, 0, 10, 1, 0, CAST(N'2022-03-26T13:35:09.6633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (663, 11, 50, N'Passport of Remove Partner/Shareholder (all corner proper visible)', 1, N'Please Provide Passport of Remove Partner/Shareholder (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:35:09.6633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (664, 11, 50, N'Existing Shareholder Share (%)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (665, 11, 50, N'Existing Shareholder Share (%)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (666, 11, 50, N'Remove Shareholder Name', 1, N'Please Provide Name of Shareholder which you want to Remove.', 0, 4, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (667, 11, 50, N'Emirates ID of Remove Partner/Shareholder', 1, N'Please Provide Emirates ID of Remove Partner/Shareholder.', 1, 3, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (668, 11, 50, N'Existing Shareholder Name', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (669, 11, 50, N'Existing Shareholder Name', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (670, 11, 50, N'Visit / Resident visa of Remove Partner/Shareholder', 1, N'Please Provide Visit / Resident visa of Remove Partner/Shareholder.', 1, 2, 1, 0, CAST(N'2022-03-26T13:35:09.6666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (671, 11, 50, N'Remove Shareholder Share (%)', 1, N'Please Provide Share (%) of Shareholder which you want to Remove.', 0, 5, 1, 0, CAST(N'2022-03-26T13:35:09.6700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (672, 11, 50, N'Upload Additional Document (If any)		', 0, NULL, 1, 12, 1, 0, CAST(N'2022-03-26T13:35:09.6700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (673, 9, 48, N'New Shareholder Name', 1, N'Please Provide Name of New Shareholder.', 0, 4, 1, 0, CAST(N'2022-03-26T13:39:05.4933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (674, 9, 48, N'Passport of New Partner/Shareholder (all corner proper visible)', 1, N'Please Provide Passport of New Partner/Shareholder (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:39:05.4933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (675, 9, 48, N'New Shareholder Share (%)', 1, N'Please Provide Share(%) of New Shareholder.', 0, 5, 1, 0, CAST(N'2022-03-26T13:39:05.5033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (676, 9, 48, N'Emirates ID of New Partner/Shareholder', 1, N'Please Provide Emirates ID of New Partner/Shareholder.', 1, 3, 1, 0, CAST(N'2022-03-26T13:39:05.5033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (677, 9, 48, N'Visit / Resident visa of New Partner/Shareholder', 1, N'Please Provide Visit / Resident visa of New Partner/Shareholder.', 1, 2, 1, 0, CAST(N'2022-03-26T13:39:05.5066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (678, 9, 48, N'Existing Shareholder Share (%)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-03-26T13:39:05.5066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (679, 9, 48, N'Existing Shareholder Name', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-26T13:39:05.5100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (680, 9, 48, N'Existing Shareholder Share (%)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-03-26T13:39:05.5100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (681, 9, 48, N'Upload Additional Document (If any)', 0, NULL, 1, 12, 1, 0, CAST(N'2022-03-26T13:39:05.5100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (682, 9, 48, N'Existing Shareholder Name', 0, NULL, 0, 6, 1, 0, CAST(N'2022-03-26T13:39:05.5166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (683, 9, 48, N'Existing Shareholder Share (%)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-26T13:39:05.5166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (684, 9, 48, N'Existing Shareholder Name', 0, NULL, 0, 10, 1, 0, CAST(N'2022-03-26T13:39:05.5166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (685, 10, 49, N'Existing Shareholder Share (%)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-03-26T13:44:31.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (686, 10, 49, N'Existing Shareholder Name', 0, NULL, 0, 8, 1, 0, CAST(N'2022-03-26T13:44:31.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (687, 10, 49, N'Passport of New Partner/Shareholder (all corner proper visible)', 1, N'Please Provide Passport of New Partner/Shareholder (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:44:31.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (688, 10, 49, N'Upload Additional Document (If any)', 0, NULL, 1, 14, 1, 0, CAST(N'2022-03-26T13:44:31.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (689, 10, 49, N'Visit / Resident visa of New Partner/Shareholder', 1, N'Please Provide Visit / Resident visa of New Partner/Shareholder.', 1, 2, 1, 0, CAST(N'2022-03-26T13:44:31.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (690, 10, 49, N'Remove Shareholder Share (%)', 1, N'Please Provide Share(%) of Shareholder which you want to Remove.', 0, 7, 1, 0, CAST(N'2022-03-26T13:44:31.6333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (691, 10, 49, N'Existing Shareholder Share (%)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-03-26T13:44:31.6366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (692, 10, 49, N'Existing Shareholder Name', 0, NULL, 0, 12, 1, 0, CAST(N'2022-03-26T13:44:31.6366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (693, 10, 49, N'New Shareholder Name', 1, N'Please Provide Name of New Shareholder.', 0, 4, 1, 0, CAST(N'2022-03-26T13:44:31.6366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (694, 10, 49, N'Remove Shareholder Name ', 1, N'Please Provide Name of Shareholder which you want to Remove.', 0, 6, 1, 0, CAST(N'2022-03-26T13:44:31.6400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (695, 10, 49, N'Existing Shareholder Share (%)', 0, NULL, 0, 13, 1, 0, CAST(N'2022-03-26T13:44:31.6400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (696, 10, 49, N'Emirates ID of New Partner/Shareholder (If Available)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-26T13:44:31.6400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (697, 10, 49, N'New Shareholder Share (%)', 1, N'Please Provide Share(%) of New Shareholder.', 0, 5, 1, 0, CAST(N'2022-03-26T13:44:31.6400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (698, 10, 49, N'Existing Shareholder Name', 0, NULL, 0, 10, 1, 0, CAST(N'2022-03-26T13:44:31.6433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (699, 9, 48, N'Comment (If Any)', 0, N'', 0, 13, 1, 0, CAST(N'2022-03-26T13:47:50.4533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (701, 10, 49, N'Comment (If Any)', 0, N'', 0, 15, 1, 0, CAST(N'2022-03-26T13:48:28.4600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (703, 11, 50, N'Comment (If Any)', 0, N'', 0, 13, 1, 0, CAST(N'2022-03-26T13:48:56.8000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (705, 5, 37, N'Comment (If Any)', 0, N'', 0, 13, 1, 0, CAST(N'2022-03-26T13:49:31.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (706, 6, 38, N'Comment (If Any)', 0, N'', 0, 14, 1, 0, CAST(N'2022-03-26T13:49:49.9900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (708, 12, 51, N'Visit / Resident visa of New Manager', 1, N'Please Provide Visit / Resident visa of New Manager.', 1, 2, 1, 0, CAST(N'2022-03-26T13:55:42.7900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (709, 12, 51, N'Passport of New Manager (all corner proper visible)', 1, N'Please Provide Passport of New Manager (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:55:42.7933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (710, 12, 51, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-26T13:55:42.8000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (711, 12, 51, N'Emirates ID of New Manager', 1, N'Please Provide Emirates ID of New Manager.', 1, 3, 1, 0, CAST(N'2022-03-26T13:55:42.8000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (712, 12, 51, N'Comment (If Any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-26T13:55:42.8033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (718, 14, 53, N'Upload Additional Document (If any)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-03-26T13:58:51.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (719, 14, 53, N'Visit / Resident visa of Remove Manager', 1, N'Please Provide Visit / Resident visa of Remove Manager.', 1, 2, 1, 0, CAST(N'2022-03-26T13:58:51.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (720, 14, 53, N'Comment (If Any)', 0, NULL, 0, 5, 1, 0, CAST(N'2022-03-26T13:58:51.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (721, 14, 53, N'Passport of Remove Manager (all corner proper visible)', 1, N'Please Provide Passport of Remove Manager (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T13:58:51.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (722, 14, 53, N'Emirates ID of Remove Manager', 1, N'Please Provide Emirates ID of Remove Manager.', 1, 3, 1, 0, CAST(N'2022-03-26T13:58:51.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (723, 13, 52, N'New Manager Name ', 1, N'Please Provide Name of New Manager.', 0, 4, 1, 0, CAST(N'2022-03-26T14:01:41.9400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (724, 13, 52, N'Emirates ID of New Manager (If Available)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-03-26T14:01:41.9400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (725, 13, 52, N'Passport of New Manager (all corner proper visible)', 1, N'Please Provide Passport of New Manager (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-03-26T14:01:41.9400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (726, 13, 52, N'Upload Additional Document (If any)', 0, NULL, 1, 8, 1, 0, CAST(N'2022-03-26T14:01:41.9466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (727, 13, 52, N'Remove Manager Name', 1, N'Please Provide Name of Manager which you want to Remove.', 0, 7, 1, 0, CAST(N'2022-03-26T14:01:41.9466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (728, 13, 52, N'Visit / Resident visa of New Manager', 1, N'Please Provide Visit / Resident visa of New Manager.', 1, 2, 1, 0, CAST(N'2022-03-26T14:01:41.9466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (729, 13, 52, N'New Manager Name', 1, N'Please Provide Name of New Manager.', 0, 5, 1, 0, CAST(N'2022-03-26T14:01:41.9466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (730, 13, 52, N'Remove Manager Name', 1, N'Please Provide Name of Manager which you want to Remove.', 0, 6, 1, 0, CAST(N'2022-03-26T14:01:41.9566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (731, 13, 52, N'Comment (If Any)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-03-26T14:01:41.9566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (732, 15, 54, N'Add New Activity', 1, N'Please Provide New Activity.', 0, 1, 1, 0, CAST(N'2022-03-26T14:05:18.5033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (733, 15, 54, N'Remove Activity', 1, N'Please Provide Activity which you want to Remove.', 0, 2, 1, 0, CAST(N'2022-03-26T14:05:18.5033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (734, 19, 58, N'Company Name - Option 3', 1, N'Please Provide Name of Company by which you want to Change Your Company Name.', 0, 3, 1, 0, CAST(N'2022-03-26T14:07:35.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (735, 19, 58, N'Company Name - Option 1', 1, N'Please Provide Name of Company by which you want to Change Your Company Name.', 0, 1, 1, 0, CAST(N'2022-03-26T14:07:35.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (736, 19, 58, N'Company Name - Option 2', 1, N'Please Provide Name of Company by which you want to Change Your Company Name.', 0, 2, 1, 0, CAST(N'2022-03-26T14:07:35.6900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (737, 18, 57, N'New Telephone Number', 1, N'Please Provide New Telephone Number.', 0, 2, 1, 0, CAST(N'2022-03-26T14:10:03.1266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (738, 18, 57, N'New Email-Id', 1, N'Please Provide New Email Id.', 0, 1, 1, 0, CAST(N'2022-03-26T14:10:03.1266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (739, 18, 57, N'New Fax Number', 1, N'Please Provide New Fax Number.', 0, 4, 1, 0, CAST(N'2022-03-26T14:10:03.1266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (740, 18, 57, N'New Mobile Number', 1, N'Please Provide New Mobile Number.', 0, 3, 1, 0, CAST(N'2022-03-26T14:10:03.1266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (741, 127, 124, N'Comment (If Any)', 0, NULL, 0, 14, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (742, 127, 124, N'Passport of Remove Partner/Shareholder (all corner proper visible)', 1, N'Please Provide Passport of Remove Partner/Shareholder (all corner proper visible).', 1, 1, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (743, 127, 124, N'Visit / Resident visa of Remove Partner/Shareholder', 1, N'Please Provide Visit / Resident visa of Remove Partner/Shareholder.', 1, 2, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (744, 127, 124, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Provide Upload Latest Ejari (Tenancy Contract).', 1, 12, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (745, 127, 124, N'Remove Shareholder Share (%)', 1, N'Please Provide Remove Shareholder Share (%).', 0, 5, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (746, 127, 124, N'Existing Shareholder Share (%)', 0, NULL, 0, 11, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (747, 127, 124, N'Existing Shareholder Name', 0, NULL, 0, 6, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (748, 127, 124, N'Remove Shareholder Name', 1, N'Please Provide Name of Shareholder which you want to Remove.', 0, 4, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (749, 127, 124, N'Existing Shareholder Name', 0, NULL, 0, 10, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (750, 127, 124, N'Upload Additional Document (If any)', 0, NULL, 1, 13, 1, 0, CAST(N'2022-04-11T12:39:16.9283317' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (751, 127, 124, N'Existing Shareholder Name', 0, NULL, 0, 8, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (752, 127, 124, N'Emirates ID of Remove Partner/Shareholder', 1, N'Please Provide Emirates ID of Remove Partner/Shareholder.', 1, 3, 1, 0, CAST(N'2022-04-11T12:39:16.9273338' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (753, 127, 124, N'Existing Shareholder Share (%)', 0, NULL, 0, 7, 1, 0, CAST(N'2022-04-11T12:39:16.9283317' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (754, 127, 124, N'Existing Shareholder Share (%)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-04-11T12:39:16.9293286' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (755, 129, 125, N'Upload Residency Visa Copy', 1, N'Please Upload Residency Visa Copy.', 1, 4, 1, 0, CAST(N'2022-04-27T13:22:13.2239731' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (756, 129, 125, N'Upload Additional Document (If any)', 0, NULL, 1, 5, 1, 0, CAST(N'2022-04-27T13:22:13.2239731' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (757, 129, 125, N'Upload Passport Copy', 1, N'Please Upload Passport Copy.', 1, 2, 1, 0, CAST(N'2022-04-27T13:22:13.2239731' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (758, 129, 125, N'Upload Latest Ejari (Tenancy Contract)', 1, N'Please Upload Latest Ejari (Tenancy Contract).', 1, 1, 1, 0, CAST(N'2022-04-27T13:22:13.2239731' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (759, 129, 125, N'Comment (If any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-04-27T13:22:13.2239731' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (760, 129, 125, N'Upload Shareholder''s Passport Copy', 1, N'Please Upload Shareholder''s Passport Copy.', 1, 3, 1, 0, CAST(N'2022-04-27T13:22:13.2239731' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (761, 130, 126, N'Upload Shareholder''s Passport Copy', 1, N'Please Upload Shareholder''s Passport Copy', 1, 1, 1, 0, CAST(N'2022-05-10T11:22:57.7971042' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (762, 130, 126, N'Upload Additional Documents(If Any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:22:57.7971042' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (763, 130, 126, N'Comment (If Any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-05-10T11:22:57.7971042' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (764, 130, 126, N'Upload Residency Visa / Visit Visa', 1, N'Please Upload Residency Visa / Visit Visa', 1, 2, 1, 0, CAST(N'2022-05-10T11:22:57.7971042' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (765, 131, 127, N'Upload Residency Visa / Visit Visa', 1, N'Please Upload Residency Visa / Visit Visa', 1, 2, 1, 0, CAST(N'2022-05-10T11:24:15.5295993' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (766, 131, 127, N'Upload Shareholder''s Passport Copy', 1, N'Please Upload Shareholder''s Passport Copy', 1, 1, 1, 0, CAST(N'2022-05-10T11:24:15.5306005' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (767, 131, 127, N'Comment (If Any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-05-10T11:24:15.5295993' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (768, 131, 127, N'Upload Additional Documents(If Any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:24:15.5306005' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (797, 93, 2, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T11:52:57.4655748' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (798, 93, 2, N'Applicant Passport Copy (Front)', 0, NULL, 1, 1, 1, 0, CAST(N'2022-05-10T11:52:57.4655748' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (799, 93, 2, N'Upload Additional Documents (If Any)', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T11:52:57.4655748' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (800, 93, 2, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T11:52:57.4665739' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (801, 93, 2, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T11:52:57.4665739' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (802, 93, 2, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T11:52:57.4655748' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (803, 93, 2, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:52:57.4655748' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (804, 94, 3, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (805, 94, 3, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (806, 94, 3, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (807, 94, 3, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (808, 94, 3, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (809, 94, 3, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (810, 94, 3, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T11:54:03.0408956' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (811, 95, 4, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:55:03.4409452' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (812, 95, 4, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T11:55:03.4409452' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (813, 95, 4, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T11:55:03.4409452' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (814, 95, 4, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T11:55:03.4409452' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (815, 95, 4, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T11:55:03.4419426' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (816, 95, 4, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T11:55:03.4419426' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (817, 95, 4, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T11:55:03.4429505' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (818, 96, 5, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (819, 96, 5, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (820, 96, 5, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (821, 96, 5, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (822, 96, 5, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (823, 96, 5, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (824, 96, 5, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T11:56:35.4445745' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (825, 97, 6, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (826, 97, 6, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (827, 97, 6, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (828, 97, 6, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (829, 97, 6, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (830, 97, 6, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (831, 97, 6, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T11:58:10.6784404' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (832, 98, 7, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T11:59:07.9250033' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (833, 98, 7, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T11:59:07.9250033' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (834, 98, 7, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T11:59:07.9250033' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (835, 98, 7, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T11:59:07.9250033' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (836, 98, 7, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T11:59:07.9250033' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (837, 98, 7, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T11:59:07.9250033' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (838, 98, 7, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T11:59:07.9399653' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (839, 99, 8, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:02:44.4097574' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (840, 99, 8, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:02:44.4097574' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (841, 99, 8, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:02:44.4386794' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (842, 99, 8, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:02:44.4386794' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (843, 99, 8, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:02:44.4386794' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (844, 99, 8, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:02:44.4386794' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (845, 99, 8, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:02:44.4386794' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (846, 100, 9, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:03:32.1743782' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (847, 100, 9, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:03:32.1743782' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (848, 100, 9, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:03:32.1743782' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (849, 100, 9, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:03:32.1743782' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (850, 100, 9, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:03:32.1743782' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (851, 100, 9, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:03:32.1743782' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (852, 100, 9, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:03:32.1773714' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (853, 101, 10, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:04:25.1256416' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (854, 101, 10, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:04:25.1256416' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (855, 101, 10, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:04:25.1256416' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (856, 101, 10, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:04:25.1256416' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (857, 101, 10, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:04:25.1266381' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (858, 101, 10, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:04:25.1266381' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (859, 101, 10, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:04:25.1296307' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (860, 102, 11, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:05:18.1512165' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (861, 102, 11, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:05:18.1512165' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (862, 102, 11, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:05:18.1512165' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (863, 102, 11, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:05:18.1512165' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (864, 102, 11, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:05:18.1512165' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (865, 102, 11, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:05:18.1591950' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (866, 102, 11, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:05:18.1611891' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (867, 103, 12, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:06:28.0935319' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (868, 103, 12, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:06:28.0935319' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (869, 103, 12, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:06:28.0935319' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (870, 103, 12, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:06:28.0935319' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (871, 103, 12, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:06:28.0935319' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (872, 103, 12, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:06:28.0935319' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (873, 103, 12, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:06:28.1000248' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (874, 104, 13, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:07:22.1950075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (875, 104, 13, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:07:22.1950075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (876, 104, 13, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:07:22.1950075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (877, 104, 13, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:07:22.1950075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (878, 104, 13, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:07:22.1950075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (879, 104, 13, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:07:22.1950075' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (880, 104, 13, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:07:22.2106045' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (881, 105, 14, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:08:14.1062060' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (882, 105, 14, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:08:14.1062060' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (883, 105, 14, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:08:14.1062060' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (884, 105, 14, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:08:14.1062060' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (885, 105, 14, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:08:14.1062060' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (886, 105, 14, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:08:14.1072043' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (887, 105, 14, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:08:14.1072043' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (888, 106, 15, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (889, 106, 15, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (890, 106, 15, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (891, 106, 15, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (892, 106, 15, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (893, 106, 15, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (894, 106, 15, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:09:00.9332409' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (895, 107, 16, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:09:54.3698211' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (896, 107, 16, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:09:54.3698211' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (897, 107, 16, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:09:54.3698211' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (898, 107, 16, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:09:54.3698211' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (899, 107, 16, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:09:54.3738089' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (900, 107, 16, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:09:54.3807919' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (901, 107, 16, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:09:54.3807919' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (902, 108, 18, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:10:48.8397448' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (903, 108, 18, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:10:48.8397448' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (904, 108, 18, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:10:48.8397448' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (905, 108, 18, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:10:48.8397448' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (906, 108, 18, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:10:48.8457301' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (907, 108, 18, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:10:48.8457301' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (908, 108, 18, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:10:48.8457301' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (909, 109, 19, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (910, 109, 19, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (911, 109, 19, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (912, 109, 19, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (913, 109, 19, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (914, 109, 19, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (915, 109, 19, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:11:44.3721690' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (916, 111, 21, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:12:43.2728442' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (917, 111, 21, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:12:43.2728442' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (918, 111, 21, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:12:43.2728442' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (919, 111, 21, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:12:43.2758361' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (920, 111, 21, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:12:43.2788277' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (921, 111, 21, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:12:43.2788277' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (922, 111, 21, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:12:43.2788277' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (923, 112, 22, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (924, 112, 22, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (925, 112, 22, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (926, 112, 22, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (927, 112, 22, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (928, 112, 22, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (929, 112, 22, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:13:41.5335108' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (930, 113, 23, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:14:30.7059226' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (931, 113, 23, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:14:30.7059226' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (932, 113, 23, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:14:30.7059226' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (933, 113, 23, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:14:30.7059226' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (934, 113, 23, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:14:30.7159046' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (935, 113, 23, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:14:30.7159046' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (936, 113, 23, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:14:30.7159046' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (937, 114, 24, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:15:18.2893793' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (938, 114, 24, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:15:18.2893793' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (939, 114, 24, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:15:18.2893793' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (940, 114, 24, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:15:18.2893793' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (941, 114, 24, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:15:18.3043408' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (942, 114, 24, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:15:18.3043408' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (943, 114, 24, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:15:18.3043408' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (944, 115, 25, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:16:21.0530323' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (945, 115, 25, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:16:21.0530323' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (946, 115, 25, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:16:21.0530323' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (947, 115, 25, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:16:21.0640017' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (948, 115, 25, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:16:21.0640017' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (949, 115, 25, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:16:21.0640017' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (950, 115, 25, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:16:21.0640017' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (951, 116, 26, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:18:02.8111797' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (952, 116, 26, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:18:02.8111797' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (953, 116, 26, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:18:02.8111797' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (954, 116, 26, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:18:02.8131744' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (955, 116, 26, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:18:02.8131744' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (956, 116, 26, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:18:02.8241457' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (957, 116, 26, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:18:02.8281368' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (958, 117, 27, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:19:28.4222650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (959, 117, 27, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:19:28.4222650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (960, 117, 27, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:19:28.4222650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (961, 117, 27, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:19:28.4222650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (962, 117, 27, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:19:28.4222650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (963, 117, 27, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:19:28.4222650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (964, 117, 27, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:19:28.4242596' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (965, 118, 28, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:20:18.3104073' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (966, 118, 28, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:20:18.3104073' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (967, 118, 28, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:20:18.3104073' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (968, 118, 28, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:20:18.3104073' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (969, 118, 28, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:20:18.3114057' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (970, 118, 28, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:20:18.3114057' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (971, 118, 28, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:20:18.3114057' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (972, 119, 30, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:21:08.4453877' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (973, 119, 30, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:21:08.4453877' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (974, 119, 30, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:21:08.4453877' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (975, 119, 30, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:21:08.4453877' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (976, 119, 30, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:21:08.4453877' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (977, 119, 30, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:21:08.4453877' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (978, 119, 30, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:21:08.4548707' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (979, 120, 17, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:21:53.8088021' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (980, 120, 17, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:21:53.8088021' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (981, 120, 17, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:21:53.8088021' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (982, 120, 17, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:21:53.8098603' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (983, 120, 17, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:21:53.8098603' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (984, 120, 17, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:21:53.8129241' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (985, 120, 17, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:21:53.8129241' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (986, 121, 31, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (987, 121, 31, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (988, 121, 31, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (989, 121, 31, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (990, 121, 31, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (991, 121, 31, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (992, 121, 31, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:22:40.4944498' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (993, 122, 32, N'Visit Visa/Immigration Cancellation', 0, NULL, 1, 5, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (994, 122, 32, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (995, 122, 32, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 6, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (996, 122, 32, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (997, 122, 32, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (998, 122, 32, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (999, 122, 32, N'Comment (If Any)', 0, NULL, 0, 8, 1, 0, CAST(N'2022-05-10T12:23:31.4056447' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1000, 0, 128, N'Upload Shareholder''s Passport Copy ', 1, N'Please Upload Shareholder''s Passport Copy ', 1, 1, 1, 0, CAST(N'2022-05-10T19:41:24.2381513' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1001, 0, 128, N'Upload Residency Visa / Visit Visa', 1, N'Please Upload Residency Visa / Visit Visa', 1, 2, 1, 0, CAST(N'2022-05-10T19:41:24.2381513' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1002, 0, 128, N'Upload Additional Documents(If Any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T19:41:24.2548061' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1003, 0, 128, N'Comment (If Any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-05-10T19:41:24.2568194' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1004, 0, 129, N'Upload Shareholder''s Passport Copy', 1, N'Please Upload Shareholder''s Passport Copy', 1, 1, 1, 0, CAST(N'2022-05-10T19:42:50.0280860' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1005, 0, 129, N'Upload Residency Visa / Visit Visa ', 1, N'Please Upload Residency Visa / Visit Visa ', 1, 2, 1, 0, CAST(N'2022-05-10T19:42:50.0290913' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1006, 0, 129, N'Upload Additional Documents(If Any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T19:42:50.0331406' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1007, 0, 129, N'Comment (If Any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-05-10T19:42:50.2398579' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1008, 134, 130, N'Comment (If Any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-05-10T19:50:59.7716633' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1009, 134, 130, N'Upload Shareholder''s Passport Copy', 1, N'Please Upload Shareholder''s Passport Copy', 1, 1, 1, 0, CAST(N'2022-05-10T19:50:59.7716633' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1010, 134, 130, N'Upload Additional Documents(If Any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T19:50:59.7746872' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1011, 134, 130, N'Upload Residency Visa / Visit Visa', 1, N'Please Upload Residency Visa / Visit Visa', 1, 2, 1, 0, CAST(N'2022-05-10T19:50:59.7756897' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1012, 135, 131, N'Upload Additional Documents(If Any)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-05-10T19:52:58.1534653' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1013, 135, 131, N'Upload Residency Visa / Visit Visa', 1, N'Please Upload Residency Visa / Visit Visa', 1, 2, 1, 0, CAST(N'2022-05-10T19:52:58.1534653' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1014, 135, 131, N'Upload Shareholder''s Passport Copy', 1, N'Please Upload Shareholder''s Passport Copy', 1, 1, 1, 0, CAST(N'2022-05-10T19:52:58.1545656' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1015, 135, 131, N'Comment (If Any)', 0, NULL, 0, 4, 1, 0, CAST(N'2022-05-10T19:52:58.2917452' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1016, 138, 133, N'Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)	', 1, N'Please provide Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, 1, 1, 0, CAST(N'2022-06-24T14:59:49.4451264' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1017, 138, 133, N'Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card)	', 1, N'Please provide Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card).', 1, 2, 1, 0, CAST(N'2022-06-24T14:59:49.4451264' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1018, 138, 133, N'Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card)	', 1, N'Please provide Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card).', 1, 3, 1, 0, CAST(N'2022-06-24T14:59:49.5859849' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1019, 138, 133, N'Upload Additional Document (If any)	', 0, NULL, 1, 4, 1, 0, CAST(N'2022-06-24T14:59:49.7420332' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1020, 138, 133, N'Comment (If any)	', 0, NULL, 0, 5, 1, 0, CAST(N'2022-06-24T14:59:50.2577619' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1021, 139, 134, N'Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)	', 1, N'Please provide Person 1: Passport copy-(Four corner proper visible) (Name will be in Immigration card)', 1, 1, 1, 0, CAST(N'2022-06-24T15:01:09.8368235' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1022, 139, 134, N'Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card)	', 1, N'Please provide Person 2: Passport copy-(Four corner proper visible) (Name will be in Immigration card).', 1, 2, 1, 0, CAST(N'2022-06-24T15:01:09.8524956' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1023, 139, 134, N'Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card)	', 1, N'Please provide Person 3: Passport copy-(Four corner proper visible) (Name will be in Immigration card).', 1, 3, 1, 0, CAST(N'2022-06-24T15:01:09.8524956' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1024, 139, 134, N'Upload Additional Document (If any)	', 0, NULL, 1, 4, 1, 0, CAST(N'2022-06-24T15:01:10.0241943' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1025, 139, 134, N'Comment (If any)	', 0, NULL, 0, 5, 1, 0, CAST(N'2022-06-24T15:01:10.0241943' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1026, 140, 135, N'Person 3: Passport copy (Four corner proper visible) (Name will be in Mohre)	', 1, N'Please Upload Person 3: Passport copy (Four corner proper visible) (Name will be in Mohre).	', 1, 3, 1, 0, CAST(N'2022-06-24T15:02:56.0010703' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1027, 140, 135, N'Person 2: Passport copy (Four corner proper visible) (Name will be in Mohre)	', 1, N'Please Upload Person 2: Passport copy (Four corner proper visible) (Name will be in Mohre).	', 1, 2, 1, 0, CAST(N'2022-06-24T15:02:56.0010703' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1028, 140, 135, N'Person 1: Passport copy (Four corner proper visible) (Name will be in Mohre)	', 1, N'Please Upload Person 1: Passport copy (Four corner proper visible) (Name will be in Mohre).	', 1, 1, 1, 0, CAST(N'2022-06-24T15:02:56.0010703' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1029, 140, 135, N'Upload Additional Document (If any)	', 0, NULL, 1, 4, 1, 0, CAST(N'2022-06-24T15:02:59.3452981' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1030, 140, 135, N'Comment (If any)	', 0, NULL, 0, 5, 1, 0, CAST(N'2022-06-24T15:02:59.8297054' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1031, 141, 136, N'Person 1: Passport copy (Four corner proper visible) (Name will be in Mohre)	', 1, N'Please Upload Person 1: Passport copy (Four corner proper visible) (Name will be in Mohre).	', 1, 1, 1, 0, CAST(N'2022-06-24T15:04:02.6791218' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1032, 141, 136, N'Person 3: Passport copy (Four corner proper visible) (Name will be in Mohre)	', 1, N'Please Upload Person 3: Passport copy (Four corner proper visible) (Name will be in Mohre).	', 1, 3, 1, 0, CAST(N'2022-06-24T15:04:02.6791218' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1033, 141, 136, N'Person 2: Passport copy (Four corner proper visible) (Name will be in Mohre)	', 1, N'Please Upload Person 2: Passport copy (Four corner proper visible) (Name will be in Mohre).	', 1, 2, 1, 0, CAST(N'2022-06-24T15:04:02.6791218' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1034, 141, 136, N'Upload Additional Document (If any)	', 0, NULL, 1, 4, 1, 0, CAST(N'2022-06-24T15:04:02.8200305' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1035, 141, 136, N'Comment (If any)	', 0, NULL, 0, 5, 1, 0, CAST(N'2022-06-24T15:04:02.8356997' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1036, 93, 2, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 7, 1, 0, CAST(N'2022-06-24T15:05:14.2803629' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1037, 94, 3, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:05:59.0330475' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1038, 95, 4, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:06:32.6127238' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1039, 96, 5, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:07:01.1923175' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1040, 97, 6, N'Applicant Name', 1, N'Please Provide Applicant Name', 0, 1, 1, 0, CAST(N'2022-06-24T15:07:43.0690694' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1041, 98, 7, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:08:13.7107523' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1042, 99, 8, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:08:47.3372205' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1043, 100, 9, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:09:18.2129672' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1044, 101, 10, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:10:03.8393839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1045, 102, 11, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:10:33.7468266' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1046, 103, 12, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:11:04.9993042' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1047, 104, 13, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:11:47.9400665' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1048, 105, 14, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:12:34.0052409' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1049, 106, 15, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:13:04.3035308' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1050, 107, 16, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:13:33.4145346' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1051, 108, 18, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:14:01.6812924' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1052, 109, 19, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:14:36.7607050' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1053, 110, 20, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:15:04.1836538' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1054, 111, 21, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:15:47.7631603' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1055, 112, 22, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:16:11.9824654' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1056, 113, 23, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:16:37.1548919' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1057, 114, 24, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:17:03.2669716' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1058, 115, 25, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:17:31.7366765' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1059, 116, 26, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:18:01.4409609' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1060, 117, 27, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:18:40.0357272' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1061, 118, 28, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:19:14.1764560' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1062, 119, 30, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:19:41.1456737' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1063, 120, 17, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:20:09.1772745' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1064, 121, 31, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:20:39.3342277' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1065, 122, 32, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:21:19.1971368' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1066, 123, 33, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:21:48.3693569' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1067, 124, 29, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-06-24T15:22:27.4637895' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1068, 143, 137, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-08-22T17:09:51.9195319' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1069, 143, 137, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-08-22T17:09:51.9195319' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1070, 143, 137, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-08-22T17:09:51.9195319' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1071, 143, 137, N'Applicant Visa Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2022-08-22T17:09:52.0599256' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1072, 143, 137, N'Comment (If Any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-08-22T17:09:52.0755821' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1073, 143, 137, N'Emirates ID Copy', 0, NULL, 1, 5, 1, 0, CAST(N'2022-08-22T17:09:52.0912381' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1074, 145, 138, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-08-22T17:25:26.4866950' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1075, 145, 138, N'Applicant Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2022-08-22T17:25:26.4866950' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1076, 145, 138, N'Applicant Visa Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2022-08-22T17:25:26.6427619' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1077, 145, 138, N'Emirates ID Copy', 0, NULL, 1, 5, 1, 0, CAST(N'2022-08-22T17:25:26.6427619' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1078, 145, 138, N'Applicant Passport Copy (Backside)', 0, NULL, 1, 3, 1, 0, CAST(N'2022-08-22T17:25:26.7836764' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1079, 145, 138, N'Comment (If Any)', 0, NULL, 0, 6, 1, 0, CAST(N'2022-08-22T17:25:27.0493170' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1080, 147, 140, N'Emirates Id', 1, N'Please Provide Emirates Id.', 1, 5, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1081, 147, 140, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 7, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1082, 147, 140, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 6, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1083, 147, 140, N'Applicant Passport Copy (Backside)', 1, N'Please Provide Applicant Passport Copy (Backside).', 1, 3, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1084, 147, 140, N'Visa', 1, N'Please Provide Visa.', 1, 4, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1085, 147, 140, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1086, 147, 140, N'Applicant Passport Copy (Front)', 1, N'Please Provide Applicant Passport Copy (Front).', 1, 2, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1087, 147, 140, N'Upload Additional Documents (If Any)', 0, NULL, 1, 8, 1, 0, CAST(N'2022-11-23T18:11:58.7388667' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1088, 147, 140, N'Comment (If Any)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-11-23T18:11:58.7433869' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1089, 148, 141, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 7, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1090, 148, 141, N'Applicant Passport Copy (Front)', 1, N'Please Provide Applicant Passport Copy (Front).', 1, 2, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1091, 148, 141, N'Applicant Passport Copy (Backside)', 1, N'Please Provide Applicant Passport Copy (Backside).', 1, 3, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1092, 148, 141, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 6, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1093, 148, 141, N'Emirates Id', 1, N'Please Provide Emirates Id.', 1, 5, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1094, 148, 141, N'Applicant Name', 1, N'Please Provide Applicant Name.', 0, 1, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1095, 148, 141, N'Visa', 1, N'Please Provide Visa.', 1, 4, 1, 0, CAST(N'2022-11-23T18:15:18.0539839' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1096, 148, 141, N'Upload Additional Documents (If Any)', 0, NULL, 1, 8, 1, 0, CAST(N'2022-11-23T18:15:18.0559889' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1097, 148, 141, N'Comment (If Any)', 0, NULL, 0, 9, 1, 0, CAST(N'2022-11-23T18:15:18.0569868' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1098, 136, 132, N'Passport Copy', 1, N'Please provide your passport copy.', 1, 2, 1, 0, CAST(N'2023-04-15T17:16:26.6609264' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1099, 136, 132, N'Degree Certificate', 0, NULL, 1, 5, 1, 0, CAST(N'2023-04-15T17:16:26.6609264' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1100, 136, 132, N'Upload Additional Documents (If Any)', 0, NULL, 1, 6, 1, 0, CAST(N'2023-04-15T17:16:26.6609264' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1101, 136, 132, N'Photograph', 1, N'Please provide your Photograph.', 1, 4, 1, 0, CAST(N'2023-04-15T17:16:26.6609264' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1102, 136, 132, N'Visa Copy', 1, N'Please provide your visa copy.', 1, 3, 1, 0, CAST(N'2023-04-15T17:16:26.6609264' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1103, 136, 132, N'Applicant Name', 1, N'Please provide applicant name.', 0, 1, 1, 0, CAST(N'2023-04-15T17:16:26.6609264' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1104, 149, 142, N'Visa copy', 0, NULL, 1, 3, 1, 0, CAST(N'2023-08-24T14:31:29.8185735' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1105, 149, 142, N'Emirates ID Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2023-08-24T14:31:29.8185735' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1106, 149, 142, N'Passport copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-08-24T14:31:29.8185735' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1107, 149, 142, N'Applicant Name', 1, N'Please provide Applicant Name', 0, 1, 1, 0, CAST(N'2023-08-24T14:40:01.9391984' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1108, 149, 142, N'Comment', 1, N'other information ', 0, 5, 1, 0, CAST(N'2023-08-24T15:35:47.6293150' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1109, 150, 143, N'1 Quota : ', 1, N'designation ', 0, 1, 1, 0, CAST(N'2023-08-26T14:03:54.0959121' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1110, 150, 143, N'3 Quota :', 0, N'	designation', 0, 3, 1, 0, CAST(N'2023-08-26T14:03:54.0959121' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1111, 150, 143, N'2 Quota : ', 0, N'	designation', 0, 2, 1, 0, CAST(N'2023-08-26T14:03:54.0959121' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1112, 150, 143, N'5 Quota :', 0, N'designation', 0, 6, 1, 0, CAST(N'2023-08-29T12:54:27.1771351' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1113, 150, 143, N'4 Quota :', 0, N'	designation', 0, 4, 1, 0, CAST(N'2023-08-29T12:54:27.1771351' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1114, 151, 144, N'visa copy ', 0, NULL, 0, 3, 1, 0, CAST(N'2023-09-22T11:34:42.7256931' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1115, 151, 144, N'Applicant name', 0, NULL, 0, 0, 1, 0, CAST(N'2023-09-22T11:34:42.7256931' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1116, 151, 144, N'passport copy ', 0, NULL, 0, 2, 1, 0, CAST(N'2023-09-22T11:34:42.7256931' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1117, 151, 144, N'Emirates ID ', 0, NULL, 0, 4, 1, 0, CAST(N'2023-09-22T11:34:42.7256931' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1118, 152, 145, N'Trade mark Name', 0, NULL, 0, 1, 1, 0, CAST(N'2023-10-10T18:08:47.1643941' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1119, 152, 145, N'Company Logo', 0, NULL, 0, 2, 1, 0, CAST(N'2023-10-10T18:08:47.1643941' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1120, 153, 146, N'Name', 0, NULL, 0, 1, 1, 0, CAST(N'2023-10-10T18:11:58.6789731' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1121, 153, 146, N'Emirates Id', 0, NULL, 0, 4, 1, 0, CAST(N'2023-10-10T18:11:58.6789731' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1122, 153, 146, N'Visa', 0, NULL, 0, 3, 1, 0, CAST(N'2023-10-10T18:11:58.6789731' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1123, 153, 146, N'Passport', 0, NULL, 0, 2, 1, 0, CAST(N'2023-10-10T18:11:58.6945328' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1124, 156, 147, N'Applicant name ', 1, N'name ', 0, 1, 1, 0, CAST(N'2023-10-10T18:18:10.0354346' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1125, 156, 147, N'Passport copy', 0, N'passport ', 1, 2, 1, 0, CAST(N'2023-10-10T18:18:10.0510388' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1126, 156, 147, N'Visa copy ', 0, N'visa ', 1, 3, 1, 0, CAST(N'2023-10-10T18:18:10.0510388' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1127, 156, 147, N'Emirates ID ', 0, N'EID ', 1, 4, 1, 0, CAST(N'2023-10-10T18:18:10.0510388' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1128, 157, 148, N'Emirates Id Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-10T18:20:43.8778901' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1129, 157, 148, N'Visa Copy', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-10T18:20:43.8778901' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1130, 157, 148, N'Passport Copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-10T18:20:43.8985169' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1131, 157, 148, N'Applicant name', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-10T18:20:43.8985169' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1132, 158, 149, N'Passport copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-11T11:00:54.0223478' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1133, 158, 149, N'Visa Copy', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-11T11:00:54.0223478' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1134, 158, 149, N'Emirates Id', 0, NULL, 0, 4, 1, 0, CAST(N'2023-10-11T11:00:54.0223478' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1135, 158, 149, N'Applicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-11T11:00:54.0379635' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1136, 158, 149, N'Comment', 1, N'Comment', 0, 5, 1, 0, CAST(N'2023-10-11T11:00:54.0379635' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1137, 159, 150, N'Comment', 1, N'Comment', 0, 5, 1, 0, CAST(N'2023-10-11T11:03:47.2870604' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1138, 159, 150, N'Emirates Id', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-11T11:03:47.2870604' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1139, 159, 150, N'Passport Copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-11T11:03:47.2870604' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1140, 159, 150, N'Visa Copy', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-11T11:03:47.2870604' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1141, 159, 150, N'Applicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-11T11:03:47.3026819' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1142, 161, 151, N'Applicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-13T10:43:59.4610888' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1143, 161, 151, N'Comment (If Any)', 1, N'Name', 0, 6, 1, 0, CAST(N'2023-10-13T10:43:59.4610888' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1144, 161, 151, N'Degree Certificate (Mofa Attasted) If high Skill', 0, NULL, 1, 5, 1, 0, CAST(N'2023-10-13T10:43:59.4610888' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1145, 161, 151, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-13T10:43:59.4462648' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1146, 161, 151, N'Passport Copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-13T10:43:59.4610888' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1147, 161, 151, N'Visa Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-13T10:43:59.4805757' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1148, 162, 152, N'Visa copy', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-16T17:19:37.3919203' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1149, 162, 152, N'Passport copy Front', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-16T17:19:37.3919203' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1150, 162, 152, N'Comments', 1, N'Comments', 0, 7, 1, 0, CAST(N'2023-10-16T17:19:37.3919203' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1151, 162, 152, N'License', 0, NULL, 1, 1, 1, 0, CAST(N'2023-10-16T17:19:37.3919203' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1152, 162, 152, N'Emirates ID copy', 0, NULL, 1, 6, 1, 0, CAST(N'2023-10-16T17:19:37.3919203' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1153, 162, 152, N'Passport copy Back', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-16T17:19:37.3919203' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1154, 163, 153, N'Emirates Id Copy', 0, NULL, 1, 6, 1, 0, CAST(N'2023-10-17T14:48:48.8655151' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1155, 163, 153, N'Comment', 1, N'Comment', 0, 7, 1, 0, CAST(N'2023-10-17T14:48:48.8655151' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1156, 163, 153, N'Visa / Cancellation visa', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-17T14:48:48.8655151' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1157, 163, 153, N'Passport Copy Back', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-17T14:48:48.8655151' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1158, 163, 153, N'Applicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-17T14:48:48.8655151' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1159, 163, 153, N'Passport Copy Front', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-17T14:48:48.8810891' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1160, 164, 154, N'Passport Copy Back', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-20T11:32:44.8678020' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1161, 164, 154, N'Passport Copy Front', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-20T11:32:44.8678020' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1162, 164, 154, N'Comment', 1, N'Comment', 0, 5, 1, 0, CAST(N'2023-10-20T11:32:44.8678020' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1163, 164, 154, N'Applicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-20T11:32:44.9069606' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1164, 164, 154, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-20T11:32:44.9069606' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1165, 165, 155, N'Comments', 1, N'Comments', 0, 10, 1, 0, CAST(N'2023-10-25T16:02:00.5836993' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1166, 165, 155, N'Applicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-25T16:02:00.5836993' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1167, 165, 155, N'Passport copy front', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-25T16:02:00.5836993' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1168, 165, 155, N'Passport copy back', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-25T16:02:00.5836993' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1169, 165, 155, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 7, 1, 0, CAST(N'2023-10-25T16:02:00.5836993' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1170, 165, 155, N'Visa copy', 0, NULL, 1, 8, 1, 0, CAST(N'2023-10-25T16:02:00.6088886' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1171, 165, 155, N'Emirates id', 0, NULL, 1, 9, 1, 0, CAST(N'2023-10-25T16:02:00.6136790' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1172, 166, 156, N'Passport copy (Back)', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-30T13:32:05.6558356' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1173, 166, 156, N'Passport copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-30T13:32:05.6558356' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1174, 166, 156, N'Comments', 1, N'Comments', 0, 7, 1, 0, CAST(N'2023-10-30T13:32:05.6558356' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1175, 166, 156, N'Apploicate', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-30T13:32:05.6558356' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1176, 166, 156, N'Emirates id', 0, NULL, 1, 5, 1, 0, CAST(N'2023-10-30T13:32:05.6558356' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1177, 166, 156, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 6, 1, 0, CAST(N'2023-10-30T13:32:05.6558356' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1178, 166, 156, N'Visa copy', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-30T13:32:05.6714168' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1179, 167, 157, N'Emirates Id', 0, NULL, 1, 6, 1, 0, CAST(N'2023-10-31T09:46:58.6883893' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1180, 167, 157, N'Applicent', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-10-31T09:46:58.7040159' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1181, 167, 157, N'Comments', 1, N'Comments', 0, 7, 1, 0, CAST(N'2023-10-31T09:46:58.7040159' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1182, 167, 157, N'Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2023-10-31T09:46:58.7040159' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1183, 167, 157, N'Visa Copy', 0, NULL, 1, 5, 1, 0, CAST(N'2023-10-31T09:46:58.7040159' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1184, 167, 157, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 4, 1, 0, CAST(N'2023-10-31T09:46:58.7196425' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1185, 167, 157, N'Passport copy (Back)', 0, NULL, 1, 3, 1, 0, CAST(N'2023-10-31T09:46:58.7196425' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1186, 168, 158, N'Passport Copy (Back)', 0, NULL, 1, 5, 1, 0, CAST(N'2023-12-06T15:46:52.3734791' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1187, 168, 158, N'Name', 1, N'Name', 0, 1, 1, 0, CAST(N'2023-12-06T15:46:52.3734791' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1188, 168, 158, N'Comments', 1, N'Comments', 1, 6, 1, 0, CAST(N'2023-12-06T15:46:52.3734791' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1189, 168, 158, N'Passport Copy (Front)', 0, NULL, 1, 4, 1, 0, CAST(N'2023-12-06T15:46:52.3734791' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1190, 169, 159, N'Visa copy', 0, NULL, 1, 3, 1, 0, CAST(N'2023-12-11T16:43:19.9073644' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1191, 169, 159, N'License copy', 0, NULL, 1, 1, 1, 0, CAST(N'2023-12-11T16:43:19.9073644' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1192, 169, 159, N'Passport copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-12-11T16:43:19.9073644' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1193, 170, 160, N'Passport Copy', 0, NULL, 1, 2, 1, 0, CAST(N'2023-12-11T16:48:02.8228966' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1194, 170, 160, N'Comment', 1, N'Comment', 0, 4, 1, 0, CAST(N'2023-12-11T16:48:02.8228966' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1195, 170, 160, N'License Copy', 0, NULL, 1, 1, 1, 0, CAST(N'2023-12-11T16:48:02.8228966' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1196, 170, 160, N'Visa Copy', 0, NULL, 1, 3, 1, 0, CAST(N'2023-12-11T16:48:02.8385180' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1197, 171, 161, N'Upload Additional Document (If any', 0, NULL, 1, 2, 1, 0, CAST(N'2023-12-11T16:55:04.7735721' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1198, 171, 161, N'Comment (If any)', 1, N'Comment (If any)', 0, 3, 1, 0, CAST(N'2023-12-11T16:55:04.7891960' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1199, 171, 161, N'Upload Latest Ejari (Tenancy Contract)*', 0, NULL, 1, 1, 1, 0, CAST(N'2023-12-11T16:55:04.7891960' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1200, 172, 162, N'Visa Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1201, 172, 162, N'Passport copy (Front Page)', 0, NULL, 1, 2, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1202, 172, 162, N'Passport copy (Back Page)', 0, NULL, 1, 3, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1203, 172, 162, N'Applicant ', 1, N'Name', 0, 1, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1204, 172, 162, N'Comment (If any)', 1, N'Comment', 0, 7, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1205, 172, 162, N'Upload Additional Documents (If any)', 0, NULL, 1, 6, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1206, 172, 162, N'Emirates Id', 0, NULL, 1, 5, 1, 0, CAST(N'2024-01-23T15:27:30.3803533' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1207, 173, 163, N'Passport Copy (Front))', 0, NULL, 1, 2, 1, 0, CAST(N'2024-02-08T17:45:04.0512745' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1208, 173, 163, N'Applicant', 1, N'Applicant', 0, 1, 1, 0, CAST(N'2024-02-08T17:45:04.0512745' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1209, 173, 163, N'Passport Copy (Back)', 0, NULL, 1, 3, 1, 0, CAST(N'2024-02-08T17:45:04.0512745' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1210, 173, 163, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 6, 1, 0, CAST(N'2024-02-08T17:45:04.0512745' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1211, 173, 163, N'Visa Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2024-02-08T17:45:04.0512745' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1212, 173, 163, N'Upload Additional Documents (If Any)', 0, NULL, 1, 7, 1, 0, CAST(N'2024-02-08T17:45:04.0512745' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1213, 173, 163, N'Comment (If Any)', 1, N'Comment (If Any)', 0, 8, 1, 0, CAST(N'2024-02-08T17:45:04.0669006' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1214, 173, 163, N'Emirates Id', 0, NULL, 1, 5, 1, 0, CAST(N'2024-02-08T17:45:04.0669006' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1215, 174, 164, N'Passport Copy (Front)', 0, NULL, 1, 2, 1, 0, CAST(N'2024-02-08T17:52:13.0638021' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1216, 174, 164, N'Applicant*', 1, N'Applicant*', 0, 1, 1, 0, CAST(N'2024-02-08T17:52:13.0638021' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1217, 174, 164, N'Comment (If Any)*', 1, N'Comment (If Any)*', 0, 7, 1, 0, CAST(N'2024-02-08T17:52:13.0794293' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1218, 174, 164, N'Photographs (Studio Image with White Background)', 0, NULL, 1, 5, 1, 0, CAST(N'2024-02-08T17:52:13.0794293' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1219, 174, 164, N'Upload Additional Documents (If Any)', 0, NULL, 1, 6, 1, 0, CAST(N'2024-02-08T17:52:13.0794293' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1220, 174, 164, N'Visa Copy', 0, NULL, 1, 4, 1, 0, CAST(N'2024-02-08T17:52:13.0794293' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1221, 174, 164, N'Passport Copy (Back)', 0, NULL, 1, 3, 1, 0, CAST(N'2024-02-08T17:52:13.0794293' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1222, 175, 165, N'FIELD 03', 0, NULL, 0, 3, 1, 0, CAST(N'2024-09-30T13:44:37.3105206' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1223, 175, 165, N'FIELD 02', 0, NULL, 0, 2, 1, 0, CAST(N'2024-09-30T13:44:37.3105206' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1224, 175, 165, N'FIELD 01', 1, N'PLEASE PROVIDE FIELD 01.', 0, 1, 1, 0, CAST(N'2024-09-30T13:44:37.3105206' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1225, 176, 166, N'TESTING FIELD 01', 1, N'PLEASE PROVIDE TESTING FIELD 01.', 0, 1, 1, 0, CAST(N'2024-09-30T13:46:42.5994068' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1226, 176, 166, N'TESTING FIELD 02', 0, NULL, 1, 2, 1, 0, CAST(N'2024-09-30T13:46:42.5994068' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceFormDataField] ([Id], [ServiceId], [FormId], [FieldName], [IsRequired], [IsRequiredMessage], [IsDocumentUpload], [StepNumber], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1227, 176, 166, N'TESTING FIELD 03', 0, NULL, 0, 3, 1, 0, CAST(N'2024-09-30T13:46:42.5994068' AS DateTime2), 285, NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_ServiceFormDataField] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_ServiceForms] ON 
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (1, N' Renewal of License ', 1, 1, 0, CAST(N'2022-03-14T07:18:00.8466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (2, N' Golden Visa (10 Years)', 93, 1, 0, CAST(N'2022-03-14T07:25:05.8800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (3, N'Partner/Investor Visa (2 years)', 94, 1, 0, CAST(N'2022-03-14T07:29:58.9766667' AS DateTime2), 1, CAST(N'2022-11-23T18:06:32.9529033' AS DateTime2), 285)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (4, N' Employment visa - Dubai Mainland (2 Years) ', 95, 1, 0, CAST(N'2022-03-14T07:32:58.9333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (5, N' Family visa (Dependent Visa)', 96, 1, 0, CAST(N'2022-03-14T07:58:01.4300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (6, N' Freelance Visa for 2 Years - Dubai Mainland', 97, 1, 0, CAST(N'2022-03-14T08:08:24.2533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (7, N' Visa for Housemaid  (Tadbeer) ', 98, 1, 0, CAST(N'2022-03-14T08:10:43.3233333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (8, N' Visa for Driver (Tadbeer)', 99, 1, 0, CAST(N'2022-03-14T08:11:44.7000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (9, N' Visa for Coock (Tadbeer) ', 100, 1, 0, CAST(N'2022-03-14T08:13:19.5300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (10, N' Short visit visa for Single Entry (30 Days)', 101, 1, 0, CAST(N'2022-03-14T08:14:22.8633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (11, N' Long visit visa for Single Entry (90 Days)', 102, 1, 0, CAST(N'2022-03-14T08:15:28.3700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (12, N' Long visit visa for Multiple Entry (90 Days) ', 103, 1, 0, CAST(N'2022-03-14T08:16:23.9333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (13, N' Extenation short visit visa inside country (30 Days)', 104, 1, 0, CAST(N'2022-03-14T08:17:24.0666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (14, N' Extenation Long visit visa inside country (90 Days)', 105, 1, 0, CAST(N'2022-03-14T08:24:26.0800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (15, N' Change Profession (Designation)', 106, 1, 0, CAST(N'2022-03-14T08:26:36.0733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (16, N' Amendment Employment contract', 107, 1, 0, CAST(N'2022-03-14T08:28:31.5900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (17, N' Amendment Employment contract', 120, 1, 0, CAST(N'2022-03-14T08:30:11.6066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (18, N' Transfer Residence Lost passport to new', 108, 1, 0, CAST(N'2022-03-14T08:32:09.7466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (19, N' Transfer Residence Old passport to new', 109, 1, 0, CAST(N'2022-03-14T08:33:46.4366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (20, N' Police Clearance Certificate ', 110, 1, 0, CAST(N'2022-03-14T08:35:13.9300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (21, N' Partner/Investor Visa (3 years)', 111, 1, 0, CAST(N'2022-03-14T08:39:36.2500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (22, N' Employment visa - Freezone  (3 Years) ', 112, 1, 0, CAST(N'2022-03-14T08:40:39.1066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (23, N' Family visa (Dependent Visa)', 113, 1, 0, CAST(N'2022-03-14T08:42:46.1533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (24, N' Short visit visa for Single Entry (30 Days)', 114, 1, 0, CAST(N'2022-03-14T08:44:54.2000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (25, N' Long visit visa for Single Entry (90 Days)', 115, 1, 0, CAST(N'2022-03-14T08:45:58.8300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (26, N' Long visit visa for Multiple Entry (90 Days) ', 116, 1, 0, CAST(N'2022-03-14T08:47:05.5533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (27, N' Extenation short visit visa inside country (30 Days)', 117, 1, 0, CAST(N'2022-03-14T08:48:06.5600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (28, N' Extenation Long visit visa inside country (90 Days)', 118, 1, 0, CAST(N'2022-03-14T08:49:19.5333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (29, N' Police Clearance Certificate ', 124, 1, 0, CAST(N'2022-03-14T08:50:42.7666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (30, N' Change Profession (Designation)', 119, 1, 0, CAST(N'2022-03-14T08:53:31.8333333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (31, N' Transfer Residence Lost passport to new', 121, 1, 0, CAST(N'2022-03-14T08:55:30.4166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (32, N' Transfer Residence Old passport to new', 122, 1, 0, CAST(N'2022-03-14T08:56:51.9100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (33, N' Salary Certificate of Freezone Company ', 123, 1, 0, CAST(N'2022-03-14T08:58:25.6266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (34, N' Change Location ', 2, 1, 0, CAST(N'2022-03-14T08:59:45.3400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (35, N' Renewal of License with Location change ', 3, 1, 0, CAST(N'2022-03-14T09:00:50.5500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (36, N' Cancellation Of License (Company Closure)', 4, 1, 0, CAST(N'2022-03-14T09:01:51.5800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (37, N' Renewal of License with Add Shareholder', 5, 1, 0, CAST(N'2022-03-14T09:02:40.7400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (38, N' Renewal of License with Remove Shareholder', 6, 1, 0, CAST(N'2022-03-14T09:06:08.3666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (39, N' Renewal of License with Change Shareholder', 7, 1, 0, CAST(N'2022-03-14T09:28:59.4200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (40, N' Freezing License', 8, 1, 0, CAST(N'2022-03-14T09:31:03.6066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (41, N' Quota Apply ', 40, 1, 0, CAST(N'2022-03-14T09:32:04.0433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (42, N' License information Update ', 41, 1, 0, CAST(N'2022-03-14T09:32:39.3266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (43, N' Open Personal File of Shareholder', 42, 1, 0, CAST(N'2022-03-14T09:33:42.3500000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (44, N' WPS Registration ', 43, 1, 0, CAST(N'2022-03-14T09:34:20.6700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (45, N' Corporate Bank Account ', 50, 1, 0, CAST(N'2022-03-14T09:39:41.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (46, N' Import/Export Code ', 51, 1, 0, CAST(N'2022-03-14T09:41:07.3800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (47, N' Power of Attorney ', 52, 1, 0, CAST(N'2022-03-14T09:42:12.4766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (48, N' Update (Addition) Shareholder & Share transfer ', 9, 1, 0, CAST(N'2022-03-14T09:43:15.3733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (49, N' Update (Change) Shareholder & Share transfer ', 10, 1, 0, CAST(N'2022-03-14T09:47:00.6533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (50, N' Update (Removal) Shareholder & Share transfer ', 11, 1, 0, CAST(N'2022-03-14T09:49:12.9933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (51, N' Update (Addition) Manager  ', 12, 1, 0, CAST(N'2022-03-14T09:52:05.1800000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (52, N' Update (Change) Manager  ', 13, 1, 0, CAST(N'2022-03-14T09:53:38.4366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (53, N' Update (Remove) Manager  ', 14, 1, 0, CAST(N'2022-03-14T09:54:53.7100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (54, N' Update (Addition)Activity in License ', 15, 1, 0, CAST(N'2022-03-14T09:56:10.3266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (55, N' Update (Change) Activity in License ', 16, 1, 0, CAST(N'2022-03-14T09:57:14.5933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (56, N' Update (Removal) Activity in License ', 17, 1, 0, CAST(N'2022-03-14T09:58:10.3933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (57, N' Update Contact Details ', 18, 1, 0, CAST(N'2022-03-14T09:59:19.7033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (58, N' Change Company Name ', 19, 1, 0, CAST(N'2022-03-14T10:00:15.6966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (59, N' Change Share Capital', 20, 1, 0, CAST(N'2022-03-14T10:01:46.1900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (60, N' Apply for Refund (Immigration)', 44, 1, 0, CAST(N'2022-03-14T10:02:43.6433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (61, N' Apply for Refund (Mohre)', 45, 1, 0, CAST(N'2022-03-14T10:03:30.7400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (62, N' Apply New Establishment card (Immigration)', 21, 1, 0, CAST(N'2022-03-14T10:04:48.4166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (63, N' Add Establishment card (Immigration)', 22, 1, 0, CAST(N'2022-03-14T10:06:03.5433333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (64, N'  Renew Establishment card (Immigration)', 23, 1, 0, CAST(N'2022-03-14T10:07:26.9200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (65, N' Modification Establishment card (Immigration)', 24, 1, 0, CAST(N'2022-03-14T10:11:18.1400000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (66, N' Remove Establishment card (Immigration)', 25, 1, 0, CAST(N'2022-03-14T10:11:51.2033333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (67, N' Cancel Establishment card (Immigration) ', 26, 1, 0, CAST(N'2022-03-14T10:12:32.1166667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (68, N' Apply New Establishment card (Mohre)', 27, 1, 0, CAST(N'2022-03-14T10:14:12.3066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (69, N' Add Establishment card (Mohre)', 28, 1, 0, CAST(N'2022-03-14T10:15:28.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (70, N' Modification Establishment card (Mohre)', 30, 1, 0, CAST(N'2022-03-14T10:16:02.4200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (71, N' Remove Establishment card (Mohre)', 31, 1, 0, CAST(N'2022-03-14T10:16:32.3366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (72, N' Cancel Establishment card (Mohre) ', 32, 1, 0, CAST(N'2022-03-14T10:17:21.4200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (73, N' Apply New  E -Signature Card', 33, 1, 0, CAST(N'2022-03-14T10:25:13.4200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (74, N' Add  E -Signature Card', 34, 1, 0, CAST(N'2022-03-14T10:26:11.3133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (75, N' Renew  E -Signature Card', 35, 1, 0, CAST(N'2022-03-14T10:27:14.5266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (76, N'  Modification  E -Signature Card', 36, 1, 0, CAST(N'2022-03-14T10:28:15.7366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (77, N' Remove E -Signature Card', 37, 1, 0, CAST(N'2022-03-14T10:31:59.2600000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (78, N' Issue PRO Card ', 38, 1, 0, CAST(N'2022-03-14T10:32:59.3366667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (79, N' Renew PRO Card', 39, 1, 0, CAST(N'2022-03-14T10:34:02.3066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (80, N' Registration of VAT', 46, 1, 0, CAST(N'2022-03-14T10:35:04.5766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (81, N' Deregistration of VAT', 47, 1, 0, CAST(N'2022-03-14T10:35:45.9900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (82, N' Registration of Excise', 48, 1, 0, CAST(N'2022-03-14T10:36:46.1566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (83, N' Deregistration of Excise', 49, 1, 0, CAST(N'2022-03-14T10:37:18.6133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (84, N' Renewal of License ', 54, 1, 0, CAST(N'2022-03-14T10:38:21.0566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (85, N' Change Location ', 55, 1, 0, CAST(N'2022-03-14T10:39:08.8966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (86, N' Renewal of License with Location change ', 56, 1, 0, CAST(N'2022-03-14T10:39:56.4100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (87, N' Good Standing Certificate ', 57, 1, 0, CAST(N'2022-03-14T10:40:46.7866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (88, N'  Incumbancy Certificate ', 58, 1, 0, CAST(N'2022-03-14T10:41:20.4466667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (89, N'  Share certificate ', 59, 1, 0, CAST(N'2022-03-14T10:41:53.6566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (90, N' Cancellation Of License (Company Closure)', 60, 1, 0, CAST(N'2022-03-14T10:42:32.5833333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (91, N' Renewal of License with Add Shareholder', 61, 1, 0, CAST(N'2022-03-14T10:46:34.1733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (92, N' Renewal of License with Remove Shareholder', 0, 1, 0, CAST(N'2022-03-14T10:50:45.5866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (93, N' Renewal of License with Change Shareholder', 125, 1, 0, CAST(N'2022-03-14T10:53:18.0933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (94, N' Freezing License', 62, 1, 0, CAST(N'2022-03-14T10:54:31.0900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (95, N' Apply E channel Services', 81, 1, 0, CAST(N'2022-03-14T10:55:05.5933333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (96, N' Renew E channel ', 82, 1, 0, CAST(N'2022-03-14T10:55:44.0200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (97, N' Corporate Bank Account ', 89, 1, 0, CAST(N'2022-03-14T10:56:18.3700000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (98, N' Import/Export Code ', 90, 1, 0, CAST(N'2022-03-14T10:56:48.6633333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (99, N' Power of Attorney ', 91, 1, 0, CAST(N'2022-03-14T10:57:26.8733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (100, N' Authorisation letter ', 92, 1, 0, CAST(N'2022-03-14T10:58:02.2100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (101, N' Update (Addition) Shareholder & Share transfer', 65, 1, 0, CAST(N'2022-03-14T11:05:51.2766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (102, N' Update (Change) Shareholder & Share transfer', 63, 1, 0, CAST(N'2022-03-14T11:10:22.5133333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (103, N' Update (Removal) Shareholder & Share transfer', 64, 1, 0, CAST(N'2022-03-14T11:11:18.5533333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (104, N' Update (Addition) Manager  ', 68, 1, 0, CAST(N'2022-03-14T11:15:33.1200000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (105, N' Update (Change) Manager  ', 66, 1, 0, CAST(N'2022-03-14T11:16:58.5100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (106, N' Update (Removal) Manager  ', 67, 1, 0, CAST(N'2022-03-14T11:18:04.7866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (107, N' Update (Change)Activity in License ', 69, 1, 0, CAST(N'2022-03-14T11:19:44.3266667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (108, N' Update (Removal)Activity in License ', 70, 1, 0, CAST(N'2022-03-14T11:20:46.2900000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (109, N' Update (Addition)Activity in License ', 71, 1, 0, CAST(N'2022-03-14T11:21:41.6300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (110, N' Update Contact Details ', 72, 1, 0, CAST(N'2022-03-14T11:22:59.6100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (111, N' Change Company Name ', 73, 1, 0, CAST(N'2022-03-14T11:24:00.9766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (112, N' Change Share Capital', 74, 1, 0, CAST(N'2022-03-14T11:25:22.8666667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (113, N' Apply for Refund (Immigration)', 83, 1, 0, CAST(N'2022-03-14T11:26:02.2066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (114, N' Apply for E channel Refund ', 84, 1, 0, CAST(N'2022-03-14T11:26:32.1866667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (115, N' Apply New Establishment card (Immigration)', 75, 1, 0, CAST(N'2022-03-14T11:28:34.7733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (116, N' Add  Establishment card (Immigration)', 77, 1, 0, CAST(N'2022-03-14T11:30:02.4733333' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (117, N' Remove Establishment card (Immigration)', 78, 1, 0, CAST(N'2022-03-14T11:30:29.8766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (118, N' Modification  Establishment card (Immigration)', 79, 1, 0, CAST(N'2022-03-14T11:31:07.4966667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (119, N' Cancel Establishment card (Immigration) ', 80, 1, 0, CAST(N'2022-03-14T11:31:43.1300000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (120, N' Registration of VAT', 85, 1, 0, CAST(N'2022-03-14T11:32:52.9566667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (121, N' Deregistration of VAT', 86, 1, 0, CAST(N'2022-03-14T11:34:26.4766667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (122, N' Registration of Excise', 87, 1, 0, CAST(N'2022-03-14T11:35:20.0100000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (123, N' Deregistration of Excise', 88, 1, 0, CAST(N'2022-03-14T11:36:13.3066667' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (124, N' Renewal of License with Remove Shareholder', 127, 1, 0, CAST(N'2022-04-11T12:36:37.4438588' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (125, N' New Company Established', 129, 1, 0, CAST(N'2022-04-27T13:17:26.3297302' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (126, N' New Company Established', 130, 1, 0, CAST(N'2022-05-10T11:22:09.9384532' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (127, N' New Company Established', 131, 1, 0, CAST(N'2022-05-10T11:23:20.6853838' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (128, N' New Company Established', 0, 1, 0, CAST(N'2022-05-10T19:38:55.5611650' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (129, N' New Company Established', 0, 1, 0, CAST(N'2022-05-10T19:41:35.5221332' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (130, N' New Company Established', 134, 1, 0, CAST(N'2022-05-10T19:49:51.6588437' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (131, N' New Company Established', 135, 1, 0, CAST(N'2022-05-10T19:51:55.1353585' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (132, N' Employement card Process (Only card) ', 136, 1, 0, CAST(N'2022-06-14T09:48:30.8698835' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (133, N' Renew Establishment card (Immigration)', 138, 1, 0, CAST(N'2022-06-24T14:58:46.4285650' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (134, N' Renew Establishment card (Immigration)', 139, 1, 0, CAST(N'2022-06-24T15:00:21.5392491' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (135, N' Renew Establishment card (Mohre)', 140, 1, 0, CAST(N'2022-06-24T15:01:56.0716679' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (136, N' Renew Establishment card (Mohre)', 141, 1, 0, CAST(N'2022-06-24T15:03:11.1276800' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (137, N' Employment Visa Cancellation ', 143, 1, 0, CAST(N'2022-08-22T16:44:05.7187961' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (138, N' Employment Visa Cancellation', 145, 1, 0, CAST(N'2022-08-22T17:24:36.0473059' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (139, N' Trademark Registration', 146, 1, 0, CAST(N'2022-10-03T10:25:43.0182094' AS DateTime2), 421, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (140, N' Partner Visa Cancellation', 147, 1, 0, CAST(N'2022-11-23T18:07:53.5142907' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (141, N' Partner Visa Cancellation', 148, 1, 0, CAST(N'2022-11-23T18:13:14.1800604' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (142, N' Employment Visa renew process. ', 149, 1, 0, CAST(N'2023-08-24T14:30:43.8033313' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (143, N' Quota Modification ', 150, 1, 0, CAST(N'2023-08-26T14:02:37.6590686' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (144, N' re-entry permit process ', 151, 1, 0, CAST(N'2023-09-22T11:33:11.5407824' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (145, N' Trade Mark Registration Process', 152, 1, 0, CAST(N'2023-10-10T18:07:29.4772151' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (146, N' Re-Entry Permit process', 153, 1, 0, CAST(N'2023-10-10T18:11:07.4604775' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (147, N' Re-entry permit process ', 156, 1, 0, CAST(N'2023-10-10T18:16:51.6141861' AS DateTime2), 317, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (148, N' Re-Entry Permit process', 157, 1, 0, CAST(N'2023-10-10T18:17:14.0827852' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (149, N' Employment Renewal Visa', 158, 1, 0, CAST(N'2023-10-11T10:57:30.9613557' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (150, N' Employment Renewal Visa', 159, 1, 0, CAST(N'2023-10-11T11:02:35.6033156' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (151, N' Employment Visa 2 Years', 161, 1, 0, CAST(N'2023-10-13T10:39:35.2760144' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (152, N' Dubai Municipality registration ', 162, 1, 0, CAST(N'2023-10-16T17:15:58.4406459' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (153, N' Partner Visa Renewal', 163, 1, 0, CAST(N'2023-10-17T13:39:37.1207025' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (154, N' Personal File Open ( Mohre)', 164, 1, 0, CAST(N'2023-10-20T11:27:45.9641569' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (155, N' Renewal Family (dependent ) visa', 165, 1, 0, CAST(N'2023-10-25T15:58:14.1777978' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (156, N' Partner Visa Renewal', 166, 1, 0, CAST(N'2023-10-30T13:29:42.0479574' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (157, N' EMPLOYEE LABOUR CARD ', 167, 1, 0, CAST(N'2023-10-30T18:01:35.1503274' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (158, N' Data Modification', 168, 1, 0, CAST(N'2023-12-06T15:41:52.2658801' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (159, N' WAREHOUSE PROCESS', 169, 1, 0, CAST(N'2023-12-11T16:41:00.4894295' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (160, N'  WAREHOUSE PERMIT ', 170, 1, 0, CAST(N'2023-12-11T16:46:56.7620280' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (161, N'  INDUSTRIAL LICENSE', 171, 1, 0, CAST(N'2023-12-11T16:53:45.6332560' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (162, N' Immigration  Absconding', 172, 1, 0, CAST(N'2024-01-23T15:20:20.5556752' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (163, N' Only new Emirates ID Apply', 173, 1, 0, CAST(N'2024-02-08T17:39:26.0213650' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (164, N' Others Services ', 174, 1, 0, CAST(N'2024-02-08T17:48:00.3313418' AS DateTime2), 2170, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (165, N' TESTING COMPANY SERVICE', 175, 1, 0, CAST(N'2024-09-30T13:44:03.2439931' AS DateTime2), 285, NULL, NULL)
GO
INSERT [dbo].[Tbl_ServiceForms] ([Id], [FormName], [ServiceId], [IsActive], [IsDelete], [CreatedOn], [CreatedBy], [ModifyOn], [ModifyBy]) VALUES (166, N' TESTING EMPLOYEE SERVICE', 176, 1, 0, CAST(N'2024-09-30T13:46:04.7160319' AS DateTime2), 285, NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_ServiceForms] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_ServiceRequestStatus] ON 
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (1, N'Documents Under Review.', 0, 1, 1, CAST(N'2022-06-15T10:30:56.6863907' AS DateTime2), CAST(N'2022-06-15T10:38:42.5402240' AS DateTime2), 0, 1)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (2, N'Documents Under Review', 0, 1, 0, CAST(N'2022-06-15T10:38:51.3221291' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (3, N'Service Approved From Support Team', 1, 1, 0, CAST(N'2022-06-15T10:40:13.0894601' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (4, N'Pending', 2, 1, 0, CAST(N'2022-06-15T10:40:18.6992236' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (5, N'Close', 3, 1, 0, CAST(N'2022-06-15T10:40:24.2331362' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (6, N'Rejected', 4, 1, 0, CAST(N'2022-06-15T10:40:43.6998659' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (7, N'Canceled', 5, 1, 0, CAST(N'2022-06-15T10:40:51.3288099' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (8, N'Service sent to Concerned Authority', 6, 1, 0, CAST(N'2022-06-15T10:40:57.8059623' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (9, N'Under process in Immigration Department', 7, 1, 0, CAST(N'2022-06-15T10:41:04.5102130' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (10, N'Under Process in Ministry of Human Resource (Mohre', 8, 1, 0, CAST(N'2022-06-15T10:41:10.1898548' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (11, N'Under process in DED', 9, 1, 0, CAST(N'2022-06-15T10:41:15.6372243' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (12, N'Payment pending', 10, 1, 0, CAST(N'2022-06-15T10:41:23.7533276' AS DateTime2), CAST(N'2024-03-04T16:50:48.2248934' AS DateTime2), 1, 285)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (13, N'Waiting Approval From DCS Finance Department', 11, 1, 0, CAST(N'2022-06-15T10:41:29.5159920' AS DateTime2), NULL, 1, NULL)
GO
INSERT [dbo].[Tbl_ServiceRequestStatus] ([Id], [Status], [DisplayId], [IsActive], [IsDelete], [CreatedOn], [ModifyOn], [CreatedBy], [ModifyBy]) VALUES (14, N'Service Approved By Financial Department', 12, 1, 0, CAST(N'2023-04-04T09:14:41.3366033' AS DateTime2), NULL, 285, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_ServiceRequestStatus] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_User] ON 
GO
INSERT [dbo].[Tbl_User] ([Id], [AccountNumber], [FirstName], [LastName], [Nationality], [EmailID], [MCode], [PhoneNumber], [CountryOfRecidence], [TelephoneNumber], [PassportNumber], [PassportExpiryDate], [Designation], [VisaExpiryDate], [InsuranceCompany], [InsuranceExpiryDate], [EmployeementCardExpiryDate], [IsLogin], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUTC], [ModifyBy], [ModifyOnUTC]) VALUES (1, N'DIBN1', N'Sunil', N'Dhola', NULL, N'sunildhola@dibnbusiness.com', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, 0, 1, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_User] ([Id], [AccountNumber], [FirstName], [LastName], [Nationality], [EmailID], [MCode], [PhoneNumber], [CountryOfRecidence], [TelephoneNumber], [PassportNumber], [PassportExpiryDate], [Designation], [VisaExpiryDate], [InsuranceCompany], [InsuranceExpiryDate], [EmployeementCardExpiryDate], [IsLogin], [IsActive], [IsDelete], [CreatedBy], [CreatedOnUTC], [ModifyBy], [ModifyOnUTC]) VALUES (2, N'TBC01', N'The', N'Bridge Code', NULL, N'info@thebridgecode.com', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 1, 1, 0, 1, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_User] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_User_Role_Mapping] ON 
GO
INSERT [dbo].[Tbl_User_Role_Mapping] ([Id], [RoleID], [UserId], [IsDelete], [CreatedOnUtc], [CreatedBy], [ModifyOnUtc], [ModifyBy]) VALUES (1, 1, 1, 0, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), 1, NULL, NULL)
GO
INSERT [dbo].[Tbl_User_Role_Mapping] ([Id], [RoleID], [UserId], [IsDelete], [CreatedOnUtc], [CreatedBy], [ModifyOnUtc], [ModifyBy]) VALUES (2, 1, 2, 0, CAST(N'2024-10-11T00:00:00.0000000' AS DateTime2), 1, NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_User_Role_Mapping] OFF
GO
SET IDENTITY_INSERT [dbo].[Tbl_UserPermission] ON 
GO
INSERT [dbo].[Tbl_UserPermission] ([UserPermissionId], [UserId], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (16, 6, 9, 1, 1, 0, 2, CAST(N'2024-10-16T13:34:21.2034476' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_UserPermission] ([UserPermissionId], [UserId], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (17, 6, 9, 2, 1, 0, 2, CAST(N'2024-10-16T13:34:21.2034476' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_UserPermission] ([UserPermissionId], [UserId], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (18, 6, 1, 3, 1, 0, 2, CAST(N'2024-10-16T13:34:21.2034476' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_UserPermission] ([UserPermissionId], [UserId], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (19, 6, 9, 3, 1, 0, 2, CAST(N'2024-10-16T13:34:21.2034476' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_UserPermission] ([UserPermissionId], [UserId], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (20, 6, 32, 3, 1, 0, 2, CAST(N'2024-10-16T13:34:21.2034476' AS DateTime2), NULL, NULL)
GO
INSERT [dbo].[Tbl_UserPermission] ([UserPermissionId], [UserId], [ModuleId], [PermissionId], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn]) VALUES (21, 6, 9, 4, 1, 0, 2, CAST(N'2024-10-16T13:34:21.2034476' AS DateTime2), NULL, NULL)
GO
SET IDENTITY_INSERT [dbo].[Tbl_UserPermission] OFF
GO
INSERT [History].[Tbl_CompanyHistory] ([Id], [AccountNumber], [DibnUserNumber], [CompanyName], [ShareCapital], [CompanyRegistrationNumber], [MCountryCode], [MobileNumber], [ECountryCode], [EmergencyNumber], [EmailID], [SecondEmailID], [CompanyType], [LicenseType], [LicenseStatus], [LicenseIssueDate], [LicenseExpiryDate], [LeaseFacilityType], [LeaseStartDate], [LeaseExpiryDate], [LeaseStatus], [CompanyStartingDate], [City], [Country], [UnitLocation], [Cmp_Pass], [IsTRN], [TRN], [TRNCreationDate], [LabourFileNo], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn], [ValidFrom], [ValidTo]) VALUES (2759, N'DIBN1165', NULL, N'TESTING COMPANY 01', NULL, NULL, N'India', N'+91 9874521036', NULL, NULL, N'testingcompany0101@gmail.com', N'testingcompany0101@gmail.com', N'Freezone', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, CAST(N'2024-09-30T00:00:00.0000000' AS DateTime2), N'Ahmedabad', N'India', NULL, N'm7JoLgGHSwjmDdG/4+O4E3Vys2ITHJS4', NULL, NULL, NULL, NULL, 0, 0, 285, CAST(N'2024-09-30T11:11:20.2272751' AS DateTime2), NULL, NULL, CAST(N'2024-09-30T07:11:20.2272751' AS DateTime2), CAST(N'2024-09-30T07:19:39.0661059' AS DateTime2))
GO
INSERT [History].[Tbl_CompanyHistory] ([Id], [AccountNumber], [DibnUserNumber], [CompanyName], [ShareCapital], [CompanyRegistrationNumber], [MCountryCode], [MobileNumber], [ECountryCode], [EmergencyNumber], [EmailID], [SecondEmailID], [CompanyType], [LicenseType], [LicenseStatus], [LicenseIssueDate], [LicenseExpiryDate], [LeaseFacilityType], [LeaseStartDate], [LeaseExpiryDate], [LeaseStatus], [CompanyStartingDate], [City], [Country], [UnitLocation], [Cmp_Pass], [IsTRN], [TRN], [TRNCreationDate], [LabourFileNo], [IsActive], [IsDelete], [CreatedBy], [CreatedOn], [ModifyBy], [ModifyOn], [ValidFrom], [ValidTo]) VALUES (2759, N'DIBN1165', NULL, N'TESTING COMPANY 01', NULL, NULL, N'India', N'+91 9874521036', NULL, NULL, N'testingcompany0101@gmail.com', N'testingcompany0101@gmail.com', N'Freezone', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, CAST(N'2024-09-30T00:00:00.0000000' AS DateTime2), N'Ahmedabad', N'India', NULL, N'm7JoLgGHSwjmDdG/4+O4E3Vys2ITHJS4', NULL, NULL, NULL, NULL, 1, 0, 285, CAST(N'2024-09-30T11:11:20.2272751' AS DateTime2), 285, CAST(N'2024-09-30T11:19:39.0661059' AS DateTime2), CAST(N'2024-09-30T07:19:39.0661059' AS DateTime2), CAST(N'2024-09-30T07:19:39.0661059' AS DateTime2))
GO
/****** Object:  Index [IX_Tbl_Company_Document_Mapping_CompanyId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Company_Document_Mapping_CompanyId] ON [dbo].[Tbl_Company_Document_Mapping]
(
	[CompanyId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Company_Document_Mapping_IsDeleted]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Company_Document_Mapping_IsDeleted] ON [dbo].[Tbl_Company_Document_Mapping]
(
	[IsDeleted] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_CompanyDocumentType_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_CompanyDocumentType_IsActive] ON [dbo].[Tbl_CompanyDocumentType]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_CompanyDocumentType_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_CompanyDocumentType_IsDelete] ON [dbo].[Tbl_CompanyDocumentType]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_CompanyPermission_Id]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_CompanyPermission_Id] ON [dbo].[Tbl_CompanyPermission]
(
	[CompanyPermissionId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_CompanyServices_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_CompanyServices_IsActive] ON [dbo].[Tbl_CompanyServices]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_CompanyServices_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_CompanyServices_IsDelete] ON [dbo].[Tbl_CompanyServices]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_CompanyServices_ParentId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_CompanyServices_ParentId] ON [dbo].[Tbl_CompanyServices]
(
	[ParentId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_Documents_CreatedOnUtc]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Documents_CreatedOnUtc] ON [dbo].[Tbl_CompanyServices]
(
	[CreatedOnUtc] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_EmployeeServices_ParentId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_EmployeeServices_ParentId] ON [dbo].[Tbl_EmployeeServices]
(
	[ParentId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_Module_Id]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Module_Id] ON [dbo].[Tbl_Module]
(
	[ModuleId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Module_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Module_IsActive] ON [dbo].[Tbl_Module]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Module_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Module_IsDelete] ON [dbo].[Tbl_Module]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Permission_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Permission_IsActive] ON [dbo].[Tbl_Permission]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Permission_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Permission_IsDelete] ON [dbo].[Tbl_Permission]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Tbl_Permission_PermissionName]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Permission_PermissionName] ON [dbo].[Tbl_Permission]
(
	[PermissionName] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Role_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Role_IsActive] ON [dbo].[Tbl_Role]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Role_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Role_IsDelete] ON [dbo].[Tbl_Role]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [IX_Tbl_Role_RoleName]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Role_RoleName] ON [dbo].[Tbl_Role]
(
	[RoleName] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_RolePermission_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_RolePermission_IsActive] ON [dbo].[Tbl_RolePermission]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_RolePermission_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_RolePermission_IsDelete] ON [dbo].[Tbl_RolePermission]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_RolePermission_RoleId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_RolePermission_RoleId] ON [dbo].[Tbl_RolePermission]
(
	[RoleID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
GO
/****** Object:  Index [IX_Tbl_Service_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Service_IsActive] ON [dbo].[Tbl_Service]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_Service_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Service_IsDelete] ON [dbo].[Tbl_Service]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_Service_ServiceId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_Service_ServiceId] ON [dbo].[Tbl_Service]
(
	[ServiceId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceFormDataField_FormId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceFormDataField_FormId] ON [dbo].[Tbl_ServiceFormDataField]
(
	[FormId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceFormDataField_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceFormDataField_IsActive] ON [dbo].[Tbl_ServiceFormDataField]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceFormDataField_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceFormDataField_IsDelete] ON [dbo].[Tbl_ServiceFormDataField]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceFormDataField_ServiceId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceFormDataField_ServiceId] ON [dbo].[Tbl_ServiceFormDataField]
(
	[ServiceId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceForms_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceForms_IsActive] ON [dbo].[Tbl_ServiceForms]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceForms_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceForms_IsDelete] ON [dbo].[Tbl_ServiceForms]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceForms_ServiceId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceForms_ServiceId] ON [dbo].[Tbl_ServiceForms]
(
	[ServiceId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceRequestStatus_DisplayId]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceRequestStatus_DisplayId] ON [dbo].[Tbl_ServiceRequestStatus]
(
	[DisplayId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceRequestStatus_IsActive]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceRequestStatus_IsActive] ON [dbo].[Tbl_ServiceRequestStatus]
(
	[IsActive] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
/****** Object:  Index [IX_Tbl_ServiceRequestStatus_IsDelete]    Script Date: 30-10-2024 15:06:37 ******/
CREATE NONCLUSTERED INDEX [IX_Tbl_ServiceRequestStatus_IsDelete] ON [dbo].[Tbl_ServiceRequestStatus]
(
	[IsDelete] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [FG_DIBN_DB_Service]
GO
ALTER TABLE [dbo].[Tbl_AssignServiceRequest] ADD  CONSTRAINT [DF_Tbl_AssignServiceRequest_MarkAsRead]  DEFAULT ((0)) FOR [MarkAsRead]
GO
ALTER TABLE [dbo].[Tbl_AssignSupportTicket] ADD  CONSTRAINT [DF_Tbl_AssignSupportTicket_MarkAsRead]  DEFAULT ((0)) FOR [MarkAsRead]
GO
ALTER TABLE [dbo].[Tbl_Company] ADD  CONSTRAINT [DF_Tbl_Company_ValidFrom]  DEFAULT (sysutcdatetime()) FOR [ValidFrom]
GO
ALTER TABLE [dbo].[Tbl_Company] ADD  CONSTRAINT [DF_Tbl_Company_ValidTo]  DEFAULT (CONVERT([datetime2],'9999-12-31 23:59:59.9999999')) FOR [ValidTo]
GO
ALTER TABLE [dbo].[Tbl_Company_User_Mapping] ADD  CONSTRAINT [DF_Tbl_Company_User_Mapping_IsDelete]  DEFAULT ((0)) FOR [IsDelete]
GO
ALTER TABLE [dbo].[Tbl_PaymentReceipt] ADD  CONSTRAINT [DF_Tbl_PaymentReceipt_IsDelete]  DEFAULT ((0)) FOR [IsDelete]
GO
ALTER TABLE [dbo].[Tbl_PaymentTransection] ADD  CONSTRAINT [DF_Tbl_PaymentTransection_IsActive]  DEFAULT ((1)) FOR [IsActive]
GO
ALTER TABLE [dbo].[Tbl_ServiceFormFieldValue] ADD  CONSTRAINT [DF_Tbl_ServiceFormFieldValue_SalesPersonId]  DEFAULT ((0)) FOR [SalesPersonId]
GO
ALTER TABLE [dbo].[Tbl_ServiceRequest] ADD  CONSTRAINT [DF_Tbl_ServiceRequest_IsActive]  DEFAULT ((1)) FOR [IsActive]
GO
ALTER TABLE [dbo].[Tbl_ServiceRequest] ADD  CONSTRAINT [DF_Tbl_ServiceRequest_IsDelete]  DEFAULT ((0)) FOR [IsDelete]
GO
ALTER TABLE [dbo].[Tbl_User_Role_Mapping] ADD  CONSTRAINT [DF_Tbl_User_Role_Mapping_IsDelete]  DEFAULT ((0)) FOR [IsDelete]
GO
/****** Object:  StoredProcedure [dbo].[GetProductsForInvoiceByPrefix]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			GetProductsForInvoiceByPrefix
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of already added Product(s) as suggestion while creating Invoice
-- GetProductsForInvoiceByPrefix N'E'
-- =============================================

CREATE PROCEDURE [dbo].[GetProductsForInvoiceByPrefix]
	@prefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @strLength INT = NULL
	SET @strLength = (SELECT LEN(@prefix))
	--SELECT DISTINCT 
	--	ProductName AS ProductName
	--FROM [dbo].[Tbl_CompanyInvoiceDetail] 
	--WHERE ProductName LIKE @prefix +'%'
	--AND IsDelete <> 1

	SELECT DISTINCT 
		ProductName AS ProductName
	FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK)
	WHERE LEFT(ProductName, @strLength) = @prefix
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[GetProductsForPIInvoiceByPrefix]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			GetProductsForPIInvoiceByPrefix
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of already added Product(s) as suggestion while creating PI Invoice
-- GetProductsForPIInvoiceByPrefix N'E'
-- =============================================

CREATE PROCEDURE [dbo].[GetProductsForPIInvoiceByPrefix]
	@prefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		ProductName AS ProductName
	FROM [dbo].[Tbl_NewCompanyInvoiceDetails] 
	WHERE ProductName LIKE @prefix +'%'
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[SP_GetFormEnquiryNumberForClient]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_GetFormEnquiryNumberForClient]
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @number NVARCHAR(100), @enquiry NVARCHAR(100);

	SET @number = (SELECT SUBSTRING(CONVERT(varchar(40), NEWID()),0,4));

	SET @enquiry = (SELECT 'Enquiry-' + @number)

	WHILE EXISTS(SELECT Id FROM [dbo].[Tbl_EnquiryFormDetails] WHERE ClientEnquiryNumber LIKE @enquiry)
	BEGIN
		SET @number = (SELECT SUBSTRING(CONVERT(varchar(40), NEWID()),0,4));

		SET @enquiry = (SELECT 'Enquiry-' + @number)
	END

	SELECT @enquiry AS ClientEnquiryNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_AddServiceFormField]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <07-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Store fields of Form from admin panel>
-- <SP_Admin_AddServiceFormField>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_AddServiceFormField]
	@Id INT =NULL,
	@ServiceId INT = NULL,
	@FieldName NVARCHAR(MAX) = NULL,
	@IsRequired BIT = NULL,
	@IsRequiredMessage NVARCHAR(MAX) = NULL,
	@IsDocumentUpload BIT = NULL,
	@StepNumber INT = NULL,
	@FormId INT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;


	IF EXISTS(SELECT Id FROM [dbo].[Tbl_ServiceFormDataField] WHERE ServiceId = @ServiceId AND FormId = @FormId AND StepNumber = @StepNumber)
	BEGIN
		UPDATE [dbo].[Tbl_ServiceFormDataField]
		SET
			StepNumber = Convert(INT,StepNumber) + 1
		WHERE ServiceId = @ServiceId AND FormId = @FormId AND StepNumber >= @StepNumber
	END

	INSERT INTO [dbo].[Tbl_ServiceFormDataField](
		ServiceId,
		FormId,
		FieldName,
		IsRequired,
		IsRequiredMessage,
		IsDocumentUpload,
		StepNumber,
		IsActive,
		IsDelete,
		CreatedOn,
		CreatedBy
	)
	VALUES(
		@ServiceId,
		@FormId,
		@FieldName,
		@IsRequired,
		@IsRequiredMessage,
		@IsDocumentUpload,
		@StepNumber,
		1,
		0,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		@UserId
	)

	SET @returnId = CONVERT(INT,SCOPE_IDENTITY());
	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ApproveTemporaryAccountManagement]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ApproveTemporaryAccountManagement
-- Author:			<Yashasvi Sharma>
-- Created date:	08/Aug/2023
-- Description:		Approve Temporary stored Account Managment
-- USP_Admin_ApproveTemporaryAccountManagement
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ApproveTemporaryAccountManagement]
	@Id INT = NULL,
	@ApprovedBy INT = NULL,
	@returnId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @TransactionId INT = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL,
	@PaymentId INT = NULL,@PortalId INT = NULL, @Amount DECIMAL(18,2) = NULL,@RemainingPortalBalance NVARCHAR(MAX) = null,@CompanyId INT = NULL,
	@PortalAmount DECIMAL(18,2) = NULL;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL))
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL));

			SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
			ELSE
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
		END
		ELSE
		BEGIN
			SET @TransactionId = (SELECT MAX(SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))) 
								FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete <> 1 OR IsDelete IS NULL));
			SET @TransactionId = @TransactionId + 1
			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
	END
	ELSE
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			SET @TransactionId = @TransactionId + 1
			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
		ELSE
		BEGIN
			SET  @TransactionCode = 'TRN101';
		END
	END

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Credit')
	BEGIN
		SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Credit')

		SET @PortalAmount = (SELECT TotalAmount FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Credit')

		INSERT INTO [dbo].[Tbl_PaymentTransection](
			UserId,
			CompanyId,
			TransactionId,
			Amount,
			PaymentMode,
			Description,
			PaymentStatus,
			Quantity,
			TotalAmount,
			TransectionDate,
			CreatedBy,
			CreatedOnUtc
		)
		SELECT 
			CreatedBy,
			CompanyId,
			@TransactionCode,
			Amount,
			PaymentMode,
			Description,
			'Success',
			Quantity,
			TotalAmount,
			TransactionDate,
			CreatedBy,
			TransactionDate
		FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Credit'

		SET @PaymentId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentTransection])

		DECLARE @SerialNumber INT = NULL,@NewSerialNumber NVARCHAR(100) = NULL;
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK))
		BEGIN
			SET @SerialNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX('B',SerialNumber)+1,LEN(SerialNumber)))) 
								FROM [dbo].[Tbl_PaymentReceipt]);
			SET @SerialNumber = @SerialNumber + 1
			SET  @NewSerialNumber ='RECDB'+ CONVERT(NVARCHAR(100),@SerialNumber);
		END
		ELSE
		BEGIN
			SET  @NewSerialNumber = 'RECDB101';
		END

		INSERT INTO [dbo].[Tbl_PaymentReceipt](
			CompanyId,
			PaymentId,
			SerialNumber,
			Through,
			OnAccount,
			CreatedOn,
			CreatedBy,
			IsDelete
		)
		SELECT 
			CompanyId,
			@PaymentId,
			@NewSerialNumber,
			'',
			Description,
			TransactionDate,
			CreatedBy,
			0
		FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Credit'

		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WHERE CompanyId = @CompanyId)
		BEGIN
			INSERT INTO [dbo].[Tbl_PortalBalance](
				UserId,
				CompanyId,
				BalanceAmount,
				CreatedOnUtc,
				IsCompletelyUsed
			)
			SELECT 
				CreatedBy,
				CompanyId,
				TotalAmount,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				0
			FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Credit'
			
			SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalance]
		END
		ELSE
		BEGIN
			SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WHERE CompanyId = @CompanyId);
			SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WHERE CompanyId = @CompanyId);
			SET @Amount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@PortalAmount);

			UPDATE [dbo].[Tbl_PortalBalance]
			SET
				BalanceAmount = @Amount,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @PortalId

			SELECT @PortalId
		END

		UPDATE [dbo].[Tbl_TempAccountManagement]
		SET 
			IsApproved = 1,
			ApprovedBy = @ApprovedBy,
			ApprovedOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id
	END
	ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Debit')
	BEGIN
		SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Debit')

		SET @PortalAmount = (SELECT GrandTotal FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Debit')

		DECLARE @PortalBalanceAmount NVARCHAR(50) = N'-' + CONVERT(nvarchar(50),@PortalAmount) 

		INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
			CompanyId,
			TransactionId,
			ExpensesTitle,
			ExpensesAmount,
			Quantity,
			TotalAmount,
			Vat,
			VatAmount,
			GrandTotal,
			IsDelete,
			CreatedBy,
			CreatedOnUtc,
			TransactionCreatedOnUtc
		)
		SELECT 
			CompanyId,
			@TransactionCode,
			Description,
			Amount,
			Quantity,
			TotalAmount,
			Vat,
			VatAmount,
			GrandTotal,
			0,
			CreatedBy,
			TransactionDate,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Debit'



		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WHERE CompanyId = @CompanyId)
		BEGIN
			INSERT INTO [dbo].[Tbl_PortalBalance](
				UserId,
				CompanyId,
				BalanceAmount,
				CreatedOnUtc,
				IsCompletelyUsed
			)
			SELECT 
				CreatedBy,
				CompanyId,
				Convert(DECIMAL(18,2),@PortalBalanceAmount),
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				0
			FROM [dbo].[Tbl_TempAccountManagement] WHERE Id = @Id AND EntryType = 'Debit'
			
			SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalance]
		END
		ELSE
		BEGIN
			SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WHERE CompanyId = @CompanyId);
			SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WHERE CompanyId = @CompanyId);
			SET @Amount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@PortalAmount);

			UPDATE [dbo].[Tbl_PortalBalance]
			SET
				BalanceAmount = @Amount,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @PortalId

			SELECT @PortalId
		END
	END

	UPDATE [dbo].[Tbl_TempAccountManagement]
	SET 
		IsApproved = 1,
		ApprovedBy = @ApprovedBy,
		ApprovedOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id

	SELECT @Id 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReport_ExcelAndPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetCustomSelectedDateReport_ExcelAndPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	08/July/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_BalanceSheetCustomSelectedDateReport_ExcelAndPdf N'2023-01-01',N'2023-07-19'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReport_ExcelAndPdf]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetCustomSelectedDateReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetCustomSelectedDateReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetCustomSelectedDateReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))

	SELECT * FROM ##AdminBalanceSheetCustomSelectedDateReportData
	ORDER BY TransactionIdNo asc
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetCustomSelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	01/July/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_BalanceSheetCustomSelectedDateReport_Pagination N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReport_Pagination]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetCustomSelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetCustomSelectedDateReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetCustomSelectedDateReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))

	SELECT * FROM ##AdminBalanceSheetCustomSelectedDateReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetCustomSelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	01/July/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_BalanceSheetCustomSelectedDateReport_TotalDetails N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReport_TotalDetails]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_ExcelPdf N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_ExcelPdf]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetCustomSelectedDateByCompanyIdReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetCustomSelectedDateByCompanyIdReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetCustomSelectedDateByCompanyIdReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetCustomSelectedDateByCompanyIdReportData
	ORDER BY TransactionIdNo 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_Pagination N'2022-01-01',N'2022-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_Pagination]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetCustomSelectedDateByCompanyIdReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetCustomSelectedDateByCompanyIdReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetCustomSelectedDateByCompanyIdReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetCustomSelectedDateByCompanyIdReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	01/July/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_TotalDetails N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetCustomSelectedDateReportByCompanyId_TotalDetails]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))
	AND CompanyId = @CompanyId

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))
	AND CompanyId = @CompanyId

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReport_ExcelAndPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetMonthlySelectedDateReport_ExcelAndPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Monthly Report Details for Excel and PDF file.
-- USP_Admin_BalanceSheetMonthlySelectedDateReport_ExcelAndPdf N'2023-01-01',N'2023-07-19'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReport_ExcelAndPdf]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetMonthlySelectedDateReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetMonthlySelectedDateReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetMonthlySelectedDateReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @month AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @month AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)

	SELECT * FROM ##AdminBalanceSheetMonthlySelectedDateReportData
	ORDER BY TransactionIdNo asc
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetMonthlySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Monhtly Selected Report 
-- USP_Admin_BalanceSheetMonthlySelectedDateReport_Pagination N'2',N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReport_Pagination]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetMonthlySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetMonthlySelectedDateReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetMonthlySelectedDateReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @month AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @month AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)

	SELECT * FROM ##AdminBalanceSheetMonthlySelectedDateReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetMonthlySelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Weekly Selected Report 
-- USP_Admin_BalanceSheetMonthlySelectedDateReport_TotalDetails N'2',N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReport_TotalDetails]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,TransectionDate)) = @month AND YEAR(CONVERT(date,TransectionDate)) = @year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @month AND YEAR(CONVERT(date,CreatedOnUtc)) = @year)

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_ExcelPdf N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_ExcelPdf]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetMonthlySelectedDateByCompanyIdReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetMonthlySelectedDateByCompanyIdReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetMonthlySelectedDateByCompanyIdReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @month AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) <= @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @month AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetMonthlySelectedDateByCompanyIdReportData
	ORDER BY TransactionIdNo 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_Pagination N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_Pagination]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetMonthlySelectedDateByCompanyIdReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetMonthlySelectedDateByCompanyIdReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetMonthlySelectedDateByCompanyIdReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @month AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @month AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetMonthlySelectedDateByCompanyIdReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Monthly Report of any company
-- USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_TotalDetails N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetMonthlySelectedDateReportByCompanyId_TotalDetails]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,TransectionDate)) = @month AND YEAR(CONVERT(date,TransectionDate)) = @year)
	AND CompanyId = @CompanyId

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @month AND YEAR(CONVERT(date,CreatedOnUtc)) = @year)
	AND CompanyId = @CompanyId

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReport_ExcelAndPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetWeeklySelectedDateReport_ExcelAndPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Weekly Report Details for Excel and PDF file.
-- USP_Admin_BalanceSheetWeeklySelectedDateReport_ExcelAndPdf N'2023-01-01',N'2023-07-19'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReport_ExcelAndPdf]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetWeeklySelectedDateReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetWeeklySelectedDateReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetWeeklySelectedDateReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))

	SELECT * FROM ##AdminBalanceSheetWeeklySelectedDateReportData
	ORDER BY TransactionIdNo asc
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetWeeklySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Weekly Selected Report 
-- USP_Admin_BalanceSheetWeeklySelectedDateReport_Pagination N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReport_Pagination]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetWeeklySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetWeeklySelectedDateReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetWeeklySelectedDateReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))

	SELECT * FROM ##AdminBalanceSheetWeeklySelectedDateReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetWeeklySelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Weekly Selected Report 
-- USP_Admin_BalanceSheetWeeklySelectedDateReport_TotalDetails N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReport_TotalDetails]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_ExcelPdf N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_ExcelPdf]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetWeeklySelectedDateByCompanyIdReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetWeeklySelectedDateByCompanyIdReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetWeeklySelectedDateByCompanyIdReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetWeeklySelectedDateByCompanyIdReportData
	ORDER BY TransactionIdNo 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_Pagination N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_Pagination]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetWeeklySelectedDateByCompanyIdReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetWeeklySelectedDateByCompanyIdReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetWeeklySelectedDateByCompanyIdReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetWeeklySelectedDateByCompanyIdReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	12/July/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_TotalDetails N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetWeeklySelectedDateReportByCompanyId_TotalDetails]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))
	AND CompanyId = @CompanyId

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))
	AND CompanyId = @CompanyId

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReport_ExcelAndPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetYearlySelectedDateReport_ExcelAndPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Yearly Report Details for Excel and PDF file.
-- USP_Admin_BalanceSheetYearlySelectedDateReport_ExcelAndPdf N'2023-01-01',N'2023-07-19'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReport_ExcelAndPdf]
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetYearlySelectedDateReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetYearlySelectedDateReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetYearlySelectedDateReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year

	SELECT * FROM ##AdminBalanceSheetYearlySelectedDateReportData
	ORDER BY TransactionIdNo asc
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetYearlySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Monhtly Selected Report 
-- USP_Admin_BalanceSheetYearlySelectedDateReport_Pagination N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReport_Pagination]
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetYearlySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetYearlySelectedDateReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetYearlySelectedDateReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year

	SELECT * FROM ##AdminBalanceSheetYearlySelectedDateReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetYearlySelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	11/July/2023
-- Description:		Get Balance Sheet Weekly Selected Report 
-- USP_Admin_BalanceSheetYearlySelectedDateReport_TotalDetails N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReport_TotalDetails]
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND YEAR(CONVERT(date,TransectionDate)) = @year

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND YEAR(CONVERT(date,CreatedOnUtc)) = @year

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	13/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_ExcelPdf N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_ExcelPdf]
	@year NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetYearlySelectedDateByCompanyIdReportData') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetYearlySelectedDateByCompanyIdReportData
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetYearlySelectedDateByCompanyIdReportData
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (YEAR(CONVERT(date,tbl_payment.TransectionDate)) <= @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetYearlySelectedDateByCompanyIdReportData
	ORDER BY TransactionIdNo 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	13/July/2023
-- Description:		Get Balance Sheet Report Data for selected Company between passed Date Range.
-- USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_Pagination N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_Pagination]
	@year NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminBalanceSheetYearlySelectedDateByCompanyIdReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminBalanceSheetYearlySelectedDateByCompanyIdReport
	END

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	INTO ##AdminBalanceSheetYearlySelectedDateByCompanyIdReport
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (tbl_payment.CompanyId = @CompanyId)
			
	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
	AND (tbl_expenses.CompanyId = @CompanyId)

	SELECT * FROM ##AdminBalanceSheetYearlySelectedDateByCompanyIdReport
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	13/July/2023
-- Description:		Get Balance Sheet Yearly Report of any company
-- USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_TotalDetails N'2022-01-01',N'2023-12-31',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_BalanceSheetYearlySelectedDateReportByCompanyId_TotalDetails]
	@year NVARCHAR(30) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (YEAR(CONVERT(date,TransectionDate)) = @year)
	AND CompanyId = @CompanyId

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (YEAR(CONVERT(date,CreatedOnUtc)) = @year)
	AND CompanyId = @CompanyId

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_BannerOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <05-Jan-2022>
-- Modify By : <Yashasvi Sharma,Yashasvi Sharma>
-- Modify date : <25-11-2022,18-05-2023>
-- Description:	<<Store Banners to display on Slider>>
-- <SP_Admin_BannerOperation>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_BannerOperation]
	@Id INT = NULL,
	@FileName NVARCHAR(MAX) = NULL,
	@Extension NVARCHAR(MAX) = NULL,
	@PictureBinary VARBINARy(MAX) = NULL,
	@Path NVARCHAR(MAX) = NULL,
	@IsActive NVARCHAR(MAX) = NULL,
	@Status INT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Id IS NULL AND @Status = 1
	BEGIN
		INSERT INTO [dbo].[Tbl_Banner](
			[FileName],
			Extension,
			PictureBinary,
			[Path],
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@FileName,
			@Extension,
			@PictureBinary,
			@Path,
			@IsActive,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_Banner])
		SELECT @returnId
	END
	ELSE IF @Id IS NOT NULL AND @Status = 1
	BEGIN
		UPDATE [dbo].[Tbl_Banner]
		SET 
			IsActive = @IsActive,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_banner.Id,0) AS Id,
			ISNULL(tbl_banner.FileName,'N/A') AS [FileName],
			ISNULL(tbl_banner.Extension,'N/A') AS Extension,
			tbl_banner.PictureBinary AS PictureBinary,
			ISNULL(tbl_banner.Path,'N/A') AS [Path],
			ISNULL(tbl_banner.IsActive,0) AS IsActive,
			ISNULL(tbl_banner.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_banner.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_banner.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_Banner] tbl_banner WITH(NOLOCK)
		WHERE tbl_banner.IsDelete <> 1
	END
	ELSE IF @Id IS NOT NULL AND @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_banner.Id,0) AS Id,
			ISNULL(tbl_banner.FileName,'N/A') AS [FileName],
			ISNULL(tbl_banner.Extension,'N/A') AS Extension,
			tbl_banner.PictureBinary AS PictureBinary,
			ISNULL(tbl_banner.Path,'N/A') AS [Path],
			ISNULL(tbl_banner.IsActive,0) AS IsActive,
			ISNULL(tbl_banner.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_banner.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_banner.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_Banner] tbl_banner WITH(NOLOCK)
		WHERE tbl_banner.Id = @Id AND tbl_banner.IsDelete <> 1
	END
	ELSE IF @Id IS NOT NULL AND @Status = 4 
	BEGIN
		UPDATE [dbo].[Tbl_Banner]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ChangePassword]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ChangePassword
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Change password 
-- USP_Admin_ChangePassword
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ChangePassword]
	@AccountType NVARCHAR(MAX) = NULL,
	@Password NVARCHAR(MAX) = NULL,
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @AccountType = N'CompanyAccount'
	BEGIN
		UPDATE [dbo].[Tbl_Company] 
        SET  
			Cmp_Pass = @Password
		WHERE Id = @Id;
	END
	ELSE IF @AccountType = N'User'
	BEGIN
		UPDATE [dbo].[Tbl_Password] 
		SET  
			Password = @Password
        WHERE UserId =  @Id;
	END
	ELSE IF @AccountType = N'SalesPerson'
	BEGIN
		UPDATE [dbo].[Tbl_Password] 
        SET  
		    Password = @Password
        WHERE SalesPersonId =   @Id;
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ChangeRequestNotificationStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <16-June-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	Change Mark As Read Status and Delete any Notification
-- SP_Admin_ChangeRequestNotificationStatus 1,1
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_ChangeRequestNotificationStatus]
	@Status INT = NULL,
	@Id INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		UPDATE [dbo].[Tbl_RequestNotification]
		SET
			MarkAsRead = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		SELECT @Id
	END
	ELSE IF @Status = 2
	BEGIN
		UPDATE [dbo].[Tbl_RequestNotification]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		SELECT @Id
	END
	ELSE IF @Status = 3
	BEGIN
		UPDATE [dbo].[Tbl_RequestNotification]
		SET
			AssignedUserMarkAsRead = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		SELECT @Id
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ChangeServiceStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<If admin approve any request it change status of request from 3-pending to 0-open>
-- <SP_Admin_ChangeServiceStatus>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_ChangeServiceStatus]
	@SerialNumber NVARCHAR(MAX) = NULL,
	@UserId INT = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_ServiceRequest]
	SET
		Status = @Status,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE SerialNumber LIKE @SerialNumber

	SELECT 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ChangeStatusOfCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <02-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <USP_Admin_ChangeStatusOfCompany 5>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ChangeStatusOfCompany]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @CompanyId IS NOT NULL
	BEGIN

		UPDATE [dbo].[Tbl_Company]
		SET IsActive = 1
		WHERE Id = @CompanyId

		UPDATE [dbo].[Tbl_User]
		SET 
			Tbl_User.IsActive = 1
		FROM [dbo].[Tbl_User] t1
		LEFT JOIN [Tbl_Company_User_Mapping] t2 ON t2.UserId = t1.Id
		LEFT JOIN [dbo].[Tbl_Company] t3 ON t3.Id = t2.CompanyId
		WHERE t3.Id = @CompanyId

		SELECT EmailID FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckAccountEntryType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_CheckAccountEntryType
-- Author:		<Yashasvi Sharma>
-- Create date: <26-September-2024>
-- Modify By : <>
-- Modify date : <>
-- USP_Admin_CheckAccountEntryType N'TRN24779'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckAccountEntryType]
	@transactionCode nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE TransactionId = @transactionCode AND (IsDelete <> 1 OR IsDelete IS NULL))
	BEGIN
		SELECT 
			'Credit' AS [AccountType],
			Id AS Id,
			CompanyId AS CompanyId,
			TotalAmount AS TotalAmount
		FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE TransactionId = @transactionCode AND (IsDelete <> 1 OR IsDelete IS NULL)
	END
	ELSE 
	BEGIN
		SELECT 
			'Debit' AS [AccountType],
			Id AS Id,
			CompanyId AS CompanyId,
			GrandTotal AS TotalAmount
		FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE TransactionId = @transactionCode AND (IsDelete <> 1 OR IsDelete IS NULL)
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckCompanyAssociation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <Create date>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <USP_Admin_CheckCompanyAssociation 4>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckCompanyAssociation]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company_User_Mapping] WHERE CompanyId = @CompanyId AND UserId <> 0 AND IsDelete <> 1)
	BEGIN
		 SELECT UserId AS Users FROM [dbo].[Tbl_Company_User_Mapping] WHERE CompanyId = @CompanyId AND UserId <> 0 AND IsDelete <> 1
	END
	ELSE 
	BEGIN
		SELECT -1 AS Users
	END
	IF EXISTS(SELECT ID FROM [dbo].[Tbl_ShareholdersOrDirectors] WHERE CompanyId = @CompanyId AND IsDelete <> 1)
	BEGIN
		SELECT COUNT(*) AS Shareholders FROM [dbo].[Tbl_ShareholdersOrDirectors] WHERE CompanyId = @CompanyId AND IsDelete <> 1
	END
	ELSE 
	BEGIN
		SELECT -1 AS Shareholders
	END
	IF EXISTS(SELECT ID FROM [dbo].[Tbl_Company_Document_Mapping] WHERE CompanyId = @CompanyId AND IsDeleted <> 1)
	BEGIN
		SELECT COUNT(*) AS Documents FROM [dbo].[Tbl_Company_Document_Mapping] WHERE CompanyId = @CompanyId AND IsDeleted <> 1
	END
	ELSE 
	BEGIN
		SELECT -1 AS Documents
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckCompnayPermissionAllowedOrNot]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Create By : <Yashasvi Sharma>
-- Create date: <07-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_CheckCompnayPermissionAllowedOrNot 1008>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckCompnayPermissionAllowedOrNot]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_CompanyPermission] tbl_companypermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_companypermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companypermission.CompanyId
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_companypermission.PermissionId = tbl_permission.PermissionId
	WHERE tbl_company.Id = @CompanyId AND tbl_companypermission.IsDelete<> 1 
	AND tbl_module.ModuleName LIKE N'CompanyPermission' AND tbl_permission.PermissionName LIKE N'View'  
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckCompnayPermissionAllowedOrNotByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Create By : <Yashasvi Sharma>
-- Create date: <07-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_CheckCompnayPermissionAllowedOrNotByRoleId 1008>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckCompnayPermissionAllowedOrNotByRoleId]
	@Role NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_RolePermission] tbl_rolepermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_rolepermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolepermission.RoleID
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_rolepermission.PermissionId = tbl_permission.PermissionId
	WHERE tbl_role.RoleName = @Role AND tbl_rolepermission.IsDelete<> 1 
	AND tbl_module.ModuleName LIKE N'CompanyPermission' OR tbl_module.ModuleName LIKE N'UserPermission' AND tbl_permission.PermissionName LIKE N'View'  
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckEmployeeCountByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckEmployeeCountByCompanyId
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Check employees count by company id
-- USP_Admin_CheckEmployeeCountByCompanyId
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckEmployeeCountByCompanyId]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT tbl_role.RoleName FROM [dbo].[Tbl_User_Role_Mapping] tbl_mapping  
    LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_mapping.UserId  
    LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_mapping.RoleID  
    WHERE tbl_mapping.IsDelete <> 1 AND tbl_user.IsDelete <> 1 AND tbl_role.IsDelete <> 1 AND tbl_user.Id =  @UserId    
    AND tbl_role.RoleName LIKE 'Employee')  
    BEGIN  
		SELECT -1  
    END 
	ELSE 
	BEGIN  
		SELECT 1  
    END;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckEmployeeForMainCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Create By : <Yashasvi Sharma>
-- Create date: <07-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_CheckEmployeeForMainCompany 4>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckEmployeeForMainCompany]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT tbl_user.Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
			  LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_userMapping 
			  ON tbl_userMapping.UserId = tbl_user.Id 
			  WHERE tbl_userMapping.UserId = @UserId AND CompanyId = 1
			  )
	BEGIN
		SELECT -1
	END
	ELSE 
	BEGIN
		SELECT 1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckExistingCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <31-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<Use to check Whether entered Company name was already exists or not.>>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckExistingCompany]
	@CompanyName NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @CompanyName IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE CompanyName LIKE @CompanyName + '%' )
		BEGIN
			SELECT -1
		END
		ELSE 
		BEGIN
			SELECT 1
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckExistingCompanyAccountNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <31-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<Use to check Whether entered Account number was already exists or not.>>
-- USP_Admin_CheckExistingCompanyAccountNumber N'DIBN104'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckExistingCompanyAccountNumber]
	@AccountNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @AccountNumber IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber + '%' AND IsDelete<> 1 )
		BEGIN
			SELECT -1
		END
		ELSE 
		BEGIN
			SELECT 1
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckExistingEmail]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <31-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<Use to check Whether entered Company name was already exists or not.>>
-- SP_Admin_CheckExistingEmail N'yashasvi1@thebridgecode.com'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckExistingEmail]
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Email IS NOT NULL
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WITH(NOLOCK) WHERE EmailAddress LIKE @Email + '%' AND IsDelete<> 1)
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId LIKE @Email + '%' AND IsDelete<> 1)
			BEGIN
				SELECT 1
			END
			ELSE 
			BEGIN
				SELECT -1
			END
		END
		ELSE 
		BEGIN
			SELECT -1
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckExistingRole]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <01-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<Use to check Whether entered Company name was already exists or not.>>
-- USP_Admin_CheckExistingRole N'DIBN',1
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_CheckExistingRole]
	@name NVARCHAR(MAX) = NULL,
	@id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @name IS NOT NULL
	BEGIN	
		IF EXISTS(SELECT RoleID FROM [dbo].[Tbl_Role] WITH(NOLOCK) WHERE (RoleName LIKE @name AND IsDelete<> 1 AND (@id IS NULL OR RoleID <> @id)) OR @name LIKE 'DIBN')
		BEGIN
			SELECT -1
		END
		ELSE
		BEGIN
			SELECT 1
		END
	END
	ELSE
	BEGIN
		SELECT -1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckExistingUserAccountNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <31-Dec-2021>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <02/august/2024>
-- Description:	<<Use to check Whether entered Account number was already exists or not.>>
-- USP_Admin_CheckExistingUserAccountNumber N'ECOEM9',670
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckExistingUserAccountNumber]
	@AccountNumber NVARCHAR(MAX) = NULL,
	@userId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @userId IS NULL
	BEGIN
		IF @AccountNumber IS NOT NULL
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber + '%' AND IsDelete<> 1)
			BEGIN
				SELECT -1
			END
			ELSE 
			BEGIN
				SELECT 1
			END
		END
	END
	ELSE
	BEGIN
		IF @AccountNumber IS NOT NULL
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete<> 1
			AND Id <> @userId)
			BEGIN
				SELECT -1
			END
			ELSE 
			BEGIN
				SELECT 1
			END
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckInvoiceDataIsDeleted]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckInvoiceDataIsDeleted
-- Author:			<Yashasvi Sharma>
-- Created date:	06/July/2023
-- Description:		Check whether selected data for update is already deleted by someone or not.
-- USP_Admin_CheckInvoiceDataIsDeleted 2
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_CheckInvoiceDataIsDeleted]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_companyInvoiceDetails.IsDelete AS IsDelete,
		ISNULL(tbl_user.FirstName + ' ' + tbl_user.LastName + ' ( ' + tbl_user.AccountNumber + ' ) ','N/A') AS ModifyBy ,
		ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,110),'N/A') AS ModifyOnDate,
		ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,108),'N/A') AS ModifyOnTime
	FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_companyInvoiceDetails.ModifyBy = tbl_user.Id
	WHERE tbl_companyInvoiceDetails.Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckIsInvoiceDeleted]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckIsInvoiceDeleted
-- Author:			<Yashasvi Sharma>
-- Created date:	07/July/2023
-- Description:		Check whether invoice is already deleted or not.
-- USP_Admin_CheckIsInvoiceDeleted N'DIBN124'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckIsInvoiceDeleted]	
	@InvoiceNumber nvarchar(500) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @totalData INT = NULL,@deletedData INT = NULL

	SET @totalData = (
						SELECT COUNT(tbl_companyInvoiceDetails.Id)
						FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails
						WHERE tbl_companyInvoiceDetails.InvoiceNumber = @InvoiceNumber
					)

	SET @deletedData = (
							SELECT COUNT(tbl_companyInvoiceDetails.Id)
							FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails
							WHERE tbl_companyInvoiceDetails.InvoiceNumber = @InvoiceNumber AND tbl_companyInvoiceDetails.IsDelete = 1
						)

	IF CONVERT(int,@totalData) = CONVERT(int,@deletedData)
	BEGIN
		SELECT 
			tbl_companyInvoiceDetails.IsDelete AS IsDelete,
			ISNULL(tbl_user.FirstName + ' ' + tbl_user.LastName + ' ( ' + tbl_user.AccountNumber + ' ) ','N/A') AS ModifyBy ,
			ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,110),'N/A') AS ModifyOnDate,
			ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,108),'N/A') AS ModifyOnTime
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_companyInvoiceDetails.ModifyBy = tbl_user.Id
		WHERE tbl_companyInvoiceDetails.InvoiceNumber = @InvoiceNumber
		AND tbl_companyInvoiceDetails.IsDelete = 1
		GROUP BY tbl_companyInvoiceDetails.InvoiceNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.AccountNumber,
		tbl_companyInvoiceDetails.ModifyOn,tbl_companyInvoiceDetails.IsDelete
	END
	ELSE
	BEGIN
		SELECT 
			'-1' AS IsDelete,
			'-1' AS ModifyBy,
			'-1' AS ModifyOnDate,
			'-1' AS ModifyOnTime
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckIsNewCompanyInvoiceDeleted]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckIsNewCompanyInvoiceDeleted
-- Author:			<Yashasvi Sharma>
-- Created date:	07/July/2023
-- Description:		Check whether invoice is already deleted or not.
-- USP_Admin_CheckIsNewCompanyInvoiceDeleted N'PI102'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckIsNewCompanyInvoiceDeleted]	
	@InvoiceNumber nvarchar(500) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @totalData INT = NULL,@deletedData INT = NULL

	SET @totalData = (
						SELECT COUNT(tbl_companyInvoiceDetails.Id)
						FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetails
						WHERE tbl_companyInvoiceDetails.InvoiceNumber = @InvoiceNumber
					)

	SET @deletedData = (
							SELECT COUNT(tbl_companyInvoiceDetails.Id)
							FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetails
							WHERE tbl_companyInvoiceDetails.InvoiceNumber = @InvoiceNumber AND tbl_companyInvoiceDetails.IsDelete = 1
						)

	IF CONVERT(int,@totalData) = CONVERT(int,@deletedData)
	BEGIN
		SELECT 
			tbl_companyInvoiceDetails.IsDelete AS IsDelete,
			ISNULL(tbl_user.FirstName + ' ' + tbl_user.LastName + ' ( ' + tbl_user.AccountNumber + ' ) ','N/A') AS ModifyBy ,
			ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,110),'N/A') AS ModifyOnDate,
			ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,108),'N/A') AS ModifyOnTime
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetails
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_companyInvoiceDetails.ModifyBy = tbl_user.Id
		WHERE tbl_companyInvoiceDetails.InvoiceNumber = @InvoiceNumber
		AND tbl_companyInvoiceDetails.IsDelete = 1
		GROUP BY tbl_companyInvoiceDetails.InvoiceNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.AccountNumber,
		tbl_companyInvoiceDetails.ModifyOn,tbl_companyInvoiceDetails.IsDelete
	END
	ELSE
	BEGIN
		SELECT 
			'-1' AS IsDelete,
			'-1' AS ModifyBy,
			'-1' AS ModifyOnDate,
			'-1' AS ModifyOnTime
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckLoggedInUserStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <24-11-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <18-05-2023>
-- Description:	<Get IsActive, IsLogin and IsDelete Status of Logged in User for Session>
-- <USP_Admin_CheckLoggedInUserStatus>
-- USP_Admin_CheckLoggedInUserStatus 358,N'Company Owner',N'DIBN103'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckLoggedInUserStatus]
	@CompanyId INT = NULL,
	@Role NVARCHAR(MAX) = NULL,
	@AccountNumber NVARCHAR(MAX) = NULL,
	@EmailId NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	IF @EmailId IS NOT NULL
	BEGIN
		IF @Role = N'Sales Person'
		BEGIN
			DECLARE @SalesPersonId INT = NULL;
			SET @SalesPersonId = (SELECT TOP(1) tbl_SalesPerson.Id FROM [dbo].[Tbl_SalesPersons] tbl_SalesPerson WITH(NOLOCK)
			WHERE tbl_SalesPerson.EmailId LIKE @EmailId ORDER BY tbl_SalesPerson.Id DESC)
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] tbl_SalesPerson WITH(NOLOCK) WHERE EmailId LIKE @EmailId AND tbl_SalesPerson.Id = @SalesPersonId)
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] tbl_SalesPerson WITH(NOLOCK) WHERE EmailId LIKE @EmailId AND tbl_SalesPerson.Id = @SalesPersonId AND IsDelete = 1)
				BEGIN
					SELECT 1 AS IsDelete,
						   0 AS IsActive,
						   0 AS IsLoggedIn
				END
				ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] tbl_SalesPerson WITH(NOLOCK)
				WHERE EmailId LIKE @EmailId AND tbl_SalesPerson.Id = @SalesPersonId AND IsActive = 0)
				BEGIN
					SELECT 0 AS IsDelete,
						   1 AS IsActive,
						   0 AS IsLoggedIn
				END
				ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] tbl_SalesPerson WITH(NOLOCK)
				WHERE EmailId LIKE @EmailId AND tbl_SalesPerson.Id = @SalesPersonId AND IsLogin = 0)
				BEGIN
					SELECT 0 AS IsDelete,
						   0 AS IsActive,
						   1 AS IsLoggedIn
				END
			END
		END
		ELSE IF @Role = N'RM Team'
		BEGIN
			DECLARE @RMTeamId INT = NULL;

			SET @RMTeamId = (SELECT TOP(1) tbl_RMTeam.Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
							WHERE tbl_RMTeam.EmailAddress LIKE @EmailId ORDER BY tbl_RMTeam.Id DESC)

			IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) WHERE tbl_RMTeam.EmailAddress LIKE @EmailId AND tbl_RMTeam.Id = @RMTeamId)
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) WHERE tbl_RMTeam.EmailAddress LIKE @EmailId AND tbl_RMTeam.Id = @RMTeamId AND IsDelete = 1)
				BEGIN
					SELECT 1 AS IsDelete,
						   0 AS IsActive,
						   0 AS IsLoggedIn
				END
				ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
					WHERE tbl_RMTeam.EmailAddress LIKE @EmailId AND tbl_RMTeam.Id = @RMTeamId AND tbl_RMTeam.IsActive = 0)
				BEGIN
					SELECT 0 AS IsDelete,
						   1 AS IsActive,
						   0 AS IsLoggedIn
				END
				ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
					WHERE tbl_RMTeam.EmailAddress LIKE @EmailId AND tbl_RMTeam.Id = @RMTeamId AND tbl_RMTeam.IsLoginAllowed = 0)
				BEGIN
					SELECT 0 AS IsDelete,
						   0 AS IsActive,
						   1 AS IsLoggedIn
				END
			END
		END
	END
	ELSE IF @AccountNumber IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber)
		BEGIN
			DECLARE @UserCompanyId INT = NULL,@UserId INT = NULL;
			SET @UserId = (SELECT TOP(1) tbl_user.Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber ORDER BY tbl_user.Id DESC)

			SET @UserCompanyId = (SELECT TOP 1 tbl_company_user_mapping.CompanyId FROM [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK)
									LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_company_user_mapping.UserId
									WHERE tbl_company_user_mapping.UserId = @UserId
									ORDER BY tbl_company_user_mapping.Id DESC)

			IF @UserCompanyId = @CompanyId
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) WHERE tbl_company.Id = @CompanyId AND tbl_company.IsActive <> 0 AND tbl_company.IsDelete <> 1)
				BEGIN
					IF EXISTS(SELECT TOP(1) Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber AND tbl_user.IsDelete = 1 AND tbl_user.Id=@UserId ORDER BY tbl_user.Id DESC)
					BEGIN
						SELECT  1 AS IsDelete,
								0 AS IsActive,
								0 AS IsLoggedIn
					END
					ELSE IF EXISTS(SELECT TOP(1) Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber AND tbl_user.IsActive = 0 AND tbl_user.Id=@UserId ORDER BY tbl_user.Id DESC)
					BEGIN
						SELECT  0 AS IsDelete,
								1 AS IsActive,
								0 AS IsLoggedIn
					END
					ELSE IF EXISTS(SELECT TOP(1) Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber AND tbl_user.IsLogin = 0 AND tbl_user.Id=@UserId ORDER BY tbl_user.Id DESC)
					BEGIN
						SELECT 0 AS IsDelete,
								0 AS IsActive,
								1 AS IsLoggedIn
					END
				END
				ELSE 
				BEGIN
					SELECT 1 AS IsDelete,
						   0 AS IsActive,
						   0 AS IsLoggedIn
				END
			END
			ELSE IF EXISTS(SELECT TOP(1) Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber AND tbl_user.IsDelete = 1 AND tbl_user.Id=@UserId ORDER BY tbl_user.Id DESC)
			BEGIN
				SELECT  1 AS IsDelete,
						0 AS IsActive,
						0 AS IsLoggedIn
			END
			ELSE IF EXISTS(SELECT TOP(1) Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber AND tbl_user.IsActive = 0 AND tbl_user.Id=@UserId ORDER BY tbl_user.Id DESC)
			BEGIN
				SELECT  0 AS IsDelete,
						1 AS IsActive,
						0 AS IsLoggedIn
			END
			ELSE IF EXISTS(SELECT TOP(1) Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.AccountNumber LIKE @AccountNumber AND tbl_user.IsLogin = 0 AND tbl_user.Id=@UserId ORDER BY tbl_user.Id DESC)
			BEGIN
				SELECT 0 AS IsDelete,
						0 AS IsActive,
						1 AS IsLoggedIn
			END
			ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) WHERE tbl_Company.AccountNumber LIKE @AccountNumber AND tbl_Company.Id = @CompanyId)
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) WHERE tbl_Company.AccountNumber LIKE @AccountNumber AND tbl_Company.Id = @CompanyId AND IsDelete = 1)
				BEGIN
					SELECT  1 AS IsDelete,
							0 AS IsActive,
							0 AS IsLoggedIn
				END
				ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) WHERE tbl_Company.AccountNumber LIKE @AccountNumber AND tbl_Company.Id = @CompanyId AND IsActive = 0)
				BEGIN
					SELECT  0 AS IsDelete,
							1 AS IsActive,
							0 AS IsLoggedIn
				END
			END
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) WHERE tbl_Company.AccountNumber LIKE @AccountNumber AND tbl_Company.Id = @CompanyId)
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) WHERE tbl_Company.AccountNumber LIKE @AccountNumber AND tbl_Company.Id = @CompanyId AND IsDelete = 1)
			BEGIN
				SELECT  1 AS IsDelete,
						0 AS IsActive,
						0 AS IsLoggedIn
			END
			ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) WHERE tbl_Company.AccountNumber LIKE @AccountNumber AND tbl_Company.Id = @CompanyId AND IsActive = 0)
			BEGIN
				SELECT  0 AS IsDelete,
						1 AS IsActive,
						0 AS IsLoggedIn
			END
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckNewPIInvoiceDataIsDeleted]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckNewPIInvoiceDataIsDeleted
-- Author:			<Yashasvi Sharma>
-- Created date:	06/July/2023
-- Description:		Check whether selected data for update is already deleted by someone or not for new company.
-- USP_Admin_CheckNewPIInvoiceDataIsDeleted 2
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_CheckNewPIInvoiceDataIsDeleted]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_companyInvoiceDetails.IsDelete AS IsDelete,
		ISNULL(tbl_user.FirstName + ' ' + tbl_user.LastName + ' ( ' + tbl_user.AccountNumber + ' ) ','N/A') AS ModifyBy ,
		ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,110),'N/A') AS ModifyOnDate,
		ISNULL(CONVERT(nvarchar(50),tbl_companyInvoiceDetails.ModifyOn,108),'N/A') AS ModifyOnTime
	FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetails
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_companyInvoiceDetails.ModifyBy = tbl_user.Id
	WHERE tbl_companyInvoiceDetails.Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckRolePermissionExists]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckRolePermissionExists
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Check Whether Currently Logged In Role has permission for passed module
-- USP_Admin_CheckRolePermissionExists
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckRolePermissionExists]
	@roleId INT = NULL,
	@moduleId INT = NULL,
	@permissionId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT PermissionId FROM [dbo].[Tbl_RolePermission] WHERE RoleID =  @roleId  AND ModuleId =  @moduleId 
			AND PermissionId =  @permissionId  AND IsDelete <> 1)  
    BEGIN  
        SELECT 1 
    END  
    ELSE  
    BEGIN  
        SELECT 0 
    END;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckSalesPerson]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <Create Date>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <18-05-2023>
-- Description:	Check if passed email address exists in sales person table or not
-- <USP_Admin_CheckSalesPerson>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckSalesPerson]
	@EmailId NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @EmailId IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId LIKE @EmailId AND IsDelete <> 1)
		BEGIN
			SELECT 1
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WITH(NOLOCK) WHERE EmailAddress LIKE @EmailId AND IsDelete <> 1)
		BEGIN
			SELECT 1
		END
		ELSE
		BEGIN
			SELECT -1
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckSupportTicketAssigned]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckSupportTicketAssigned
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Check if passed support ticket is assigned to user , if true than it will remove all assigned users
-- USP_Admin_CheckSupportTicketAssigned
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckSupportTicketAssigned]
	@TrackingNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_AssignSupportTicket] WHERE TrackingNumber LIKE @TrackingNumber) 
    BEGIN 
		DELETE FROM[dbo].[Tbl_AssignSupportTicket] 
		WHERE TrackingNumber LIKE @TrackingNumber 
    END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckUserPermissionAllowedOrNot]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Create By : <Yashasvi Sharma>
-- Create Date : <07-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_CheckUserPermissionAllowedOrNot 1008>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_CheckUserPermissionAllowedOrNot]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @Count INT = NULL;
	SET @Count =(SELECT COUNT(UserPermissionId) FROM [dbo].[Tbl_UserPermission] WHERE UserId = @UserId AND (IsDelete <> 1 OR IsDelete IS NULL))
	
	IF @Count > 0
	BEGIN
		SELECT DISTINCT 
			tbl_module.ModuleName AS ModuleName
		FROM [dbo].[Tbl_UserPermission] tbl_userpermission WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_userpermission.ModuleId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_userpermission.UserId
		LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_userpermission.PermissionId = tbl_permission.PermissionId
		WHERE tbl_user.Id = @UserId AND (tbl_userpermission.IsDelete <> 1 OR tbl_userpermission.IsDelete IS NULL)
		AND tbl_module.ModuleName LIKE N'UserPermission' AND tbl_permission.PermissionName LIKE N'View' 
	END
	ELSE
	BEGIN
	 SELECT '0' AS ModuleName
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckWhetherAccountManagementAdded]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_CheckWhetherAccountManagementAdded
-- Author:		<Yashasvi Sharma>
-- Create date: <22-March-2024>
-- Modify By : <>
-- Modify date : <>
-- Check whether any account entry is not added.
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckWhetherAccountManagementAdded]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	--DECLARE @PlanHandle VARBINARY(64);

	--SELECT  @PlanHandle = deps.plan_handle
	--FROM    sys.dm_exec_procedure_stats AS deps
	--WHERE   deps.object_id = OBJECT_ID('dbo.USP_Admin_CheckWhetherAccountManagementAdded') AND deps.database_id = DB_ID();

	--IF @PlanHandle IS NOT NULL
	--BEGIN
	--    DBCC FREEPROCCACHE(@PlanHandle);
	--END

	SET TRANSACTION ISOLATION LEVEL READ COMMITTED
	BEGIN TRAN 
	EXEC sp_getapplock @Resource = 'USP_Admin_CheckWhetherAccountManagementAdded', @LockOwner='Transaction', @LockMode = 'Exclusive', @LockTimeout = 120000; 
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_AccountManagementStaging]
		WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)
		AND Id = @Id)
	BEGIN
		DECLARE @UserId int, 
				@CompanyId int, 
				@TransactionType nvarchar(50),
				@Description nvarchar(max), 
				@PaymentMode nvarchar(100),
				@Amount decimal(18,2),
				@Quantity int,
				@TotalAmount decimal(18,2),
				@Vat decimal(18,2),
				@VatAmount decimal(18,2),
				@CreatedOn nvarchar(50),
				@PaymentStatus nvarchar(50),
				@GrandTotal decimal(18,2),
				@Ids int,
				@ChangeAmount NVARCHAR(50)=NULL

		DECLARE @PortalId INT = NULL, @Amounts DECIMAL(18,2) = NULL;
		DECLARE @RemainingPortalBalance NVARCHAR(MAX) = null;
		DECLARE @SerialNumber INT = NULL,@NewSerialNumber NVARCHAR(100) = NULL;
		DECLARE @TransactionId INT = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;
		DECLARE @paymentId INT =0,@paymentReceiptId INT =0
		DECLARE @returnId INT =0

		SELECT TOP(1)
				@UserId = UserId,
				@CompanyId = CompanyId,
				@TransactionType = TransactionType,
				@Description = Description,
				@PaymentMode = PaymentMode,
				@Amount = Amount,
				@Quantity = Quantity,
				@TotalAmount = TotalAmount,
				@Vat = Vat,
				@VatAmount = VatAmount,
				@CreatedOn = CreatedOn,
				@PaymentStatus = PaymentStatus,
				@GrandTotal = GrandTotal
			FROM [dbo].[Tbl_AccountManagementStaging]
			WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)
			AND Id = @Id
		
			UPDATE [dbo].[Tbl_AccountManagementStaging] 
			SET 
				IsDeleted = 1
			WHERE Id = @Id
		
			IF @TransactionType = N'Credit'
			BEGIN
				INSERT INTO [dbo].[Tbl_PaymentTransection](
					UserId,
					CompanyId,
					TransactionId,
					Amount,
					PaymentMode,
					Description,
					PaymentStatus,
					Quantity,
					TotalAmount,
					TransectionDate,
					CreatedBy,
					CreatedOnUtc
				)
				VALUES(
					@UserId,
					@CompanyId,
					@TransactionCode,
					@Amount,
					@PaymentMode,
					@Description,
					@PaymentStatus,
					@Quantity,
					@TotalAmount,
					@CreatedOn,
					@UserId,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				)

				SET @paymentId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK))

				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK))
				BEGIN
					SET @SerialNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX('B',SerialNumber)+1,LEN(SerialNumber)))) 
										FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK));
					SET @SerialNumber = @SerialNumber + 1
					SET  @NewSerialNumber ='RECDB'+ CONVERT(NVARCHAR(100),@SerialNumber);
				END
				ELSE
				BEGIN
					SET  @NewSerialNumber = 'RECDB101';
				END

				IF @CreatedOn IS NULL
				BEGIN
					SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
				END
	
				IF @CompanyId IS NOT NULL
				BEGIN

					INSERT INTO [dbo].[Tbl_PaymentReceipt](
						CompanyId,
						PaymentId,
						SerialNumber,
						Through,
						OnAccount,
						CreatedOn,
						CreatedBy,
						IsDelete
					)
					VALUES(
						@CompanyId,
						@PaymentId,
						@NewSerialNumber,
						N'',
						@Description,
						@CreatedOn,
						@UserId,
						0
					)
				END

				IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
				BEGIN
					INSERT INTO [dbo].[Tbl_PortalBalance](
						UserId,
						CompanyId,
						BalanceAmount,
						CreatedOnUtc,
						IsCompletelyUsed
					)
					VALUES(
						@UserId,
						@CompanyId,
						@TotalAmount,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
						0
					)

					SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK)
				END
				ELSE
				BEGIN
					SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
					SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
					SET @Amount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@TotalAmount);

					UPDATE [dbo].[Tbl_PortalBalance]
					SET
						BalanceAmount = @Amount,
						ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					WHERE Id = @PortalId

					SELECT @PortalId
				END

				UPDATE [dbo].[Tbl_AccountManagementStaging]
				SET 
					TransactionId = @TransactionCode
				WHERE Id = @Id
			END
			ELSE IF @TransactionType = N'Debit'
			BEGIN
				IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE TransactionId = @TransactionCode AND (IsDelete <> 1 OR IsDelete IS NULL))
				BEGIN
					IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE TransactionId = @TransactionCode AND (IsDelete <> 1 OR IsDelete IS NULL))
					BEGIN
						INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
							CompanyId,
							TransactionId,
							ExpensesTitle,
							ExpensesAmount,
							Quantity,
							TotalAmount,
							Vat,
							VatAmount,
							GrandTotal,
							IsDelete,
							CreatedBy,
							CreatedOnUtc,
							TransactionCreatedOnUtc
						)
						VALUES(
							@CompanyId,
							@TransactionCode,
							@Description,
							@Amount,
							@Quantity,
							@TotalAmount,
							@Vat,
							@VatAmount,
							@GrandTotal,
							0,
							@UserId,
							@CreatedOn,
							SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						)

						SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK));
					END
					ELSE
					BEGIN
						SET @returnId = -1
					END
				END
				ELSE
				BEGIN
					SET @returnId = -1
				END

				IF CONVERT(INT,@returnId) > 0
				BEGIN
					SET @Amount = (SELECT ISNULL(BalanceAmount,'0') AS BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);

					IF @Amount IS NULL
					BEGIN
						SET @Amount = '0'
					END

					IF CONVERT(DECIMAL(18,2),@Amount) <= 0
					BEGIN
						SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
					END
					ELSE 
					BEGIN
						SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
					END

					IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
					BEGIN
						UPDATE [dbo].[Tbl_PortalBalance]
						SET
							BalanceAmount = @ChangeAmount,
							ModifyBy = @UserId,
							ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						WHERE CompanyId = @CompanyId
					END
					ELSE
					BEGIN
						INSERT INTO [dbo].[Tbl_PortalBalance](
							UserId,
							CompanyId,
							BalanceAmount,
							CreatedBy,
							CreatedOnUtc,
							IsCompletelyUsed
						)
						VALUES(
							@UserId,
							@CompanyId,
							@ChangeAmount,
							@UserId,
							SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
							0
						)
					END
					UPDATE [dbo].[Tbl_AccountManagementStaging]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @Id
				END
		END	
	END
	COMMIT TRAN
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckWhetherFinalInvoiceExists]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckWhetherFinalInvoiceExists
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Check Whether Passed Invoice Number's Final Invoice exists or not.
-- USP_Admin_CheckWhetherFinalInvoiceExists N'V'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckWhetherFinalInvoiceExists]
	@InvoiceNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS (SELECT * FROM [dbo].[Tbl_CompanyInvoicePdf] WHERE InvoiceNumber LIKE @InvoiceNumber AND IsDelete <> 1) 
	BEGIN 
		SELECT -1 
	END 
	ELSE 
	BEGIN 
		SELECT 1 
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CheckWhetherServiceRequestAssignedOrNot]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CheckWhetherServiceRequestAssignedOrNot
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Check whether service request is already assigned or not, if it is assigned than remove that.
-- USP_Admin_CheckWhetherServiceRequestAssignedOrNot
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CheckWhetherServiceRequestAssignedOrNot]
	@serialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_AssignServiceRequest] WHERE SerialNumber LIKE @serialNumber) 
    BEGIN 
        DELETE FROM [dbo].[Tbl_AssignServiceRequest] WHERE SerialNumber LIKE @serialNumber
    END;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CompanyOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <30-Dec-2021>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <22-June-2021>
-- Description:	<<Use to do CURD operation on Company Table by Admin.>>
-- USP_Admin_CompanyOperation 3,2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CompanyOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@UserId INT = NULL,
	@AccountNumber NVARCHAR(MAX) = NULL,
	@DIBNUserNumber NVARCHAR(MAX) = NULL,
	@CompanyName NVARCHAR(MAX) = NULL,
	@ShareCapital NVARCHAR(50) = NULL,
	@CompanyRegistrationNumber NVARCHAR(100) = NULL,
	@MCountryCode NVARCHAR(MAX) = NULL,
	@MobileNumber NVARCHAR(MAX) = NULL,
	@ECountryCode NVARCHAR(MAX) = NULL,
	@EmergencyNumber NVARCHAR(MAX) = NULL,
	@EmailID NVARCHAR(MAX) = NULL,
	@SecondEmailID NVARCHAR(MAX) = NULL,
	@CompanyType NVARCHAR(MAX) = NULL,
	@LicenseType NVARCHAR(50) = NULL,
	@LicenseStatus NVARCHAR(50) = NULL,
	@LicenseIssueDate NVARCHAR(50) = NULL,
	@LicenseExpiryDate NVARCHAR(50) = NULL,
	@LeaseFacilityType NVARCHAR(50) = NULL,
	@LeaseStartDate NVARCHAR(50) = NULL,
	@LeaseExpiryDate NVARCHAR(50) = NULL,
	@CompanyStartingDate NVARCHAR(50) = NULL,
	@LeaseStatus NVARCHAR(50) = NULL,
	@UnitLocation NVARCHAR(MAX) = NULL,
	@City NVARCHAR(100) = NULL,
	@Country NVARCHAR(100) = NULL,
	@IsTRN BIT = NULL,
	@TRN NVARCHAR(100) = NULL,
	@TRNCreationDate NVARCHAR(50) = NULL,
	@LabourFileNo NVARCHAR(200) = NULL,
	@IsActive BIT = NULL,
	@Cmp_pass NVARCHAR(MAX) = NULL,
	@CreatedBy INT = NULL,
	@IsCorporateText bit = NULL,
	@CorporateText nvarchar(max) = NULL,
	@CompanySubType nvarchar(max) = NULL,
	@returnId INT = 0 OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	IF @Status = 1 AND @ID IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_Company](
			AccountNumber,
			DibnUserNumber,
			CompanyName,
			ShareCapital,
			CompanyRegistrationNumber,
			MCountryCode,
			MobileNumber,
			EmailID,
			SecondEmailID,
			CompanyType,
			LicenseType,
			LicenseStatus,
			LicenseIssueDate,
			LicenseExpiryDate,
			LeaseFacilityType,
			LeaseStartDate,
			LeaseExpiryDate,
			LeaseStatus,
			CompanyStartingDate,
			UnitLocation,
			City,
			Country,
			IsTRN,
			TRN,
			TRNCreationDate,
			LabourFileNo,
			Cmp_Pass,
			IsCorportaeText,
			CorporateText,
			SubCompanyType,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOn
		)
		VALUES(
			@AccountNumber,
			@DIBNUserNumber,
			@CompanyName,
			@ShareCapital,
			@CompanyRegistrationNumber,
			@MCountryCode,
			@MobileNumber,
			@EmailID,
			@SecondEmailID,
			@CompanyType,
			@LicenseType,
			@LicenseStatus,
			@LicenseIssueDate,
			@LicenseExpiryDate,
			@LeaseFacilityType,
			@LeaseStartDate,
			@LeaseExpiryDate,
			@LeaseStatus,
			@CompanyStartingDate,
			@UnitLocation,
			@City,
			@Country,
			@IsTRN,
			@TRN,
			@TRNCreationDate,
			@LabourFileNo,
			@Cmp_pass,
			@IsCorporateText,
			@CorporateText,
			@CompanySubType,
			@IsActive,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)
		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_Company] WITH(NOLOCK))
		IF @UserId IS NULL
			SET @UserId = 0
		INSERT INTO [dbo].[Tbl_Company_User_Mapping](
			CompanyId,
			UserId,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@returnId,
			@UserId,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		IF @CompanySubType IS NOT NULL AND @CompanySubType NOT LIKE ''
		BEGIN
			UPDATE [dbo].[Tbl_Company]
			SET 
				CompanySubTypeUpdated = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @returnId
		END

		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @ID IS NOT NULL
	BEGIN
		DECLARE @companySubTypes nvarchar(max) = NULL
		SET @companySubTypes = (SELECT SubCompanyType FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE Id = @Id)

		UPDATE [dbo].[Tbl_Company]
		SET
			AccountNumber = @AccountNumber,
			DibnUserNumber = @DIBNUserNumber,
			CompanyName = @CompanyName,
			ShareCapital = @ShareCapital,
			CompanyRegistrationNumber = @CompanyRegistrationNumber,
			MCountryCode = @MCountryCode,
			MobileNumber = @MobileNumber,
			EmailID = @EmailID,
			Cmp_Pass = @Cmp_pass,
			SecondEmailID = @SecondEmailID,
			CompanyType = @CompanyType,
			LicenseType = @LicenseType,
			LicenseStatus = @LicenseStatus,
			LicenseIssueDate = @LicenseIssueDate,
			LicenseExpiryDate =@LicenseExpiryDate,
			LeaseFacilityType = @LeaseFacilityType,
			LeaseStartDate = @LeaseStartDate,
			LeaseExpiryDate = @LeaseExpiryDate,
			LeaseStatus = @LeaseStatus,
			CompanyStartingDate = @CompanyStartingDate,
			UnitLocation = @UnitLocation,
			City = @City,
			Country = @Country,
			LabourFileNo = @LabourFileNo,
			IsCorportaeText = @IsCorporateText,
			CorporateText = @CorporateText,
			SubCompanyType = @CompanySubType,
			IsActive = @IsActive,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @ID

		IF @companySubTypes IS NULL OR @companySubTypes LIKE ''
		BEGIN
			UPDATE [dbo].[Tbl_Company]
			SET 
				CompanySubTypeUpdated = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @ID
		END

		IF @IsTRN = 0
		BEGIN
			UPDATE [dbo].[Tbl_Company]
			SET
				IsTRN = NULL,
				TRN = NULL,
				TRNCreationDate = NULL
			WHERE Id = @ID
		END
		ELSE
		BEGIN
			UPDATE [dbo].[Tbl_Company]
			SET
				IsTRN = @IsTRN,
				TRN = @TRN,
				TRNCreationDate = @TRNCreationDate
			WHERE Id = @ID
		END

		IF @UserId IS NOT NULL OR @UserId <> 0
		BEGIN
			UPDATE [dbo].[Tbl_Company_User_Mapping]
			SET
				CompanyId = @ID,
				ModifyBy = @CreatedBy,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE UserId = @UserId
		END

		IF @DIBNUserNumber IS NULL
		BEGIN
			UPDATE [dbo].[Tbl_Company_User_Mapping]
			SET 
				IsDelete = 1,
				ModifyBy = @CreatedBy,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE CompanyId = @ID
		END
		SET @returnId = @ID

		SELECT @returnId
	END
	ELSE IF @Status = 2 
	BEGIN
		SELECT DISTINCT
			tbl_company.Id AS Id,
			ISNULL(tbl_company.AccountNumber,'N/A') AS AccountNumber,
			ISNULL(tbl_company.DibnUserNumber,'N/A') AS DIBNUserNumber,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_company.ShareCapital,'N/A') AS ShareCapital,
			ISNULL(tbl_company.CompanyRegistrationNumber,'N/A') AS CompanyRegistrationNumber,
			ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
			ISNULL(tbl_company.EmergencyNumber,'N/A') AS EmergencyNumber,
			ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
			ISNULL(tbl_company.SecondEmailID,'N/A') AS SecondEmailID,
			ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
			ISNULL(tbl_company.LicenseType,'N/A') AS LicenseType,
			ISNULL(tbl_company.LicenseStatus,'N/A') AS LicenseStatus,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseIssueDate,105),'N/A') AS LicenseIssueDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseExpiryDate,105),'N/A') AS LicenseExpiryDate,
			ISNULL(tbl_company.LeaseFacilityType,'N/A') AS LeaseFacilityType,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseStartDate,105),'N/A') AS LeaseStartDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseExpiryDate,105),'N/A') AS LeaseExpiryDate,
			ISNULL(tbl_company.LeaseStatus,'N/A') AS LeaseStatus,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.CompanyStartingDate,105),'N/A') AS CompanyStartingDate,
			ISNULL(tbl_company.UnitLocation,'N/A') AS UnitLocation,
			ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.FirstName +' '+tbl_shareholder.LastName,'N/A')
               FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
				   WHERE tbl_shareholder.CompanyId = tbl_company.Id
				   AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				   FOR XML PATH('')
			),1,1,''),'N/A') AS ShareholderName,
			ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.SharePercentage,'N/A')
               FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
				   WHERE tbl_shareholder.CompanyId = tbl_company.Id
				   AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				   FOR XML PATH('')
			),1,1,''),'N/A') AS ShareholderSharePercentage,
			CONVERT(BIT, ISNULL(STUFF((SELECT TOP(1) ',' + CONVERT(NVARCHAR(2),ISNULL(tbl_shareholder.IsActive,0))
               FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
				   WHERE tbl_shareholder.CompanyId = tbl_company.Id
				   AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				   FOR XML PATH('')
			),1,1,''),0)) AS ShareholderIsActive,
			ISNULL(tbl_company.City,'N/A') AS City,
			ISNULL(tbl_company.Country,'N/A') AS Country,
			ISNULL(tbl_company.IsTRN,0) AS IsTRN,
			ISNULL(tbl_company.TRN,'N/A') AS TRN,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.TRNCreationDate,105),'N/A') AS TRNCreationDate,
			ISNULL(tbl_company.LabourFileNo,'N/A') AS LabourFileNo,
			ISNULL(tbl_company.IsActive,0) AS IsActive,
			ISNULL(tbl_company.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.ModifyOn,105),'N/A') AS ModifyOn
		FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company.Id = tbl_company_user_mapping.CompanyId
	    LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id
		WHERE tbl_company.IsDelete <> 1 
		AND tbl_company.CompanyName NOT LIKE N'DIBN'
		ORDER BY tbl_company.Id
	END
	ELSE IF @Status = 3
	BEGIN
		DECLARE @userRole INT = NULL

		SET @userRole = (SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) WHERE tbl_role.RoleName LIKE 'Company Owner')

		SELECT TOP 1
			ISNULL(tbl_company.Id,0) AS Id,
			ISNULL(tbl_company.AccountNumber,'N/A') AS AccountNumber,
			ISNULL(
				(
					SELECT TOP 1 tbl_users.AccountNumber FROM [dbo].[Tbl_User] tbl_users WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_users.Id
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_mapping.UserId
					WHERE tbl_company_user_mapping.CompanyId = tbl_company.Id
					AND tbl_company_user_mapping.IsDelete <> 1
					AND tbl_mapping.RoleID = @userRole
					AND tbl_mapping.IsDelete <> 1
					AND tbl_users.IsActive <> 0
					AND tbl_company_user_mapping.CompanyId = @ID
					ORDER BY tbl_company_user_mapping.ModifyOnUtc DESC
				)
			,'N/A') AS DIBNUserNumber,
			ISNULL(
				(
					SELECT TOP 1 tbl_users.FirstName +' '+ tbl_users.LastName FROM [dbo].[Tbl_User] tbl_users WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_users.Id
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_mapping.UserId
					WHERE tbl_company_user_mapping.CompanyId = tbl_company.Id
					AND tbl_company_user_mapping.IsDelete <> 1
					AND tbl_mapping.RoleID = @userRole
					AND tbl_mapping.IsDelete <> 1
					AND tbl_users.IsActive <> 0
					AND tbl_company_user_mapping.CompanyId = @ID
					ORDER BY tbl_company_user_mapping.ModifyOnUtc DESC
				)
			,'N/A') AS Username,
			ISNULL(
				(
					SELECT TOP 1 tbl_users.Id FROM [dbo].[Tbl_User] tbl_users WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_users.Id
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_mapping.UserId
					WHERE tbl_company_user_mapping.CompanyId = tbl_company.Id
					AND tbl_company_user_mapping.IsDelete <> 1
					AND tbl_mapping.RoleID = @userRole
					AND tbl_mapping.IsDelete <> 1
					AND tbl_users.IsActive <> 0
					AND tbl_company_user_mapping.CompanyId = @ID
					ORDER BY tbl_company_user_mapping.ModifyOnUtc DESC
				)
			,0) AS UserId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_company.ShareCapital,'N/A') AS ShareCapital,
			ISNULL(tbl_company.CompanyRegistrationNumber,'N/A') AS CompanyRegistrationNumber,
			ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
			ISNULL(tbl_company.EmergencyNumber,'N/A') AS EmergencyNumber,
			ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
			ISNULL(tbl_company.SecondEmailID,'N/A') AS SecondEmailID,
			ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
			ISNULL(tbl_company.LicenseType,'N/A') AS LicenseType,
			ISNULL(tbl_company.LicenseStatus,'N/A') AS LicenseStatus,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseIssueDate,105),'N/A') AS LicenseIssueDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseExpiryDate,105),'N/A') AS LicenseExpiryDate,
			ISNULL(tbl_company.LeaseFacilityType,'N/A') AS LeaseFacilityType,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseStartDate,105),'N/A') AS LeaseStartDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseExpiryDate,105),'N/A') AS LeaseExpiryDate,
			ISNULL(tbl_company.LeaseStatus,'N/A') AS LeaseStatus,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.CompanyStartingDate,105),'N/A') AS CompanyStartingDate,
			ISNULL(tbl_company.UnitLocation,'N/A') AS UnitLocation,
			ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.FirstName +' '+tbl_shareholder.LastName,'N/A')
               FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
				   WHERE tbl_shareholder.CompanyId = tbl_company.Id
				   AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				   FOR XML PATH('')
			),1,1,''),'N/A') AS ShareholderName,
			ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.SharePercentage,'N/A')
               FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
				   WHERE tbl_shareholder.CompanyId = tbl_company.Id
				   AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				   FOR XML PATH('')
			),1,1,''),'N/A') AS ShareholderSharePercentage,
			CONVERT(BIT, ISNULL(STUFF((SELECT TOP(1) ',' + CONVERT(NVARCHAR(2),ISNULL(tbl_shareholder.IsActive,0))
               FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
				   WHERE tbl_shareholder.CompanyId = tbl_company.Id
				   AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				   FOR XML PATH('')
			),1,1,''),0)) AS ShareholderIsActive,
			ISNULL(tbl_company.City,'N/A') AS City,
			ISNULL(tbl_company.Country,'N/A') AS Country,
			ISNULL(tbl_company.IsTRN,0) AS IsTRN,
			ISNULL(tbl_company.TRN,'N/A') AS TRN,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.TRNCreationDate,105),'N/A') AS TRNCreationDate,
			ISNULL(tbl_company.IsCorportaeText,0) AS IsCorportaeText,
			ISNULL(tbl_company.CorporateText,'N/A') AS CorporateText,
			ISNULL(tbl_company.LabourFileNo,'N/A') AS LabourFileNo,
			ISNULL(tbl_company.IsActive,0) AS IsActive,
			ISNULL(tbl_company.IsDelete,0) AS IsDelete,
			ISNULL(tbl_user.IsActive,0) AS UserActive,
			ISNULL(tbl_user.IsLogin,0) AS UserLogin,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.ModifyOn,105),'N/A') AS ModifyOn
		FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id
		WHERE tbl_company.Id = @ID AND tbl_company.IsDelete <> 1 
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_Company_Document_Mapping]
		SET
			IsDeleted = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_User]
		SET
			tbl_user.IsDelete = 1,
			tbl_user.ModifyBy = @CreatedBy,
			tbl_user.ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		INNER JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id
		WHERE tbl_mapping.CompanyId = @ID

		UPDATE [dbo].[Tbl_Company_User_Mapping]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_ShareholdersOrDirectors]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_Notifications]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_PaymentReceipt]
		SET 
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_PaymentTransection]
		SET 
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_PortalBalanceExpenses]
		SET 
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID
		
		UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
		SET 
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID

		UPDATE [dbo].[Tbl_SalesPerson_Company_Mapping]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE CompanyId = @ID	

		UPDATE [dbo].[Tbl_Company]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @ID	

		SELECT 1
	END
	ELSE IF @Status = 5
	BEGIN
		SELECT AccountNumber AS AccountNumber ,
				EmailID AS EmailID
		FROM [dbo].[Tbl_User] WITH(NOLOCK)
		WHERE Id = @UserId
	END
	ELSE IF @Status = 6
	BEGIN
		DECLARE @accountNumbers INT = NULL,@CompanyCode NVARCHAR(MAX) = NULL
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK))
		BEGIN
			SET @accountNumbers = 
								(SELECT TOP (1) SUBSTRING(AccountNumber, PATINDEX('%[0-9]%', AccountNumber), LEN(AccountNumber)) 
								FROM [dbo].[Tbl_Company] WITH(NOLOCK)
								WHERE (IsDelete <> 1 OR IsDelete IS NULL)
								ORDER BY Id DESC)

			SET  @CompanyCode ='DIBN'+ CONVERT(NVARCHAR(100),@accountNumbers);

			SELECT @CompanyCode AS AccountNumber
		END
		ELSE 
		BEGIN	
			SELECT 'DIBN100' AS AccountNumber
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CompanyServiceOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-Feb-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <19-05-2023>
-- Description:	<USP_Admin_CompanyServiceOperation 2>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CompanyServiceOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@CompanyType NVARCHAR(MAX) = NULL,
	@ParentId INT = NULL,
	@ServiceName NVARCHAR(MAX) = NULL,
	@IsActive BIT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1 AND @ID IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_CompanyServices](
			ParentId,
			CompanyType,
			ServiceName,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@ParentId,
			@CompanyType,
			@ServiceName,
			@IsActive,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(ID) FROM [dbo].[Tbl_CompanyServices])

		IF(@returnId > 0 AND @ParentId >0)
		BEGIN
			INSERT INTO [dbo].[Tbl_Service](
				ServiceId,
				IsCompanyService,
				IsEmployeeService,
				IsActive,
				IsDelete,
				AllowDisplay,
				CreatedOn,
				CreatedBy
			)
			VALUES(
				@returnId,
				1,
				0,
				@IsActive,
				0,
				1,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				@UserId
			)
		END
		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @ID IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_CompanyServices]
		SET
			ParentId = @ParentId,
			CompanyType = @CompanyType,
			ServiceName = @ServiceName,
			IsActive = @IsActive,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @ID

		UPDATE [dbo].[Tbl_CompanyServices]
		SET
			IsActive = @IsActive
		WHERE ParentId = @ID

		UPDATE [dbo].[Tbl_Service]
		SET
			IsActive = @IsActive,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			ModifyBy = @UserId
		WHERE ServiceId = @ID AND IsCompanyService = 1

		SELECT @ID
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT 
			ISNULL(tbl_companyservice.ID,0) AS ID,
			ISNULL(tbl_companyservice.ParentId,0) AS ParentId,
			ISNULL(tbl_companyservice.CompanyType,'N/A') AS CompanyType,
			CASE WHEN tbl_companyservice.ParentId = 0 
				THEN ISNULL(tbl_companyservice.ServiceName,'N/A')
			WHEN tbl_companyservice.ParentId <> 0
				THEN (SELECT ServiceName FROM [dbo].[Tbl_CompanyServices] WHERE ID = tbl_companyservice.ParentId) +' >> '+ tbl_companyservice.ServiceName
			END AS ServiceName,
			ISNULL(tbl_companyservice.IsActive,0) AS IsActive,
			ISNULL(tbl_companyservice.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_CompanyServices] tbl_companyservice WITH(NOLOCK)
		WHERE tbl_companyservice.IsDelete <> 1  
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_companyservice.ID,0) AS ID,
			ISNULL(tbl_companyservice.ParentId,0) AS ParentId,
			ISNULL(tbl_companyservice.CompanyType,'N/A') AS CompanyType,
			ISNULL(tbl_companyservice.ServiceName,'N/A') AS ServiceName,
			ISNULL(tbl_companyservice.IsActive,0) AS IsActive,
			ISNULL(tbl_companyservice.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_CompanyServices] tbl_companyservice WITH(NOLOCK)
		WHERE tbl_companyservice.IsDelete <> 1 AND tbl_companyservice.ID = @ID
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_CompanyServices]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @ID

		UPDATE [dbo].[Tbl_Service]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ServiceId = @ID AND IsCompanyService = 1

		SELECT @ID
	END
	ELSE IF @Status = 5
	BEGIN
		SELECT CASE WHEN ISNULL(MAX(SerialNumber),'N/A') ='N/A' THEN 'SRNo.0'
					ELSE MAX(SerialNumber) END
		FROM [dbo].[Tbl_CompanyServices]
		WHERE IsDelete <> 1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CompayDocumentType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <07-Feb-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <19-05-2023>
-- <USP_Admin_CompayDocumentType 3,1>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CompayDocumentType]
	@Status INT = NULL,
	@Id INT = NULL,
	@UserId INT = NULL,
	@Name NVARCHAR(MAX) = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1 AND @Id IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_CompanyDocumentType]
		(
			Name,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@Name,
			1,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SELECT MAX(ID) FROM [dbo].[Tbl_CompanyDocumentType] WITH(NOLOCK)
	END
	ELSE IF @Status = 1 AND @Id IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_CompanyDocumentType]
		SET
			Name = @Name,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @Id

		SELECT @Id
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_companydocumenttype.ID,0) AS ID,
			ISNULL(tbl_companydocumenttype.Name,'N/A') AS Name,
			ISNULL(tbl_companydocumenttype.IsActive,0) AS IsActive,
			ISNULL(tbl_companydocumenttype.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companydocumenttype.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companydocumenttype.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_CompanyDocumentType] tbl_companydocumenttype WITH(NOLOCK)
		WHERE tbl_companydocumenttype.IsDelete <> 1 
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_companydocumenttype.ID,0) AS ID,
			ISNULL(tbl_companydocumenttype.Name,'N/A') AS Name,
			ISNULL(tbl_companydocumenttype.IsActive,0) AS IsActive,
			ISNULL(tbl_companydocumenttype.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companydocumenttype.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companydocumenttype.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_CompanyDocumentType] tbl_companydocumenttype WITH(NOLOCK)
		WHERE tbl_companydocumenttype.ID = @Id AND IsDelete <> 1
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_CompanyDocumentType]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @Id

		SELECT @Id
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CreateCompanyServiceRequestTempTable]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CreateCompanyServiceRequestTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Add all Company Service request for admin panel into temp table
-- USP_Admin_CreateCompanyServiceRequestTempTable
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CreateCompanyServiceRequestTempTable]
AS
BEGIN

	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminCompanyServiceRequestTable') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminCompanyServiceRequestTable
	END

	SELECT DISTINCT ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		(SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX('R',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) AS SerialCode,
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForms.FormName,'N/A') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName, 
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName,'N/A')
		ELSE 
			ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName ,'N/A') 
		END AS RequestedBy, 
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),'N/A') AS CreatedOn,
		ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
		ISNULL(
			(
				SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
				WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
				AND tbl_request.Status = tbl_serviceRequest.Status
				AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				ORDER BY tbl_serviceRequest.StepId DESC
			)
		,'N/A') AS Status,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
					FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('')), 1, 1, ''),'N/A') AS AssignedUser, 
		ISNULL((SELECT TOP(1) 
			ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
			WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,'N/A') AS AssignOn,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
		WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
		WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
		FOR XML PATH ('')), 1, 1, ''),'N/A') AS SalesPerson
	INTO ##AdminCompanyServiceRequestTable
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson  WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId
	WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL)
	AND (tbl_serviceRequest.IsDelete <> 1)
	AND tbl_service.IsCompanyService <> 0 
	AND tbl_serviceRequest.Id = 
		(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
			WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
			AND b.IsDelete <> 1
			ORDER BY b.StepId DESC
		) 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_CreateEmployeeServiceRequestTempTable]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_CreateCompanyServiceRequestTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Add all Company Service request for admin panel into temp table
-- USP_Admin_CreateEmployeeServiceRequestTempTable
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_CreateEmployeeServiceRequestTempTable]
AS
BEGIN

	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminEmployeeServiceRequestTable') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminEmployeeServiceRequestTable
	END

	SELECT 
		tbl_serviceFormFieldValue.SerialNumber AS SerialNumber,
		(SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX('R',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) AS SerialCode,
		ISNULL((
			SELECT 
				ISNULL(tbl_serviceFormFieldValues.FieldValue,'N/A') AS ApplicantName
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField WITH(NOLOCK) ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
			WHERE tbl_serviceformField.FieldName LIKE '%Applicant Name%'
			AND tbl_serviceFormFieldValues.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber
		),'N/A') AS ApplicantName,
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForms.FormName,'N/A') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName, 
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName,'N/A')
		ELSE 
			ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName ,'N/A') 
		END AS RequestedBy, 
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),'N/A') AS CreatedOn,
		ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
		ISNULL(
			(
				SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
				WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
				AND tbl_request.Status = tbl_serviceRequest.Status
				AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				ORDER BY tbl_serviceRequest.StepId DESC
			)
		,'N/A') AS Status,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
					FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('')), 1, 1, ''),'N/A') AS AssignedUser, 
		ISNULL((SELECT TOP(1) 
		ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
		WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,'N/A') AS AssignOn,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
		WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
		WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
		FOR XML PATH ('')), 1, 1, ''),'N/A') AS SalesPerson
		INTO ##AdminEmployeeServiceRequestTable
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
		LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
		LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
		AND tbl_companyMappings.CompanyId IS NOT NULL
	WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
			AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
			AND (tbl_serviceRequest.IsDelete <> 1) 
			AND tbl_service.IsEmployeeService <> 0 
			AND tbl_serviceRequest.Id = 
					(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
						WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
						AND b.IsDelete <> 1
						ORDER BY b.StepId DESC
					) 
	GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, 
		tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName 
		,tbl_serviceRequest.StepId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Dashboard_BalanceSheetReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <04-10-2023>
-- Modify By : <Modify By>
-- Modify date : <Modify On>
-- Description:	Get data for balance sheet report on dashboard
-- USP_Admin_Dashboard_BalanceSheetReport
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_Dashboard_BalanceSheetReport]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_company.AccountNumber AS AccountNumber,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_portalBalance.BalanceAmount,'0') AS PortalBalance
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_PortalBalance] tbl_portalBalance WITH(NOLOCK) ON tbl_portalBalance.CompanyId = tbl_company.Id
	WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName NOT LIKE N'DIBN'
	AND CONVERT(decimal(18,2),tbl_portalBalance.BalanceAmount) > 0

	SELECT DISTINCT
		tbl_company.AccountNumber AS AccountNumber,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_portalBalance.BalanceAmount,'0') AS PortalBalance
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_PortalBalance] tbl_portalBalance WITH(NOLOCK) ON tbl_portalBalance.CompanyId = tbl_company.Id
	WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName NOT LIKE N'DIBN'
	AND CONVERT(decimal(18,2),tbl_portalBalance.BalanceAmount) < 0
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Delete_CompanyType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_Delete_CompanyType
-- Author:			<Yashasvi Sharma>
-- Created date:	16/Oct/2024
-- Description:		Delete company type
-- USP_Admin_Delete_CompanyType 1
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Delete_CompanyType]
	@Id int = NULL,
	@UserId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_CompanySubType]
	SET
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Delete_RMTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<USP_Admin_Delete_RMTeam Sharma>
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	RM Team Delete
-- USP_Admin_Delete_RMTeam
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Delete_RMTeam]
	@Id int = NULL,
	@UserId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_RMTeam]
	SET
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id

	UPDATE [dbo].[Tbl_RMTeam_Company_Mapping]
	SET
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE RMTeamId = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_DeleteInvoiceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <create date>
-- Modify By : <modify By>
-- Modify date : <modify date>
-- Description:	<USP_Admin_DeleteInvoiceDetails>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_DeleteInvoiceDetails]
	@Id INT = NULL,
	@TotalAmount NVARCHAR(50) = NULL,
	@VatAmount NVARCHAR(50) = NULL,
	@UserId INT = NULL,
	@InvoiceNumber NVARCHAR(50) = NULL
AS
BEGIN	
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @GrandTotal DECIMAL(18,2) = NULL,@RemoveAmount DECIMAL(18,2) = NULL,@FinalTotal DECIMAL(18,2)=NULL;
	--SET @GrandTotal = (SELECT MAX(GrandTotal) FROM [dbo].[Tbl_CompanyInvoiceDetail] WHERE InvoiceNumber LIKE @InvoiceNumber AND IsDelete <> 1);

	--SET @RemoveAmount = CONVERT(DECIMAL(18,2),@TotalAmount) + CONVERT(DECIMAL(18,2),@VatAmount);

	--SET @FinalTotal =  CONVERT(DECIMAL(18,2),@GrandTotal) - CONVERT(DECIMAL(18,2),@RemoveAmount);

	--UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
	--SET
	--	GrandTotal = @FinalTotal,
	--	ModifyBy = @UserId,
	--	ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	--WHERE InvoiceNumber LIKE @InvoiceNumber

	UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
	SET
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id

	SET @GrandTotal = (SELECT (SUM(TotalAmount) + SUM(VatAmount)) AS GrandTotal FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK)
	WHERE InvoiceNumber = @InvoiceNumber AND IsDelete <> 1)

	UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
	SET
		GrandTotal = @GrandTotal
	WHERE InvoiceNumber LIKE @InvoiceNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_DeleteServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_DeleteServiceRequest]
	@SerialNumber NVARCHAR(MAX) = NULL,
	@ServiceId INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_ServiceRequest]
	SET 
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE SerialNumber LIKE @SerialNumber AND ServiceId = @ServiceId


	UPDATE [dbo].[Tbl_ServiceFormFieldValue]
	SET 
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE SerialNumber LIKE @SerialNumber AND ServiceId = @ServiceId


	DELETE FROM [dbo].[Tbl_AssignServiceRequest]
	WHERE SerialNumber LIKE @SerialNumber AND ServiceId = @ServiceId

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber LIKE @SerialNumber)
	BEGIN
		UPDATE [dbo].[Tbl_CompanyServiceRequests]
		SET 
			IsDelete = 1,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE SerialNumber LIKE @SerialNumber
	END

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_EmployeeServiceRequests] WHERE SerialNumber LIKE @SerialNumber)
	BEGIN
		UPDATE [dbo].[Tbl_EmployeeServiceRequests]
		SET 
			IsDelete = 1,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE SerialNumber LIKE @SerialNumber
	END

	SELECT 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_DeleteSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_DeleteSupportTicket]
	@TrackingNumber NVARCHAR(MAX) = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_SupportTicket]
	SET 
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE TrackingNumber LIKE @TrackingNumber

	UPDATE [dbo].[Tbl_SupportTicketDocument]
	SET 
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE TicketId LIKE @TrackingNumber

	DELETE FROM [dbo].[Tbl_AssignSupportTicket]
	WHERE TrackingNumber LIKE @TrackingNumber

	SELECT 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_DeleteTemporaryAccount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_DeleteTemporaryAccount
-- Author:			<Yashasvi Sharma>
-- Created date:	23/Aug/2023
-- Description:		Delete Temporary Account Management By Id
-- USP_Admin_DeleteTemporaryAccount 1
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_DeleteTemporaryAccount]
	@Id INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_TempAccountManagement]
	SET
		IsDelete = 1,
		ModifyBy = @UserId,
		ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id

	SELECT @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_DocumentsExpire]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ==============================================
-- Author : <Yashasvi Sharma>
-- Create date: <09-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_DocumentsExpire 7>
-- ==============================================
CREATE PROCEDURE [dbo].[USP_Admin_DocumentsExpire]
	@CompanyId INT = 0
AS
BEGIN
	SET NOCOUNT ON;

	-- Get Company Documents which is going to expire soon. (less than 60 days left)
	SELECT 
		tbl_companydocumentType.ID AS DocumentId,
		tbl_companydocumentType.Name AS CompanyDocumentName,
	    CONVERT(NVARCHAR(50),tbl_companydocuments.ExpiryDate,105) AS CompanyDocumentExpiryDate, 
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_companydocuments.ExpiryDate) AS CompanyDocumentExpireDaysLeft
	FROM [dbo].[Tbl_Company_Document_Mapping]  tbl_companydocuments WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_CompanyDocumentType] tbl_companydocumentType ON tbl_companydocuments.DocumentTypeId = tbl_companydocumentType.ID
	WHERE tbl_companydocuments.CompanyId = @CompanyId AND tbl_companydocuments.ExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

	-- Get Passport Expiry date of Employee which is going to expire soon. (less than 60 days left)
	SELECT 
		tbl_user.Id AS Id,
		tbl_user.FirstName +' '+tbl_user.LastName AS EmployeeName,
		CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) AS PassportExpiryDate,
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_user.PassportExpiryDate) AS EmployeePassportExpireDaysLeft
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
	WHERE CompanyId = @CompanyId AND tbl_user.PassportExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

	-- Get Passport Expiry date of Shareholder which is going to expire soon. (less than 60 days left)
	SELECT 
		ID AS ID,
		FirstName +' '+ LastName AS ShareholderName,
		CONVERT(NVARCHAR(50),PassportExpiryDate,105) AS PassportExpiryDate,
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',PassportExpiryDate) AS ShareholderPassportExpireDaysLeft
	FROM [dbo].[Tbl_ShareholdersOrDirectors] WITH(NOLOCK)
	WHERE CompanyId = @CompanyId AND PassportExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_EmployeeServiceOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-Feb-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <19-05-2023>
-- Description:	<USP_Admin_EmployeeServiceOperation 2>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_EmployeeServiceOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@ParentId INT = NULL,
	@CompanyType NVARCHAR(MAX) = NULL,
	@ServiceName NVARCHAR(MAX) = NULL,
	@IsActive BIT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1 AND @ID IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_EmployeeServices](
			ParentId,
			CompanyType,
			ServiceName,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@ParentId,
			@CompanyType,
			@ServiceName,
			@IsActive,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(ID) FROM [dbo].[Tbl_EmployeeServices] WITH(NOLOCK))
		IF(@returnId > 0 AND @ParentId >0)
		BEGIN
			INSERT INTO [dbo].[Tbl_Service](
				ServiceId,
				IsCompanyService,
				IsEmployeeService,
				AllowDisplay,
				IsActive,
				IsDelete,
				CreatedOn,
				CreatedBy
			)
			VALUES(
				@returnId,
				0,
				1,
				1,
				@IsActive,
				0,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				@UserId
			)
		END
		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @ID IS NOT NULL
	BEGIN
		DECLARE @ServiceId INT =0;

		UPDATE [dbo].[Tbl_EmployeeServices]
		SET
			ParentId = @ParentId,
			CompanyType = @CompanyType,
			ServiceName = @ServiceName,
			IsActive = @IsActive,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @ID

		UPDATE [dbo].[Tbl_EmployeeServices]
		SET
			IsActive = @IsActive
		WHERE ParentId = @ID

		UPDATE [dbo].[Tbl_Service]
		SET
			IsActive = @IsActive,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			ModifyBy = @UserId
		WHERE ServiceId = @ID AND IsEmployeeService = 1

		SET @ServiceId = (SELECT Id FROM [dbo].[Tbl_Service] WHERE ServiceId = @ID AND IsEmployeeService = 1)

		UPDATE [dbo].[Tbl_ServiceForms]
		SET
			IsActive = @IsActive,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			ModifyBy = @UserId,
			FormName = @ServiceName
		WHERE ServiceId = @ServiceId

		SELECT @ID
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_employeeservice.ID,0) AS ID,
			ISNULL(tbl_employeeservice.ParentId,0) AS ParentId,
			ISNULL(tbl_employeeservice.CompanyType,'N/A') AS CompanyType,
			CASE WHEN tbl_employeeservice.ParentId = 0 
				THEN ISNULL(tbl_employeeservice.ServiceName,'N/A')
			WHEN tbl_employeeservice.ParentId <> 0
				THEN (SELECT ServiceName FROM [dbo].[Tbl_EmployeeServices] WHERE ID = tbl_employeeservice.ParentId) +' >> '+ tbl_employeeservice.ServiceName
			END AS ServiceName,
			ISNULL(tbl_employeeservice.IsActive,0) AS IsActive,
			ISNULL(tbl_employeeservice.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_EmployeeServices] tbl_employeeservice WITH(NOLOCK)
		WHERE tbl_employeeservice.IsDelete <> 1  
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_employeeservice.ID,0) AS ID,
			ISNULL(tbl_employeeservice.ParentId,0) AS ParentId,
			ISNULL(tbl_employeeservice.CompanyType,'N/A') AS CompanyType,
			ISNULL(tbl_employeeservice.ServiceName,'N/A') AS ServiceName,
			ISNULL(tbl_employeeservice.IsActive,0) AS IsActive,
			ISNULL(tbl_employeeservice.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_EmployeeServices] tbl_employeeservice WITH(NOLOCK)
		WHERE tbl_employeeservice.IsDelete <> 1 AND tbl_employeeservice.ID = @ID
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_EmployeeServices]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @ID

		UPDATE [dbo].[Tbl_Service]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ServiceId = @ID AND IsEmployeeService = 1
		SELECT @ID
	END
	ELSE IF @Status = 5
	BEGIN
		SELECT CASE WHEN ISNULL(MAX(SerialNumber),'N/A') ='N/A' THEN 'SRNo.0'
					ELSE MAX(SerialNumber) END
		FROM [dbo].[Tbl_EmployeeServices] WITH(NOLOCK)
		WHERE IsDelete <> 1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ExpesesRecieptOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <29-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <25-11-2022>
-- <USP_Admin_ExpesesRecieptOperation>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_ExpesesRecieptOperation]
	@Status INT = NULL,
	@Id INT = NULL,
	@CompanyId INT = NULL,
	@DataBinary VARBINARY(MAX) = NULL,
	@FileName NVARCHAR(MAX) = NULL,
	@Extension NVARCHAR(50) = NULL,
	@ReceiptId INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		
		IF @ReceiptId IS NOT NULL
		BEGIN
			UPDATE [dbo].[Tbl_Expense_Receipt]
			SET
				IsDelete = 1,
				ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE RecieptId = @ReceiptId
		END

		INSERT INTO [dbo].[Tbl_Expense_Receipt](
			FileName,
			Extension,
			DataBinary,
			RecieptId,
			CompanyId,
			CreatedBy,
			CreatedOnUtc,
			IsActive,
			IsDelete
		)
		VALUES(
			@FileName,
			@Extension,
			@DataBinary,
			@ReceiptId,
			@CompanyId,
			@UserId,													-- To Store By Which User Expense Receipt of Any Company is Added				Yashasvi [TBC] (25-11-2022)
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			1,
			0
		)

		SELECT MAX(Id) FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK)
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_expense_receipt.Id,0) AS Id,
			ISNULL(tbl_expense_receipt.FileName,'N/A') AS FileName,
			ISNULL(tbl_expense_receipt.Extension,'N/A') AS Extension,
			tbl_expense_receipt.DataBinary AS DataBinary,
			ISNULL(tbl_expense_receipt.CompanyId,0) AS CompanyId,
			ISNULL(tbl_expense_receipt.RecieptId,0) AS ReceiptId,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expense_receipt.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expense_receipt.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL(tbl_expense_receipt.IsActive,0) AS IsActive,
			ISNULL(tbl_expense_receipt.IsDelete,0) AS IsDelete
		FROM [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK) ON tbl_expense_receipt.Id = tbl_portalExpenses.Id
		WHERE tbl_expense_receipt.Id = @Id AND (tbl_expense_receipt.RecieptId = @ReceiptId OR @ReceiptId IS NULL)
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GenerateNotifications]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-Feb-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <30-Aug-2022>
-- <USP_Admin_GenerateNotifications>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GenerateNotifications]
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RoleId INT = NULL;
	SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')
	SELECT @RoleId

	UPDATE requestNotification
	SET 
	requestNotification.MarkAsRead = 1
	FROM [dbo].[Tbl_RequestNotification] requestNotification
	WHERE DATEDIFF(DAY,CONVERT(date,CreatedOn),GETDATE()) > 7

	UPDATE requestNotification
	SET 
	requestNotification.AssignedUserMarkAsRead = 1
	FROM [dbo].[Tbl_RequestNotification] requestNotification
	WHERE DATEDIFF(DAY,CONVERT(date,CreatedOn),GETDATE()) > 7 
	AND requestNotification.AssignedOn IS NOT NULL

	UPDATE [dbo].[Tbl_Notifications]
	SET
		IsDelete = 1
	WHERE Id = (
		SELECT TOP 1 notifications.ID
		FROM Tbl_Notifications notifications
		LEFT JOIN [dbo].[Tbl_Company_Document_Mapping]  tbl_companydocuments ON tbl_companydocuments.CompanyId = notifications.CompanyId
		LEFT JOIN [dbo].[Tbl_CompanyDocumentType] tbl_companydocumentType ON tbl_companydocuments.DocumentTypeId = tbl_companydocumentType.ID
		WHERE notifications.CompanyId = tbl_companydocuments.CompanyId
		AND notifications.Service = tbl_companydocumentType.Name 
		AND notifications.IsDelete <> 1
		AND tbl_companydocuments.ExpiryDate > DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	)

	UPDATE [dbo].[Tbl_Notifications]
	SET
		IsDelete = 1
	WHERE Id = (
		SELECT TOP 1 notifications.ID
		FROM Tbl_Notifications notifications
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = notifications.UserId
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_user_mapping.CompanyId = tbl_company.Id
		WHERE notifications.CompanyId = tbl_company.Id
		AND notifications.Service = 'Passport'
		AND notifications.UserId = tbl_user.Id
		AND notifications.IsDelete <> 1
		AND tbl_user.PassportExpiryDate > DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	)

	UPDATE [dbo].[Tbl_Notifications]
	SET
		IsDelete = 1
	WHERE Id = (
		SELECT TOP 1 notifications.ID
		FROM Tbl_Notifications notifications
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = notifications.UserId
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_user_mapping.CompanyId = tbl_company.Id
		WHERE notifications.CompanyId = tbl_company.Id
		AND notifications.Service = 'Visa'
		AND notifications.IsDelete <> 1
		AND notifications.UserId = tbl_user.Id
		AND tbl_user.VisaExpiryDate > DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	)

	UPDATE [dbo].[Tbl_Notifications]
	SET
		IsDelete = 1
	WHERE Id = (
		SELECT notifications.ID
		FROM Tbl_Notifications notifications
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = notifications.UserId
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_user_mapping.CompanyId = tbl_company.Id
		WHERE notifications.CompanyId = tbl_company.Id
		AND notifications.Service = 'Employeement Card'
		AND notifications.UserId = tbl_user.Id
		AND notifications.IsDelete <> 1
		AND tbl_user.EmployeementCardExpiryDate > DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	)

	-- Add Company Documents which are going to expire
	INSERT INTO [dbo].[Tbl_Notifications](
		CompanyId,
		CompanyName,
		UserId,
		Username,
		[Service],
		ExpiryDate,
		LeftDayToExpire,
		SendNotificationAfter,
		MarkAsRead,
		IsActive,
		IsDelete,
		CreatedOnUtc
	)
	SELECT DISTINCT 
		tbl_companydocuments.CompanyId AS CompanyId,
		tbl_company.CompanyName AS CompanyName,
		0 AS UserId,
		'' AS Username,
		tbl_companydocumentType.Name AS Service,
		tbl_companydocuments.ExpiryDate AS ExpiryDate,
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_companydocuments.ExpiryDate) AS LeftDayToExpire,
		60 AS SendNotificationAfter,
		0 AS MarkAsRead,
		1 AS IsActive,
		0 AS IsDelete,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time' AS CreatedOnUtc
	FROM [dbo].[Tbl_Company_Document_Mapping]  tbl_companydocuments WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_CompanyDocumentType] tbl_companydocumentType ON tbl_companydocuments.DocumentTypeId = tbl_companydocumentType.ID
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_companydocuments.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_companyUser ON tbl_company.Id = tbl_companyUser.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_companyUser.UserId = tbl_user.Id
	WHERE tbl_companydocuments.ExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	AND tbl_companydocuments.IsDeleted <> 1
	AND tbl_companydocuments.ID = (SELECT TOP 1 ID FROM [dbo].[Tbl_Company_Document_Mapping] WHERE IsDeleted <> 1 AND DocumentTypeId = tbl_companydocumentType.ID ORDER BY ID DESC)
	AND NOT EXISTS(
		SELECT notifications.ID
        FROM Tbl_Notifications notifications
		WHERE CompanyId = tbl_companydocuments.CompanyId
		AND notifications.IsDelete <> 1
		AND Service = tbl_companydocumentType.Name 
	)


	-- Add User whoes Passport is going to Expire
	INSERT INTO [dbo].[Tbl_Notifications](
		CompanyId,
		CompanyName,
		UserId,
		Username,
		[Service],
		ExpiryDate,
		LeftDayToExpire,
		SendNotificationAfter,
		MarkAsRead,
		IsActive,
		IsDelete,
		CreatedOnUtc
	)
	SELECT DISTINCT
		tbl_company.Id AS CompanyId,
		tbl_company.CompanyName AS CompanyName,
		tbl_user.Id AS UserId,
		tbl_user.FirstName +' '+ tbl_user.LastName AS Username,
		'Passport' AS Service,
		tbl_user.PassportExpiryDate AS ExpiryDate,
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_user.PassportExpiryDate) AS LeftDayToExpire,
		60 AS SendNotificationAfter,
		0 AS MarkAsRead,
		1 AS IsActive,
		0 AS IsDelete,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time' AS CreatedOnUtc
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_user_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Role]tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
	WHERE tbl_user.PassportExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time') 
	AND tbl_user_mapping.CompanyId <> 1
	AND tbl_role.RoleID <> @RoleId
	AND NOT EXISTS(
		SELECT notifications.ID 
        FROM Tbl_Notifications notifications
		WHERE CompanyId = tbl_company.Id
		AND notifications.IsDelete <> 1
		AND Service = 'Passport'
		AND UserId = tbl_user.Id
	)

	-- Add User whoes Visa is going to Expire
	INSERT INTO [dbo].[Tbl_Notifications](
		CompanyId,
		CompanyName,
		UserId,
		Username,
		[Service],
		ExpiryDate,
		LeftDayToExpire,
		SendNotificationAfter,
		MarkAsRead,
		IsActive,
		IsDelete,
		CreatedOnUtc
	)
	SELECT DISTINCT
		tbl_company.Id AS CompanyId,
		tbl_company.CompanyName AS CompanyName,
		tbl_user.Id AS UserId,
		tbl_user.FirstName +' '+ tbl_user.LastName AS Username,
		'Visa' AS Service,
		tbl_user.VisaExpiryDate AS ExpiryDate,
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_user.VisaExpiryDate) AS LeftDayToExpire,
		60 AS SendNotificationAfter,
		0 AS MarkAsRead,
		1 AS IsActive,
		0 AS IsDelete,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time' AS CreatedOnUtc
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_user_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Role]tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
	WHERE tbl_user.VisaExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	AND tbl_user_mapping.CompanyId <> 1
	AND tbl_role.RoleID <> @RoleId
	AND NOT EXISTS(
		SELECT notifications.ID 
        FROM Tbl_Notifications notifications
		WHERE CompanyId = tbl_company.Id
		AND Service = 'Visa'
		AND notifications.IsDelete <> 1
		AND UserId = tbl_user.Id 
	)

	-- Add User whoes Employeement Card is going to Expire
	INSERT INTO [dbo].[Tbl_Notifications](
		CompanyId,
		CompanyName,
		UserId,
		Username,
		[Service],
		ExpiryDate,
		LeftDayToExpire,
		SendNotificationAfter,
		MarkAsRead,
		IsActive,
		IsDelete,
		CreatedOnUtc
	)
	SELECT DISTINCT
		tbl_company.Id AS CompanyId,
		tbl_company.CompanyName AS CompanyName,
		tbl_user.Id AS UserId,
		tbl_user.FirstName +' '+ tbl_user.LastName AS Username,
		'Employeement Card' AS Service,
		tbl_user.EmployeementCardExpiryDate AS ExpiryDate,
		DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_user.EmployeementCardExpiryDate) AS LeftDayToExpire,
		60 AS SendNotificationAfter,
		0 AS MarkAsRead,
		1 AS IsActive,
		0 AS IsDelete,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time' AS CreatedOnUtc
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_mapping ON tbl_user.Id = tbl_user_mapping.UserId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_user_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Role]tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
	WHERE tbl_user.EmployeementCardExpiryDate < DATEADD(D,60,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time') 
	AND tbl_user_mapping.CompanyId <> 1
	AND tbl_role.RoleID <> @RoleId
	AND NOT EXISTS(
		SELECT notifications.ID
        FROM Tbl_Notifications notifications
		WHERE CompanyId = tbl_company.Id
		AND Service = 'Employeement Card'
		AND notifications.IsDelete <> 1
		AND UserId = tbl_user.Id 
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAccountHistoryByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetAccountHistoryByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_accountHistory.Id AS Id,
		ISNULL(tbl_accountHistory.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_accountHistory.Description,'N/A') AS Description,
		ISNULL(tbl_accountHistory.Amount,'0.0') AS Amount,
		ISNULL(tbl_accountHistory.Quantity,0) AS Quantity,
		ISNULL(tbl_accountHistory.Vat,'0.0') AS Vat,
		ISNULL(tbl_accountHistory.VatAmount,'0.0') AS VatAmount,
		ISNULL(tbl_accountHistory.TotalAmount,'0.0') AS TotalAmount,
		ISNULL(tbl_accountHistory.GrandTotal,'0.0') AS GrandTotal,
		ISNULL(tbl_accountHistory.PaymentMethod,'N/A') AS PaymentMethod,
		ISNULL(tbl_accountHistory.ExpenseType,'N/A') AS ExpenseType,
		ISNULL(CONVERT(NVARCHAR(50),tbl_accountHistory.TransactionDate,105),'N/A') AS TransactionDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_accountHistory.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_accountHistory.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_accountHistory.CreatedBy,0) AS CreatedBy,
		ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') AS Username
	FROM [dbo].[Tbl_AccountHistory] tbl_accountHistory WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_accountHistory.CreatedBy
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_accountHistory.CompanyId
	WHERE (tbl_accountHistory.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0)
	ORDER BY tbl_accountHistory.Id DESC
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetActiveEmployee]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <04-02-2022,08-02-2022,06-09-2022>
-- Description:	<Get all active employees whoes IsActive is one>
-- <USP_Admin_GetActiveEmployee>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetActiveEmployee]
	@CompanyId INT = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS RoleName,
		ISNULL(tbl_user.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),'N/A') AS EmployeementCardExpiryDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUtc,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping ON tbl_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_mapping.CompanyId
	WHERE  tbl_user.IsActive = 1 AND tbl_user.IsDelete <> 1 AND tbl_company.IsDelete <> 1
	AND (tbl_company.Id = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
	AND tbl_company.CompanyName NOT LIKE 'DIBN' 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetActiveRoles]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <27-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get active roles list>
-- USP_Admin_GetActiveRoles
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetActiveRoles]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_role.RoleID,0) AS RoleID,
		ISNULL(tbl_role.RoleName,'N/A') AS RoleName,
		ISNULL(tbl_role.IsActive,0) AS IsActive,
		ISNULL(tbl_role.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_role.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_role.ModifyOn,105),'N/A') AS ModifyON
	FROM [dbo].[Tbl_Role] tbl_role WITH(NOLOCK)
	WHERE tbl_role.IsDelete <> 1 AND tbl_role.IsActive <> 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveCompanyOwnerWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active company owner whoes IsActive is one with pagination>
-- <USP_Admin_GetAllActiveCompanyOwnerWithPagination 0,20,NULL,NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveCompanyOwnerWithPagination]
	@companyId INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN

	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id, 
						ISNULL(tbl_user.AccountNumber,''N/A'') AS AccountNumber, 
						ISNULL(tbl_user.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_user.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_user.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_user.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_user.PhoneNumber,''N/A'') AS PhoneNumber, 
						ISNULL(
							STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''') 
						,''N/A'') AS RoleName,
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName 
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
					LEFT JOIN [dbo].[Tbl_Role] tbl_roles WITH(NOLOCK) ON tbl_roles.RoleID = tbl_userRoleMapping.RoleID 
				'

	SET @conditions = N' WHERE tbl_user.IsActive = 1 
						AND tbl_user.IsDelete <> 1 
						AND tbl_company.IsDelete <> 1 
						AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
						AND tbl_userRoleMapping.RoleID = (
							SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''  
						)
						AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
						AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.EmailID LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.PhoneNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_roles.RoleName LIKE ''%'+@searchPrefix+'%'' 
						) 
					'

	SET @groupByClause = N'
							GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
							tbl_user.EmailID,tbl_user.PhoneNumber,tbl_company.CompanyName,tbl_user.PhoneNumber 
						'

	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Id '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' DESC '
		END

		IF @sortColumn = 'Contact No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PhoneNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'Contact No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PhoneNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmailID '
			+ ' ASC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmailID '
			+ ' DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' STUFF((SELECT '', '' + tbl_role.RoleName 
				FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id 
				LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
				WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
				FOR XML PATH('''')),1,1,'''')  '
			+ ' ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
				+ ' STUFF((SELECT '', '' + tbl_role.RoleName 
					FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id 
					LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
					WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
					FOR XML PATH('''')),1,1,'''')  '
			+ ' DESC '
		END

	SET @pagination = N' OFFSET @skipRows ROWS 
						 FETCH NEXT @RowsOfPage ROWS ONLY 
					'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery
	,N'@companyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)'
	,@companyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveCompanyOwnerWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active company owner whoes IsActive is one with pagination>
-- <USP_Admin_GetAllActiveCompanyOwnerWithPaginationCount NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveCompanyOwnerWithPaginationCount]
	@companyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
					LEFT JOIN [dbo].[Tbl_Role] tbl_roles WITH(NOLOCK) ON tbl_roles.RoleID = tbl_userRoleMapping.RoleID 
				'

	SET @conditions = N' WHERE tbl_user.IsActive = 1 
						AND tbl_user.IsDelete <> 1 
						AND tbl_company.IsDelete <> 1 
						AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
						AND tbl_userRoleMapping.RoleID = (
							SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''  
						)
						AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
						AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.EmailID LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.PhoneNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_roles.RoleName LIKE ''%'+@searchPrefix+'%'' 
						)  
					'

	SET @groupByClause = N'
							GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
							tbl_user.EmailID,tbl_user.PhoneNumber,tbl_company.CompanyName,tbl_user.PhoneNumber 
						'	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


	EXEC SP_EXECUTESQL @selectQuery,N'@companyId INT,@searchPrefix NVARCHAR(MAX)',@companyId,@searchPrefix

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveCompanyShareholders]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Shareholder List with Pagination>
-- <USP_Admin_GetAllActiveCompanyShareholders 0,20,NULL,N'Name',N'asc'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveCompanyShareholders]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		    @conditions NVARCHAR(MAX) = NULL,
			@groupByClause NVARCHAR(MAX) = NULL,
			@orderByClause NVARCHAR(MAX) = NULL,
			@paginationClause NVARCHAR(MAX) = NULL,
			@selectQuery NVARCHAR(MAX) = NULL

	SET @query = N'
					SELECT 
						ISNULL(tbl_shareholder.ID,0) AS ID, 
						ISNULL(tbl_shareholder.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_shareholder.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_shareholder.Passport_Number,''N/A'') AS PassportNumber, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105),''N/A'') AS PassportExpiryDate, 
						ISNULL(tbl_shareholder.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_shareholder.Designation,''N/A'') AS Designation, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105),''N/A'') AS VisaExpiryDate, 
						ISNULL(tbl_shareholder.InsuranceCompany,''N/A'') AS InsuranceCompany, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.InsuranceExpiryDate,105),''N/A'') AS InsuranceExpiryDate, 
						ISNULL(tbl_shareholder.CompanyId,0) AS CompanyId, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_shareholder.SharePercentage,''N/A'') AS SharePercentage, 
						ISNULL(tbl_shareholder.IsActive,0) AS IsActive
					FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_company] tbl_company WITH(NOLOCK) ON tbl_shareholder.CompanyId = tbl_company.Id 
				'
	SET @conditions = N' WHERE tbl_shareholder.IsDelete <> 1 
						 AND tbl_shareholder.IsActive <> 0 
					'

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR (tbl_shareholder.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_shareholder.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_Company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.SharePercentage LIKE '''+@searchPrefix+'%'' 
							OR tbl_shareholder.Passport_Number LIKE '''+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_shareholder.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.Designation LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @groupByClause = N' GROUP BY tbl_shareholder.ID,tbl_shareholder.FirstName,tbl_shareholder.LastName,tbl_shareholder.Passport_Number,
							tbl_shareholder.PassportExpiryDate,tbl_shareholder.Nationality,tbl_shareholder.Designation,tbl_shareholder.VisaExpiryDate,
							tbl_shareholder.InsuranceCompany,tbl_shareholder.InsuranceExpiryDate,tbl_shareholder.CompanyId,tbl_company.CompanyName,
							tbl_shareholder.SharePercentage,tbl_shareholder.IsActive 
						  '
	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.ID ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.FirstName ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.FirstName DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_company.CompanyName ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_company.CompanyName DESC '
		END

		IF @sortColumn = 'Share(%)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' ISNULL(CONVERT(DECIMAL(18,2),tbl_shareholder.SharePercentage),0) ASC '
		END

		IF @sortColumn = 'Share(%)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' ISNULL(CONVERT(DECIMAL(18,2),tbl_shareholder.SharePercentage),0) DESC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Passport_Number ASC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Passport_Number DESC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.PassportExpiryDate ASC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.PassportExpiryDate DESC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.VisaExpiryDate ASC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.VisaExpiryDate DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Nationality ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Nationality DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Designation ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Designation DESC '
		END

	SET @paginationClause =  ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@paginationClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveCompanyShareholdersCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Shareholder List with Pagination Count>
-- <USP_Admin_GetAllActiveCompanyShareholdersCount N'Share(%)',N'50'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveCompanyShareholdersCount]
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		    @conditions NVARCHAR(MAX) = NULL,
			@groupByClause NVARCHAR(MAX) = NULL,
			@orderByClause NVARCHAR(MAX) = NULL,
			@paginationClause NVARCHAR(MAX) = NULL,
			@selectQuery NVARCHAR(MAX) = NULL

	SET @query = N'
					SELECT 
						ISNULL(tbl_shareholder.ID,0) AS ID
					FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_company] tbl_company WITH(NOLOCK) ON tbl_shareholder.CompanyId = tbl_company.Id 
				'
	SET @conditions = N' WHERE tbl_shareholder.IsDelete <> 1 
						 AND tbl_shareholder.IsActive <> 0 
					'

	IF @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR (tbl_shareholder.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_shareholder.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_Company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.SharePercentage LIKE '''+@searchPrefix+'%'' 
							OR tbl_shareholder.Passport_Number LIKE '''+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_shareholder.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.Designation LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @groupByClause = N' GROUP BY tbl_shareholder.ID,tbl_shareholder.FirstName,tbl_shareholder.LastName,tbl_shareholder.Passport_Number,
							tbl_shareholder.PassportExpiryDate,tbl_shareholder.Nationality,tbl_shareholder.Designation,tbl_shareholder.VisaExpiryDate,
							tbl_shareholder.InsuranceCompany,tbl_shareholder.InsuranceExpiryDate,tbl_shareholder.CompanyId,tbl_company.CompanyName,
							tbl_shareholder.SharePercentage,tbl_shareholder.IsActive 
						  '
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX)',@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveEmployeesWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active employees whoes IsActive is one with pagination>
-- <USP_Admin_GetAllActiveEmployeesWithPagination NULL,0,20>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveEmployeesWithPagination]
	@companyId INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id, 
						ISNULL(tbl_user.AccountNumber,''N/A'') AS AccountNumber, 
						ISNULL(tbl_user.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_user.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_user.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_user.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_user.PhoneNumber,''N/A'') AS PhoneNumber, 
						ISNULL(tbl_user.PassportNumber,''N/A'') AS PassportNumber, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),''N/A'') AS PassportExpiryDate, 
						ISNULL(tbl_user.Designation,''N/A'') AS Designation, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),''N/A'') AS VisaExpiryDate, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),''N/A'') AS EmployeementCardExpiryDate,  
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName 
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'

	SET @conditions = N' WHERE  tbl_user.IsActive = 1 
							AND tbl_user.IsDelete <> 1 
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							)
							AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
							AND (
								@searchPrefix IS NULL 
								OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
								OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''  
								OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105) = '''+@searchPrefix+''' 
								OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Designation LIKE ''%'+@searchPrefix+'%'' 
							) 
					   '

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
						tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,tbl_user.Designation,tbl_user.PassportExpiryDate,
						tbl_user.VisaExpiryDate,tbl_user.EmployeementCardExpiryDate,tbl_company.CompanyName '

	SET @orderByClause = N' ORDER BY '

		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Employment Card Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmployeementCardExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Employment Card Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmployeementCardExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Designation '
			+ ' ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Designation '
			+ ' DESC '
		END

	SET @pagination = N' OFFSET @skipRows ROWS 
						 FETCH NEXT @RowsOfPage ROWS ONLY 
					'
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery,
	N'@companyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',
	@companyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveEmployeesWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <13-March-2023>
-- Description:	<Get all active employees whoes IsActive is one with pagination Count>
-- <USP_Admin_GetAllActiveEmployeesWithPaginationCount NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveEmployeesWithPaginationCount]
	@companyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'

	SET @conditions = N' WHERE  tbl_user.IsActive = 1 
							AND tbl_user.IsDelete <> 1 
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							)
							AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
							AND (
								@searchPrefix IS NULL 
								OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
								OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''  
								OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105) = '''+@searchPrefix+''' 
								OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Designation LIKE ''%'+@searchPrefix+'%'' 
							) 
					   '

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
						tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,tbl_user.Designation,tbl_user.PassportExpiryDate,
						tbl_user.VisaExpiryDate,tbl_user.EmployeementCardExpiryDate,tbl_company.CompanyName '

	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


	EXEC SP_EXECUTESQL @selectQuery,N'@companyId INT,@searchPrefix NVARCHAR(MAX)',@companyId,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveMainCompanyEmployeesWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active employees whoes IsActive is one with pagination>
-- <USP_Admin_GetAllActiveMainCompanyEmployeesWithPagination 0,50,NULL,N'Insuarnce Expiry Date',N'desc',1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveMainCompanyEmployeesWithPagination]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id, 
						ISNULL(tbl_user.AccountNumber,''N/A'') AS AccountNumber, 
						ISNULL(tbl_user.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_user.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_user.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_user.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_user.PhoneNumber,''N/A'') AS PhoneNumber, 
						ISNULL(tbl_user.PassportNumber,''N/A'') AS PassportNumber, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),''N/A'') AS PassportExpiryDate, 
						ISNULL(
							STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')
						,''N/A'') AS Designation,
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),''N/A'') AS VisaExpiryDate, 
						ISNULL(tbl_user.InsuranceCompany,''N/A'') AS InsuranceCompany,  
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,105),''N/A'') AS InsuranceExpiryDate, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName 
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK)  ON tbl_mapping.UserId = tbl_user.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'
	SET @conditions = N' WHERE tbl_user.IsActive = 1 
							AND tbl_user.IsDelete <> 1  
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.Id = @CompanyId 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							) 
							AND tbl_user.AccountNumber NOT LIKE ''TBC01'' 
						'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.InsuranceCompany LIKE ''%'+@searchPrefix+'%''  
						) ' 
	END

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,
							tbl_user.Nationality,tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,
							tbl_user.Designation,tbl_user.PassportExpiryDate,tbl_user.VisaExpiryDate,tbl_company.CompanyName,
							tbl_user.InsuranceCompany,tbl_user.InsuranceExpiryDate 
						  '
	SET @orderByClause = N' ORDER BY '

		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Insurance Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Insurance Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) '
			+ ' ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) '
			+ ' DESC '
		END

		IF @sortColumn = 'Insurance Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceCompany '
			+ ' ASC '
		END

		IF @sortColumn = 'Insurance Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceCompany '
			+ ' DESC '
		END


	SET @pagination = N' OFFSET @skipRows ROWS 
						 FETCH NEXT @RowsOfPage ROWS ONLY 
					'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery
	,N'@CompanyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)'
	,@CompanyId,@skipRows,@RowsOfPage,@searchPrefix

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllActiveMainCompanyEmployeesWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <13-March-2023>
-- Description:	<Get all active employees whoes IsActive is one with pagination>
-- <USP_Admin_GetAllActiveMainCompanyEmployeesWithPaginationCount NULL,NULL,1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllActiveMainCompanyEmployeesWithPaginationCount]
	@searchBy NVARCHAR(MAX) =NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_user.AccountNumber,0) AS AccountNumber
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK)  ON tbl_mapping.UserId = tbl_user.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'
	SET @conditions = N' WHERE tbl_user.IsActive = 1 
							AND tbl_user.IsDelete <> 1  
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.Id = @CompanyId 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							) 
							AND tbl_user.AccountNumber NOT LIKE ''TBC01'' 
						'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.InsuranceCompany LIKE ''%'+@searchPrefix+'%''  
						) ' 
	END


	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,
							tbl_user.Nationality,tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,
							tbl_user.Designation,tbl_user.PassportExpiryDate,tbl_user.VisaExpiryDate,tbl_company.CompanyName,
							tbl_user.InsuranceCompany,tbl_user.InsuranceExpiryDate 
						  '
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAdminCompanyServicesRequestFromTempTable]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Company service request from temp table
-- USP_Admin_GetAllAdminCompanyServicesRequestFromTempTable NULL,20,20,N'',N'',N'Serial Number',N'desc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllAdminCompanyServicesRequestFromTempTable]
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	--IF OBJECT_ID(N'tempdb..##AdminCompanyServiceRequestTable') IS NULL
	--BEGIN
	--	EXEC USP_Admin_CreateCompanyServiceRequestTempTable
	--END
	
	SET @query = N'
				SELECT
					ISNULL(tbl_companyServiceRequest.SerialNumber,''N/A'') AS SerialNumber,
					ISNULL(tbl_companyServiceRequest.SerialCode,0) AS SerialCode,
					ISNULL(tbl_companyServiceRequest.ServiceId,0) AS ServiceId,
					ISNULL(tbl_companyServiceRequest.RequestedService,''N/A'') AS RequestedService,
					ISNULL(tbl_companyServiceRequest.CompanyId,0) AS CompanyId,
					ISNULL(tbl_companyServiceRequest.CompanyName,''N/A'') AS CompanyName,
					ISNULL(tbl_companyServiceRequest.RequestedBy,''N/A'') AS RequestedBy,
					ISNULL(CONVERT(NVARCHAR(MAX),tbl_companyServiceRequest.CreatedOn,105),''N/A'') AS CreatedOn,
					ISNULL(tbl_companyServiceRequest.StatusId,0) AS StatusId,
					ISNULL(tbl_companyServiceRequest.Status,''N/A'') AS Status,
					ISNULL(tbl_companyServiceRequest.AssignedUser,''N/A'') AS AssignedUser,
					ISNULL(CONVERT(NVARCHAR(MAX),tbl_companyServiceRequest.AssignOn,105),''N/A'') AS AssignOn,
					ISNULL(tbl_companyServiceRequest.SalesPerson,''N/A'') AS SalesPerson
				FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
				LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id 
				WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1
				AND (tbl_companyServiceRequest.IsDelete <> 1) '

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_companyServiceRequest.StatusId <> 3 AND tbl_companyServiceRequest.StatusId <> 4 AND tbl_companyServiceRequest.StatusId <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_companyServiceRequest.StatusId = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_companyServiceRequest.StatusId = 4 OR tbl_companyServiceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL 
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_companyServiceRequest.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_companyServiceRequest.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_companyServiceRequest.CreatedOn,105) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND tbl_companyServiceRequest.Status LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_companyServiceRequest.AssignOn,105) LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @orderByClause = N'ORDER BY ' 
				IF @sortColumn = '' OR @sortColumn IS NULL
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.SerialCode'
					+ ' ASC'
				END
			
				IF @sortColumn = 'Serial Number' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.SerialCode'
					+ ' ASC'
				END

				IF @sortColumn = 'Serial Number' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.SerialCode'
					+ ' DESC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.RequestedBy ASC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.RequestedBy DESC'
				END

				IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.CreatedOn'
					+ ' ASC'
				END

				IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.CreatedOn'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.AssignOn'
					+' ASC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.AssignOn'
					+ ' DESC'
				END

				IF @sortColumn = 'Company' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.CompanyName'
					+' ASC'
				END

				IF @sortColumn = 'Company' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.CompanyName'
					+ ' DESC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.RequestedService'
					+' ASC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.RequestedService'
					+ ' DESC'
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.SalesPerson'
					+ ' ASC'
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.SalesPerson'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.AssignedUser'
					+ ' ASC'
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_companyServiceRequest.AssignedUser'
					+ ' DESC'
				END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAdminCompanyServicesRequestFromTempTableCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Company service request from temp table
-- USP_Admin_GetAllAdminCompanyServicesRequestFromTempTableCount NULL,N'',N''
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllAdminCompanyServicesRequestFromTempTableCount]
	@Status INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	--IF OBJECT_ID(N'tempdb..##AdminCompanyServiceRequestTable') IS NULL
	--BEGIN
	--	EXEC USP_Admin_CreateCompanyServiceRequestTempTable
	--END
	
	SET @query = N'
				SELECT DISTINCT
					COUNT(*) AS ServiceRequestCount
				FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
				LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id 
				WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1
				AND (tbl_companyServiceRequest.IsDelete <> 1) '

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_companyServiceRequest.StatusId <> 3 AND tbl_companyServiceRequest.StatusId <> 4 AND tbl_companyServiceRequest.StatusId <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_companyServiceRequest.StatusId = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_companyServiceRequest.StatusId = 4 OR tbl_companyServiceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_companyServiceRequest.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_companyServiceRequest.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_companyServiceRequest.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_companyServiceRequest.CreatedOn,105) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND tbl_companyServiceRequest.Status LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_companyServiceRequest.AssignOn,105) LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @selectQuery = @query +' '+ @conditions

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT'
	,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Employee service request from temp table
-- USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable 0,0,20,N'',N'',N'Company',N'desc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable]
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''
	
	--IF OBJECT_ID(N'tempdb..##AdminEmployeeServiceRequestTable') IS NULL
	--BEGIN
	--	EXEC USP_Admin_CreateEmployeeServiceRequestTempTable
	--END

	SET @query = N'
				SELECT 
					ISNULL(tbl_employeeServiceRequests.SerialNumber,''N/A'') AS SerialNumber,
					ISNULL(tbl_employeeServiceRequests.SerialCode,0) AS SerialCode,
					ISNULL(tbl_employeeServiceRequests.ApplicantName,''N/A'') AS ApplicantName,
					ISNULL(tbl_employeeServiceRequests.ServiceId,0) AS ServiceId,
					ISNULL(tbl_employeeServiceRequests.RequestedService,''N/A'') AS RequestedService,
					ISNULL(tbl_employeeServiceRequests.CompanyId,0) AS CompanyId,
					ISNULL(tbl_employeeServiceRequests.CompanyName,''N/A'') AS CompanyName,
					ISNULL(tbl_employeeServiceRequests.RequestedBy,''N/A'') AS RequestedBy,
					ISNULL(CONVERT(NVARCHAR(MAX),tbl_employeeServiceRequests.CreatedOn,105),''N/A'') AS CreatedOn,
					ISNULL(tbl_employeeServiceRequests.StatusId,0) AS StatusId,
					ISNULL(tbl_employeeServiceRequests.Status,''N/A'') AS Status,
					ISNULL(tbl_employeeServiceRequests.AssignedUser,''N/A'') AS AssignedUser,
					ISNULL(CONVERT(NVARCHAR(MAX),tbl_employeeServiceRequests.AssignOn,105),''N/A'') AS AssignOn,
					ISNULL(tbl_employeeServiceRequests.SalesPerson,''N/A'') AS SalesPerson
				FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequests
				LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequests.ServiceId = tbl_service.Id 
				WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1
				AND (tbl_employeeServiceRequests.IsDelete <> 1) '

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.StatusId <> 3 AND tbl_employeeServiceRequests.StatusId <> 4 AND tbl_employeeServiceRequests.StatusId <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.StatusId = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_employeeServiceRequests.StatusId = 4 OR tbl_employeeServiceRequests.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_employeeServiceRequests.CreatedOn,105) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND tbl_employeeServiceRequests.Status LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_employeeServiceRequests.AssignOn,105) = '''+@searchPrefix+''''
		END
		IF @searchBy = 'Applicant Name'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.ApplicantName LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @orderByClause = N'ORDER BY ' 
				IF @sortColumn = '' OR @sortColumn IS NULL
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.SerialCode'
					+ ' ASC'
				END
			
				IF @sortColumn = 'Serial Number' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.SerialCode'
					+ ' ASC'
				END

				IF @sortColumn = 'Serial Number' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.SerialCode'
					+ ' DESC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.RequestedBy ASC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.RequestedBy DESC'
				END

				IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.CreatedOn'
					+ ' ASC'
				END

				IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.CreatedOn'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.AssignOn'
					+' ASC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.AssignOn'
					+ ' DESC'
				END

				IF @sortColumn = 'Company' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.CompanyName'
					+' ASC'
				END

				IF @sortColumn = 'Company' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.CompanyName'
					+ ' DESC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.RequestedService'
					+' ASC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.RequestedService'
					+ ' DESC'
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.SalesPerson'
					+ ' ASC'
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.SalesPerson'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.AssignedUser'
					+ ' ASC'
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.AssignedUser'
					+ ' DESC'
				END

				IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.ApplicantName'
					+ ' ASC'
				END

				IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_employeeServiceRequests.ApplicantName'
					+ ' DESC'
				END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTableCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Employee service request from temp table
-- USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTableCount 0,N'Applicant Name',N'SATYAM JOSHI'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTableCount]
	@Status INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	--IF OBJECT_ID(N'tempdb..##AdminEmployeeServiceRequestTable') IS NULL
	--BEGIN
	--	EXEC USP_Admin_CreateEmployeeServiceRequestTempTable
	--END

	SET @query = N'
				SELECT DISTINCT
					COUNT(*) AS ServiceRequestCount
				FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequests
				LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequests.ServiceId = tbl_service.Id 
				WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1
				AND (tbl_employeeServiceRequests.IsDelete <> 1) '

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.StatusId <> 3 AND tbl_employeeServiceRequests.StatusId <> 4 AND tbl_employeeServiceRequests.StatusId <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.StatusId = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_employeeServiceRequests.StatusId = 4 OR tbl_employeeServiceRequests.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_employeeServiceRequests.CreatedOn,105) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND tbl_employeeServiceRequests.Status LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_employeeServiceRequests.AssignOn,105) = '''+@searchPrefix+''''
		END
		IF @searchBy = 'Applicant Name'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_employeeServiceRequests.ApplicantName LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @selectQuery = @query +' '+ @conditions +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT'
	,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAssignedCompanyServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllAssignedCompanyServiceRequest 316
CREATE PROCEDURE [dbo].[USP_Admin_GetAllAssignedCompanyServiceRequest]
	@UserId INT = NULL,
	@Company NVARCHAR(100) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;

	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			(SELECT TOP(1) tbl_serviceRequestStatus.Status 
			FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
			WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				 AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceRequest.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND tbl_service.IsCompanyService <> 0
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND tbl_service.IsCompanyService <> 0
			AND tbl_serviceRequest.Status = 3
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
			SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND tbl_service.IsCompanyService <> 0
			AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAssignedEmployeeServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllAssignedEmployeeServiceRequest 316
CREATE PROCEDURE [dbo].[USP_Admin_GetAllAssignedEmployeeServiceRequest]
	@UserId INT = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL((SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
								WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
								AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
								AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
								AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
					,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser,
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
			AND tbl_service.IsEmployeeService = 1
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL((SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
					,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND tbl_service.IsEmployeeService = 1
			AND tbl_serviceRequest.Status = 3
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
			SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL((SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
			,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND tbl_service.IsEmployeeService = 1
			AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAssignedServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllAssignedServiceRequest 316
CREATE PROCEDURE [dbo].[USP_Admin_GetAllAssignedServiceRequest]
	@UserId INT = NULL,
	@Company NVARCHAR(100) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;

	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceRequest.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceRequest.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceRequest.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceRequest.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND tbl_serviceRequest.Status = 3
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
			SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceRequest.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceRequest.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber LIKE tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber)
			AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAssignedServiceRequest_TEST]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllAssignedServiceRequest 316
CREATE PROCEDURE [dbo].[USP_Admin_GetAllAssignedServiceRequest_TEST]
	@UserId INT = NULL,
	@Company NVARCHAR(100) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber = tbl_serviceRequest.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceRequest.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(20),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber = tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber = tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber
				AND b.IsDelete <> 1
				--GROUP BY b.SerialNumber
				)
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
			AND tbl_service.IsCompanyService<> 0
		--GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		--tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		--tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber asc
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber = tbl_serviceRequest.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceRequest.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(20),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber = tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber = tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber
				AND b.IsDelete <> 1
				--GROUP BY b.SerialNumber
				)
			AND tbl_serviceRequest.Status = 3
		--GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		--tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		--tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber asc
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
			SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber = tbl_serviceRequest.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
			CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName ,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceRequest.SalesPersonId )
			END AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(20),tbl_serviceFormFieldValue.CreatedOn,105),'N/A')  AS CreatedOn,
			tbl_serviceRequest.Status AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber = tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 
				ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assignUser ON tbl_assignUser.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
		WHERE tbl_assignUser.UserId = @UserId 
			AND tbl_assignUser.SerialNumber = tbl_serviceRequest.SerialNumber
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)
			AND tbl_serviceRequest.Id IN(SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber
				AND b.IsDelete <> 1
				--GROUP BY b.SerialNumber
				)
			AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
		--GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,
		--tbl_serviceRequest.SalesPersonId,tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,
		--tbl_user.FirstName,tbl_user.LastName,tbl_serviceFormFieldValue.CreatedOn,tbl_serviceRequest.Status,tbl_serviceFormFieldValue.SalesPersonId,tbl_assignUser.UserId,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber asc
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllAssignedSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetAllAssignedSupportTicket]
	@UserId INT = NULL ,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
			tbl_supportTicket.TrackingNumber AS TrackingNumber,
			ISNULL(tbl_supportTicket.ID,0) AS ID,
			ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_supportTicket.UserId,0) AS UserId,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
			ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
			ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
			CASE WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 1 THEN 1
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 0 THEN 1
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 2 THEN 2
			END AS TicketStatusId,
			CASE WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 1 THEN 'Open'
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 0 THEN 'Open'
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 2 THEN 'Close'
			END AS TicketStatus,
			ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
			ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
			ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.ModifyOn,105),'N/A') AS ModifyOn,
			ISNULL(tbl_supportTicket.ModifyBy,0) AS ModifyBy,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_assigneduser.TrackingNumber = tbl_supportTicket.TrackingNumber
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_assigneduser.UserId = @UserId)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		GROUP BY TrackingNumber
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanies]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get Company Details with Pagination except Main Company DIBN Detail>
-- <USP_Admin_GetAllCompanies 0,1000,N'',NULL,NULL>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanies]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	DECLARE @strLength INT = NULL
	SET @strLength = (SELECT LEN(@searchPrefix))

	SET @query = N'
					SELECT 
						ISNULL(tbl_company.Id,0) AS Id, 
						ISNULL(tbl_company.AccountNumber,''N/A'') AS AccountNumber,  
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_company.CompanyType,''N/A'') AS CompanyType, 
						ISNULL(tbl_company.MobileNumber,''N/A'') AS MobileNumber, 
						ISNULL(tbl_company.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_company.LicenseType,''N/A'') AS LicenseType, 
						ISNULL(STUFF((SELECT TOP(1) '','' + ISNULL(tbl_shareholder.FirstName +'' ''+tbl_shareholder.LastName,''N/A'') 
						FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
						WHERE tbl_shareholder.CompanyId = tbl_company.Id 
						AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
						FOR XML PATH('''')),1,1,''''),''N/A'') AS ShareholderName,  
						ISNULL((SELECT TOP(1) tbl_shareholder.SharePercentage 
						FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
						WHERE tbl_shareholder.CompanyId = tbl_company.Id 
						AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
						),''N/A'') AS ShareholderSharePercentage, 
						CONVERT(BIT, ISNULL(STUFF((SELECT TOP(1) '','' + CONVERT(NVARCHAR(2),ISNULL(tbl_shareholder.IsActive,0)) 
						FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
						WHERE tbl_shareholder.CompanyId = tbl_company.Id 
						AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
						FOR XML PATH('''')),1,1,''''),0)) AS ShareholderIsActive, 
						ISNULL(tbl_company.IsActive,0) AS IsActive 
					FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK)  ON tbl_company.Id = tbl_company_user_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK)  ON tbl_company_user_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholderData WITH(NOLOCK)  ON tbl_company.Id = tbl_shareholderData.CompanyId 
				'
	SET @conditions = N' WHERE tbl_company.IsDelete <> 1 
						AND tbl_company.CompanyName NOT LIKE N''DIBN'' 
					'
	IF @searchPrefix IS NOT NULL AND (@searchPrefix = N'de-active' OR @searchPrefix = N'De-Active')
	BEGIN
		SET @conditions =  @conditions + N' AND CONVERT(NVARCHAR(50),tbl_company.IsActive) =  ''0'''
	END
	ELSE IF @searchPrefix IS NOT NULL AND (@searchPrefix = N'Active' OR @searchPrefix = N'active')
	BEGIN
		SET @conditions =  @conditions + N' AND CONVERT(NVARCHAR(50),tbl_company.IsActive) =  ''1'''
	END
	ELSE
	BEGIN
		SET @conditions = @conditions +N'
						AND (
							@searchPrefix IS NULL 
							OR LEFT(tbl_company.AccountNumber, @strLength) = '''+@searchPrefix+''' 
							OR LEFT(tbl_company.CompanyName, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.CompanyType, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.EmailID, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.MobileNumber, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.LicenseType, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_shareholderData.FirstName, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_shareholderData.LastName, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_shareholderData.SharePercentage, @strLength) = '''+@searchPrefix+'''
						) 
		'
	END

	SET @groupByClause = N' GROUP BY tbl_company.AccountNumber,tbl_company.Id,tbl_company.CompanyName,tbl_company.CompanyType,
							tbl_company.MobileNumber,tbl_company.EmergencyNumber,
							tbl_company.EmailID,tbl_company.SecondEmailID,tbl_company.LicenseType,tbl_company.IsActive
						'

	SET @orderByClause = N' ORDER BY '
		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause + N'
									(SELECT CONVERT(INT,SUBSTRING(tbl_company.AccountNumber, PATINDEX(''%[0-9]%'', tbl_company.AccountNumber), LEN(tbl_company.AccountNumber)))) '
									+' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N'
									(SELECT CONVERT(INT,SUBSTRING(tbl_company.AccountNumber, PATINDEX(''%[0-9]%'', tbl_company.AccountNumber), LEN(tbl_company.AccountNumber)))) '
									+' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N'
									(SELECT CONVERT(INT,SUBSTRING(tbl_company.AccountNumber, PATINDEX(''%[0-9]%'', tbl_company.AccountNumber), LEN(tbl_company.AccountNumber)))) '
									+' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyName '
									+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyName '
									+' DESC '
		END

		IF @sortColumn = 'Company Type' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyType '
									+' ASC '
		END

		IF @sortColumn = 'Company Type' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyType '
									+' DESC '
		END

		IF @sortColumn = 'Contact Number' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.MobileNumber '
									+' ASC '
		END

		IF @sortColumn = 'Contact Number' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.MobileNumber '
									+' DESC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.EmailID '
									+' ASC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.EmailID '
									+' DESC '
		END

		IF @sortColumn = 'Authority' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.LicenseType '
									+' ASC '
		END

		IF @sortColumn = 'Authority' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.LicenseType '
									+' DESC '
		END

		IF @sortColumn = 'Company Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.IsActive '
									+' ASC '
		END

		IF @sortColumn = 'Company Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.IsActive '
									+' DESC '
		END

		IF @sortColumn = 'Shareholder' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT STUFF((SELECT TOP(1) '','' + ISNULL(tbl_shareholder.FirstName +'' ''+tbl_shareholder.LastName,''N/A'') 
													FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
													WHERE tbl_shareholder.CompanyId = tbl_company.Id 
													AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
													FOR XML PATH('''')),1,1,''''))  '
									+' ASC '
		END

		IF @sortColumn = 'Shareholder' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT STUFF((SELECT TOP(1) '','' + ISNULL(tbl_shareholder.FirstName +'' ''+tbl_shareholder.LastName,''N/A'') 
													FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
													WHERE tbl_shareholder.CompanyId = tbl_company.Id 
													AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
													FOR XML PATH('''')),1,1,'''')) '
									+' DESC '
		END


		IF @sortColumn = 'Shareholder Share(%)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT TOP(1) ISNULL(CONVERT(DECIMAL(18,2),tbl_shareholder.SharePercentage),0)
													FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
													WHERE tbl_shareholder.CompanyId = tbl_company.Id 
													AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
													) '
									+' ASC '
		END

		IF @sortColumn = 'Shareholder Share(%)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT TOP(1) ISNULL(CONVERT(DECIMAL(18,2),tbl_shareholder.SharePercentage),0)
													FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder 
													WHERE tbl_shareholder.CompanyId = tbl_company.Id 
													AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0 
													) '
									+' DESC '
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX),@strLength INT',@skipRows,@RowsOfPage,@searchPrefix,@strLength
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompaniesCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get Company Details with Pagination except Main Company DIBN Detail>
-- <USP_Admin_GetAllCompaniesCount N'102'>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompaniesCount]
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	DECLARE @strLength INT = NULL
	SET @strLength = (SELECT LEN(@searchPrefix))


	SET @query = N'
					SELECT 
						ISNULL(tbl_company.Id,0) AS Id
					FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK)  ON tbl_company.Id = tbl_company_user_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK)  ON tbl_company_user_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholderData WITH(NOLOCK)  ON tbl_company.Id = tbl_shareholderData.CompanyId 
				'
	SET @conditions = N' WHERE tbl_company.IsDelete <> 1 
						AND tbl_company.CompanyName NOT LIKE N''DIBN'' 
					'
	IF @searchPrefix IS NOT NULL AND (@searchPrefix = N'de-active' OR @searchPrefix = N'De-Active')
	BEGIN
		SET @conditions =  @conditions + N' AND CONVERT(NVARCHAR(50),tbl_company.IsActive) =  ''0'''
	END
	ELSE IF @searchPrefix IS NOT NULL AND (@searchPrefix = N'Active' OR @searchPrefix = N'active')
	BEGIN
		SET @conditions =  @conditions + N' AND CONVERT(NVARCHAR(50),tbl_company.IsActive) =  ''1'''
	END
	ELSE
	BEGIN
		SET @conditions = @conditions +N'
						AND (
							@searchPrefix IS NULL 
							OR LEFT(tbl_company.AccountNumber, @strLength) = '''+@searchPrefix+''' 
							OR LEFT(tbl_company.CompanyName, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.CompanyType, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.EmailID, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.MobileNumber, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_company.LicenseType, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_shareholderData.FirstName, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_shareholderData.LastName, @strLength) = '''+@searchPrefix+'''
							OR LEFT(tbl_shareholderData.SharePercentage, @strLength) = '''+@searchPrefix+'''
						) 
		'
	END

	SET @groupByClause = N' GROUP BY tbl_company.AccountNumber,tbl_company.Id,tbl_company.CompanyName,tbl_company.CompanyType,
							tbl_company.MobileNumber,tbl_company.EmergencyNumber,
							tbl_company.EmailID,tbl_company.SecondEmailID,tbl_company.LicenseType,tbl_company.IsActive
						'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@strLength INT',@searchPrefix,@strLength
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyAssignedServiceRequest 316,NULL,0,1000,N'Assigned To','Jash',N'SR No.',N'asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequest]
	@UserId INT = NULL,
	@Status INT = NULL,
	@skipRows  INT = 0,
	@RowsOfPage INT = 0,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT ISNULL(tbl_assignRequest.SerialNumber,''N/A'') AS SerialNumber,
			ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService,
			ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
			ELSE 
				ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'')
			END AS RequestedBy,
			ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] formField 
			WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber ),''N/A'') AS CreatedOn,
			ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
			ISNULL(
				(
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					AND tbl_request.Status = tbl_serviceRequest.Status
					AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
					ORDER BY tbl_serviceRequest.StepId DESC
				)
			,''N/A'') AS Status,
			ISNULL(STUFF(
			(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
			WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
			FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
			ISNULL(STUFF(
			(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
			WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
			FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson 
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignRequest.UserId = tbl_assignUser.Id	
			LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue ON tbl_assignRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id	
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id	
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId	
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 	
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
		AND tbl_serviceRequest.Id = 
			(   
				SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
			    WHERE b.SerialNumber = tbl_assignRequest.SerialNumber 
			    AND b.IsDelete <> 1 
			    ORDER BY b.StepId DESC 
			) 
		AND tbl_serviceRequest.IsDelete <> 1  
		AND tbl_service.IsCompanyService <> 0 
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL 
	BEGIN
		
		SET @conditions = @conditions + ' AND (
					@searchPrefix IS NULL 
					OR tbl_assignRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
					OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
					OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
					OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'') 
					OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
					OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM 
					[dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
						WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
				) '

	END
	
	SET @groupByClause =  N'
				GROUP BY tbl_assignRequest.SerialNumber,tbl_serviceForms.FormName,tbl_company.CompanyName,
				tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
				tbl_serviceRequest.Status,tbl_serviceRequest.CompanyId,tbl_serviceRequest.Status,tbl_serviceRequest.CreatedOn,
				tbl_salesPerson.FirstName,tbl_salesPerson.LastName,tbl_serviceRequest.StepId 
			'

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_assignRequest.SerialNumber,CHARINDEX(''R'',tbl_assignRequest.SerialNumber)+1,LEN(tbl_assignRequest.SerialNumber))))'
			+ ' ASC '
		END
			
		IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_assignRequest.SerialNumber,CHARINDEX(''R'',tbl_assignRequest.SerialNumber)+1,LEN(tbl_assignRequest.SerialNumber))))'
			+ ' ASC ' 
		END

		IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_assignRequest.SerialNumber,CHARINDEX(''R'',tbl_assignRequest.SerialNumber)+1,LEN(tbl_assignRequest.SerialNumber))))'
			+ ' DESC '
		END
		
		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
			'END ASC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
			'END DESC ' 
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber)'
			+ ' ASC '
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber)'
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+ ' DESC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForms.FormName'
			+' ASC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForms.FormName'
			+ ' DESC '
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+' ASC '
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+ ' DESC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
					WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+' ASC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
					WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+ ' DESC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					AND tbl_request.Status = tbl_serviceRequest.Status
					AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
					ORDER BY tbl_serviceRequest.StepId DESC
				) '
			+' ASC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					AND tbl_request.Status = tbl_serviceRequest.Status
					AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
					ORDER BY tbl_serviceRequest.StepId DESC
				) '
			+ ' DESC '
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@UserId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyAssignedServiceRequestCount 3,NULL
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequestCount]
	@UserId INT = NULL,
	@Status INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT ISNULL(tbl_assignRequest.SerialNumber,''N/A'') AS SerialNumber
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignRequest.UserId = tbl_assignUser.Id	
			LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue ON tbl_assignRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id	
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id	
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId	
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 	
		'

	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
		AND tbl_serviceRequest.Id = 
			(   
				SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
			    WHERE b.SerialNumber = tbl_assignRequest.SerialNumber 
			    AND b.IsDelete <> 1 
			    ORDER BY b.StepId DESC 
			) 
		AND tbl_serviceRequest.IsDelete <> 1  
		AND tbl_service.IsCompanyService <> 0 
	' 
	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL 
	BEGIN
		
		SET @conditions = @conditions + ' AND (
					@searchPrefix IS NULL 
					OR tbl_assignRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
					OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
					OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
					OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'') 
					OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
					OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM 
					[dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
						WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
				) '

	END

	SET @groupByClause =  N'
				GROUP BY tbl_assignRequest.SerialNumber,tbl_serviceForms.FormName,tbl_company.CompanyName,
				tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
				tbl_serviceRequest.Status,tbl_serviceRequest.CompanyId,tbl_serviceRequest.Status,tbl_serviceRequest.CreatedOn,
				tbl_salesPerson.FirstName,tbl_salesPerson.LastName,tbl_serviceRequest.StepId 
			'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
	,@UserId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequestToDIBNTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Company service request from temp table
-- USP_Admin_GetAllCompanyAssignedServiceRequestToDIBNTeam 316,NULL,40,20,N'','',N'',N''
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequestToDIBNTeam]
	@UserId INT = NULL,
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT  
				ISNULL(tbl_serviceRequest.SerialNumber,''N/A'') AS SerialNumber,
				ISNULL(tbl_serviceRequest.RequestedService,''N/A'') AS RequestedService,
				ISNULL(tbl_serviceRequest.CompanyName,''N/A'') AS CompanyName,
				ISNULL(tbl_serviceRequest.RequestedBy,''N/A'') AS RequestedBy,
				ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105),''N/A'') AS CreatedOn,
				ISNULL(tbl_serviceRequest.Status,''N/A'') AS Status,
				ISNULL(tbl_serviceRequest.AssignedUser,''N/A'') AS AssignedUser,
				ISNULL(tbl_serviceRequest.SalesPerson,''N/A'') AS SalesPerson
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id		
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
		AND tbl_serviceRequest.IsDelete <> 1  
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) = '''+@searchPrefix+''''
		END
	END

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Serial Number' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode'
			+ ' ASC'
		END

		IF @sortColumn = 'Serial Number' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode'
			+ ' DESC'
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy ASC'
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy DESC'
		END

		IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn'
			+ ' ASC'
		END

		IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+' ASC'
		END

		IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+ ' DESC'
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SalesPerson'
			+ ' ASC'
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SalesPerson'
			+ ' DESC'
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser'
			+ ' ASC'
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@UserId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequestToDIBNTeamCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Company service request from temp table
-- USP_Admin_GetAllCompanyAssignedServiceRequestToDIBNTeamCount 316,NULL,N'',''
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyAssignedServiceRequestToDIBNTeamCount]
	@UserId INT = NULL,
	@Status INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT DISTINCT
				COUNT(*) AS ServiceRequestCount
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id		
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
		AND tbl_serviceRequest.IsDelete <> 1  
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) = '''+@searchPrefix+''''
		END
	END

	SET @selectQuery = @query +' '+ @conditions 

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
	,@UserId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyFinalInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Invoice List with Pagination>
-- <USP_Admin_GetAllCompanyFinalInvoice 0,50,NULL,NULL,N'Created Date',N'desc',NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyFinalInvoice]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_companypdf.Id,0) AS Id, 
						ISNULL(tbl_companypdf.PdfName,''N/A'') AS [Name], 
						ISNULL(tbl_companypdf.Extension,''N/A'') AS Extension, 
						ISNULL(tbl_companypdf.InvoiceNumber,''N/A'') AS InvoiceNumber, 
						ISNULL(tbl_Company.CompanyName,''N/A'') AS Company, 
						ISNULL(CONVERT(nvarchar(50),tbl_companypdf.CreatedOn,105),''N/A'') AS CreatedOn, 
						ISNULL(tbl_companypdf.CreatedBy,0) AS CreatedBy, 
						ISNULL(tbl_user.FirstName +'' ''+ tbl_user.LastName,''N/A'') AS Username 
					FROM [dbo].[Tbl_CompanyInvoicePdf] tbl_companypdf WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails WITH(NOLOCK) ON tbl_companyInvoiceDetails.InvoiceNumber = tbl_companypdf.InvoiceNumber
					LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoiceDetails.CompanyId
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companypdf.CreatedBy 
				'
	SET @conditions = N' WHERE tbl_companypdf.IsDelete <> 1 
							AND (tbl_companyInvoiceDetails.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
							AND (
								@searchPrefix IS NULL 
								OR tbl_companypdf.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_Company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' 
							)
						'

	SET @groupByClause = N' GROUP BY tbl_companypdf.Id,tbl_companypdf.PdfName,tbl_companypdf.Extension,
							tbl_companypdf.InvoiceNumber,tbl_Company.CompanyName,tbl_companypdf.CreatedOn,tbl_companypdf.CreatedBy,
							tbl_user.FirstName,tbl_user.LastName '

	SET @orderByClause = N' ORDER BY '
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+' (SELECT CONVERT(INT,SUBSTRING(tbl_companypdf.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companypdf.InvoiceNumber), LEN(tbl_companypdf.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortColumn = 'Invoice No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' (SELECT CONVERT(INT,SUBSTRING(tbl_companypdf.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companypdf.InvoiceNumber), LEN(tbl_companypdf.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortColumn = 'Invoice No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' (SELECT CONVERT(INT,SUBSTRING(tbl_companypdf.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companypdf.InvoiceNumber), LEN(tbl_companypdf.InvoiceNumber)))) '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' tbl_Company.CompanyName '
			+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' tbl_Company.CompanyName '
			+ ' DESC '
		END

		IF @sortColumn = 'Final Invoice' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' tbl_companypdf.PdfName '
			+ ' ASC '
		END

		IF @sortColumn = 'Final Invoice' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' tbl_companypdf.PdfName '
			+ ' DESC '
		END

		IF @sortColumn = 'Generated By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' tbl_user.FirstName +'' ''+ tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Generated By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+' tbl_user.FirstName +'' ''+ tbl_user.LastName '
			+ ' DESC '
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

	PRINT @orderByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyFinalInvoiceCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Invoice List with Pagination>
-- <USP_Admin_GetAllCompanyFinalInvoiceCount NULL,NULL,155>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyFinalInvoiceCount]
	@searchPrefix NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;


	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_companypdf.Id,0) AS Id
					FROM [dbo].[Tbl_CompanyInvoicePdf] tbl_companypdf WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails WITH(NOLOCK) ON tbl_companyInvoiceDetails.InvoiceNumber = tbl_companypdf.InvoiceNumber
					LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoiceDetails.CompanyId
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companypdf.CreatedBy 
				'
	SET @conditions = N' WHERE tbl_companypdf.IsDelete <> 1 
							AND (tbl_companyInvoiceDetails.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
							AND (
								@searchPrefix IS NULL 
								OR tbl_companypdf.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_Company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' 
							) 
						'

	SET @groupByClause = N' GROUP BY tbl_companypdf.Id,tbl_companypdf.PdfName,tbl_companypdf.Extension,
							tbl_companypdf.InvoiceNumber,tbl_Company.CompanyName,tbl_companypdf.CreatedOn,tbl_companypdf.CreatedBy,
							tbl_user.FirstName,tbl_user.LastName '

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Invoice List with Pagination>
-- <USP_Admin_GetAllCompanyInvoice 0,20,NULL,N'Date',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyInvoice]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'SELECT 
		tbl_companyInvoiceDetail.InvoiceNumber AS InvoiceNumber, 
		ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
		ISNULL(tbl_companyInvoiceDetail.Services,''N/A'') AS [Service], 
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105),''N/A'') AS [Date], 
		MAX(tbl_companyInvoiceDetail.GrandTotal) AS GrandTotal, 
		ISNULL(MAX(tbl_companyInvoiceDetail.Currency),''AED'') AS Currency, 
		ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy, 
		ISNULL(tbl_user.FirstName +'' ''+ tbl_user.LastName,''N/A'') AS Username 
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK)  ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy 
	'

	SET @conditions = N' WHERE (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 ) 
							AND tbl_companyInvoiceDetail.Id = ( 
														SELECT DISTINCT 
														MAX(Id) 
														FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK) 
														WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
														AND (b.IsDelete <> 1 OR b.IsDelete IS NULL) 
														GROUP BY b.InvoiceNumber 
														) 
							AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL) 
							AND (
									@searchPrefix IS NULL 
									OR tbl_companyInvoiceDetail.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_companyInvoiceDetail.Services LIKE ''%'+@searchPrefix+'%'' 
									OR CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105) LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_companyInvoiceDetail.GrandTotal LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_companyInvoiceDetail.Currency LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'' 
								) 
					   '

	SET @groupByClause = N' GROUP BY tbl_companyInvoiceDetail.InvoiceNumber,tbl_company.CompanyName,tbl_companyInvoiceDetail.InvoiceCreatedOn,
	tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.CreatedBy,tbl_user.FirstName,tbl_user.LastName,
	tbl_companyInvoiceDetail.Currency,tbl_companyInvoiceDetail.Services'

	SET @orderByClause = N' ORDER  BY '
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber,PATINDEX(''%[0-9]%'',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortColumn = 'Invoice No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortColumn = 'Invoice No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber)))) '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' DESC '
		END

		IF @sortColumn = 'Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CONVERT(DATE,tbl_companyInvoiceDetail.InvoiceCreatedOn) '
			+ ' ASC '
		END

		IF @sortColumn = 'Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CONVERT(DATE,tbl_companyInvoiceDetail.InvoiceCreatedOn) '
			+ ' DESC '
		END

		IF @sortColumn = 'Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Services '
			+ ' ASC '
		END

		IF @sortColumn = 'Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Services '
			+ ' DESC '
		END

		IF @sortColumn = 'Currency' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Currency '
			+ ' ASC '
		END

		IF @sortColumn = 'Currency' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Currency '
			+ ' DESC '
		END

		IF @sortColumn = 'Generated By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+ tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Generated By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+ tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Amount' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CONVERT(DECIMAL(18,2),tbl_companyInvoiceDetail.GrandTotal) '
			+ ' ASC '
		END

		IF @sortColumn = 'Amount' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CONVERT(DECIMAL(18,2),tbl_companyInvoiceDetail.GrandTotal) '
			+ ' DESC '
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+  @groupByClause +' '+@orderByClause +' '+@pagination 

	EXEC SP_EXECUTESQL @selectQuery
	,N'@CompanyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)'
	,@CompanyId,@skipRows,@RowsOfPage,@searchPrefix
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyInvoiceCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Invoice List with Pagination>
-- USP_Admin_GetAllCompanyInvoiceCount NULL,NULL
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyInvoiceCount]
	@searchPrefix NVARCHAR(MAX) =NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'SELECT 
			tbl_companyInvoiceDetail.InvoiceNumber AS InvoiceNumber
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK)  ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy 
	'

	SET @conditions = N' WHERE (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 ) 
							AND tbl_companyInvoiceDetail.Id = ( 
															SELECT DISTINCT 
															MAX(Id) 
															FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK) 
															WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
															AND (b.IsDelete <> 1 OR b.IsDelete IS NULL) 
															GROUP BY b.InvoiceNumber 
															) 
							AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL) 
							AND (
									@searchPrefix IS NULL 
									OR tbl_companyInvoiceDetail.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_companyInvoiceDetail.Services LIKE ''%'+@searchPrefix+'%'' 
									OR CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105) LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_companyInvoiceDetail.GrandTotal LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_companyInvoiceDetail.Currency LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'' 
								)
	'

	SET @groupByClause = N' GROUP BY tbl_companyInvoiceDetail.InvoiceNumber,tbl_company.CompanyName,tbl_companyInvoiceDetail.InvoiceCreatedOn,
	tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.CreatedBy,tbl_user.FirstName,tbl_user.LastName,
	tbl_companyInvoiceDetail.Currency,tbl_companyInvoiceDetail.Services'

	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServiceByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<SP_Admin_GetAllCompanyServiceByCompanyId 50,10>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServiceByCompanyId]
	@CompanyId INT = NULL,
	@ParentId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @CompanyType NVARCHAR(MAX) = (SELECT CompanyType FROM [dbo].[Tbl_Company] WHERE Id=@CompanyId AND IsDelete <> 1 AND IsActive <> 0);
	SELECT DISTINCT
		tbl_service.ServiceId AS ID,
		ISNULL(tbl_companyservice.ParentId,0) AS ParentId,
		ISNULL(tbl_companyservice.CompanyType,'N/A') AS CompanyType,
		CASE WHEN tbl_service.DisplayName IS NULL THEN 
				ISNULL(tbl_companyservice.ServiceName,'N/A')
			ELSE
				ISNULL(tbl_service.DisplayName,'N/A')
		END AS ServiceName,
		ISNULL(tbl_service.FormConstrains,'N/A') AS FormConstrain,
		ISNULL(tbl_service.HasMultipleForms,0) AS HasMultipleForms,
		ISNULL(tbl_service.IsActive,0) AS IsActive,
		ISNULL(tbl_service.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
		tbl_service.AllowDisplay
	FROM [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_CompanyServices] tbl_companyservice ON tbl_service.ServiceId = tbl_companyservice.ID
	WHERE tbl_companyservice.IsDelete <> 1 
	and tbl_companyservice.IsActive <> 0 
	AND tbl_service.IsActive <> 0 
	AND tbl_service.IsCompanyService <> 0 
	AND (tbl_service.AllowDisplay <> 0)
	AND tbl_companyservice.CompanyType = @CompanyType
	AND tbl_companyservice.ParentId = @ParentId
	ORDER BY HasMultipleForms
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithCount NULL,234,NULL,NULL,NULL
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithCount]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
			ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_serviceRequest.ServiceId  
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm WITH(NOLOCK)  ON tbl_serviceFormFieldValue.FormId = tbl_serviceForm.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_serviceFormFieldValue.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK)  ON  tbl_serviceFormFieldValue.UserId = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND (tbl_salesPerson.Id = @SalesPersonId OR @SalesPersonId IS NULL) 
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
	 AND (tbl_serviceRequest.IsDelete <> 1) 
	 AND tbl_serviceRequest.Id = 
								(SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber AND b.IsDelete <> 1 
								ORDER BY b.StepId DESC 
								) 
	AND tbl_service.IsCompanyService <> 0 '

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceFormFieldValue.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceFormFieldValue.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END

		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
			OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'')'
		END

		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'' '
		END
	END


	SET @groupByClause = @groupByClause + N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,
		tbl_serviceForm.FormName,tbl_company.CompanyName,
		tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
		tbl_serviceRequest.Status,tbl_serviceRequest.StepId '

	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
									,@CompanyId,@SalesPersonId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPagination NULL,2763,NULL,0,50,N'',N'SR No.','asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPagination]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@skipRows INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
			ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber, 
			ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
			ISNULL(tbl_serviceForm.FormName,''N/A'') AS RequestedService, 
			ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
			CASE WHEN (((tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0) 
			AND (tbl_serviceFormFieldValue.RMTeamId IS NULL OR tbl_serviceFormFieldValue.RMTeamId = 0)))
			THEN 
				ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'') 
			WHEN tbl_serviceFormFieldValue.RMTeamId IS NOT NULL OR tbl_serviceFormFieldValue.RMTeamId <> 0
			THEN 
				(SELECT ISNULL(FirstName +'' ''+ LastName,''N/A'') FROM [dbo].[Tbl_RMTeam] WHERE Id = tbl_serviceFormFieldValue.RMTeamId)
			ELSE 
				(SELECT FirstName +'' ''+LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId) 
			END AS RequestedBy,
			ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] formField 
			WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn, 
			ISNULL(tbl_serviceRequest.Status,0) AS StatusId, 
			ISNULL( 
				( 
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)  
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK)  ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status 
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status 
					AND tbl_request.Status = tbl_serviceRequest.Status 
					AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
					ORDER BY tbl_serviceRequest.StepId DESC 
				)
			,''N/A'') AS Status, 
			ISNULL(STUFF( 
			(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
			FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser 
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_serviceRequest.ServiceId  
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm WITH(NOLOCK)  ON tbl_serviceFormFieldValue.FormId = tbl_serviceForm.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_serviceFormFieldValue.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK)  ON  tbl_serviceFormFieldValue.UserId = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
	 AND (tbl_serviceRequest.IsDelete <> 1) 
	 AND tbl_serviceRequest.Id = 
								(SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber AND b.IsDelete <> 1 
								ORDER BY b.StepId DESC 
								) 
	AND tbl_service.IsCompanyService <> 0 '

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
							OR tbl_serviceForm.FormName LIKE ''%'+@searchPrefix+'%''
							OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
							formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
							OR (
								SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC
							) LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF( 
							(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
							WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
							FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
						) '
	END

	SET @groupByClause = @groupByClause + N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,
		tbl_serviceForm.FormName,tbl_company.CompanyName,
		tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
		tbl_serviceRequest.Status,tbl_serviceRequest.StepId,tbl_serviceFormFieldValue.RMTeamId '

	SET @orderByClause = N' ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) '
			+ 'ASC '
		END
			
		IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) '
			+ 'ASC ' 
		END

		IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) '
			+ ' DESC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE (SELECT FirstName +'' ''+LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId)  ' +
			'END ASC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE (SELECT FirstName +'' ''+LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId)  ' +
			'END DESC ' 
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
			+ ' ASC '
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+ ' DESC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForm.FormName'
			+' ASC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForm.FormName'
			+ ' DESC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC) '
			+' ASC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC) '
			+ ' DESC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF( 
				(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
				FOR XML PATH ('''')), 1, 1, '''')) '
			+' ASC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF( 
				(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
				FOR XML PATH ('''')), 1, 1, '''')) '
			+ ' DESC '
		END

		SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

		SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

		EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
										,@CompanyId,@SalesPersonId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationCount NULL,N'24-08-2022',NULL,9
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationCount]
	@Status INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
		SELECT	
			ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_serviceRequest.ServiceId  
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm WITH(NOLOCK)  ON tbl_serviceFormFieldValue.FormId = tbl_serviceForm.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_serviceFormFieldValue.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK)  ON  tbl_serviceFormFieldValue.UserId = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
	 AND (tbl_serviceRequest.IsDelete <> 1) 
	 AND tbl_serviceRequest.Id = 
								(SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber AND b.IsDelete <> 1 
								ORDER BY b.StepId DESC 
								) 
	AND tbl_service.IsCompanyService <> 0 '

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
							OR tbl_serviceForm.FormName LIKE ''%'+@searchPrefix+'%''
							OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
							formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
							OR (
								SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC
							) LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF( 
							(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
							WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
							FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
						) '
	END

	SET @groupByClause = @groupByClause + N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,
		tbl_serviceForm.FormName,tbl_company.CompanyName,
		tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
		tbl_serviceRequest.Status,tbl_serviceRequest.StepId,tbl_serviceFormFieldValue.RMTeamId '

		SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


		EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
										,@CompanyId,@SalesPersonId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationTempTable]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationTempTable NULL,2,NULL,0,50,N'',N'Created By','asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationTempTable]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@RMTeamId INT = NULL,
	@skipRows INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
			ISNULL(tbl_serviceRequest.SerialNumber,''N/A'') AS SerialNumber,
			ISNULL(tbl_serviceRequest.RequestedBy,''N/A'') AS RequestedBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105),''N/A'') AS CreatedOn,
			ISNULL(tbl_serviceRequest.CompanyName,''N/A'') AS CompanyName,
			ISNULL(tbl_serviceRequest.RequestedService,''N/A'') AS RequestedService,
			ISNULL(tbl_serviceRequest.Status,''N/A'') AS Status,
			ISNULL(tbl_serviceRequest.AssignedUser,''N/A'') AS AssignedUser
		FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id 
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceRequest.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL) 
	'

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @RMTeamId IS NOT NULL AND @RMTeamId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_RMTeam.Id = @RMTeamId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.Status LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%''
							OR CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @groupByClause = N' GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceRequest.RequestedBy,tbl_serviceRequest.CreatedOn,tbl_serviceRequest.CompanyName,
	tbl_serviceRequest.RequestedService,tbl_serviceRequest.Status,tbl_serviceRequest.AssignedUser,tbl_serviceRequest.SerialCode
	'

	SET @orderByClause = N' ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode '
			+ 'ASC '
		END
			
		IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode '
			+ 'ASC ' 
		END

		IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode '
			+ ' DESC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy ASC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy DESC ' 
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn '
			+ ' ASC '
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+ ' DESC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+' ASC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+ ' DESC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.Status '
			+' ASC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.Status '
			+ ' DESC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser '
			+' ASC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser '
			+ ' DESC '
		END

		SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

		SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


		EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@RMTeamId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
										,@CompanyId,@SalesPersonId,@RMTeamId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationTempTableCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationTempTableCount NULL,2,NULL,N''
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServiceRequestByCompanyIdWithPaginationTempTableCount]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@RMTeamId INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
			DISTINCT tbl_serviceRequest.SerialNumber AS ServiceRequestCount
		FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceRequest.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL) 
	'

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @RMTeamId IS NOT NULL AND @RMTeamId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_RMTeam.Id = @RMTeamId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.Status LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%''
							OR CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%''
						) '
	END

		SET @selectQuery = @query +' '+ @conditions


		EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@RMTeamId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
										,@CompanyId,@SalesPersonId,@RMTeamId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyServicesRequestByCompanyId NULL,1,50,N'Dove','Created Date','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyId]
	@Status INT = NULL,
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
		
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

		SET @query = N'
					SELECT ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber,
					ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
					ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService, 
					ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
					CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
					THEN 
						ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
					ELSE 
						ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') 
					END AS RequestedBy, 
					ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn,
					ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
					ISNULL(
						(
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						)
					,''N/A'') AS Status,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_assignUser1.FirstName +'' ''+tbl_assignUser1.LastName,''N/A'') 
								FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
								WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
					ISNULL((SELECT TOP(1) 
						ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,''N/A'') AS AssignOn,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson
				 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
				 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
				 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
				 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
				 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
				 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
				 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson  WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId'

	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
				' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
				' AND (tbl_serviceRequest.IsDelete <> 1) '+
				' AND tbl_service.IsCompanyService <> 0 '+
				' AND tbl_serviceRequest.Id = 
							(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								AND b.IsDelete <> 1
								ORDER BY b.StepId DESC
							)' 
	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)'
	END

	IF @searchPrefix IS NOT NULL
	BEGIN
		SET @conditions = @conditions + ' AND (
						@searchPrefix IS NULL
						OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
						OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
						OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
						OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
						OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
						OR (
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						) LIKE ''%'+@searchPrefix+'%'' 
						OR (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
						OR (SELECT TOP(1) 
						ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''  
						OR (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''') 
						) LIKE ''%'+@searchPrefix+'%'' 
					)
				'
	END

	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	SET @orderByClause = N'ORDER BY ' 

				IF @sortColumn IS NULL OR @sortColumn = ''
					BEGIN
						SET @orderByClause = @orderByClause 
						+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
						+ ' ASC'
					END

				IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' ASC'
				END

				IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' DESC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END ASC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END DESC'
				END

				IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' ASC'
				END

				IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+' ASC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+' ASC'
				END

				IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+ ' DESC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+' ASC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+ ' DESC'
				END

				IF @sortColumn = 'Status' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
										LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										AND tbl_request.Status = tbl_serviceRequest.Status
										AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
										ORDER BY tbl_serviceRequest.StepId DESC) '
					+' ASC '
				END

				IF @sortColumn = 'Status' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
										LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										AND tbl_request.Status = tbl_serviceRequest.Status
										AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
										ORDER BY tbl_serviceRequest.StepId DESC) '
					+ ' DESC '
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) '
					+' ASC '
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) '
					+ ' DESC '
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''')
						) '
					+' ASC '
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''')
						) '
					+ ' DESC '
				END

	SET @pagination = 'OFFSET @PageNumber ROWS
					   FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+@conditions +' ' +@groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@PageNumber INT,@RowsOfPage INT',@searchPrefix,@Status,@PageNumber,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyId_TEST]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyServicesRequestByCompanyId_TEST NULL,NULL,NULL,1,50,N'','Created Date','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyId_TEST]
	@Status INT = NULL,
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
		
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

		SET @query = N'
					SELECT ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber,
					ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
					ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService, 
					ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
					CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
					THEN 
						ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
					ELSE 
						ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') 
					END AS RequestedBy, 
					ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn,
					ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
					ISNULL(
						(
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						)
					,''N/A'') AS Status,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_assignUser1.FirstName +'' ''+tbl_assignUser1.LastName,''N/A'') 
								FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
								WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
					ISNULL((SELECT TOP(1) 
						ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,''N/A'') AS AssignOn,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson
				 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
				 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
				 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
				 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
				 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
				 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
				 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson  WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId'

	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
				' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
				' AND (tbl_serviceRequest.IsDelete <> 1) '+
				' AND tbl_service.IsCompanyService <> 0 '+
				' AND (@SearchPrefix IS NULL '+
				' OR tbl_serviceFormFieldValue.SerialNumber LIKE @SearchPrefix +''%''' +
				' OR tbl_Company.CompanyName LIKE ''%'' + @SearchPrefix +''%''' +
				' OR tbl_serviceCreatedBy.FirstName LIKE ''%''+ @SearchPrefix +''%''' +
				' OR tbl_serviceCreatedBy.LastName LIKE ''%''+ @SearchPrefix +''%''' +
				' OR tbl_serviceForms.FormName LIKE ''%''+ @SearchPrefix +''%''' +
				' OR tbl_assignUser.FirstName LIKE ''%''+ @SearchPrefix +''%''' +
				' OR tbl_assignUser.LastName LIKE ''%''+ @SearchPrefix +''%''' +
				' OR CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105)  LIKE ''%''+ @SearchPrefix +''%'')'+
				'AND tbl_serviceRequest.Id = 
							(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								AND b.IsDelete <> 1
								ORDER BY b.StepId DESC
							)' 
	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)'
	END


	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	SET @orderByClause = N'ORDER BY ' 

				IF @sortColumn IS NULL OR @sortColumn = ''
					BEGIN
						SET @orderByClause = @orderByClause 
						+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
						+ ' ASC'
					END

				IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' ASC'
				END

				IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' DESC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END ASC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END DESC'
				END

				IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' ASC'
				END

				IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+' ASC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+' ASC'
				END

				IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+ ' DESC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+' ASC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+ ' DESC'
				END

	SET @pagination = 'OFFSET (@PageNumber-1)*@RowsOfPage ROWS
					   FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+@conditions +' ' +@groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@PageNumber INT,@RowsOfPage INT',@searchPrefix,@Status,@PageNumber,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyIdCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyServicesRequestByCompanyIdCount 4,N'',3,1,50,N'',N'SR No.',N'asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyIdCount]
	@Status INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
				SELECT ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber
			 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
			 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
			 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
			 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
			 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
			 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
			 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
			 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id'

		SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
					' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
					' AND (tbl_serviceRequest.IsDelete <> 1) '+
					' AND tbl_service.IsCompanyService <> 0 '+
					'AND tbl_serviceRequest.Id = 
								(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
									WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
									AND b.IsDelete <> 1
									ORDER BY b.StepId DESC
								)' 

		IF @searchPrefix IS NOT NULL
		BEGIN
			SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
							OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
							OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
							formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
							OR (
								SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC
							) LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF( 
							(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
							WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
							FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT TOP(1) 
							ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
							WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''  
							OR (
								SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
								WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
								WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
								FOR XML PATH ('''')), 1, 1, '''') 
							) LIKE ''%'+@searchPrefix+'%'' 
						)
					'
		END

		IF @Status = 0
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
		END

		IF @Status = 3
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
		END

		IF @Status = 4
		BEGIN 
			SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)'
		END


		SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber'

		SET @selectQuery = @query +' '+@conditions +' ' +@groupByClause

		EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT',@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyIdCount_TEST]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyServicesRequestByCompanyIdCount_TEST 4,N'',3,1,50,N'',N'SR No.',N'asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyIdCount_TEST]
	@Status INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
				SELECT ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber
			 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
			 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
			 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
			 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
			 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
			 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
			 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
			 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id'

		SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
					' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
					' AND (tbl_serviceRequest.IsDelete <> 1) '+
					' AND tbl_service.IsCompanyService <> 0 '+
					'AND tbl_serviceRequest.Id = 
								(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
									WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
									AND b.IsDelete <> 1
									ORDER BY b.StepId DESC
								)' 

		IF @searchPrefix IS NOT NULL OR @searchPrefix != ''
		BEGIN
			SET @conditions = @conditions + 'AND (tbl_serviceFormFieldValue.SerialNumber LIKE @SearchPrefix +''%''' +
					' OR tbl_Company.CompanyName LIKE ''%'' + @SearchPrefix +''%''' +
					' OR tbl_serviceCreatedBy.FirstName LIKE ''%''+ @SearchPrefix +''%''' +
					' OR tbl_serviceCreatedBy.LastName LIKE ''%''+ @SearchPrefix +''%''' +
					' OR tbl_serviceForms.FormName LIKE ''%''+ @SearchPrefix +''%''' +
					' OR tbl_assignUser.FirstName LIKE ''%''+ @SearchPrefix +''%''' +
					' OR tbl_assignUser.LastName LIKE ''%''+ @SearchPrefix +''%''' +
					' OR CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105)  LIKE ''%''+ @SearchPrefix +''%'')'
		END

		IF @Status = 0
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
		END

		IF @Status = 3
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
		END

		IF @Status = 4
		BEGIN 
			SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)'
		END


		SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber'

		SET @selectQuery = @query +' '+@conditions +' ' +@groupByClause

		EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT',@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyIdWithFilter]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllCompanyServicesRequestByCompanyIdWithFilter NULL
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCompanyServicesRequestByCompanyIdWithFilter]
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
		
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

		SET @query = N'
					SELECT DISTINCT ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber,
					CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))) AS SerialNo,
					ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
					ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService, 
					ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
					CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
					THEN 
						ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
					ELSE 
						ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') 
					END AS RequestedBy, 
					ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn,
					(SELECT TOP 1 CONVERT(date,formField.CreatedOn) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ) AS CreatedOnUTC,
					ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
					ISNULL(
						(
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						)
					,''N/A'') AS Status,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_assignUser1.FirstName +'' ''+tbl_assignUser1.LastName,''N/A'') 
								FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
								WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
					ISNULL((SELECT TOP(1) 
						ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,''N/A'') AS AssignOn,
					(SELECT TOP(1) 
					CONVERT(date,tbl_assign1.CreatedOn) FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) AS AssignOnUTC,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson
				 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
				 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
				 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
				 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
				 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
				 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
				 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson  WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId'

	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
				' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
				' AND (tbl_serviceRequest.IsDelete <> 1) '+
				' AND tbl_service.IsCompanyService <> 0 '+
				'AND tbl_serviceRequest.Id = 
							(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								AND b.IsDelete <> 1
								ORDER BY b.StepId DESC
							)' 
	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)'
	END

	SET @selectQuery = @query +' '+@conditions

	EXEC SP_EXECUTESQL @selectQuery,N'@Status INT',@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllCurrentEmployeeServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- EXEC USP_Admin_GetAllCurrentEmployeeServicesRequestByCompanyId 1,10,null,'Created By','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllCurrentEmployeeServicesRequestByCompanyId]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	IF OBJECT_ID(N'tempdb..#allServiceRequest') IS NOT NULL BEGIN	DROP TABLE #allServiceRequest END
	
	SELECT DISTINCT ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForms.FormName,'N/A') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName, 
		ISNULL((SELECT tbl_serviceFormFieldValues.FieldValue FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues 
		LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
			WHERE tbl_serviceformField.FieldName LIKE '%Applicant Name%'
			AND tbl_serviceFormFieldValues.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber),'N/A') AS ApplicantName,
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName,'N/A')
		ELSE 
			ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName ,'N/A') 
		END AS RequestedBy, 
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),'N/A') AS CreatedOn,
		ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
		ISNULL(
			tbl_serviceRequestStatus.Status
		,'N/A') AS Status,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
					FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('')), 1, 1, ''),'N/A') AS AssignedUser, 
		ISNULL((SELECT TOP(1) 
			ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
			WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,'N/A') AS AssignOn,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
		WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
		WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
		FOR XML PATH ('')), 1, 1, ''),'N/A') AS SalesPerson
		INTO #allServiceRequest
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId
		WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
		AND (tbl_serviceRequest.IsDelete <> 1)  AND tbl_service.IsEmployeeService <> 0 AND tbl_serviceRequest.Id = 
						(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
							WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							AND b.IsDelete <> 1
							ORDER BY b.StepId DESC )
		AND (@searchPrefix IS NULL 
			OR tbl_serviceFormFieldValue.SerialNumber LIKE @searchPrefix +'%'
			OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceForms.FormName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceRequestStatus.Status LIKE '%' + @searchPrefix +'%')

	SET @orderByClause = N'ORDER BY ' 
			
	IF @sortColumn = '' OR @sortColumn IS NULL
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' DESC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' ASC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' DESC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' ASC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+' ASC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+' ASC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+ ' DESC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+' ASC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+ ' DESC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+' ASC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+ ' DESC'
	END

	SET @pagination = ' OFFSET (@PageNumber-1)*@RowsOfPage ROWS
						FETCH NEXT @RowsOfPage ROWS ONLY'
	
	SET @selectQuery = 'select * from #allServiceRequest ' +@orderByClause +' '+@pagination
	
	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@PageNumber INT,@RowsOfPage INT',@searchPrefix,@PageNumber,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeAssignedServiceRequest 316,NULL,0,20,NULL,NULL,'SR No.','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequest]
	@UserId INT = NULL,
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
			SELECT ISNULL(tbl_assignRequest.SerialNumber,''N/A'') AS SerialNumber,
			ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService,
			ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
			ELSE 
				ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'')
			END AS RequestedBy,
			ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] formField 
			WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber ),''N/A'') AS CreatedOn,
			ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
			ISNULL(
				(
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					AND tbl_request.Status = tbl_serviceRequest.Status
					AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
					ORDER BY tbl_serviceRequest.StepId DESC
				)
			,''N/A'') AS Status,
			ISNULL(STUFF(
			(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
			WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
			FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
			ISNULL(STUFF(
			(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
			WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
			FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson 
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignRequest.UserId = tbl_assignUser.Id	
			LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue ON tbl_assignRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id	
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id	
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId	
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 	
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
		AND tbl_serviceRequest.Id = 
			(   
				SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
			    WHERE b.SerialNumber = tbl_assignRequest.SerialNumber 
			    AND b.IsDelete <> 1 
			    ORDER BY b.StepId DESC 
			) 
		AND tbl_serviceRequest.IsDelete <> 1  
		AND tbl_service.IsEmployeeService <> 0 
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL 
	BEGIN
		
		SET @conditions = @conditions + ' AND (
					@searchPrefix IS NULL 
					OR tbl_assignRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
					OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
					OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
					OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'') 
					OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
					OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM 
					[dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
						WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
				) '

	END
	
	SET @groupByClause =  N'
				GROUP BY tbl_assignRequest.SerialNumber,tbl_serviceForms.FormName,tbl_company.CompanyName,
				tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
				tbl_serviceRequest.Status,tbl_serviceRequest.CompanyId,tbl_serviceRequest.Status,tbl_serviceRequest.CreatedOn,
				tbl_salesPerson.FirstName,tbl_salesPerson.LastName,tbl_serviceRequest.StepId 
			'

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_assignRequest.SerialNumber,CHARINDEX(''R'',tbl_assignRequest.SerialNumber)+1,LEN(tbl_assignRequest.SerialNumber))))'
			+ ' ASC '
		END
			
		IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_assignRequest.SerialNumber,CHARINDEX(''R'',tbl_assignRequest.SerialNumber)+1,LEN(tbl_assignRequest.SerialNumber))))'
			+ ' ASC ' 
		END

		IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_assignRequest.SerialNumber,CHARINDEX(''R'',tbl_assignRequest.SerialNumber)+1,LEN(tbl_assignRequest.SerialNumber))))'
			+ ' DESC '
		END
		
		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
			'END ASC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
			'END DESC ' 
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber)'
			+ ' ASC '
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber)'
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+ ' DESC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForms.FormName'
			+' ASC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForms.FormName'
			+ ' DESC '
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+' ASC '
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+ ' DESC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
					WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+' ASC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF(
					(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
					WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+ ' DESC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					AND tbl_request.Status = tbl_serviceRequest.Status
					AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
					ORDER BY tbl_serviceRequest.StepId DESC
				) '
			+' ASC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
					AND tbl_request.Status = tbl_serviceRequest.Status
					AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
					ORDER BY tbl_serviceRequest.StepId DESC
				) '
			+ ' DESC '
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT tbl_serviceFormFieldValues.FieldValue
				FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues
				LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
				WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
				AND tbl_serviceFormFieldValues.SerialNumber = tbl_assignRequest.SerialNumber) '
			+' ASC '
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT tbl_serviceFormFieldValues.FieldValue
				FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues
				LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
				WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
				AND tbl_serviceFormFieldValues.SerialNumber = tbl_assignRequest.SerialNumber) '
			+ ' DESC '
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@UserId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeAssignedServiceRequestCount 3,NULL
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequestCount]
	@UserId INT = NULL,
	@Status INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT ISNULL(tbl_assignRequest.SerialNumber,''N/A'') AS SerialNumber
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignRequest.UserId = tbl_assignUser.Id	
			LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue ON tbl_assignRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber 
			LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id	
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id	
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId	
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 	
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
		AND tbl_serviceRequest.Id = 
			(   
				SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
			    WHERE b.SerialNumber = tbl_assignRequest.SerialNumber 
			    AND b.IsDelete <> 1 
			    ORDER BY b.StepId DESC 
			) 
		AND tbl_serviceRequest.IsDelete <> 1  
		AND tbl_service.IsEmployeeService <> 0 
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL 
	BEGIN
		
		SET @conditions = @conditions + ' AND (
					@searchPrefix IS NULL 
					OR tbl_assignRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
					OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
					OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
					OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'') 
					OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
					OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM 
					[dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_assignRequest.SerialNumber) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_assignRequest.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'' 
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_assignRequest.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
					OR (
						SELECT STUFF(
						(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
						WHERE tbl_companyMapping.CompanyId = tbl_serviceRequest.CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('''')), 1, 1, '''')
					) LIKE ''%'+@searchPrefix+'%''  
				) '

	END
	
	SET @groupByClause =  N'
				GROUP BY tbl_assignRequest.SerialNumber,tbl_serviceForms.FormName,tbl_company.CompanyName,
				tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
				tbl_serviceRequest.Status,tbl_serviceRequest.CompanyId,tbl_serviceRequest.Status,tbl_serviceRequest.CreatedOn,
				tbl_salesPerson.FirstName,tbl_salesPerson.LastName,tbl_serviceRequest.StepId 
			
			'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
	,@UserId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequestToDIBNTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Company service request from temp table
-- USP_Admin_GetAllEmployeeAssignedServiceRequestToDIBNTeam 316,NULL,40,20,N'','',N'',N''
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequestToDIBNTeam]
	@UserId INT = NULL,
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT  
				ISNULL(tbl_serviceRequest.SerialNumber,''N/A'') AS SerialNumber,
				ISNULL(tbl_serviceRequest.RequestedService,''N/A'') AS RequestedService,
				ISNULL(tbl_serviceRequest.CompanyName,''N/A'') AS CompanyName,
				ISNULL(tbl_serviceRequest.RequestedBy,''N/A'') AS RequestedBy,
				ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105),''N/A'') AS CreatedOn,
				ISNULL(tbl_serviceRequest.Status,''N/A'') AS Status,
				ISNULL(tbl_serviceRequest.AssignedUser,''N/A'') AS AssignedUser,
				ISNULL(tbl_serviceRequest.SalesPerson,''N/A'') AS SalesPerson,
				ISNULL(tbl_serviceRequest.ApplicantName,''N/A'') AS ApplicantName
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id		
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
		AND tbl_serviceRequest.IsDelete <> 1  
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) = '''+@searchPrefix+''''
		END
		IF @searchBy = 'Applicant Name'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.ApplicantName LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Serial Number' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode'
			+ ' ASC'
		END

		IF @sortColumn = 'Serial Number' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode'
			+ ' DESC'
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy ASC'
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy DESC'
		END

		IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn'
			+ ' ASC'
		END

		IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+' ASC'
		END

		IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+ ' DESC'
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SalesPerson'
			+ ' ASC'
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SalesPerson'
			+ ' DESC'
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser'
			+ ' ASC'
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser'
			+ ' DESC'
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.ApplicantName'
			+ ' ASC'
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.ApplicantName'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@UserId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequestToDIBNTeamCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllAdminEmployeeServicesRequestFromTempTable
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Get all Company service request from temp table
-- USP_Admin_GetAllEmployeeAssignedServiceRequestToDIBNTeamCount 316,NULL,N'',N''
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeAssignedServiceRequestToDIBNTeamCount]
	@UserId INT = NULL,
	@Status INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
			SELECT DISTINCT
				COUNT(*) AS ServiceRequestCount
			FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
			LEFT JOIN [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 	
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id		
		'
	SET @conditions = N'
		WHERE tbl_assignRequest.UserId = @UserId 
		AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
		AND tbl_serviceRequest.IsDelete <> 1  
	'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceRequest.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.SalesPerson LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned User(s)'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created Date'
		BEGIN
			SET @conditions = @conditions + ' AND CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) = '''+@searchPrefix+''''
		END
		IF @searchBy = 'Applicant Name'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceRequest.ApplicantName LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @selectQuery = @query +' '+ @conditions

	EXEC SP_EXECUTESQL @selectQuery,N'@UserId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
	,@UserId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeesDetailsForExport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<USP_Admin_GetAllEmployeesDetailsForExport 1>
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeesDetailsForExport]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RoleId INT = NULL;

	SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')


	SELECT DISTINCT
		ISNULL(tbl_user.AccountNumber,'N/A') AS [Account No],
		ISNULL(tbl_user.FirstName,'N/A') AS [First Name],
		ISNULL(tbl_user.LastName,'N/A') AS [Last Name],
		ISNULL(tbl_company.CompanyName,'N/A') AS Company,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS Email,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS [Phone No],
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS [Country],
		ISNULL(tbl_user.PassportNumber,'N/A') AS [Passport No],
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),'N/A') AS [Passport Expiry],
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),'N/A') AS [Visa Expiry],
		ISNULL(tbl_user.IsActive,0) AS [Is Active]
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_user.Id = tbl_company_user_mapping.UserId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
	WHERE (tbl_user.IsDelete <> 1 AND tbl_company_user_mapping.IsDelete <> 1) 
	AND tbl_user.AccountNumber <> 'TBC01'
	AND tbl_company_user_mapping.CompanyId <> 1
	AND (tbl_company_user_mapping.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
	AND tbl_user_role_mapping.RoleID <> @RoleId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeesDetailsForExport_Cmp]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<USP_Admin_GetAllEmployeesDetailsForExport 7>
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeesDetailsForExport_Cmp]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RoleId INT = NULL;

	SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')


	SELECT DISTINCT
		ISNULL(tbl_user.AccountNumber,'N/A') AS [Account No],
		ISNULL(tbl_user.FirstName,'N/A') AS [First Name],
		ISNULL(tbl_user.LastName,'N/A') AS [Last Name],
		ISNULL(tbl_company.CompanyName,'N/A') AS Company,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS Email,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS [Phone No],
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS [Country],
		ISNULL(tbl_user.PassportNumber,'N/A') AS [Passport No],
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),'N/A') AS [Passport Expiry],
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),'N/A') AS [Visa Expiry],
		ISNULL(tbl_user.IsActive,0) AS [Is Active]
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_user.Id = tbl_company_user_mapping.UserId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
	WHERE (tbl_user.IsDelete <> 1 OR tbl_company_user_mapping.IsDelete <> 1) 
	AND tbl_company_user_mapping.CompanyId = @CompanyId
	AND tbl_user_role_mapping.RoleID <> @RoleId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeesDetailsForExportMainCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<USP_Admin_GetAllEmployeesDetailsForExportMainCompany 1>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeesDetailsForExportMainCompany]
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RoleId INT = NULL;

	SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')


	SELECT DISTINCT
		ISNULL(tbl_user.AccountNumber,'N/A') AS [Account No],
		ISNULL(tbl_user.FirstName,'N/A') AS [First Name],
		ISNULL(tbl_user.LastName,'N/A') AS [Last Name],
		ISNULL(tbl_company.CompanyName,'N/A') AS Company,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS Email,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS [Phone No],
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS [Country],
		ISNULL(tbl_user.PassportNumber,'N/A') AS [Passport No],
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),'N/A') AS [Passport Expiry],
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),'N/A') AS [Visa Expiry],
		ISNULL(tbl_user.IsActive,0) AS [Is Active]
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_user.Id = tbl_company_user_mapping.UserId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
	WHERE (tbl_user.IsDelete <> 1 AND tbl_company_user_mapping.IsDelete <> 1) 
	AND tbl_user.AccountNumber <> 'TBC01'
	AND tbl_company_user_mapping.CompanyId = 1
	AND tbl_user_role_mapping.RoleID <> @RoleId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServiceByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<USP_Admin_GetAllEmployeeServiceByCompanyId 275,1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServiceByCompanyId]
	@CompanyId INT = NULL,
	@ParentId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @CompanyType NVARCHAR(MAX)= NULL;
	SET @CompanyType = (SELECT CompanyType FROM [dbo].[Tbl_Company] WHERE Id=@CompanyId AND IsDelete <> 1 AND IsActive <> 0)
	SELECT 
		tbl_service.ServiceId AS ID,
		ISNULL(tbl_employeeservice.ParentId,0) AS ParentId,
		ISNULL(tbl_employeeservice.CompanyType,'N/A') AS CompanyType,
		CASE WHEN tbl_service.DisplayName IS NULL THEN 
				ISNULL(tbl_employeeservice.ServiceName,'N/A')
			ELSE
				ISNULL(tbl_service.DisplayName,'N/A')
		END AS ServiceName,
		ISNULL(tbl_service.FormConstrains,'N/A') AS FormConstrain,
		ISNULL(tbl_service.HasMultipleForms,0) AS HasMultipleForms,
		ISNULL(tbl_service.IsActive,0) AS IsActive,
		ISNULL(tbl_service.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
		tbl_service.AllowDisplay
	FROM [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_EmployeeServices] tbl_employeeservice ON tbl_service.ServiceId = tbl_employeeservice.ID
	WHERE tbl_employeeservice.IsDelete <> 1 
	and tbl_employeeservice.IsActive <> 0 
	AND tbl_service.IsActive <> 0 
	AND tbl_service.IsEmployeeService <> 0 
	AND (tbl_service.AllowDisplay <> 0 OR tbl_service.AllowDisplay IS NULL)
	AND tbl_employeeservice.CompanyType = @CompanyType
	AND tbl_employeeservice.ParentId = @ParentId
	ORDER BY HasMultipleForms
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPagination N'',128,0,1,50,N'',N'SR No.',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyId]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@PageNumber  INT = 0,
	@RowsOfPage INT = 0,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status IS NULL
	BEGIN
		SELECT	
			ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
			ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.CreatedBy )
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceFormFieldValue.ServiceId = tbl_serviceRequest.ServiceId 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceFormFieldValue.FormId = tbl_serviceForm.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_serviceFormFieldValue.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_company.Id = tbl_mapping.CompanyId
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id
		WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL) 
		AND (tbl_salesPerson.Id = @SalesPersonId OR @SalesPersonId IS NULL)
		AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
		AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL)
		AND (tbl_serviceRequest.IsDelete <> 1)
		AND tbl_serviceRequest.Id IN
			(   SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				GROUP BY b.SerialNumber
			)
		AND tbl_service.IsEmployeeService <> 0
		GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
		tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceFormFieldValue.CreatedBy
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithCount NULL,234,NULL
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithCount]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
			ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_serviceRequest.ServiceId  
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm WITH(NOLOCK)  ON tbl_serviceFormFieldValue.FormId = tbl_serviceForm.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_serviceFormFieldValue.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK)  ON  tbl_serviceFormFieldValue.UserId = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
	 AND (tbl_serviceRequest.IsDelete <> 1) 
	 AND tbl_serviceRequest.Id = 
								(SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber AND b.IsDelete <> 1 
								ORDER BY b.StepId DESC 
								) 
	AND tbl_service.IsEmployeeService <> 0 '

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
							OR tbl_serviceForm.FormName LIKE ''%'+@searchPrefix+'%''
							OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
							formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
							OR (
								SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC
							) LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF( 
							(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
							WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
							FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
						) '
	END


	SET @groupByClause = @groupByClause + N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,
		tbl_serviceForm.FormName,tbl_company.CompanyName,
		tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
		tbl_serviceRequest.Status,tbl_serviceRequest.StepId,tbl_serviceFormFieldValue.RMTeamId '


	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 


	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
									,@CompanyId,@SalesPersonId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPagination NULL,2,NULL,0,50,N'Te',N'SR No.',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPagination]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@skipRows  INT = 0,
	@RowsOfPage INT = 0,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
		ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber, 
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForm.FormName,''N/A'') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
		CASE WHEN (((tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0) 
		AND (tbl_serviceFormFieldValue.RMTeamId IS NULL OR tbl_serviceFormFieldValue.RMTeamId = 0)))
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'') 
		WHEN tbl_serviceFormFieldValue.RMTeamId IS NOT NULL OR tbl_serviceFormFieldValue.RMTeamId <> 0
		THEN 
			(SELECT ISNULL(FirstName +'' ''+ LastName,''N/A'') FROM [dbo].[Tbl_RMTeam] WHERE Id = tbl_serviceFormFieldValue.RMTeamId)
		ELSE 
			(SELECT FirstName +'' ''+LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId) 
		END AS RequestedBy,
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] formField 
		WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn, 
		ISNULL(tbl_serviceRequest.Status,0) AS StatusId, 
		ISNULL( 
			( 
				SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)  
				LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK)  ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status 
				WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status 
				AND tbl_request.Status = tbl_serviceRequest.Status 
				AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
				ORDER BY tbl_serviceRequest.StepId DESC 
			)
		,''N/A'') AS Status, 
		ISNULL(STUFF( 
		(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
		FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser 
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_serviceRequest.ServiceId  
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm WITH(NOLOCK)  ON tbl_serviceFormFieldValue.FormId = tbl_serviceForm.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  ON tbl_serviceFormFieldValue.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK)  ON  tbl_serviceFormFieldValue.UserId = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
	 AND (tbl_serviceRequest.IsDelete <> 1) 
	 AND tbl_serviceRequest.Id = 
								(SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK) 
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber AND b.IsDelete <> 1 
								ORDER BY b.StepId DESC 
								) 
	AND tbl_service.IsEmployeeService <> 0 '

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
							OR tbl_serviceForm.FormName LIKE ''%'+@searchPrefix+'%''
							OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
							formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
							OR (
								SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC
							) LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF( 
							(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
							WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
							FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%''						    
						) '
	END


	SET @groupByClause = @groupByClause + N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,
		tbl_serviceForm.FormName,tbl_company.CompanyName,
		tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName,
		tbl_serviceRequest.Status,tbl_serviceRequest.StepId,tbl_serviceFormFieldValue.RMTeamId '

	SET @orderByClause = N' ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) '
			+ 'ASC '
		END
			
		IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) '
			+ 'ASC ' 
		END

		IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber)))) '
			+ ' DESC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE (SELECT FirstName +'' ''+LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId)  ' +
			'END ASC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
			'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
			'ELSE (SELECT FirstName +'' ''+LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId)  ' +
			'END DESC ' 
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
			+ ' ASC '
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName'
			+ ' DESC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForm.FormName'
			+' ASC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceForm.FormName'
			+ ' DESC '
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT tbl_serviceFormFieldValues.FieldValue
				FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues
				LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
				WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
				AND tbl_serviceFormFieldValues.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) '
			+' ASC '
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT tbl_serviceFormFieldValues.FieldValue
				FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues
				LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
				WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
				AND tbl_serviceFormFieldValues.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) '
			+ ' DESC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC) '
			+' ASC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
								AND tbl_request.Status = tbl_serviceRequest.Status
								AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								ORDER BY tbl_serviceRequest.StepId DESC) '
			+ ' DESC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF( 
				(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
				FOR XML PATH ('''')), 1, 1, '''')) '
			+' ASC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF( 
				(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
				FOR XML PATH ('''')), 1, 1, '''')) '
			+ ' DESC '
		END

		SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

		SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

		PRINT @conditions


		EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
										,@CompanyId,@SalesPersonId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPaginationTempTable]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPaginationTempTable NULL,2,NULL,0,50,N'',N'Created By','asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPaginationTempTable]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@RMTeamId INT = NULL,
	@skipRows INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT	
			ISNULL(tbl_serviceRequest.SerialNumber,''N/A'') AS SerialNumber,
			ISNULL(tbl_serviceRequest.RequestedBy,''N/A'') AS RequestedBy,
			ISNULL(tbl_serviceRequest.ApplicantName,''N/A'') AS ApplicantName,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105),''N/A'') AS CreatedOn,
			ISNULL(tbl_serviceRequest.CompanyName,''N/A'') AS CompanyName,
			ISNULL(tbl_serviceRequest.RequestedService,''N/A'') AS RequestedService,
			ISNULL(tbl_serviceRequest.Status,''N/A'') AS Status,
			ISNULL(tbl_serviceRequest.AssignedUser,''N/A'') AS AssignedUser
		FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceRequest.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL) 
	'

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @RMTeamId IS NOT NULL AND @RMTeamId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_RMTeam.Id = @RMTeamId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.Status LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%''
							OR CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) = '''+@searchPrefix+'''
							OR tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.ApplicantName LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @groupByClause = N' GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceRequest.RequestedBy,tbl_serviceRequest.CreatedOn,tbl_serviceRequest.CompanyName,
	tbl_serviceRequest.RequestedService,tbl_serviceRequest.Status,tbl_serviceRequest.AssignedUser,tbl_serviceRequest.SerialCode,tbl_serviceRequest.ApplicantName
	'

	SET @orderByClause = N' ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode '
			+ 'ASC '
		END
			
		IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode '
			+ 'ASC ' 
		END

		IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.SerialCode '
			+ ' DESC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy ASC '
		END

		IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedBy DESC ' 
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn '
			+ ' ASC '
		END

		IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CreatedOn '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.CompanyName'
			+ ' DESC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+' ASC '
		END

		IF @sortColumn = 'Requested Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.RequestedService'
			+ ' DESC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.Status '
			+' ASC '
		END

		IF @sortColumn = 'Status' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.Status '
			+ ' DESC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser '
			+' ASC '
		END

		IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.AssignedUser '
			+ ' DESC '
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.ApplicantName '
			+' ASC '
		END

		IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_serviceRequest.ApplicantName '
			+ ' DESC '
		END

		SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

		SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


		EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@RMTeamId INT,@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
										,@CompanyId,@SalesPersonId,@RMTeamId,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPaginationTempTableCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-02-2023>
-- Description : Get Company Service Request By Company Id with Pagination	
-- USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPaginationTempTableCount NULL,2,NULL,N''
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServiceRequestByCompanyIdWithPaginationTempTableCount]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@RMTeamId INT = NULL,
	@SalesPersonId INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS ServiceRequestCount
		FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id  
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId 
		LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id  
	'

	SET @conditions = @conditions + N' WHERE (tbl_serviceRequest.CompanyId = @CompanyId OR @CompanyId IS NULL)  
	 AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
	 AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL) 
	'

	IF @SalesPersonId IS NOT NULL AND @SalesPersonId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_salesPerson.Id = @SalesPersonId '
	END

	IF @RMTeamId IS NOT NULL AND @RMTeamId != 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_RMTeam.Id = @RMTeamId '
	END

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 '
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.StatusId = 3 '
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL
							OR tbl_serviceRequest.SerialNumber LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.CompanyName LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.RequestedService LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.Status LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.AssignedUser LIKE ''%'+@searchPrefix+'%''
							OR CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105) = '''+@searchPrefix+'''
							OR tbl_serviceRequest.RequestedBy LIKE ''%'+@searchPrefix+'%''
							OR tbl_serviceRequest.ApplicantName LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @selectQuery = @query +' '+ @conditions 


	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@SalesPersonId INT,@RMTeamId INT,@searchPrefix NVARCHAR(MAX),@Status INT'
									,@CompanyId,@SalesPersonId,@RMTeamId,@searchPrefix,@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeServicesRequestByCompanyId NULL,0,20,N'DOVE SOFT TECHNOLOG',N'SR No.',N'desc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyId]
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
				SELECT tbl_serviceFormFieldValue.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
				ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService, 
				ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
				ELSE 
					ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') 
				END AS RequestedBy, 
				ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
					formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn,
				ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
				ISNULL(
					(
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					)
				,''N/A'') AS Status,
				ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_assignUser1.FirstName +'' ''+tbl_assignUser1.LastName,''N/A'') 
							FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
							WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
				ISNULL((SELECT TOP(1) 
				ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
				WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,''N/A'') AS AssignOn,
				ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
				WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
				WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
				FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson
			 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
			 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
			 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
			 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
			 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
			 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
			 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
			 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
			 AND tbl_companyMappings.CompanyId IS NOT NULL'

	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
				' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
				' AND (tbl_serviceRequest.IsDelete <> 1) '+
				' AND tbl_service.IsEmployeeService <> 0 '+
				'AND tbl_serviceRequest.Id = 
							(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								AND b.IsDelete <> 1
								ORDER BY b.StepId DESC
							) ' 

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL
	BEGIN
		SET @conditions = @conditions + ' AND (
						@searchPrefix IS NULL
						OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
						OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
						OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
						OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
						OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
						OR (
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						) LIKE ''%'+@searchPrefix+'%'' 
						OR (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
						OR (SELECT TOP(1) 
						ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''  
						OR (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''') 
						) LIKE ''%'+@searchPrefix+'%'' 
					)
				'
	END

	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	SET @orderByClause = N'ORDER BY ' 
				IF @sortColumn = '' OR @sortColumn IS NULL
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' ASC'
				END
			
				IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' ASC'
				END

				IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' DESC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END ASC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END DESC'
				END

				IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' ASC'
				END

				IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+' ASC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+' ASC'
				END

				IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+ ' DESC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+' ASC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+ ' DESC'
				END

				IF @sortColumn = 'Status' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
										LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										AND tbl_request.Status = tbl_serviceRequest.Status
										AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
										ORDER BY tbl_serviceRequest.StepId DESC) '
					+' ASC '
				END

				IF @sortColumn = 'Status' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
										LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
										AND tbl_request.Status = tbl_serviceRequest.Status
										AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
										ORDER BY tbl_serviceRequest.StepId DESC) '
					+ ' DESC '
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) '
					+' ASC '
				END

				IF @sortColumn = 'Assigned User(s)' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) '
					+ ' DESC '
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''')
						) '
					+' ASC '
				END

				IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''')
						) '
					+ ' DESC '
				END

				IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT tbl_serviceFormFieldValues.FieldValue
						FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues
						LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
						WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
						AND tbl_serviceFormFieldValues.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) '
					+' ASC '
				END

				IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT tbl_serviceFormFieldValues.FieldValue
						FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues
						LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
						WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
						AND tbl_serviceFormFieldValues.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) '
					+ ' DESC '
				END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyId_TEST]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeServicesRequestByCompanyId_TEST NULL,3,20,N'',N'',N'Serial Number',N'desc'
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyId_TEST]
	@Status INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
				SELECT 
				tbl_serviceFormFieldValue.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
				ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService, 
				ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
				ELSE 
					ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') 
				END AS RequestedBy, 
				ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
					formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),''N/A'') AS CreatedOn,
				ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
				ISNULL(
					(
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					)
				,''N/A'') AS Status,
				ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_assignUser1.FirstName +'' ''+tbl_assignUser1.LastName,''N/A'') 
							FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
							WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
				ISNULL((SELECT TOP(1) 
				ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
				WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,''N/A'') AS AssignOn,
				ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
				WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
				WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
				FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson
			 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
			 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
			 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
			 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
			 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
			 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
			 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
			 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
			 AND tbl_companyMappings.CompanyId IS NOT NULL'

	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
				' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
				' AND (tbl_serviceRequest.IsDelete <> 1) '+
				' AND tbl_service.IsEmployeeService <> 0 '+
				' AND tbl_serviceRequest.Id = 
							(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								AND b.IsDelete <> 1
								ORDER BY b.StepId DESC
							) ' 

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceFormFieldValue.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceFormFieldValue.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
			OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'')'
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_companySales.FirstName = (SELECT TOP 1 FirstName 
			FROM [dbo].[Tbl_SalesPersons] tbl_sales 
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id 
			WHERE (tbl_sales.FirstName LIKE '''+@searchPrefix+'%'' AND tbl_mapping.CompanyId = 
			tbl_company.Id AND tbl_mapping.SalesPersonId = tbl_sales.Id)))'
		END
		IF @searchBy = 'Assigned By'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_assignUser.FirstName = (SELECT TOP 1 FirstName 
			FROM [dbo].[Tbl_User] tbl_mapping
			WHERE (tbl_mapping.FirstName LIKE '''+@searchPrefix+'%'' AND tbl_mapping.Id = tbl_assign.UserId)))'
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned Date'
		BEGIN
			SET @conditions = @conditions + ' AND (SELECT TOP(1) Convert(NVARCHAR(50),tbl_assign1.CreatedOn,105) FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	SET @orderByClause = N'ORDER BY ' 
				IF @sortColumn = '' OR @sortColumn IS NULL
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' ASC'
				END
			
				IF @sortColumn = 'Serial Number' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' ASC'
				END

				IF @sortColumn = 'Serial Number' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_serviceFormFieldValue.SerialNumber,CHARINDEX(''R'',tbl_serviceFormFieldValue.SerialNumber)+1,LEN(tbl_serviceFormFieldValue.SerialNumber))))'
					+ ' DESC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END ASC'
				END

				IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0 '+
					'THEN ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName ,''N/A'')' +
					'ELSE ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') ' +
					'END DESC'
				END

				IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' ASC'
				END

				IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP 1 formField.CreatedOn FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+' ASC'
				END

				IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' (SELECT TOP(1) tbl_assign1.CreatedOn FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber)'
					+ ' DESC'
				END

				IF @sortColumn = 'Company' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+' ASC'
				END

				IF @sortColumn = 'Company' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_company.CompanyName'
					+ ' DESC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+' ASC'
				END

				IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
				BEGIN
					SET @orderByClause = @orderByClause 
					+ ' tbl_serviceForms.FormName'
					+ ' DESC'
				END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@skipRows INT,@RowsOfPage INT'
	,@searchPrefix,@Status,@skipRows,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyIdCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeServicesRequestByCompanyIdCount 3,NULL
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyIdCount]
	@Status INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
				SELECT tbl_serviceFormFieldValue.SerialNumber AS SerialNumber
			 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
			 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
			 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
			 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
			 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
			 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
			 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
			 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
			 AND tbl_companyMappings.CompanyId IS NOT NULL'
	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
			' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
			' AND (tbl_serviceRequest.IsDelete <> 1) '+
			' AND tbl_service.IsEmployeeService <> 0 '+
			'AND tbl_serviceRequest.Id = 
						(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
							WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							AND b.IsDelete <> 1
							ORDER BY b.StepId DESC
						) ' 
	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL
	BEGIN
		SET @conditions = @conditions + ' AND (
						@searchPrefix IS NULL
						OR tbl_serviceFormFieldValue.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
						OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''
						OR tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%''
						OR (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%'')
						OR (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''
						OR (
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						) LIKE ''%'+@searchPrefix+'%'' 
						OR (SELECT STUFF( 
						(SELECT '', '' + ISNULL(tbl_assignUser.FirstName +'' ''+tbl_assignUser.LastName,''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
						WHERE tbl_assign.SerialNumber = tbl_serviceFormFieldValue.SerialNumber 
						FOR XML PATH ('''')), 1, 1, '''')) LIKE ''%'+@searchPrefix+'%'' 
						OR (SELECT TOP(1) 
						ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),''N/A'') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%''  
						OR (
							SELECT STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''') 
						) LIKE ''%'+@searchPrefix+'%'' 
					)
				'
	END
	
	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@searchBy NVARCHAR(MAX)'
	,@searchPrefix,@Status,@searchBy
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyIdCount_TEST]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeServicesRequestByCompanyIdCount_TEST 3,NULL
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyIdCount_TEST]
	@Status INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
				SELECT tbl_serviceFormFieldValue.SerialNumber AS SerialNumber
			 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
			 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
			 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
			 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
			 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
			 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
			 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
			 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
			 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
			 LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
			 AND tbl_companyMappings.CompanyId IS NOT NULL'
	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
			' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
			' AND (tbl_serviceRequest.IsDelete <> 1) '+
			' AND tbl_service.IsEmployeeService <> 0 '+
			'AND tbl_serviceRequest.Id = 
						(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
							WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							AND b.IsDelete <> 1
							ORDER BY b.StepId DESC
						) ' 
	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5) '
	END

	IF @searchPrefix IS NOT NULL AND @searchBy IS NOT NULL
	BEGIN
		IF @searchBy = 'Serial Number'
		BEGIN
			DECLARE @index INT = NULL
			SET @index = (SELECT CONVERT(INT,charindex('sr', @searchPrefix)))
			IF (CONVERT(INT,@index)) >= 1
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceFormFieldValue.SerialNumber = '''+@searchPrefix+''''
			END
			ELSE
			BEGIN
				SET @conditions = @conditions + ' AND tbl_serviceFormFieldValue.SerialNumber = ''SR'+@searchPrefix+''''
			END
		END
		IF @searchBy = 'Created By'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_serviceCreatedBy.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_serviceCreatedBy.LastName LIKE ''%'+@searchPrefix+'%''
			OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'' OR tbl_salesPerson.LastName LIKE ''%'+@searchPrefix+'%'')'
		END
		IF @searchBy = 'Company'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Sales Person'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_companySales.FirstName = (SELECT TOP 1 FirstName 
			FROM [dbo].[Tbl_SalesPersons] tbl_sales 
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id 
			WHERE (tbl_sales.FirstName LIKE '''+@searchPrefix+'%'' AND tbl_mapping.CompanyId = tbl_company.Id AND tbl_mapping.SalesPersonId = tbl_sales.Id)))'
		END
		IF @searchBy = 'Assigned By'
		BEGIN
			SET @conditions = @conditions + ' AND (tbl_assignUser.FirstName = (SELECT TOP 1 FirstName 
			FROM [dbo].[Tbl_User] tbl_mapping
			WHERE (tbl_mapping.FirstName LIKE '''+@searchPrefix+'%'' AND tbl_mapping.Id = tbl_assign.UserId)))'
		END
		IF @searchBy = 'Service Request Type'
		BEGIN
			SET @conditions = @conditions + ' AND tbl_serviceForms.FormName LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Created On'
		BEGIN
			SET @conditions = @conditions + ' AND (SELECT TOP 1 Convert(NVARCHAR(50),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] formField WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Status'
		BEGIN
			SET @conditions = @conditions +' AND (
						SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
						AND tbl_request.Status = tbl_serviceRequest.Status
						AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
						ORDER BY tbl_serviceRequest.StepId DESC
					) LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = 'Assigned Date'
		BEGIN
			SET @conditions = @conditions + ' AND (SELECT TOP(1) Convert(NVARCHAR(50),tbl_assign1.CreatedOn,105) FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
						WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) LIKE ''%'+@searchPrefix+'%'''
		END
	END

	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@Status INT,@searchBy NVARCHAR(MAX)'
	,@searchPrefix,@Status,@searchBy
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyIdWithFilter]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllEmployeeServicesRequestByCompanyIdWithFilter NULL
CREATE PROCEDURE [dbo].[USP_Admin_GetAllEmployeeServicesRequestByCompanyIdWithFilter]
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
		
	DECLARE @query AS NVARCHAR(MAX) = '' ,
			@conditions AS NVARCHAR(MAX) ='',
			@groupByClause AS NVARCHAR(MAX) ='',
			@selectQuery AS NVARCHAR(MAX) ='',
			@orderByClause AS NVARCHAR(MAX) ='',
			@pagination AS NVARCHAR(MAX) ='',
			@countingQuery AS NVARCHAR(MAX) =''

		SET @query = N'
					SELECT ISNULL(tbl_serviceFormFieldValue.SerialNumber,''N/A'') AS SerialNumber,
					ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
					ISNULL(tbl_serviceForms.FormName,''N/A'') AS RequestedService, 
					ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
					ISNULL((SELECT tbl_serviceFormFieldValues.FieldValue FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues 
					LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
					WHERE tbl_serviceformField.FieldName LIKE ''%Applicant Name%''
					AND tbl_serviceFormFieldValues.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber),''N/A'') AS ApplicantName,
					CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
					THEN 
						ISNULL(tbl_serviceCreatedBy.FirstName +'' ''+ tbl_serviceCreatedBy.LastName,''N/A'')
					ELSE 
						ISNULL(tbl_salesPerson.FirstName +'' ''+ tbl_salesPerson.LastName ,''N/A'') 
					END AS RequestedBy, 
					(SELECT TOP 1 CONVERT(date,formField.CreatedOn) FROM [dbo].[Tbl_ServiceFormFieldValue] 
						formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ) AS CreatedOn,
					ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
					ISNULL(
						(
							SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_request WITH(NOLOCK) ON tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							WHERE tbl_serviceRequestStatus.DisplayId = tbl_request.Status
							AND tbl_request.Status = tbl_serviceRequest.Status
							AND tbl_request.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							ORDER BY tbl_serviceRequest.StepId DESC
						)
					,''N/A'') AS Status,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_assignUser1.FirstName +'' ''+tbl_assignUser1.LastName,''N/A'') 
								FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
								WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS AssignedUser, 
					(SELECT TOP(1) 
					CONVERT(date,tbl_assign1.CreatedOn) FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) AS AssignOn,
					ISNULL(STUFF((SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, ''''),''N/A'') AS SalesPerson
				 FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
				 LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
				 LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
				 LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
				 LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
				 LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
				 LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
				 LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson  WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
				 LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId'

	SET @conditions = N' WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 '+
				' AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) '+
				' AND (tbl_serviceRequest.IsDelete <> 1) '+
				' AND tbl_service.IsEmployeeService <> 0 '+
				'AND tbl_serviceRequest.Id = 
							(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
								WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
								AND b.IsDelete <> 1
								ORDER BY b.StepId DESC
							)' 
	SET @groupByClause =N' GROUP BY tbl_serviceFormFieldValue.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForms.FormName,tbl_company.CompanyName,tbl_serviceCreatedBy.FirstName,tbl_serviceCreatedBy.LastName, '+
				'tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.Status,tbl_company.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName '+
				',tbl_serviceRequest.StepId'

	IF @Status = 0
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5'
	END

	IF @Status = 3
	BEGIN
		SET @conditions = @conditions + ' AND tbl_serviceRequest.Status = 3'
	END

	IF @Status = 4
	BEGIN 
		SET @conditions = @conditions + ' AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)'
	END

	SET @selectQuery = @query +' '+@conditions +' '+@groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@Status INT',@Status
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllFinalInvoicesByCompanyIdWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Final Invoice List with Pagination By Company Id>
-- <USP_Admin_GetAllFinalInvoicesByCompanyIdWithPagination 41,0,20,NULL,NULL,NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllFinalInvoicesByCompanyIdWithPagination]
	@CompanyId INT = NULL,
	@skipRows INT = NULL,
	@rowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortBy NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		@conditions NVARCHAR(MAX) = NULL,
		@groupByClause NVARCHAR(MAX) = NULL,
		@orderByClause NVARCHAR(MAX) = NULL,
		@paginationClause NVARCHAR(MAX) = NULL,
		@selectQuery NVARCHAR(MAX) = NULL


	SET @query = N'
					SELECT 
						tbl_companypdf.Id AS Id,
						tbl_companypdf.PdfName AS [Name], 
						tbl_companypdf.Extension AS Extension, 
						tbl_companypdf.InvoiceNumber AS InvoiceNumber, 
						tbl_Company.CompanyName AS Company, 
						CONVERT(nvarchar(50),tbl_companypdf.CreatedOn,105) AS CreatedOn, 
						ISNULL(tbl_companypdf.CreatedBy,0) AS CreatedBy, 
						ISNULL(tbl_user.FirstName +'' ''+ tbl_user.LastName,''N/A'') AS Username 
					FROM [dbo].[Tbl_CompanyInvoicePdf] tbl_companypdf WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails WITH(NOLOCK) ON tbl_companyInvoiceDetails.InvoiceNumber LIKE tbl_companypdf.InvoiceNumber 
					LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoiceDetails.CompanyId 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companypdf.CreatedBy  
				'
	SET @conditions = N' WHERE tbl_companyInvoiceDetails.CompanyId = @CompanyId 
						 AND (tbl_companypdf.IsDelete <> 1 OR tbl_companypdf.IsDelete IS NULL) 
					  '
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR tbl_companypdf.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_companypdf.PdfName LIKE ''%'+@searchPrefix+'%''
						)'
		
	END

	SET @groupByClause = N' GROUP BY tbl_companypdf.Id,tbl_companypdf.PdfName,tbl_companypdf.Extension,tbl_companypdf.InvoiceNumber,tbl_Company.CompanyName,
							tbl_companypdf.CreatedOn,tbl_companypdf.CreatedBy,tbl_user.FirstName,tbl_user.LastName
						'

	SET @orderByClause = N' ORDER BY '
		
		IF @sortBy IS NULL OR @sortBy =''
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companypdf.InvoiceNumber,PATINDEX(''%[0-9]%'',tbl_companypdf.InvoiceNumber), LEN(tbl_companypdf.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortBy = 'Invoice No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companypdf.InvoiceNumber,PATINDEX(''%[0-9]%'',tbl_companypdf.InvoiceNumber), LEN(tbl_companypdf.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortBy = 'Invoice No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companypdf.InvoiceNumber,PATINDEX(''%[0-9]%'',tbl_companypdf.InvoiceNumber), LEN(tbl_companypdf.InvoiceNumber)))) '
			+ ' DESC '
		END

		IF @sortBy = 'Invoice' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companypdf.PdfName '
			+ ' ASC '
		END

		IF @sortBy = 'Invoice' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companypdf.PdfName '
			+ ' DESC '
		END

	SET @paginationClause = N' OFFSET @skipRows ROWS 
								FETCH NEXT @rowsOfPage ROWS ONLY
							'
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@paginationClause

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@skipRows INT,@rowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@skipRows,@rowsOfPage,@searchPrefix
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllFinalInvoicesByCompanyIdWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Final Invoice List with Pagination By Company Id>
-- <USP_Admin_GetAllFinalInvoicesByCompanyIdWithPaginationCount 41,NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllFinalInvoicesByCompanyIdWithPaginationCount]
	@CompanyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		@conditions NVARCHAR(MAX) = NULL,
		@groupByClause NVARCHAR(MAX) = NULL,
		@orderByClause NVARCHAR(MAX) = NULL,
		@paginationClause NVARCHAR(MAX) = NULL,
		@selectQuery NVARCHAR(MAX) = NULL


	SET @query = N'
					SELECT 
						tbl_companypdf.Id AS Id
					FROM [dbo].[Tbl_CompanyInvoicePdf] tbl_companypdf WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails WITH(NOLOCK) ON tbl_companyInvoiceDetails.InvoiceNumber LIKE tbl_companypdf.InvoiceNumber 
					LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoiceDetails.CompanyId 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companypdf.CreatedBy  
				'
	SET @conditions = N' WHERE tbl_companyInvoiceDetails.CompanyId = @CompanyId 
						 AND (tbl_companypdf.IsDelete <> 1 OR tbl_companypdf.IsDelete IS NULL) 
					  '
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN

		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR tbl_companypdf.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_companypdf.PdfName LIKE ''%'+@searchPrefix+'%''
						)'
		
	END

	SET @groupByClause = N' GROUP BY tbl_companypdf.Id,tbl_companypdf.PdfName,tbl_companypdf.Extension,tbl_companypdf.InvoiceNumber,tbl_Company.CompanyName,
							tbl_companypdf.CreatedOn,tbl_companypdf.CreatedBy,tbl_user.FirstName,tbl_user.LastName
						'
	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveCompanyOwnerWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active company owner whoes IsActive is one with pagination>
-- <USP_Admin_GetAllInActiveCompanyOwnerWithPagination 0,20,N'',NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveCompanyOwnerWithPagination]
	@companyId INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id, 
						ISNULL(tbl_user.AccountNumber,''N/A'') AS AccountNumber, 
						ISNULL(tbl_user.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_user.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_user.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_user.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_user.PhoneNumber,''N/A'') AS PhoneNumber, 
						ISNULL(
							STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''') 
						,''N/A'') AS RoleName,
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName 
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
					LEFT JOIN [dbo].[Tbl_Role] tbl_roles WITH(NOLOCK) ON tbl_roles.RoleID = tbl_userRoleMapping.RoleID 
				'

	SET @conditions = N' WHERE tbl_user.IsActive = 0 
						AND tbl_user.IsDelete <> 1 
						AND tbl_company.IsDelete <> 1 
						AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
						AND tbl_userRoleMapping.RoleID = (
							SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''  
						)
						AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
						AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.EmailID LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.PhoneNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_roles.RoleName LIKE ''%'+@searchPrefix+'%'' 
						) 
					'

	SET @groupByClause = N'
							GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
							tbl_user.EmailID,tbl_user.PhoneNumber,tbl_company.CompanyName,tbl_user.PhoneNumber 
						'

	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Id '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' DESC '
		END

		IF @sortColumn = 'Contact No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PhoneNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'Contact No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PhoneNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmailID '
			+ ' ASC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmailID '
			+ ' DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' STUFF((SELECT '', '' + tbl_role.RoleName 
				FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id 
				LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
				WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
				FOR XML PATH('''')),1,1,'''')  '
			+ ' ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
				+ ' STUFF((SELECT '', '' + tbl_role.RoleName 
					FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id 
					LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
					WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
					FOR XML PATH('''')),1,1,'''')  '
			+ ' DESC '
		END

	SET @pagination = N' OFFSET @skipRows ROWS 
						 FETCH NEXT @RowsOfPage ROWS ONLY 
					'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery
	,N'@companyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)'
	,@companyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveCompanyOwnerWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active company owner whoes IsActive is one with pagination>
-- <USP_Admin_GetAllInActiveCompanyOwnerWithPaginationCount NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveCompanyOwnerWithPaginationCount]
	@companyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
					LEFT JOIN [dbo].[Tbl_Role] tbl_roles WITH(NOLOCK) ON tbl_roles.RoleID = tbl_userRoleMapping.RoleID 
				'

	SET @conditions = N' WHERE tbl_user.IsActive = 0 
						AND tbl_user.IsDelete <> 1 
						AND tbl_company.IsDelete <> 1 
						AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
						AND tbl_userRoleMapping.RoleID = (
							SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''  
						)
						AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
						AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.EmailID LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.PhoneNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_roles.RoleName LIKE ''%'+@searchPrefix+'%'' 
						) 
					'

	SET @groupByClause = N'
							GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
							tbl_user.EmailID,tbl_user.PhoneNumber,tbl_company.CompanyName,tbl_user.PhoneNumber 
						'	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


	EXEC SP_EXECUTESQL @selectQuery,N'@companyId INT,@searchPrefix NVARCHAR(MAX)',@companyId,@searchPrefix

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveCompanyShareholders]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <11-March-2023>
-- Description:	<Get all Company Shareholder List with Pagination>
-- <USP_Admin_GetAllInActiveCompanyShareholders 1,50,N'',N'',N'',0>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveCompanyShareholders]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		    @conditions NVARCHAR(MAX) = NULL,
			@groupByClause NVARCHAR(MAX) = NULL,
			@orderByClause NVARCHAR(MAX) = NULL,
			@paginationClause NVARCHAR(MAX) = NULL,
			@selectQuery NVARCHAR(MAX) = NULL

	SET @query = N'
					SELECT 
						ISNULL(tbl_shareholder.ID,0) AS ID, 
						ISNULL(tbl_shareholder.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_shareholder.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_shareholder.Passport_Number,''N/A'') AS PassportNumber, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105),''N/A'') AS PassportExpiryDate, 
						ISNULL(tbl_shareholder.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_shareholder.Designation,''N/A'') AS Designation, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105),''N/A'') AS VisaExpiryDate, 
						ISNULL(tbl_shareholder.InsuranceCompany,''N/A'') AS InsuranceCompany, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.InsuranceExpiryDate,105),''N/A'') AS InsuranceExpiryDate, 
						ISNULL(tbl_shareholder.CompanyId,0) AS CompanyId, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_shareholder.SharePercentage,''N/A'') AS SharePercentage, 
						ISNULL(tbl_shareholder.IsActive,0) AS IsActive
					FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_company] tbl_company WITH(NOLOCK) ON tbl_shareholder.CompanyId = tbl_company.Id 
				'
	SET @conditions = N' WHERE tbl_shareholder.IsDelete <> 1 
						 AND tbl_shareholder.IsActive <> 1 
					'

	IF @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR (tbl_shareholder.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_shareholder.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_Company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.SharePercentage LIKE '''+@searchPrefix+'%'' 
							OR tbl_shareholder.Passport_Number LIKE '''+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_shareholder.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.Designation LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @groupByClause = N' GROUP BY tbl_shareholder.ID,tbl_shareholder.FirstName,tbl_shareholder.LastName,tbl_shareholder.Passport_Number,
							tbl_shareholder.PassportExpiryDate,tbl_shareholder.Nationality,tbl_shareholder.Designation,tbl_shareholder.VisaExpiryDate,
							tbl_shareholder.InsuranceCompany,tbl_shareholder.InsuranceExpiryDate,tbl_shareholder.CompanyId,tbl_company.CompanyName,
							tbl_shareholder.SharePercentage,tbl_shareholder.IsActive 
						  '
	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.ID ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.FirstName ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.FirstName DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_company.CompanyName ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_company.CompanyName DESC '
		END

		IF @sortColumn = 'Share(%)' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' ISNULL(CONVERT(DECIMAL(18,2),tbl_shareholder.SharePercentage),0) ASC '
		END

		IF @sortColumn = 'Share(%)' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' ISNULL(CONVERT(DECIMAL(18,2),tbl_shareholder.SharePercentage),0) DESC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Passport_Number ASC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Passport_Number DESC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.PassportExpiryDate ASC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.PassportExpiryDate DESC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.VisaExpiryDate ASC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.VisaExpiryDate DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Nationality ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Nationality DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Designation ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + ' tbl_shareholder.Designation DESC '
		END

	SET @paginationClause =  ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@paginationClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveCompanyShareholdersCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Shareholder List with Pagination Count>
-- <USP_Admin_GetAllInActiveCompanyShareholdersCount NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveCompanyShareholdersCount]
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		    @conditions NVARCHAR(MAX) = NULL,
			@groupByClause NVARCHAR(MAX) = NULL,
			@orderByClause NVARCHAR(MAX) = NULL,
			@paginationClause NVARCHAR(MAX) = NULL,
			@selectQuery NVARCHAR(MAX) = NULL

	SET @query = N'
					SELECT 
						ISNULL(tbl_shareholder.ID,0) AS ID
					FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_company] tbl_company WITH(NOLOCK) ON tbl_shareholder.CompanyId = tbl_company.Id 
				'
	SET @conditions = N' WHERE tbl_shareholder.IsDelete <> 1 
						 AND tbl_shareholder.IsActive <> 1 
					'

	IF @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR (tbl_shareholder.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_shareholder.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR tbl_Company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.SharePercentage LIKE '''+@searchPrefix+'%'' 
							OR tbl_shareholder.Passport_Number LIKE '''+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_shareholder.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_shareholder.Designation LIKE ''%'+@searchPrefix+'%''
						) '
	END

	SET @groupByClause = N' GROUP BY tbl_shareholder.ID,tbl_shareholder.FirstName,tbl_shareholder.LastName,tbl_shareholder.Passport_Number,
							tbl_shareholder.PassportExpiryDate,tbl_shareholder.Nationality,tbl_shareholder.Designation,tbl_shareholder.VisaExpiryDate,
							tbl_shareholder.InsuranceCompany,tbl_shareholder.InsuranceExpiryDate,tbl_shareholder.CompanyId,tbl_company.CompanyName,
							tbl_shareholder.SharePercentage,tbl_shareholder.IsActive 
						  '
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX)',@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveEmployeesWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active employees whoes IsActive is zero with pagination>
-- <USP_Admin_GetAllInActiveEmployeesWithPagination>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveEmployeesWithPagination]
	@companyId INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id, 
						ISNULL(tbl_user.AccountNumber,''N/A'') AS AccountNumber, 
						ISNULL(tbl_user.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_user.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_user.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_user.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_user.PhoneNumber,''N/A'') AS PhoneNumber, 
						ISNULL(tbl_user.PassportNumber,''N/A'') AS PassportNumber, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),''N/A'') AS PassportExpiryDate, 
						ISNULL(tbl_user.Designation,''N/A'') AS Designation, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),''N/A'') AS VisaExpiryDate, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),''N/A'') AS EmployeementCardExpiryDate,  
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName 
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'

	SET @conditions = N' WHERE  tbl_user.IsActive = 0 
							AND tbl_user.IsDelete <> 1 
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							)
							AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
							AND (
								@searchPrefix IS NULL 
								OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
								OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''  
								OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105) = '''+@searchPrefix+''' 
								OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Designation LIKE ''%'+@searchPrefix+'%'' 
							)
					   '

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
						tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,tbl_user.Designation,tbl_user.PassportExpiryDate,
						tbl_user.VisaExpiryDate,tbl_user.EmployeementCardExpiryDate,tbl_company.CompanyName '

	SET @orderByClause = N' ORDER BY '

		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_company.CompanyName '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Employment Card Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmployeementCardExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Employment Card Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.EmployeementCardExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Designation '
			+ ' ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Designation '
			+ ' DESC '
		END

	SET @pagination = N' OFFSET @skipRows ROWS 
						 FETCH NEXT @RowsOfPage ROWS ONLY 
					'
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery,
	N'@companyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',
	@companyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveEmployeesWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <13-March-2023>
-- Description:	<Get all active employees whoes IsActive is one with pagination Count>
-- <USP_Admin_GetAllActiveEmployeesWithPaginationCount NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveEmployeesWithPaginationCount]
	@companyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'

	SET @conditions = N' WHERE  tbl_user.IsActive = 0 
							AND tbl_user.IsDelete <> 1 
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.CompanyName NOT LIKE ''DIBN'' 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							)
							AND (tbl_mapping.CompanyId = @companyId OR @companyId IS NULL OR @companyId = 0) 
							AND (
								@searchPrefix IS NULL 
								OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
								OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%''  
								OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
								OR CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105) = '''+@searchPrefix+''' 
								OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_user.Designation LIKE ''%'+@searchPrefix+'%'' 
							) 
					   '

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,
						tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,tbl_user.Designation,tbl_user.PassportExpiryDate,
						tbl_user.VisaExpiryDate,tbl_user.EmployeementCardExpiryDate,tbl_company.CompanyName '

	
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


	EXEC SP_EXECUTESQL @selectQuery,N'@companyId INT,@searchPrefix NVARCHAR(MAX)',@companyId,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveMainCompanyEmployeesWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all active employees whoes IsActive is one with pagination>
-- <USP_Admin_GetAllInActiveMainCompanyEmployeesWithPagination 1,50,N'',N'',N'',1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveMainCompanyEmployeesWithPagination]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_user.Id,0) AS Id, 
						ISNULL(tbl_user.AccountNumber,''N/A'') AS AccountNumber, 
						ISNULL(tbl_user.FirstName,''N/A'') AS FirstName, 
						ISNULL(tbl_user.LastName,''N/A'') AS LastName, 
						ISNULL(tbl_user.Nationality,''N/A'') AS Nationality, 
						ISNULL(tbl_user.EmailID,''N/A'') AS EmailID, 
						ISNULL(tbl_user.PhoneNumber,''N/A'') AS PhoneNumber, 
						ISNULL(tbl_user.PassportNumber,''N/A'') AS PassportNumber, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105),''N/A'') AS PassportExpiryDate, 
						ISNULL(
							STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')
						,''N/A'') AS Designation,
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105),''N/A'') AS VisaExpiryDate, 
						ISNULL(tbl_user.InsuranceCompany,''N/A'') AS InsuranceCompany,  
						ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,105),''N/A'') AS InsuranceExpiryDate, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName 
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK)  ON tbl_mapping.UserId = tbl_user.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'
	SET @conditions = N' WHERE tbl_user.IsActive = 0 
							AND tbl_user.IsDelete <> 1  
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.Id = @CompanyId 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							) 
						'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.InsuranceCompany LIKE ''%'+@searchPrefix+'%''  
						) ' 
	END

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,
							tbl_user.Nationality,tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,
							tbl_user.Designation,tbl_user.PassportExpiryDate,tbl_user.VisaExpiryDate,tbl_company.CompanyName,
							tbl_user.InsuranceCompany,tbl_user.InsuranceExpiryDate 
						  '
	SET @orderByClause = N' ORDER BY '

		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.AccountNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' ASC '
		END

		IF @sortColumn = 'Name' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.FirstName +'' ''+tbl_user.LastName '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.VisaExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Insurance Expiry Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceExpiryDate '
			+ ' ASC '
		END

		IF @sortColumn = 'Insurance Expiry Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceExpiryDate '
			+ ' DESC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' ASC '
		END

		IF @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.PassportNumber '
			+ ' DESC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' ASC '
		END

		IF @sortColumn = 'Nationality' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.Nationality '
			+ ' DESC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) '
			+ ' ASC '
		END

		IF @sortColumn = 'Designation' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT STUFF((SELECT '', '' + tbl_role.RoleName 
							FROM [dbo].[Tbl_User] tbl_user1 
							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id 
							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID 
							WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1 
							FOR XML PATH('''')),1,1,'''')) '
			+ ' DESC '
		END

		IF @sortColumn = 'Insurance Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceCompany '
			+ ' ASC '
		END

		IF @sortColumn = 'Insurance Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_user.InsuranceCompany '
			+ ' DESC '
		END

	SET @pagination = N' OFFSET @skipRows ROWS 
						 FETCH NEXT @RowsOfPage ROWS ONLY 
					'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 


	EXEC SP_EXECUTESQL @selectQuery
	,N'@CompanyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)'
	,@CompanyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllInActiveMainCompanyEmployeesWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <13-March-2023>
-- Description:	<Get all active employees whoes IsActive is one with pagination>
-- <USP_Admin_GetAllInActiveMainCompanyEmployeesWithPaginationCount NULL,NULL,1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllInActiveMainCompanyEmployeesWithPaginationCount]
	@searchPrefix NVARCHAR(MAX) =NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_user.AccountNumber,0) AS AccountNumber
					FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK)  ON tbl_mapping.UserId = tbl_user.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_mapping.CompanyId
					LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId 
				'
	SET @conditions = N' WHERE tbl_user.IsActive = 0 
							AND tbl_user.IsDelete <> 1  
							AND tbl_company.IsDelete <> 1 
							AND tbl_company.Id = @CompanyId 
							AND tbl_userRoleMapping.RoleID <> ( 
								SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE ''Company Owner''
							) 
						'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
							@searchPrefix IS NULL 
							OR tbl_user.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
							OR (tbl_user.FirstName LIKE ''%'+@searchPrefix+'%'' OR tbl_user.LastName LIKE ''%'+@searchPrefix+'%'') 
							OR CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,105) = '''+@searchPrefix+''' 
							OR CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,105) = '''+@searchPrefix+''' 
							OR tbl_user.PassportNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Nationality LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.Designation LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_user.InsuranceCompany LIKE ''%'+@searchPrefix+'%''  
						) ' 
	END

	SET @groupByClause = N' GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,
							tbl_user.Nationality,tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.PassportNumber,
							tbl_user.Designation,tbl_user.PassportExpiryDate,tbl_user.VisaExpiryDate,tbl_company.CompanyName,
							tbl_user.InsuranceCompany,tbl_user.InsuranceExpiryDate 
						  '
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause


	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllMessageTemplate]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetAllMessageTemplate]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_messageTemplate.Id,0) AS Id,
		ISNULL(tbl_messageTemplate.Name,'N/A') AS Name,
		ISNULL(tbl_messageTemplate.Subject,'N/A') AS Subject,
		ISNULL(tbl_messageTemplate.MailFrom,'N/A') AS MailFrom,
		tbl_messageTemplate.Body AS Body,
		ISNULL(tbl_messageTemplate.IsActive,0) AS IsActive,
		ISNULL(tbl_messageTemplate.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_messageTemplate.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_messageTemplate.CreatedBy,0) AS CreatedBy,
		ISNULL(CONVERT(NVARCHAR(50),tbl_messageTemplate.ModifyOn,105),'N/A') AS ModifyOn,
		ISNULL(tbl_messageTemplate.ModifyBy,0) AS ModifyBy
	FROM [dbo].[Tbl_MessageTemplate] tbl_messageTemplate WITH(NOLOCK)
	WHERE (tbl_messageTemplate.Id = @Id OR @Id IS NULL OR @Id =0)
		   AND tbl_messageTemplate.IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllNewCompanyInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all new Company Invoice List with Pagination>
-- <USP_Admin_GetAllNewCompanyInvoice 1,50,N'',N'',N''>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllNewCompanyInvoice]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_companyInvoiceDetail.InvoiceNumber AS InvoiceNumber,
		tbl_companyInvoiceDetail.CompanyName AS CompanyName,
		ISNULL(tbl_companyInvoiceDetail.Service,'N/A') AS [Service],
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreationDate,105),'N/A') AS [Date],
		MAX(tbl_companyInvoiceDetail.GrandTotal) AS GrandTotal,
		ISNULL(MAX(tbl_companyInvoiceDetail.Currency),'AED') AS Currency,
		ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy,
		ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username
	FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy
	WHERE tbl_companyInvoiceDetail.Id IN (
											SELECT DISTINCT
											MAX(Id) 
											FROM [dbo].[Tbl_NewCompanyInvoiceDetails] b WITH(NOLOCK)
											WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
											AND (b.IsDelete <> 1 OR b.IsDelete IS NULL)
											GROUP BY b.InvoiceNumber 
										  )
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		AND (@SearchPrefix IS NULL 
			OR tbl_companyInvoiceDetail.InvoiceNumber LIKE @SearchPrefix +'%'
			OR tbl_companyInvoiceDetail.Service LIKE '%'+@SearchPrefix +'%'
			OR CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreationDate,105) LIKE '%'+@SearchPrefix +'%'
			OR tbl_companyInvoiceDetail.GrandTotal LIKE '%'+@SearchPrefix +'%'
			OR tbl_companyInvoiceDetail.Currency LIKE '%'+@SearchPrefix +'%'
			OR tbl_user.FirstName LIKE '%'+@SearchPrefix +'%'
			OR tbl_user.LastName LIKE '%'+@SearchPrefix +'%'
		)
	GROUP BY 
		tbl_companyInvoiceDetail.InvoiceNumber,
		tbl_companyInvoiceDetail.InvoiceCreationDate,
		tbl_companyInvoiceDetail.GrandTotal,
		tbl_companyInvoiceDetail.CreatedBy,
		tbl_user.FirstName,
		tbl_user.LastName,
		tbl_companyInvoiceDetail.CompanyName,
		tbl_companyInvoiceDetail.Currency,
		tbl_companyInvoiceDetail.Service
	ORDER BY 
		CASE WHEN @sortColumn = 'Invoice No.' AND @sortDirection = 'asc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber, PATINDEX('%[0-9]%',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'Invoice No.' AND @sortDirection = 'desc'
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber, PATINDEX('%[0-9]%',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Date' AND @sortDirection = 'asc' 
			THEN (SELECT TOP 1 formField.InvoiceCreationDate FROM [dbo].[Tbl_NewCompanyInvoiceDetails] formField WHERE formField.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber)
		END ASC,
		CASE WHEN @sortColumn = 'Date' AND @sortDirection = 'desc'
			THEN (SELECT TOP 1 formField.InvoiceCreationDate FROM [dbo].[Tbl_NewCompanyInvoiceDetails] formField WHERE formField.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber)
		END DESC,
		CASE WHEN @sortColumn = 'Service' AND @sortDirection = 'asc' 
			THEN tbl_companyInvoiceDetail.Service
		END ASC,
		CASE WHEN @sortColumn = 'Service' AND @sortDirection = 'desc'
			THEN tbl_companyInvoiceDetail.Service
		END DESC,
		CASE WHEN @sortColumn = 'Currency' AND @sortDirection = 'asc' 
			THEN tbl_companyInvoiceDetail.Currency
		END ASC,
		CASE WHEN @sortColumn = 'Currency' AND @sortDirection = 'desc'
			THEN tbl_companyInvoiceDetail.Currency
		END DESC,
		CASE WHEN @sortColumn = 'Amount' AND @sortDirection = 'asc' 
			THEN tbl_companyInvoiceDetail.GrandTotal
		END ASC,
		CASE WHEN @sortColumn = 'Amount' AND @sortDirection = 'desc'
			THEN tbl_companyInvoiceDetail.GrandTotal
		END DESC,
		CASE WHEN @sortColumn = 'Generated By' AND @sortDirection = 'asc' 
			THEN tbl_user.FirstName +' '+ tbl_user.LastName
		END ASC,
		CASE WHEN @sortColumn = 'Generated By' AND @sortDirection = 'desc'
			THEN tbl_user.FirstName +' '+ tbl_user.LastName
		END DESC
	OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	FETCH NEXT @RowsOfPage ROWS ONLY

	SELECT 
		tbl_companyInvoiceDetail.InvoiceNumber AS InvoiceNumber
	FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy
	WHERE tbl_companyInvoiceDetail.Id IN (
												SELECT DISTINCT
												MAX(Id) 
												FROM [dbo].[Tbl_NewCompanyInvoiceDetails] b WITH(NOLOCK)
												WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
												AND (b.IsDelete <> 1 OR b.IsDelete IS NULL)
												GROUP BY b.InvoiceNumber 
											)
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		AND (@SearchPrefix IS NULL 
			OR tbl_companyInvoiceDetail.InvoiceNumber LIKE @SearchPrefix +'%'
			OR tbl_companyInvoiceDetail.Service LIKE '%'+@SearchPrefix +'%'
			OR CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreationDate,105) LIKE '%'+@SearchPrefix +'%'
			OR tbl_companyInvoiceDetail.GrandTotal LIKE '%'+@SearchPrefix +'%'
			OR tbl_companyInvoiceDetail.Currency LIKE '%'+@SearchPrefix +'%'
			OR tbl_user.FirstName LIKE '%'+@SearchPrefix +'%'
			OR tbl_user.LastName LIKE '%'+@SearchPrefix +'%'
		)
	GROUP BY 
		tbl_companyInvoiceDetail.InvoiceNumber,
		tbl_companyInvoiceDetail.InvoiceCreationDate,
		tbl_companyInvoiceDetail.GrandTotal,
		tbl_companyInvoiceDetail.CreatedBy,
		tbl_user.FirstName,
		tbl_user.LastName,
		tbl_companyInvoiceDetail.Currency,
		tbl_companyInvoiceDetail.Service
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllNotifications]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetAllNotifications>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllNotifications]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_notification.ID,0) AS ID,
		ISNULL(tbl_notification.CompanyId,0) AS CompanyId,
		ISNULL(tbl_notification.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_notification.UserId,0) AS UserId,
		ISNULL(tbl_notification.Username,'N/A') AS Username,
		ISNULL(tbl_notification.Service,'N/A') AS [Service],
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ExpiryDate,105),'N/A') AS ExpiryDate,
		CASE 
			WHEN tbl_notification.LeftDayToExpire > 0 
			THEN 
			ISNULL(tbl_notification.LeftDayToExpire,0) 
			ELSE 
			-1 
		END AS LeftDayToExpire,
		ISNULL(tbl_notification.SendNotificationAfter,0) AS SendNotificationAfter,
		ISNULL(tbl_notification.MarkAsRead,0) AS MarkAsRead,
		ISNULL(tbl_notification.IsActive,0) AS IsActive,
		ISNULL(tbl_notification.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_Notifications] tbl_notification WITH(NOLOCK)
	WHERE tbl_notification.IsDelete <> 1 
	--AND tbl_notification.LeftDayToExpire > 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllParentCompanyServiceByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<SP_Admin_GetAllParentCompanyServiceByCompanyId 13>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllParentCompanyServiceByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @CompanyType NVARCHAR(MAX)= NULL;
	SET @CompanyType = (SELECT CompanyType FROM [dbo].[Tbl_Company] WHERE Id=@CompanyId AND IsDelete <> 1 AND IsActive <> 0)
	SELECT 
		ISNULL(tbl_companyservice.ID,0) AS ID,
		ISNULL(tbl_companyservice.ParentId,0) AS ParentId,
		ISNULL(tbl_companyservice.ServiceName,'N/A') AS ServiceName,
		ISNULL(tbl_companyservice.IsActive,0) AS IsActive,
		ISNULL(tbl_companyservice.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
		@CompanyType AS CompanyType
	FROM [dbo].[Tbl_CompanyServices] tbl_companyservice WITH(NOLOCK)
	WHERE tbl_companyservice.IsDelete <> 1  AND tbl_companyservice.IsActive <> 0 AND ParentId =0 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllParentEmployeeServiceByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<USP_Admin_GetAllParentEmployeeServiceByCompanyId 10>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllParentEmployeeServiceByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @CompanyType NVARCHAR(MAX)= NULL;
	SET @CompanyType = (SELECT CompanyType FROM [dbo].[Tbl_Company] WHERE Id=@CompanyId AND IsDelete <> 1 AND IsActive <> 0)
	SELECT 
		ISNULL(tbl_employeeservice.ID,0) AS ID,
		--ISNULL(tbl_employeeservice.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_employeeservice.ParentId,0) AS ParentId,
		ISNULL(tbl_employeeservice.ServiceName,'N/A') AS ServiceName,
		ISNULL(tbl_employeeservice.IsActive,0) AS IsActive,
		ISNULL(tbl_employeeservice.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_employeeservice.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
		@CompanyType AS CompanyType
	FROM [dbo].[Tbl_EmployeeServices] tbl_employeeservice WITH(NOLOCK)
	WHERE tbl_employeeservice.IsDelete <> 1  AND ParentId = 0 AND tbl_employeeservice.IsActive <> 0
	ORDER BY (SELECT COUNT(*) FROM [dbo].[Tbl_EmployeeServices] WHERE ParentId = tbl_employeeservice.ID AND IsActive<>0 AND IsDelete <> 1) DESC
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllRequestNotificaion]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <16-June-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <17-June-2022>
-- Description:	To get all request notifications
-- USP_Admin_GetAllRequestNotificaion N'2022-06-14',N'2022-06-16'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllRequestNotificaion]
	@StartDate NVARCHAR(50) = NULL,
	@EndDate NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;


	SELECT DISTINCT
		tbl_requestNotification.Id AS Id,
		ISNULL(tbl_requestNotification.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.RequestCreatedOn, 100), 7)),'N/A') AS RequestCreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_requestNotification.Type,'N/A') AS Type,
		ISNULL(tbl_requestNotification.AssignedUserId,0) AS AssignedUserId,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.AssignedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.AssignedOn, 100), 7)),'N/A') AS AssignedOn,
		ISNULL(tbl_requestNotification.AssignedBy,0) AS AssignedById,
		ISNULL(tbl_serviceForms.FormName,'N/A') AS FormName,
		ISNULL(tbl_requestNotification.Title,'N/A') AS Title,
		ISNULL(tbl_requestNotification.Description,'N/A') AS Description,
		ISNULL(tbl_requestNotification.ResponseType,'N/A') AS ResponseType,
		ISNULL(CASE WHEN AssignedUserId IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb 
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedUserId
			WHERE tbl_notification.AssignedUserId = tbl_requestNotification.AssignedUserId
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
			)
		END,'N/A') AS AssignedUser,
		ISNULL(CASE WHEN AssignedBy IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedBy
			WHERE tbl_notification.AssignedBy = tbl_requestNotification.AssignedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS AssignedBy,
		ISNULL(CASE WHEN tbl_requestNotification.SerialNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.ServiceCreatedBy
			WHERE tbl_notification.ServiceCreatedBy = tbl_requestNotification.ServiceCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS ServiceCreatedBy,
		ISNULL(CASE WHEN tbl_requestNotification.SerialNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_SalesPersons] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.ServiceCreatedBySalesPerson
			WHERE tbl_notification.ServiceCreatedBy = tbl_requestNotification.ServiceCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS ServiceCreatedBySalesPerson,
		ISNULL(tbl_requestNotification.ServiceCreatedBy,0) AS ServiceCreatedById,
		tbl_requestNotification.MarkAsRead AS MarkAsRead,
		ISNULL(tbl_RMTeam.Id,0) AS RMTeamId,
		ISNULL(tbl_RMTeam.Firstname +'' + CASE WHEN ISNULL(tbl_RMTeam.Lastname,'N/A') NOT LIKE 'N/A' THEN ' ' + tbl_RMTeam.Lastname END,'N/A') AS ServiceCreatedByRMTeam
	FROM [dbo].[Tbl_RequestNotification] tbl_requestNotification WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.SerialNumber = tbl_requestNotification.SerialNumber
	LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.ServiceId = tbl_serviceRequest.ServiceId
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms ON tbl_serviceForms.ServiceId = tbl_service.ServiceId
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam ON tbl_serviceRequest.RMTeamId = tbl_RMTeam.Id
	WHERE tbl_requestNotification.IsActive <> 0 AND tbl_requestNotification.IsDelete <> 1
	AND tbl_requestNotification.Type LIKE 'Service Request'
	AND (CONVERT(date,tbl_requestNotification.CreatedOn) >= CONVERT(date,@StartDate) AND CONVERT(date,tbl_requestNotification.CreatedOn) <= CONVERT(date,@EndDate)
	AND (tbl_requestNotification.MarkAsRead = 1 OR tbl_requestNotification.MarkAsRead = 0)
	OR (@EndDate IS NULL AND @StartDate IS NULL AND tbl_requestNotification.MarkAsRead <> 1))
	GROUP BY tbl_requestNotification.Id,tbl_requestNotification.SerialNumber,tbl_requestNotification.RequestCreatedOn,tbl_requestNotification.Type,tbl_requestNotification.AssignedUserId,
	tbl_requestNotification.AssignedOn,tbl_requestNotification.AssignedBy,tbl_serviceForms.FormName,tbl_requestNotification.Title,tbl_requestNotification.Description,
	tbl_requestNotification.ResponseType,tbl_requestNotification.SerialNumber,tbl_requestNotification.ServiceCreatedBy,tbl_requestNotification.MarkAsRead,
	tbl_RMTeam.Id,tbl_RMTeam.Firstname,tbl_RMTeam.Lastname
	ORDER BY tbl_requestNotification.Id DESC

	SELECT DISTINCT
		tbl_requestNotification.Id AS Id,
		ISNULL(tbl_requestNotification.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.RequestCreatedOn, 100), 7)),'N/A') AS RequestCreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_requestNotification.Type,'N/A') AS Type,
		ISNULL(tbl_requestNotification.AssignedUserId,0) AS AssignedUserId,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.AssignedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.AssignedOn, 100), 7)),'N/A') AS AssignedOn,
		ISNULL(tbl_requestNotification.AssignedBy,0) AS AssignedById,
		ISNULL(tbl_requestNotification.Title,'N/A') AS Title,
		ISNULL(tbl_requestNotification.Description,'N/A') AS Description,
		ISNULL(tbl_requestNotification.ResponseType,'N/A') AS ResponseType,
		ISNULL(CASE WHEN AssignedUserId IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb 
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedUserId
			WHERE tbl_notification.AssignedUserId = tbl_requestNotification.AssignedUserId
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
			)
		END,'N/A') AS AssignedUser,
		ISNULL(CASE WHEN AssignedBy IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedBy
			WHERE tbl_notification.AssignedBy = tbl_requestNotification.AssignedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS AssignedBy,
		ISNULL(CASE WHEN tbl_requestNotification.TrackingNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.SupportTicketCreatedBy
			WHERE tbl_notification.SupportTicketCreatedBy = tbl_requestNotification.SupportTicketCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS SupportTicketCreatedBy,
		ISNULL(CASE WHEN tbl_requestNotification.TrackingNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_SalesPersons] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.SupportTicketCreatedBySalesPerson
			WHERE tbl_notification.SupportTicketCreatedBy = tbl_requestNotification.SupportTicketCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS SupportTicketCreatedBySalesPerson,
		ISNULL(tbl_requestNotification.SupportTicketCreatedBy,0) AS SupportTicketCreatedById,
		tbl_requestNotification.MarkAsRead AS MarkAsRead
	FROM [dbo].[Tbl_RequestNotification] tbl_requestNotification WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_SupportTicket] tbl_supportTicket ON tbl_supportTicket.TrackingNumber = tbl_requestNotification.TrackingNumber
	WHERE tbl_requestNotification.IsActive <> 0 AND tbl_requestNotification.IsDelete <> 1
	AND tbl_requestNotification.Type LIKE 'Support Ticket'
	AND (CONVERT(date,tbl_requestNotification.CreatedOn) >= CONVERT(date,@StartDate) AND CONVERT(date,tbl_requestNotification.CreatedOn) <= CONVERT(date,@EndDate) AND (tbl_requestNotification.MarkAsRead = 1 OR tbl_requestNotification.MarkAsRead = 0))
	OR (@EndDate IS NULL AND @StartDate IS NULL AND tbl_requestNotification.MarkAsRead <> 1)
	GROUP BY tbl_requestNotification.Id,tbl_requestNotification.TrackingNumber,tbl_requestNotification.RequestCreatedOn,tbl_requestNotification.Type,tbl_requestNotification.AssignedUserId,
	tbl_requestNotification.AssignedOn,tbl_requestNotification.AssignedBy,tbl_requestNotification.Title,tbl_requestNotification.Description,tbl_requestNotification.ResponseType,tbl_requestNotification.TrackingNumber
	,tbl_requestNotification.SupportTicketCreatedBy,tbl_requestNotification.MarkAsRead
	ORDER BY tbl_requestNotification.Id DESC
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllRMTeamAssignedCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllRMTeamAssignedCompany
-- Author:			<Yashasvi Sharma>
-- Created date:	10/Oct/2024
-- Description:		Get RM Team Company
-- USP_Admin_GetAllRMTeamAssignedCompany
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllRMTeamAssignedCompany]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @UserId IS NOT NULL
	BEGIN
		SELECT DISTINCT 
			tbl_company.CompanyName AS CompanyName,
			tbl_company.Id AS CompanyId
		FROM [dbo].[Tbl_Company] tbl_company  
		LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id  
		LEFT JOIN[dbo].[Tbl_RMTeam] tbl_RMTeam ON tbl_RMTeam.Id = tbl_mapping.RMTeamId 
		WHERE tbl_RMTeam.Id = @UserId;
	END
	ELSE
	BEGIN
		SELECT DISTINCT tbl_company.CompanyName AS CompanyName FROM [dbo].[Tbl_Company] tbl_company
		WHERE tbl_company.IsDelete<> 1 AND tbl_company.IsActive <> 0
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllRMTeamPersonForCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllRMTeamPersonForCompany
-- Author:			<Yashasvi Sharma>
-- Created date:	29/Oct/2024
-- Description:		Get all RM Teams
-- USP_Admin_GetAllRMTeamPersonForCompany
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllRMTeamPersonForCompany]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_RMTeam.Firstname + '' + CASE WHEN ISNULL(tbl_RMTeam.Lastname,'N/A') <> 'N/A' THEN ' ' + tbl_RMTeam.Lastname ELSE '' END AS RMPerson,
		tbl_RMTeam.Id AS Id
	FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
	WHERE (tbl_RMTeam.IsDelete <> 1 OR tbl_RMTeam.IsDelete IS NULL)
	AND tbl_RMTeam.IsActive <> 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllSalesPersonAssignedCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAllSalesPersonAssignedCompany
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Sales Person Company
-- USP_Admin_GetAllSalesPersonAssignedCompany
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllSalesPersonAssignedCompany]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @UserId IS NOT NULL
	BEGIN
		SELECT DISTINCT 
			tbl_company.CompanyName AS CompanyName,
			tbl_company.Id AS CompanyId
		FROM [dbo].[Tbl_Company] tbl_company  
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id  
		LEFT JOIN[dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId 
		WHERE tbl_salesPerson.Id=  @UserId;
	END
	ELSE
	BEGIN
		SELECT DISTINCT tbl_company.CompanyName AS CompanyName FROM [dbo].[Tbl_Company] tbl_company
		WHERE tbl_company.IsDelete<> 1 AND tbl_company.IsActive <> 0
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllSalesPersonListWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <23-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all sales person list with pagination>
-- <USP_Admin_GetAllSalesPersonListWithPagination 1,50,N'',N'Insuarnce Expiry Date',N'desc'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllSalesPersonListWithPagination]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_salesPersons.Id,0) AS Id,
		ISNULL(tbl_salesPersons.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_salesPersons.LastName,'N/A') AS LastName,
		ISNULL(tbl_salesPersons.EmailId,'N/A') AS EmailId,
		ISNULL(tbl_salesPersons.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_salesPersons.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.PassportExpiryDate,105),'N/A') AS PassportExpiryDate,
		ISNULL(tbl_role.RoleName,'N/A') AS [Role],
		ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.VisaExpiryDate,105),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_salesPersons.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.InsuarnceExpiryDate,105),'N/A') AS InsuarnceExpiryDate,
		ISNULL(STUFF(
			(SELECT ', ' + ISNULL(tbl_company.CompanyName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
				LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
				LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
				WHERE tbl_salesPersons1.Id = tbl_salesPersons.Id AND tbl_companyMapping.IsDelete <> 1
			FOR XML PATH ('')), 1, 1, ''
			) ,'N/A') AS Company
	FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_salesPersons.Designation
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Password] tbl_password ON tbl_password.SalesPersonId = tbl_salesPersons.Id
	WHERE tbl_salesPersons.IsDelete <> 1
	AND (@SearchPrefix IS NULL 
		OR tbl_company.CompanyName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.FirstName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.LastName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.EmailId LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.CountryOfRecidence LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.PassportNumber LIKE '%'+@searchPrefix+'%'
		OR tbl_role.RoleName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.InsuranceCompany LIKE '%'+@searchPrefix+'%'
		OR CONVERT(NVARCHAR(50),tbl_salesPersons.PassportExpiryDate,23) LIKE '%'+@searchPrefix+'%'
		OR CONVERT(NVARCHAR(50),tbl_salesPersons.VisaExpiryDate,23) LIKE '%'+@searchPrefix+'%'
		OR CONVERT(NVARCHAR(50),tbl_salesPersons.InsuarnceExpiryDate,23) LIKE '%'+@searchPrefix+'%'
	)
	GROUP BY tbl_salesPersons.Id,tbl_salesPersons.FirstName,tbl_salesPersons.LastName,tbl_salesPersons.EmailId,tbl_salesPersons.CountryOfRecidence,tbl_salesPersons.PassportNumber,
	tbl_salesPersons.PassportExpiryDate,tbl_role.RoleName,tbl_salesPersons.VisaExpiryDate,tbl_salesPersons.InsuranceCompany,tbl_salesPersons.InsuarnceExpiryDate
	ORDER BY 
		CASE WHEN @sortColumn = 'Name' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.FirstName +' '+tbl_salesPersons.LastName
		END ASC,
		CASE WHEN @sortColumn = 'Name' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.FirstName +' '+tbl_salesPersons.LastName
		END DESC,
		CASE WHEN @sortColumn = 'Email ID' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.EmailId
		END ASC,
		CASE WHEN @sortColumn = 'Email ID' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.EmailId
		END DESC,
		CASE WHEN @sortColumn = 'Country of Residence' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.CountryOfRecidence
		END ASC,
		CASE WHEN @sortColumn = 'Country of Residence' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.CountryOfRecidence
		END DESC,
		CASE WHEN @sortColumn = 'Passport No.' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.PassportNumber
		END ASC,
		CASE WHEN @sortColumn = 'Passport No.' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.PassportNumber
		END DESC,
		CASE WHEN @sortColumn = 'Passport Expiry Date.' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.PassportExpiryDate
		END ASC,
		CASE WHEN @sortColumn = 'Passport Expiry Date.' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.PassportExpiryDate
		END DESC,
		CASE WHEN @sortColumn = 'Designation' AND @sortDirection = 'asc' 
			THEN tbl_role.RoleName
		END ASC,
		CASE WHEN @sortColumn = 'Designation' AND @sortDirection = 'desc'
			THEN tbl_role.RoleName
		END DESC,
		CASE WHEN @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.VisaExpiryDate
		END ASC,
		CASE WHEN @sortColumn = 'Visa Expiry Date' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.VisaExpiryDate
		END DESC,
		CASE WHEN @sortColumn = 'Insurance Company' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.InsuranceCompany
		END ASC,
		CASE WHEN @sortColumn = 'Insurance Company' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.InsuranceCompany
		END DESC,
		CASE WHEN @sortColumn = 'Insurance Expiry Date' AND @sortDirection = 'asc' 
			THEN tbl_salesPersons.InsuarnceExpiryDate
		END ASC,
		CASE WHEN @sortColumn = 'Insurance Expiry Date' AND @sortDirection = 'desc'
			THEN tbl_salesPersons.InsuarnceExpiryDate
		END DESC,
		CASE WHEN @sortColumn = 'Assigned Company' AND @sortDirection = 'asc' 
			THEN (SELECT STUFF(
			(SELECT ', ' + ISNULL(tbl_company.CompanyName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
				LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
				LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
				WHERE tbl_salesPersons1.Id = tbl_salesPersons.Id AND tbl_companyMapping.IsDelete <> 1
			FOR XML PATH ('')), 1, 1, ''
			))
		END ASC,
		CASE WHEN @sortColumn = 'Assigned Company' AND @sortDirection = 'desc'
			THEN (SELECT STUFF(
			(SELECT ', ' + ISNULL(tbl_company.CompanyName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
				LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
				LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
				WHERE tbl_salesPersons1.Id = tbl_salesPersons.Id AND tbl_companyMapping.IsDelete <> 1
			FOR XML PATH ('')), 1, 1, ''
			))
		END DESC
	OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	FETCH NEXT @RowsOfPage ROWS ONLY

	SELECT 
		tbl_salesPersons.Id AS Id
	FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_salesPersons.Designation
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Password] tbl_password ON tbl_password.SalesPersonId = tbl_salesPersons.Id
	WHERE tbl_salesPersons.IsDelete <> 1
	AND (@SearchPrefix IS NULL 
		OR tbl_company.CompanyName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.FirstName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.LastName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.EmailId LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.CountryOfRecidence LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.PassportNumber LIKE '%'+@searchPrefix+'%'
		OR tbl_role.RoleName LIKE '%'+@searchPrefix+'%'
		OR tbl_salesPersons.InsuranceCompany LIKE '%'+@searchPrefix+'%'
		OR CONVERT(NVARCHAR(50),tbl_salesPersons.PassportExpiryDate,23) LIKE '%'+@searchPrefix+'%'
		OR CONVERT(NVARCHAR(50),tbl_salesPersons.VisaExpiryDate,23) LIKE '%'+@searchPrefix+'%'
		OR CONVERT(NVARCHAR(50),tbl_salesPersons.InsuarnceExpiryDate,23) LIKE '%'+@searchPrefix+'%'
	)
	GROUP BY tbl_salesPersons.Id,tbl_salesPersons.FirstName,tbl_salesPersons.LastName,tbl_salesPersons.EmailId,tbl_salesPersons.CountryOfRecidence,tbl_salesPersons.PassportNumber,
	tbl_salesPersons.PassportExpiryDate,tbl_role.RoleName,tbl_salesPersons.VisaExpiryDate,tbl_salesPersons.InsuranceCompany,tbl_salesPersons.InsuarnceExpiryDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllServiceNotifications]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-Oct-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <[USP_Admin_GetAllServiceNotifications>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAllServiceNotifications]
	@service nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_notification.ID,0) AS ID,
		ISNULL(tbl_notification.CompanyId,0) AS CompanyId,
		ISNULL(tbl_notification.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_notification.UserId,0) AS UserId,
		ISNULL(tbl_notification.Username,'N/A') AS Username,
		ISNULL(tbl_notification.Service,'N/A') AS [Service],
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ExpiryDate,105),'N/A') AS ExpiryDate,
		CASE 
			WHEN tbl_notification.LeftDayToExpire > 0 
			THEN 
			ISNULL(tbl_notification.LeftDayToExpire,0) 
			ELSE 
			-1 
		END AS LeftDayToExpire,
		ISNULL(tbl_notification.SendNotificationAfter,0) AS SendNotificationAfter,
		ISNULL(tbl_notification.MarkAsRead,0) AS MarkAsRead,
		ISNULL(tbl_notification.IsActive,0) AS IsActive,
		ISNULL(tbl_notification.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_Notifications] tbl_notification WITH(NOLOCK)
	WHERE tbl_notification.IsDelete <> 1 
	AND tbl_notification.Service = @service
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllServiceRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllServiceRequestByCompanyId 354,0,N'',0
CREATE PROCEDURE [dbo].[USP_Admin_GetAllServiceRequestByCompanyId]
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@Company NVARCHAR(MAX) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;
	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
					THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
					ELSE	
						(SELECT 'N/A')
			END,'N/A') AS ApplicantName,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
				(SELECT TOP(1) Status FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)	
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) END AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL	
				THEN	
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 	
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)	
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status	
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 	
				ELSE 'N/A'	
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser,
				ISNULL(
				(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				) ,'N/A') AS AssignOn
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
		WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL) 
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
			AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
			AND (tbl_serviceRequest.IsDelete <> 1)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
			WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
			AND b.IsDelete <> 1
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
			GROUP BY b.SerialNumber)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,tbl_service.IsCompanyService,
		tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
		tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
		tbl_user.LastName
		ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
				ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
				ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)	
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL	
				THEN	
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 	
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)	
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status	
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 	
				ELSE 'N/A'	
			END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL ) 
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND tbl_serviceRequest.Status = 3
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,tbl_service.IsCompanyService,
			tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
				ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
				ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)	
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL	
				THEN	
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 	
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)	
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status	
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 	
				ELSE 'N/A'	
			END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL ) 
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,tbl_service.IsCompanyService,
			tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllServiceRequestByCompanyId_Cmp]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetAllServiceRequestByCompanyId 354,0,N'',0
CREATE PROCEDURE [dbo].[USP_Admin_GetAllServiceRequestByCompanyId_Cmp]
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@Company NVARCHAR(MAX) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;
	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
			ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
					THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
					ELSE	
						(SELECT 'N/A')
			END,'N/A') AS ApplicantName,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
				(SELECT TOP(1) Status FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)	
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) END AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL	
				THEN	
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 	
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)	
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status	
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 	
				ELSE 'N/A'	
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser,
				ISNULL(
				(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				) ,'N/A') AS AssignOn
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
		WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL) 
			AND (tbl_salesPerson.Id = @SalesPersonId OR @SalesPersonId IS NULL)
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
			AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
			AND (tbl_serviceRequest.IsDelete <> 1)
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
			WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
			AND b.IsDelete <> 1
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
			GROUP BY b.SerialNumber)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,tbl_service.IsCompanyService,
		tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
		tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
		tbl_user.LastName
		ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
				ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
				ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)	
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL	
				THEN	
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 	
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)	
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status	
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 	
				ELSE 'N/A'	
			END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL ) 
				AND (tbl_salesPerson.Id = @SalesPersonId OR @SalesPersonId IS NULL)
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND tbl_serviceRequest.Status = 3
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,tbl_service.IsCompanyService,
			tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
				ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
				ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)	
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL	
				THEN	
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 	
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)	
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status	
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber ORDER BY StepId DESC) 	
				ELSE 'N/A'	
			END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
			LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL ) 
				AND (tbl_salesPerson.Id = @SalesPersonId OR @SalesPersonId IS NULL)
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,tbl_service.IsCompanyService,
			tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllShareholdersDetailsForExport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<SP_Admin_GetAllShareholdersDetailsForExport>
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_GetAllShareholdersDetailsForExport]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(tbl_shareholder.FirstName,'N/A') AS [First Name],
		ISNULL(tbl_shareholder.LastName,'N/A') AS [Last Name],
		ISNULL(tbl_shareholder.SharePercentage +'%','N/A') AS [Share(%)],
		ISNULL(tbl_shareholder.Passport_Number,'N/A') AS [Passport No],
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105),'N/A') AS [Passport Expiry Date], 
		ISNULL(tbl_shareholder.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_shareholder.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105),'N/A') AS [Visa Expiry Date],
		ISNULL(tbl_company.CompanyName,'N/A') AS [Company],	
		ISNULL(tbl_shareholder.IsActive,0) AS IsActive
	FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_company] tbl_company ON tbl_shareholder.CompanyId = tbl_company.Id
	WHERE tbl_shareholder.IsDelete <> 1 AND (tbl_shareholder.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllShareholdersDetailsForExport_Cmp]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-Feb-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	<SP_Admin_GetAllShareholdersDetailsForExport>
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_GetAllShareholdersDetailsForExport_Cmp]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(tbl_shareholder.FirstName,'N/A') AS [First Name],
		ISNULL(tbl_shareholder.LastName,'N/A') AS [Last Name],
		ISNULL(tbl_shareholder.SharePercentage +'%','N/A') AS [Share(%)],
		ISNULL(tbl_shareholder.Passport_Number,'N/A') AS [Passport No],
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,105),'N/A') AS [Passport Expiry Date], 
		ISNULL(tbl_shareholder.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_shareholder.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,105),'N/A') AS [Visa Expiry Date],
		ISNULL(tbl_company.CompanyName,'N/A') AS [Company],	
		ISNULL(tbl_shareholder.IsActive,0) AS IsActive
	FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_company] tbl_company ON tbl_shareholder.CompanyId = tbl_company.Id
	WHERE tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.CompanyId = @CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllSupportTicketsBySalesPerson]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetAllSupportTicketsBySalesPerson]
	@SalesPersonId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_supportTicket.ID,0) AS ID,
		ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_supportTicket.UserId,0) AS UserId,
		ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		ISNULL(tbl_supportTicket.TicketStatus,0) AS TicketStatusId,
		CASE WHEN (SELECT MAX(TicketStatus) FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber)= 1 THEN 1
				 WHEN (SELECT MAX(TicketStatus) FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber)= 2 THEN 2
			END AS TicketStatusId,
		CASE WHEN (SELECT MAX(TicketStatus) FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber)= 1 THEN 'Open'
				WHEN (SELECT MAX(TicketStatus) FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber)= 2 THEN 'Close'
		END AS TicketStatus,
		ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
		ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.ModifyOn,105),'N/A') AS ModifyOn,
		ISNULL(tbl_supportTicket.ModifyBy,0) AS ModifyBy,
		ISNULL(STUFF(
			(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
			WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
			FOR XML PATH ('')), 1, 1, ''
			) ,'N/A') AS AssignedUser
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_assigneduser.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
	WHERE (tbl_salesPerson.Id = @SalesPersonId) 
	AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1 WITH(NOLOCK)
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		GROUP BY TrackingNumber
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAllSupportTicketWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <14-02-2023>
-- Description : Get assigned Support Ticket
-- USP_Admin_GetAllSupportTicketWithPagination 1,50,N'',N'TR No.',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAllSupportTicketWithPagination]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.ID,0) AS ID,
		ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.Id,0)
		ELSE ISNULL(tbl_supportTicket.UserId,0)
		END AS UserId,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
		ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		END AS Username,
		ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_supportTicket.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 1
			ELSE  2
		END AS TicketStatusId,
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_supportTicket.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
		ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
		ISNULL(STUFF(
		(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
		WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
		FOR XML PATH ('')), 1, 1, ''
		) ,'N/A') AS AssignedUser,
		ISNULL((SELECT TOP (1) CONVERT(nvarchar(50),tbl_assign1.CreatedOn,105) FROM [Tbl_AssignSupportTicket] tbl_assign1 
		WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
		ORDER BY tbl_assign1.Id DESC
		),'N/A') AS AssignedOn
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_supportTicket.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_supportTicket.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_supportTicket.TrackingNumber,CHARINDEX('R',tbl_supportTicket.TrackingNumber)+1,LEN(tbl_supportTicket.TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_supportTicket.TrackingNumber,CHARINDEX('R',tbl_supportTicket.TrackingNumber)+1,LEN(tbl_supportTicket.TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN tbl_company.CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN tbl_company.CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
		THEN 
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
		THEN 
			CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END DESC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.CreatedOn
		END ASC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.CreatedOn
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_supportTicket.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END ASC,	
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_supportTicket.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END DESC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'asc' 
			THEN 
				(SELECT TOP (1) tbl_assign1.CreatedOn FROM [Tbl_AssignSupportTicket] tbl_assign1 
					WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
					ORDER BY tbl_assign1.Id DESC
				 )
		END ASC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'desc' 
			THEN 
				(SELECT TOP (1) tbl_assign1.CreatedOn FROM [Tbl_AssignSupportTicket] tbl_assign1 
					WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
					ORDER BY tbl_assign1.Id DESC
				 )
		END DESC


	SELECT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_supportTicket.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_supportTicket.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetApplicantNameBySerialNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetApplicantNameBySerialNumber N'SR276'
CREATE PROCEDURE [dbo].[USP_Admin_GetApplicantNameBySerialNumber]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_serviceFormFieldValue.FieldValue,'N/A') AS ApplicantName
	FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue
	LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValue.FieldId = tbl_serviceformField.Id
	WHERE tbl_serviceformField.FieldName LIKE '%Applicant Name%'
	AND tbl_serviceFormFieldValue.SerialNumber LIKE @SerialNumber
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetArabianCurrentDateTime]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetArabianCurrentDateTime
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get dubai current time
-- USP_Admin_GetArabianCurrentDateTime
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetArabianCurrentDateTime]
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDate NVARCHAR(MAX) = NULL

	SET @currentDate = (SELECT CONVERT(NVARCHAR(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'))

	SELECT @currentDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedClosedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedClosedServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Assigned Close Service Request Count
-- USP_Admin_GetAssignedClosedServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedClosedServiceRequestCount]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		COUNT(*) AS CompanyServiceRequests
    FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest
    LEFT JOIN [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber
    LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id
    WHERE tbl_assignRequest.UserId = @UserId AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
    AND tbl_serviceRequest.IsDelete <> 1 
    AND tbl_serviceRequest.StatusId = 3 


	SELECT 
		COUNT(*) AS EmployeeServiceRequest
    FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest
    LEFT JOIN [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber
    LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id
    WHERE tbl_assignRequest.UserId = @UserId AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
    AND tbl_serviceRequest.IsDelete <> 1 
    AND tbl_serviceRequest.StatusId = 3 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedCompanyIdByUserId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedCompanyIdByUserId
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Assigned Company Id to User
-- USP_Admin_GetAssignedCompanyIdByUserId
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedCompanyIdByUserId]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1) 
		CompanyId 
	FROM [dbo].[Tbl_Company_User_Mapping] user_mapping 
	WHERE UserId = @Id AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedOpenServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedOpenServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Assigned Open Service Request Count
-- USP_Admin_GetAssignedOpenServiceRequestCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedOpenServiceRequestCount]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT  
		COUNT(*) AS CompanyServiceRequests
    FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
    LEFT JOIN [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id 
    WHERE tbl_assignRequest.UserId =@UserId  AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
    AND tbl_serviceRequest.IsDelete <> 1  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;


	SELECT  
		COUNT(*) AS EmployeeServiceRequest
    FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
    LEFT JOIN [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id 
    WHERE tbl_assignRequest.UserId = @UserId AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
    AND tbl_serviceRequest.IsDelete <> 1  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedRejectedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedRejectedServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Assigned Rejected or Cancelled Service Request Count
-- USP_Admin_GetAssignedRejectedServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedRejectedServiceRequestCount]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT  
		COUNT(*) AS CompanyServiceRequests
    FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
    LEFT JOIN [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id 
    WHERE tbl_assignRequest.UserId = @UserId  AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
    AND tbl_serviceRequest.IsDelete <> 1  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5 );
	
	SELECT  
		COUNT(*) AS EmployeeServiceRequest
    FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignRequest 
    LEFT JOIN [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest ON tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_serviceRequest.ServiceId = tbl_service.Id 
    WHERE tbl_assignRequest.UserId =  @UserId AND tbl_assignRequest.SerialNumber = tbl_serviceRequest.SerialNumber  
    AND tbl_serviceRequest.IsDelete <> 1  
    AND (tbl_serviceRequest.StatusId = 4 AND tbl_serviceRequest.StatusId = 5 );
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedRoleListByUserId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedRoleListByUserId
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of Role By User Id
-- USP_Admin_GetAssignedRoleListByUserId
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedRoleListByUserId]	
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_role.RoleName AS RoleName
	FROM [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping
    LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
	WHERE tbl_roleMapping.UserId = @Id;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedSupportTicketWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <14-02-2023>
-- Description : Get assigned Support Ticket
-- USP_Admin_GetAssignedSupportTicketWithPagination N'',128,0,1,50,N'',N'SR No.',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedSupportTicketWithPagination]
	@UserId INT = NULL,
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		ISNULL(tbl_assigneduser.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.ID,0) AS ID,
		ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.Id,0)
		ELSE ISNULL(tbl_supportTicket.UserId,0)
		END AS UserId,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
		ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		END AS Username,
		ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_assigneduser.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 1
			ELSE  2
		END AS TicketStatusId,
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_assigneduser.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
		ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
		ISNULL(STUFF(
		(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
		WHERE tbl_assign.TrackingNumber = tbl_assigneduser.TrackingNumber
		FOR XML PATH ('')), 1, 1, ''
		) ,'N/A') AS AssignedUser
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_assigneduser.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_assigneduser.UserId = @UserId)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_assigneduser.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_assigneduser.TrackingNumber,CHARINDEX('R',tbl_assigneduser.TrackingNumber)+1,LEN(tbl_assigneduser.TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_assigneduser.TrackingNumber,CHARINDEX('R',tbl_assigneduser.TrackingNumber)+1,LEN(tbl_assigneduser.TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN tbl_company.CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN tbl_company.CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN	
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END DESC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.CreatedOn
		END ASC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.CreatedOn
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_assigneduser.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_assigneduser.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_assigneduser.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END ASC,	
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_assigneduser.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END DESC

	SELECT
		ISNULL(tbl_assigneduser.TrackingNumber,'N/A') AS TrackingNumber
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_assigneduser.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_assigneduser.UserId = @UserId)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_assigneduser.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUserByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedUserByCompanyId
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Assigned User Id to Company
-- USP_Admin_GetAssignedUserByCompanyId
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUserByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		user_mapping.UserId AS Id 
	FROM [dbo].[Tbl_Company_User_Mapping] user_mapping
	LEFT JOIN[dbo].[Tbl_User_Role_Mapping] role_mapping ON user_mapping.UserId = role_mapping.UserId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = user_mapping.UserId
	WHERE CompanyId = @CompanyId AND user_mapping.IsDelete <> 1 AND role_mapping.RoleID = 2
	AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUserNamesForCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedUserNamesForCompany
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Assigned Usernames by Company Id
-- USP_Admin_GetAssignedUserNamesForCompany
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUserNamesForCompany]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_user.Id AS Id , 
		tbl_user.FirstName+ ' '+tbl_user.LastName AS Username  
    FROM[dbo].[Tbl_User] tbl_user  
    LEFT JOIN[dbo].[Tbl_Company_User_Mapping] tbl_mapping ON tbl_user.Id = tbl_mapping.UserId  
    WHERE tbl_mapping.CompanyId = @CompanyId  
	AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUserOfSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedUserOfSupportTicket
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of User Assigned to Support Ticket
-- USP_Admin_GetAssignedUserOfSupportTicket
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUserOfSupportTicket]
	@TrackingNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_assign.UserId As UserId 
	FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign 
    LEFT JOIN [dbo].[Tbl_SupportTicket] tbl_supportTicket ON tbl_supportTicket.TrackingNumber = tbl_assign.TrackingNumber 
    WHERE tbl_assign.TrackingNumber = @TrackingNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUsersBySerialNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUsersBySerialNumber]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(STUFF(
		(SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 ON tbl_assignUser1.Id = tbl_assign1.UserId
		WHERE tbl_assign1.SerialNumber = @SerialNumber
		FOR XML PATH ('')), 1, 1, ''),'N/A')
		AS AssignedUser
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUsersIdOfServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetAssignedUsersIdOfServiceRequest
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of all users which are assigned to passed service request
-- USP_Admin_GetAssignedUsersIdOfServiceRequest
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUsersIdOfServiceRequest]
	@serialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		UserId AS UserId 
	FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignServiceRequest
    WHERE SerialNumber LIKE @serialNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUserSupportTicketWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- SP Name:			USP_Admin_GetAssignedUserSupportTicketWithPagination
-- Author:			<Yashasvi Sharma>
-- Created date:	08/July/2023
-- Description:		Get support tickets for admin panel with pagination
-- USP_Admin_GetAssignedUserSupportTicketWithPagination 0,50,N'',N'TR No.','asc',NULL,2814
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUserSupportTicketWithPagination]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@Status INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AssignedUserSupportTablePaginationTbl') IS NOT NULL
	BEGIN
		DROP TABLE ##AssignedUserSupportTablePaginationTbl
	END

	SELECT DISTINCT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(
		(
			tbl_company.CompanyName
		),'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.UserId <> 0 AND tbl_supportTicket.UserId IS NOT NULL
			THEN tbl_user.FirstName + ' ' + tbl_user.LastName
			ELSE tbl_salesPerson.FirstName + ' ' + tbl_salesPerson.LastName
		END AS UserName,
		ISNULL(
			tbl_supportTicket.Title
		,'N/A') AS Title,
		ISNULL(
			CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105)
		,'N/A') AS [CreatedOn],
		tbl_supportTicket.CreatedOn AS CreatedOnDate,
		(SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber) AS [TicketStatusId],
		CASE 
			WHEN (SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC) = 1  
			THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(
			STUFF(
				(
					SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
					FOR XML PATH ('')
				), 1, 1, '') 
		,'N/A') AS AssignedUser,
		ISNULL(
			(SELECT TOP (1) 
				CONVERT(nvarchar(50),tbl_assign1.CreatedOn,105) 
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
			)
		,'N/A') AS AssignedOn,
		(
			SELECT TOP (1) 
				tbl_assign1.CreatedOn
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
		) AS AssignedOnDate
	INTO ##AssignedUserSupportTablePaginationTbl
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_supportTicket.SalesPersonId = tbl_salesPerson.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assignedSupportTicketUser ON tbl_supportTicket.TrackingNumber = tbl_assignedSupportTicketUser.TrackingNumber
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND tbl_assignedSupportTicketUser.UserId = @UserId
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	AND ((SELECT TOP 1 TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC)= @Status OR @Status IS NULL OR @Status = 0)

	SELECT * FROM ##AssignedUserSupportTablePaginationTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN 
				CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN 
				CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN 
				UserName
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				UserName
		END DESC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'asc' 
			THEN 
				CreatedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'desc' 
			THEN 
				CreatedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN 
				Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN 
				Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				AssignedUser
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				AssignedUser
		END DESC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'asc' 
			THEN 
				AssignedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'desc' 
			THEN 
				AssignedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				TicketStatus
		END ASC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				TicketStatus
		END DESC

	OFFSET @pageNumber ROWS 
	FETCH NEXT @rowsOfPage ROWS ONLY


	SELECT COUNT(*) AS totalSupportTickets FROM ##AssignedUserSupportTablePaginationTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetAssignedUserToCompanyForPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <06-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <15-Nov-2022>
-- Description:	<<USP_Admin_GetCompanyDetailsForPermission N'DIBN102'>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetAssignedUserToCompanyForPermission]
	@AccountNumber NVARCHAR(MAX) = NULL,
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @countOfUser INT =NULL,@CompanyId INT = NULL;
	DECLARE @roleId INT = NULL;
	IF @Email IS NOT NULL AND @AccountNumber IS NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company
		WHERE (tbl_Company.EmailID = @Email OR tbl_Company.SecondEmailID = @Email) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1) 
		BEGIN
			SET @CompanyId = (SELECT Id FROM [dbo].[Tbl_Company] WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0)
			SET @countOfUser = (SELECT COUNT(Id) FROM [dbo].[Tbl_Company_User_Mapping] WHERE CompanyId = @CompanyId AND IsDelete <> 1)
			IF @countOfUser > 0
			BEGIN
				
				SET @roleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')
				SELECT TOP(1) ISNULL(tbl_user.Id,0) AS Id
				FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.CompanyId = tbl_Company.Id
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_role_mapping ON tbl_role_mapping.UserId = tbl_user.Id
				WHERE (tbl_Company.EmailID = @Email OR tbl_Company.SecondEmailID = @Email) 
				AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
				AND tbl_company_user_mapping.IsDelete <> 1 AND tbl_user.IsLogin <> 0 AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1
				AND tbl_role_mapping.RoleID = @roleId
			END
			ELSE
			BEGIN
				SELECT 0 AS Id
			END
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
	ELSE IF @AccountNumber IS NOT NULL AND @Email IS NULL
	BEGIN
		IF EXISTS(
			SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
			WHERE (tbl_Company.AccountNumber = @AccountNumber) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
		)
		BEGIN
			SET @CompanyId = (SELECT Id FROM [dbo].[Tbl_Company] WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0)
			SET @countOfUser = (SELECT COUNT(Id) FROM [dbo].[Tbl_Company_User_Mapping] WHERE CompanyId = @CompanyId AND IsDelete <> 1)
			IF @countOfUser > 0
			BEGIN
				SET @roleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')

				SELECT TOP(1) ISNULL(tbl_user.Id,0) AS Id
				FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.CompanyId = tbl_Company.Id
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_role_mapping ON tbl_role_mapping.UserId = tbl_user.Id
				WHERE (tbl_Company.AccountNumber = @AccountNumber)
				AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
				AND tbl_company_user_mapping.IsDelete <> 1 AND tbl_user.IsLogin <> 0 AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1
				AND tbl_role_mapping.RoleID = @roleId
			END
			ELSE
			BEGIN
				SELECT 0 AS Id
			END
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetBalanceSheetCompanyList]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================================
-- SP Name :			USP_Admin_GetBalanceSheetCompanyList 
-- Author :				<Yashasvi Sharma>
-- Created Date :		<12-July-2023>
-- Description :		Get Company List for Balance Sheet Report
-- USP_Admin_GetBalanceSheetCompanyList
-- =============================================================

CREATE PROCEDURE [dbo].[USP_Admin_GetBalanceSheetCompanyList]
	@skipRows INT = NULL,
	@rowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_company.Id AS Id,
		tbl_company.CompanyName AS CompanyName,
		tbl_company.AccountNumber AS CompanyAccountNumber
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN'
	AND (
		@searchPrefix IS NULL
		OR tbl_company.CompanyName LIKE '%' + @searchPrefix + '%'
		OR tbl_company.AccountNumber LIKE '%' + @searchPrefix + '%'
	)
	GROUP BY tbl_company.Id,tbl_company.CompanyName,tbl_company.AccountNumber
	ORDER BY 
	CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
		THEN tbl_company.Id 
	END ASC,
	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
		THEN tbl_company.CompanyName
	END ASC,
	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
		THEN tbl_company.CompanyName
	END DESC,
	CASE WHEN @sortColumn = 'Company Account Number' AND @sortColumn = 'asc'
		THEN (SELECT CONVERT(int,SUBSTRING(tbl_company.AccountNumber,PATINDEX('%[0-9]%',tbl_company.AccountNumber),LEN(tbl_company.AccountNumber))))
	END ASC,
	CASE WHEN @sortColumn = 'Company Account Number' AND @sortColumn = 'desc'
		THEN (SELECT CONVERT(int,SUBSTRING(tbl_company.AccountNumber,PATINDEX('%[0-9]%',tbl_company.AccountNumber),LEN(tbl_company.AccountNumber)))) 
	END DESC
	OFFSET @skipRows ROWS
	FETCH NEXT @rowsOfPage ROWS ONLY

	SELECT COUNT(*) AS CompanyCount
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN'
	AND (
		@searchPrefix IS NULL
		OR tbl_company.CompanyName LIKE '%'+@searchPrefix+'%'
		OR tbl_company.AccountNumber LIKE '%'+@searchPrefix+'%'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetBasicSupportTicketDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetBasicSupportTicketDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Basic of Support Ticket for adding assigned user details as response
-- USP_Admin_GetBasicSupportTicketDetails
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetBasicSupportTicketDetails]
	@TrackingNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1) 
		TrackingNumber AS TrackingNumber,
		ISNULL(SalesPersonId,0) AS SalesPersonId,
		ISNULL(CompanyId,0) AS CompanyId,
		ISNULL(ParentId,0) AS ParentId,
		ISNULL(Title,'N/A') AS Title,
		ISNULL(UserId,0) AS UserId,
		ISNULL(TicketStatus,0) AS TicketStatus,
		ISNULL(CreatedBy,0) AS CreatedBy
	FROM [dbo].[Tbl_SupportTicket] 
	WHERE TrackingNumber LIKE @TrackingNumber 
	ORDER BY Id DESC
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCloseEmployeeServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- EXEC USP_Admin_GetCloseEmployeeServicesRequestByCompanyId 1,10,null,'Created By','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetCloseEmployeeServicesRequestByCompanyId]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	IF OBJECT_ID(N'tempdb..#closeServiceRequest') IS NOT NULL BEGIN	DROP TABLE #closeServiceRequest END
	
	SELECT DISTINCT ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForms.FormName,'N/A') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName, 
		ISNULL((SELECT tbl_serviceFormFieldValues.FieldValue FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues 
		LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
			WHERE tbl_serviceformField.FieldName LIKE '%Applicant Name%'
			AND tbl_serviceFormFieldValues.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber),'N/A') AS ApplicantName,
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName,'N/A')
		ELSE 
			ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName ,'N/A') 
		END AS RequestedBy, 
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),'N/A') AS CreatedOn,
		ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
		ISNULL(
			tbl_serviceRequestStatus.Status
		,'N/A') AS Status,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
					FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('')), 1, 1, ''),'N/A') AS AssignedUser, 
		ISNULL((SELECT TOP(1) 
			ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
			WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,'N/A') AS AssignOn,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
		WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
		WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
		FOR XML PATH ('')), 1, 1, ''),'N/A') AS SalesPerson
		INTO #closeServiceRequest
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId
		WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
		AND (tbl_serviceRequest.IsDelete <> 1)  AND tbl_service.IsEmployeeService <> 0 AND tbl_serviceRequest.Id = 
						(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
							WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							AND b.IsDelete <> 1
							ORDER BY b.StepId DESC )
		AND (@searchPrefix IS NULL 
			OR tbl_serviceFormFieldValue.SerialNumber LIKE @searchPrefix +'%'
			OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceForms.FormName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceRequestStatus.Status LIKE '%' + @searchPrefix +'%')
		AND tbl_serviceRequest.Status = 3

	SET @orderByClause = N'ORDER BY ' 
			
	IF @sortColumn = '' OR @sortColumn IS NULL
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' DESC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' ASC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' DESC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' ASC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+' ASC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+' ASC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+ ' DESC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+' ASC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+ ' DESC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+' ASC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+ ' DESC'
	END

	SET @pagination = ' OFFSET (@PageNumber-1)*@RowsOfPage ROWS
						FETCH NEXT @RowsOfPage ROWS ONLY'
	
	SET @selectQuery = 'select * from #closeServiceRequest ' +@orderByClause +' '+@pagination
	
	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@PageNumber INT,@RowsOfPage INT',@searchPrefix,@PageNumber,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCloseServiceCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCloseServiceCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Close Services For Admin Panel
-- USP_Admin_GetCloseServiceCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCloseServiceCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) AS CompanyServices	
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_companyServiceRequest.IsDelete <> 1) 
    AND tbl_companyServiceRequest.StatusId = 3 

	SELECT DISTINCT 
		COUNT(*) AS EmployeeServices
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequests  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequests.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_employeeServiceRequests.IsDelete <> 1) 
    AND tbl_employeeServiceRequests.StatusId = 3 ;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCloseSupportTicketCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCloseSupportTicketCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Close Support Ticket For Admin Panel
-- USP_Admin_GetCloseSupportTicketCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCloseSupportTicketCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		COUNT(*) 
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket
	WHERE tbl_supportTicket.TicketStatus = 2  
    AND tbl_supportTicket.ID IN(SELECT MAX(ID) FROM [dbo].[Tbl_SupportTicket] b  
    WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber ) 
	AND (IsDelete <> 1 OR IsDelete IS NULL);
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyAccountDetailBalanceForPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-03-2024>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get Company Account Details Balance With Pagination>
-- <USP_Admin_GetCompanyAccountDetailBalanceForPagination 2,20,N'',N'',N'Transaction Id',N'asc'>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyAccountDetailBalanceForPagination]
	@CompanyId INT = NULL,
	@skipRows  INT = NULL,
	@searchBy NVARCHAR(MAX) =NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN

DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) ='',
		@subQuery AS NVARCHAR(MAX) ='',
		@subQueryGroupBy AS NVARCHAR(MAX) = '';

	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	SET @query = N'WITH 
	transactionTbl
	AS
	(
		SELECT 
			ISNULL(tbl_payment.Id,0) AS Id, 
			ISNULL(tbl_payment.CompanyId,0) AS CompanyId,
			ISNULL(tbl_payment.TransactionId,''N/A'') AS TransactionId, 
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
			FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo, 
			ISNULL(tbl_payment.PaymentMode,''N/A'') AS PaymentMode,
			ISNULL(tbl_payment.Description,''N/A'') AS Description,
			CASE 
				WHEN tbl_payment.TotalAmount IS NULL 
				THEN ISNULL(tbl_payment.Amount,0) 
				ELSE ISNULL(tbl_payment.TotalAmount,0)
				END 
			AS GrandTotal, 
			''0'' AS Vat,  
			''0'' AS VatAmount,
			CONVERT(DATE,tbl_payment.TransectionDate) AS CreatedOn,
			CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
			ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
			tbl_payment.IsDelete AS IsDelete,
			tbl_paymentReceipt.IsDelete AS PaymentReceiptIsDelete,
			''Credit'' AS TransactionType
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id  
		WHERE tbl_payment.CompanyId = @CompanyId
		GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_payment.Amount,tbl_payment.TransactionId,tbl_payment.PaymentMode,
		tbl_payment.Description,tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,
		tbl_payment.IsDelete,tbl_paymentReceipt.IsDelete

		UNION ALL

		SELECT 
			ISNULL(tbl_portalExpenses.Id,0) AS Id, 
			ISNULL(tbl_portalExpenses.CompanyId,0) AS CompanyId, 
			ISNULL(tbl_portalExpenses.TransactionId,''N/A'') AS TransactionId, 
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
			FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_portalExpenses.Id ) AS TransactionIdNo, 
			''--'' AS PaymentMode,
			ISNULL(tbl_portalExpenses.ExpensesTitle,''N/A'') AS Description,  
			CASE 
				WHEN tbl_portalExpenses.GrandTotal IS NULL THEN ISNULL(tbl_portalExpenses.TotalAmount,0)
				ELSE ISNULL(''-''+tbl_portalExpenses.GrandTotal,0)
			END AS GrandTotal, 
			ISNULL(tbl_portalExpenses.Vat,''0'') AS Vat,  
			ISNULL(tbl_portalExpenses.VatAmount,''0'') AS VatAmount,  
			CONVERT(DATE,tbl_portalExpenses.CreatedOnUtc) AS CreatedOn, 
			CONVERT(NVARCHAR(50),tbl_portalExpenses.CreatedOnUtc,105) AS [Date], 
			ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_portalExpenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId,
			tbl_portalExpenses.IsDelete AS IsDelete,
			''0'' AS PaymentReceiptIsDelete,
			''Debit'' AS TransactionType
		FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK)  ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId 
		WHERE tbl_portalExpenses.CompanyId = @CompanyId
		GROUP BY tbl_portalExpenses.Id,tbl_portalExpenses.CompanyId,tbl_portalExpenses.ExpensesTitle,tbl_portalExpenses.TransactionId, 
		tbl_portalExpenses.GrandTotal,tbl_portalExpenses.TotalAmount,tbl_portalExpenses.Vat,tbl_portalExpenses.VatAmount,tbl_portalExpenses.CreatedOnUtc,
		tbl_portalExpenses.IsDelete
	)'

	SET @subQuery = N'SELECT * FROM transactionTbl
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (PaymentReceiptIsDelete <> 1 OR PaymentReceiptIsDelete IS NULL)
	'

	IF @searchBy IS NOT NULL AND @searchPrefix IS NOT NULL
		BEGIN
			IF @searchBy = N'Transaction Id'
			BEGIN
				SET @conditions = N' AND TransactionId = '''+@searchPrefix+''''
			END
			IF @searchBy = N'Transaction Id No'
			BEGIN
				SET @conditions = N' AND CONVERT(NVARCHAR(50),TransactionIdNo) = '''+@searchPrefix+''''
			END
			IF @searchBy = N'Date'
			BEGIN
				SET @conditions = N' AND [Date] = '''+@searchPrefix+''''
			END
			IF @searchBy = N'Description'
			BEGIN
				SET @conditions = N' AND Description LIKE ''%'+@searchPrefix+'%'''
			END
			IF @searchBy = N'Credit(AED)'
			BEGIN
				SET @conditions = N' AND CONVERT(NVARCHAR(50),GrandTotal) = '''+@searchPrefix+''''
				SET @conditions = @conditions + N' AND TransactionType = ''Credit'''
			END
			IF @searchBy = N'Debit(AED)'
			BEGIN
				SET @conditions = N' AND CONVERT(NVARCHAR(50),GrandTotal) = '''+@searchPrefix+''''
				SET @conditions = @conditions + N' AND TransactionType = ''Debit'''
			END
			IF @searchBy = N'Vat(%)'
			BEGIN
				SET @conditions = N' AND CONVERT(NVARCHAR(50),Vat) = '''+@searchPrefix+''''
			END
			IF @searchBy = N'Vat Amount'
			BEGIN
				SET @conditions = N' AND CONVERT(NVARCHAR(50),VatAmount) = '''+@searchPrefix+''''
			END
		END
		ELSE
		BEGIN
			SET @conditions = N' AND (@searchPrefix IS NULL)'
		END

	SET @orderByClause = N' ORDER BY '

	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionIdNo '
		+ ' ASC '
	END

	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionIdNo '
		+ ' DESC '
	END

	IF @sortColumn = 'Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn '
		+ ' ASC '
	END

	IF @sortColumn = 'Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn '
		+ ' DESC '
	END

	IF @sortColumn = 'Description' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' Description '
		+ ' ASC '
	END

	IF @sortColumn = 'Description' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' Description '
		+ ' DESC '
	END

	SET @pagination = N'OFFSET 0 ROWS
					FETCH NEXT @skipRows ROWS ONLY;'

	SET @selectQuery = @query +' ' + @subQuery +' ' + @conditions +' ' + @orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery
		,N'@searchPrefix NVARCHAR(MAX),@conditions NVARCHAR(MAX),@CompanyId INT,@skipRows INT'
		,@searchPrefix,@conditions,@CompanyId,@skipRows;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyAccountDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetCompanyAccountDetails 283
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyAccountDetails]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(MAX) = NULL,
	@ToDate NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @FromDate IS NOT NULL AND @ToDate IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE CompanyId=@CompanyId)
		BEGIN
			SELECT DISTINCT
				tbl_payment.Id AS PaymentTransactionId,
				tbl_payment.CompanyId AS CompanyId ,
				tbl_payment.Amount AS Amount,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				tbl_payment.PaymentMode AS PaymentMode,
				tbl_payment.Description AS Description,
				ISNULL(tbl_payment.Quantity,1) AS Quantity,
				CASE WHEN tbl_payment.TotalAmount IS NULL THEN tbl_payment.Amount
				ELSE tbl_payment.TotalAmount END AS PaymentCredit,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE tbl_payment.CompanyId=@CompanyId 
			AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
			AND (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
		END
		ELSE
		BEGIN
			SELECT 
			'-1' AS PaymentTransactionId,
			'-1' AS CompanyId,
			'-1' AS Amount,
			'-1' AS TransactionId,
			'-1' AS TransactionIdNo,
			'-1' AS PaymentMode,
			'-1' AS Description,
			'-1' AS Quantity,
			'-1' AS PaymentCredit,
			'-1' AS ExpenseReceiptId,
			'-1' AS [Date]
		END


		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE CompanyId =@CompanyId)
		BEGIN
			SELECT DISTINCT
				tbl_portalExpenses.Id AS Id,
				tbl_portalExpenses.CompanyId AS CompanyId,
				tbl_portalExpenses.ExpensesTitle AS ExpensesTitle,
				tbl_portalExpenses.TransactionId AS TransactionId,
				CASE 
					WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
					ELSE tbl_portalExpenses.GrandTotal END AS ExpenseAmount,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_portalExpenses.Id ) AS TransactionIdNo,
				ISNULL(tbl_portalExpenses.Vat,'0') AS Vat,
				ISNULL(tbl_portalExpenses.VatAmount,'0') AS VatAmount,
				CASE 
					WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
					ELSE tbl_portalExpenses.GrandTotal END AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_portalExpenses.CreatedOnUtc,105) AS [Date],
				ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_portalExpenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK) ON tbl_payment.CompanyId = tbl_portalExpenses.CompanyId
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId
			WHERE tbl_portalExpenses.CompanyId =@CompanyId AND (CONVERT(date,tbl_portalExpenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_portalExpenses.CreatedOnUtc) <= CONVERT(date,@ToDate)) 
			AND tbl_portalExpenses.IsDelete <> 1
		END
		ELSE
		BEGIN
			SELECT 
			'-1' AS Id,
			'-1' AS CompanyId,
			'-1' AS ExpensesTitle,
			'-1' AS ExpenseAmount,
			'-1' AS GrandTotal,
			'-1' AS TransactionId,
			'-1' AS TransactionIdNo,
			'-1' AS Vat,
			'-1' AS ExpenseReceiptId,
			'-1' AS VatAmount,
			'-1' AS [Date]
		END
	END
	ELSE
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE CompanyId=@CompanyId)
		BEGIN
			SELECT DISTINCT
				tbl_payment.Id AS PaymentTransactionId,
				tbl_payment.CompanyId AS CompanyId,
				tbl_payment.Amount AS Amount,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				tbl_payment.PaymentMode AS PaymentMode,
				tbl_payment.Description AS Description,
				ISNULL(tbl_payment.Quantity,1) AS Quantity,
				CASE WHEN tbl_payment.TotalAmount IS NULL THEN tbl_payment.Amount
				ELSE tbl_payment.TotalAmount END AS PaymentCredit,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE tbl_payment.CompanyId=@CompanyId AND (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
		END
		ELSE
		BEGIN
			SELECT '-1' AS PaymentTransactionId,
			'-1' AS CompanyId,
			'-1' AS Amount,
			'-1' AS TransactionId,
			'-1' AS PaymentMode,
			'-1' AS TransactionIdNo,
			'-1' AS Description,
			'-1' AS Quantity,
			'-1' AS PaymentCredit,
			'-1' AS ExpenseReceiptId,
			'-1' AS [Date]
		END


		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE CompanyId =@CompanyId)
		BEGIN
			SELECT DISTINCT
				tbl_portalExpenses.Id AS Id,
				tbl_portalExpenses.CompanyId AS CompanyId,
				tbl_portalExpenses.ExpensesTitle AS ExpensesTitle,
				tbl_portalExpenses.TransactionId AS TransactionId,
				CASE 
					WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
					ELSE tbl_portalExpenses.GrandTotal END AS ExpenseAmount,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_portalExpenses.Id ) AS TransactionIdNo,
				ISNULL(tbl_portalExpenses.Vat,'0') AS Vat,
				ISNULL(tbl_portalExpenses.VatAmount,'0') AS VatAmount,
				CASE 
					WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
					ELSE tbl_portalExpenses.GrandTotal END AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_portalExpenses.CreatedOnUtc,105) AS [Date],
				ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_portalExpenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK) ON tbl_payment.CompanyId = tbl_portalExpenses.CompanyId
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId
			WHERE tbl_portalExpenses.CompanyId =@CompanyId AND tbl_portalExpenses.IsDelete <> 1
		END
		ELSE
		BEGIN
			SELECT 
			'-1' AS Id,
			'-1' AS CompanyId,
			'-1' AS ExpensesTitle,
			'-1' AS ExpenseAmount,
			'-1' AS GrandTotal,
			'-1' AS TransactionIdNo,
			'-1' AS TransactionId,
			'-1' AS Vat,
			'-1' AS VatAmount,
			'-1' AS [Date],
			'-1'  AS ExpenseReceiptId
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyAccountDetailWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-03-2023>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get Company Account Details With Pagination>
-- <USP_Admin_GetCompanyAccountDetailWithPagination 2,0,20,N'',N'',N'Transaction Id',N'asc'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyAccountDetailWithPagination]
	@CompanyId INT = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) ='',
		@subQuery AS NVARCHAR(MAX) ='';

	SET @query = N'WITH 
			transactionTbl
			AS
			(
				SELECT 
					ISNULL(tbl_payment.Id,0) AS Id, 
					ISNULL(tbl_payment.CompanyId,0) AS CompanyId,
					ISNULL(tbl_payment.TransactionId,''N/A'') AS TransactionId, 
					(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo, 
					ISNULL(tbl_payment.PaymentMode,''N/A'') AS PaymentMode,
					ISNULL(tbl_payment.Description,''N/A'') AS Description,
					CASE 
						WHEN tbl_payment.TotalAmount IS NULL 
						THEN ISNULL(tbl_payment.Amount,0) 
						ELSE ISNULL(tbl_payment.TotalAmount,0)
						END 
					AS GrandTotal, 
					''0'' AS Vat,  
					''0'' AS VatAmount,
					CONVERT(DATE,tbl_payment.TransectionDate) AS CreatedOn,
					CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
					ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
					tbl_payment.IsDelete AS IsDelete,
					tbl_paymentReceipt.IsDelete AS PaymentReceiptIsDelete,
					''Credit'' AS TransactionType
				FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id  
				WHERE tbl_payment.CompanyId = @CompanyId
				GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_payment.Amount,tbl_payment.TransactionId,tbl_payment.PaymentMode,
				tbl_payment.Description,tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,
				tbl_payment.IsDelete,tbl_paymentReceipt.IsDelete

				UNION ALL

				SELECT 
					ISNULL(tbl_portalExpenses.Id,0) AS Id, 
					ISNULL(tbl_portalExpenses.CompanyId,0) AS CompanyId, 
					ISNULL(tbl_portalExpenses.TransactionId,''N/A'') AS TransactionId, 
					(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_portalExpenses.Id ) AS TransactionIdNo, 
					''--'' AS PaymentMode,
					ISNULL(tbl_portalExpenses.ExpensesTitle,''N/A'') AS Description,  
					CASE 
						WHEN tbl_portalExpenses.GrandTotal IS NULL THEN ISNULL(tbl_portalExpenses.TotalAmount,0)
						ELSE ISNULL(tbl_portalExpenses.GrandTotal,0)
					END AS GrandTotal, 
					ISNULL(tbl_portalExpenses.Vat,''0'') AS Vat,  
					ISNULL(tbl_portalExpenses.VatAmount,''0'') AS VatAmount,  
					CONVERT(DATE,tbl_portalExpenses.CreatedOnUtc) AS CreatedOn, 
					CONVERT(NVARCHAR(50),tbl_portalExpenses.CreatedOnUtc,105) AS [Date], 
					ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_portalExpenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId,
					tbl_portalExpenses.IsDelete AS IsDelete,
					''0'' AS PaymentReceiptIsDelete,
					''Debit'' AS TransactionType
				FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK)  ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId 
				WHERE tbl_portalExpenses.CompanyId =@CompanyId
				GROUP BY tbl_portalExpenses.Id,tbl_portalExpenses.CompanyId,tbl_portalExpenses.ExpensesTitle,tbl_portalExpenses.TransactionId, 
				tbl_portalExpenses.GrandTotal,tbl_portalExpenses.TotalAmount,tbl_portalExpenses.Vat,tbl_portalExpenses.VatAmount,tbl_portalExpenses.CreatedOnUtc,
				tbl_portalExpenses.IsDelete
			)'

	SET @subQuery = N'SELECT * FROM transactionTbl
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (PaymentReceiptIsDelete <> 1 OR PaymentReceiptIsDelete IS NULL)'

	IF @searchBy IS NOT NULL AND @searchPrefix IS NOT NULL
	BEGIN
		IF @searchBy = N'Transaction Id'
		BEGIN
			SET @conditions = N' AND TransactionId = '''+@searchPrefix+''''
		END
		IF @searchBy = N'Transaction Id No'
		BEGIN
			SET @conditions = N' AND CONVERT(NVARCHAR(50),TransactionIdNo) = '''+@searchPrefix+''''
		END
		IF @searchBy = N'Date'
		BEGIN
			SET @conditions = N' AND [Date] = '''+@searchPrefix+''''
		END
		IF @searchBy = N'Description'
		BEGIN
			SET @conditions = N' AND Description LIKE ''%'+@searchPrefix+'%'''
		END
		IF @searchBy = N'Credit(AED)'
		BEGIN
			SET @conditions = N' AND CONVERT(NVARCHAR(50),GrandTotal) = '''+@searchPrefix+''''
			SET @conditions = @conditions + N' AND TransactionType = ''Credit'''
		END
		IF @searchBy = N'Debit(AED)'
		BEGIN
			SET @conditions = N' AND CONVERT(NVARCHAR(50),GrandTotal) = '''+@searchPrefix+''''
			SET @conditions = @conditions + N' AND TransactionType = ''Debit'''
		END
		IF @searchBy = N'Vat(%)'
		BEGIN
			SET @conditions = N' AND CONVERT(NVARCHAR(50),Vat) = '''+@searchPrefix+''''
		END
		IF @searchBy = N'Vat Amount'
		BEGIN
			SET @conditions = N' AND CONVERT(NVARCHAR(50),VatAmount) = '''+@searchPrefix+''''
		END
	END
	ELSE
	BEGIN
		SET @conditions = N' AND (@searchPrefix IS NULL)'
	END

	SET @orderByClause = N' ORDER BY '

	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionIdNo '
		+ ' ASC '
	END

	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionIdNo '
		+ ' DESC '
	END

	IF @sortColumn = 'Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn '
		+ ' ASC '
	END

	IF @sortColumn = 'Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn '
		+ ' DESC '
	END

	IF @sortColumn = 'Description' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' Description '
		+ ' ASC '
	END

	IF @sortColumn = 'Description' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' Description '
		+ ' DESC '
	END

	SET @pagination = N'OFFSET @skipRows ROWS
					FETCH NEXT @RowsOfPage ROWS ONLY;'

	SET @selectQuery = @query +' '+ @subQuery +' ' + @conditions + ' '+@orderByClause +' '+@pagination 

	EXEC SP_EXECUTESQL @selectQuery
		,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX),@conditions NVARCHAR(MAX),@CompanyId INT'
		,@skipRows,@RowsOfPage,@searchPrefix,@conditions,@CompanyId;

	SET @subQuery = N'SELECT COUNT(*) AS TransactionCount FROM transactionTbl
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (PaymentReceiptIsDelete <> 1 OR PaymentReceiptIsDelete IS NULL)'

	SET @selectQuery = @query +' '+ @subQuery +' ' + @conditions

	EXEC SP_EXECUTESQL @selectQuery
		,N'@searchPrefix NVARCHAR(MAX),@conditions NVARCHAR(MAX),@CompanyId INT'
		,@searchPrefix,@conditions,@CompanyId;

	--SET @query = N'
	--				SELECT 
	--					ISNULL(tbl_payment.Id,0) AS PaymentTransactionId, 
	--					ISNULL(tbl_payment.CompanyId,0) AS CompanyId, 
	--					ISNULL(tbl_payment.Amount,0) AS Amount, 
	--					ISNULL(tbl_payment.TransactionId,''N/A'') AS TransactionId, 
	--					(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo, 
	--					ISNULL(tbl_payment.PaymentMode,''N/A'') AS PaymentMode, 
	--					ISNULL(tbl_payment.Description,''N/A'') AS Description,
	--					ISNULL(tbl_payment.Quantity,1) AS Quantity, 
	--					CASE 
	--						WHEN tbl_payment.TotalAmount IS NULL 
	--						THEN ISNULL(tbl_payment.Amount,0) 
	--						ELSE ISNULL(tbl_payment.TotalAmount,0)
	--						END 
	--					AS PaymentCredit, 
	--					CONVERT(DATE,tbl_payment.TransectionDate) AS [Date], 
	--					ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId 
	--				FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK) 
	--				LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id  
	--			'
	
	--SET @conditions = N' WHERE tbl_payment.CompanyId=@CompanyId 
	--					AND (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	--					AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL) '

	--SET @groupByClause = N' GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_payment.Amount,tbl_payment.TransactionId,tbl_payment.PaymentMode,
	--					tbl_payment.Description,tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id
	--					'
	--SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 


	--SET @query = N' SELECT 
	--					ISNULL(tbl_portalExpenses.Id,0) AS Id, 
	--					ISNULL(tbl_portalExpenses.CompanyId,0) AS CompanyId, 
	--					ISNULL(tbl_portalExpenses.ExpensesTitle,''N/A'') AS ExpensesTitle,  
	--					ISNULL(tbl_portalExpenses.TransactionId,''N/A'') AS TransactionId,  
	--					CASE 
	--						WHEN tbl_portalExpenses.GrandTotal IS NULL THEN ISNULL(tbl_portalExpenses.TotalAmount,0)
	--						ELSE ISNULL(tbl_portalExpenses.GrandTotal,0)
	--					END AS ExpenseAmount, 
	--					(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_portalExpenses.Id ) AS TransactionIdNo, 
	--					ISNULL(tbl_portalExpenses.Vat,''0'') AS Vat,  
	--					ISNULL(tbl_portalExpenses.VatAmount,''0'') AS VatAmount,  
	--					CASE  
	--						WHEN tbl_portalExpenses.GrandTotal IS NULL THEN ISNULL(tbl_portalExpenses.TotalAmount,0)
	--						ELSE ISNULL(tbl_portalExpenses.GrandTotal,0)
	--					END AS GrandTotal,
	--					CONVERT(DATE,tbl_portalExpenses.CreatedOnUtc) AS [Date], 
	--					ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_portalExpenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId 
	--			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK) 
	--			LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)  ON tbl_payment.CompanyId = tbl_portalExpenses.CompanyId 
	--			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK)  ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId 
	--		'

	--SET @conditions = N' WHERE tbl_portalExpenses.CompanyId =@CompanyId AND tbl_portalExpenses.IsDelete <> 1 '

	--SET @groupByClause = N' GROUP BY tbl_portalExpenses.Id,tbl_portalExpenses.CompanyId,tbl_portalExpenses.ExpensesTitle,tbl_portalExpenses.TransactionId, 
	--					tbl_portalExpenses.GrandTotal,tbl_portalExpenses.TotalAmount,tbl_portalExpenses.Vat,tbl_portalExpenses.VatAmount,tbl_portalExpenses.CreatedOnUtc
	--					'

	--SET @selectQuery = @selectQuery +' '+ @query +' '+ @conditions +' '+ @groupByClause

	--EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT',@CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyAccountDetailWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <09-03-2023>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get Company Account Details With Pagination Count>
-- <USP_Admin_GetCompanyAccountDetailWithPaginationCount 41>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyAccountDetailWithPaginationCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

	SET @query = N'
					SELECT 
						ISNULL(tbl_payment.Id,0) AS PaymentTransactionId,
						CASE 
							WHEN tbl_payment.TotalAmount IS NULL 
							THEN tbl_payment.Amount 
							ELSE tbl_payment.TotalAmount 
							END 
						AS PaymentCredit
					FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id  
				'
	
	SET @conditions = N' WHERE tbl_payment.CompanyId=@CompanyId 
						AND (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
						AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL) '

	SET @groupByClause = N' GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_payment.Amount,tbl_payment.TransactionId,tbl_payment.PaymentMode,
						tbl_payment.Description,tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id
						'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 


	SET @query = N' SELECT 
						ISNULL(tbl_portalExpenses.Id,0) AS Id, 
						CASE  
							WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
							ELSE tbl_portalExpenses.GrandTotal 
						END AS GrandTotal
				FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK) 
				LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)  ON tbl_payment.CompanyId = tbl_portalExpenses.CompanyId 
				LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK)  ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId 
			'

	SET @conditions = N' WHERE tbl_portalExpenses.CompanyId =@CompanyId AND tbl_portalExpenses.IsDelete <> 1 '

	SET @groupByClause = N' GROUP BY tbl_portalExpenses.Id,tbl_portalExpenses.CompanyId,tbl_portalExpenses.ExpensesTitle,tbl_portalExpenses.TransactionId, 
						tbl_portalExpenses.GrandTotal,tbl_portalExpenses.TotalAmount,tbl_portalExpenses.Vat,tbl_portalExpenses.VatAmount,tbl_portalExpenses.CreatedOnUtc
						'

	SET @selectQuery = @selectQuery +' '+ @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT',@CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyCloseServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyCloseServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company's Close Service Request Count
-- USP_Admin_GetCompanyCloseServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyCloseServiceRequestCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    WHERE (tbl_serviceRequest.CompanyId = @CompanyId  ) 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId = 3 ;


	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    WHERE (tbl_serviceRequest.CompanyId = @CompanyId  ) 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId = 3 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyCloseTicketCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyCloseTicketCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company's Close Support Ticket Count
-- USP_Admin_GetCompanyCloseTicketCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyCloseTicketCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) AS ClosedTickets
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket
	WHERE tbl_supportTicket.TicketStatus = 2 
    AND tbl_supportTicket.ID IN(SELECT MAX(ID) FROM [dbo].[Tbl_SupportTicket] b 
    WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber) AND (IsDelete <> 1 OR IsDelete IS NULL) 
    AND tbl_supportTicket.CompanyId = @CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyDetail]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <24-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get Company Details>
-- USP_Admin_GetCompanyDetail 479
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyDetail]
	@ID INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @userRole INT = NULL

	SET @userRole = (SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE 'Company Owner')

	SELECT 
		ISNULL(tbl_company.Id,0) AS Id,
		ISNULL(tbl_company.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(
			(
				SELECT TOP 1 tbl_users.AccountNumber FROM [dbo].[Tbl_User] tbl_users 
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_users.Id
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_mapping ON tbl_company_user_mapping.UserId = tbl_mapping.UserId
				WHERE tbl_company_user_mapping.CompanyId = tbl_company.Id
				AND tbl_company_user_mapping.IsDelete <> 1
				AND tbl_mapping.RoleID = @userRole
				AND tbl_mapping.IsDelete <> 1
				AND tbl_users.IsActive <> 0
				ORDER BY tbl_company_user_mapping.ModifyOnUtc DESC
			)
		,'N/A') AS DIBNUserNumber,
		ISNULL(
			(
				SELECT TOP 1 tbl_users.FirstName +' '+ tbl_users.LastName FROM [dbo].[Tbl_User] tbl_users 
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_users.Id
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_mapping ON tbl_company_user_mapping.UserId = tbl_mapping.UserId
				WHERE tbl_company_user_mapping.CompanyId = tbl_company.Id
				AND tbl_company_user_mapping.IsDelete <> 1
				AND tbl_mapping.RoleID = @userRole
				AND tbl_mapping.IsDelete <> 1
				AND tbl_users.IsActive <> 0
				ORDER BY tbl_company_user_mapping.ModifyOnUtc DESC
			)
		,'N/A') AS Username,
		ISNULL(
			(
				SELECT TOP 1 tbl_users.Id FROM [dbo].[Tbl_User] tbl_users 
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_users.Id
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_mapping ON tbl_company_user_mapping.UserId = tbl_mapping.UserId
				WHERE tbl_company_user_mapping.CompanyId = tbl_company.Id
				AND tbl_company_user_mapping.IsDelete <> 1
				AND tbl_mapping.RoleID = @userRole
				AND tbl_mapping.IsDelete <> 1
				AND tbl_users.IsActive <> 0
				ORDER BY tbl_company_user_mapping.ModifyOnUtc DESC
			)
		,0) AS UserId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_company.Cmp_Pass,'N/A') AS Cmp_Pass,
		ISNULL(tbl_company.ShareCapital,'N/A') AS ShareCapital,
		ISNULL(tbl_company.CompanyRegistrationNumber,'N/A') AS CompanyRegistrationNumber,
		ISNULL(tbl_company.MCountryCode,'N/A') AS MCountryCode,
		ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
		ISNULL(tbl_company.ECountryCode,'N/A') AS ECountryCode,
		ISNULL(tbl_company.EmergencyNumber,'N/A') AS EmergencyNumber,
		ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_company.SecondEmailID,'N/A') AS SecondEmailID,
		ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
		ISNULL(tbl_company.LicenseType,'N/A') AS LicenseType,
		ISNULL(tbl_company.LicenseStatus,'N/A') AS LicenseStatus,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseIssueDate,23),'N/A') AS LicenseIssueDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseExpiryDate,23),'N/A') AS LicenseExpiryDate,
		ISNULL(tbl_company.LeaseFacilityType,'N/A') AS LeaseFacilityType,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseStartDate,23),'N/A') AS LeaseStartDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseExpiryDate,23),'N/A') AS LeaseExpiryDate,
		ISNULL(tbl_company.LeaseStatus,'N/A') AS LeaseStatus,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.CompanyStartingDate,23),'N/A') AS CompanyStartingDate,
		ISNULL(tbl_company.UnitLocation,'N/A') AS UnitLocation,
		ISNULL(tbl_shareholder.FirstName +' '+tbl_shareholder.LastName,'N/A') AS ShareholderName,
		ISNULL(tbl_shareholder.SharePercentage,'N/A') AS ShareholderSharePercentage,
		ISNULL(tbl_shareholder.IsActive,0) AS ShareholderIsActive,
		ISNULL(tbl_company.IsActive,0) AS IsActive,
		ISNULL(tbl_company.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.CreatedOn,23),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.ModifyOn,23),'N/A') AS ModifyOn,
		ISNULL(tbl_company.Country,'N/A') AS Country,
		ISNULL(tbl_company.City,'N/A') AS City,
		ISNULL(tbl_company.IsTRN,0) AS IsTRN,
		ISNULL(tbl_company.TRN,'N/A') AS TRN,
		ISNULL(tbl_company.LabourFileNo,'N/A') AS LabourFileNo,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.TRNCreationDate,23),'N/A') AS TRNCreationDate,
		ISNULL(tbl_company.IsCorportaeText,0) AS IsCorportaeText,
		ISNULL(tbl_company.CorporateText,'N/A') AS CorporateText,
		ISNULL(tbl_company.SubCompanyType,'N/A') AS SubCompanyType
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder ON tbl_company.Id = tbl_shareholder.CompanyId
	WHERE tbl_company.Id = @ID AND tbl_company.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyDetailsByRMTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--USP_Admin_GetCompanyDetailsByRMTeam 1

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyDetailsByRMTeam]
	@RMTeamId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_company.Id,0) AS Id,
		ISNULL(tbl_company.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_company.DibnUserNumber,'N/A') AS DIBNUserNumber,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_company.ShareCapital,'N/A') AS ShareCapital,
		ISNULL(tbl_company.CompanyRegistrationNumber,'N/A') AS CompanyRegistrationNumber,
		ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
		ISNULL(tbl_company.EmergencyNumber,'N/A') AS EmergencyNumber,
		ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_company.SecondEmailID,'N/A') AS SecondEmailID,
		ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
		ISNULL(tbl_company.LicenseType,'N/A') AS LicenseType,
		ISNULL(tbl_company.LicenseStatus,'N/A') AS LicenseStatus,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseIssueDate,105),'N/A') AS LicenseIssueDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseExpiryDate,105),'N/A') AS LicenseExpiryDate,
		ISNULL(tbl_company.LeaseFacilityType,'N/A') AS LeaseFacilityType,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseStartDate,105),'N/A') AS LeaseStartDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseExpiryDate,105),'N/A') AS LeaseExpiryDate,
		ISNULL(tbl_company.LeaseStatus,'N/A') AS LeaseStatus,
		ISNULL(tbl_company.UnitLocation,'N/A') AS UnitLocation,
		ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.FirstName +' '+tbl_shareholder.LastName,'N/A')
            FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
				WHERE tbl_shareholder.CompanyId = tbl_company.Id
				AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				FOR XML PATH('')
		),1,1,''),'N/A') AS ShareholderName,
		ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.SharePercentage,'N/A')
            FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
				WHERE tbl_shareholder.CompanyId = tbl_company.Id
				AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				FOR XML PATH('')
		),1,1,''),'N/A') AS ShareholderSharePercentage,
		CONVERT(BIT, ISNULL(STUFF((SELECT TOP(1) ',' + CONVERT(NVARCHAR(2),ISNULL(tbl_shareholder.IsActive,0))
            FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
				WHERE tbl_shareholder.CompanyId = tbl_company.Id
				AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				FOR XML PATH('')
		),1,1,''),0)) AS ShareholderIsActive,
		ISNULL(tbl_company.IsActive,0) AS IsActive,
		ISNULL(tbl_company.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam ON tbl_RMTeam.Id = tbl_mapping.RMTeamId
	WHERE tbl_company.IsDelete <> 1 
	AND tbl_RMTeam.Id = @RMTeamId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyDetailsBySalesPerson]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--SP_Admin_GetCompanyDetailsBySalesPerson 1

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyDetailsBySalesPerson]
	@SalesPersonId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_company.Id,0) AS Id,
		ISNULL(tbl_company.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_company.DibnUserNumber,'N/A') AS DIBNUserNumber,
		--ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_company.ShareCapital,'N/A') AS ShareCapital,
		ISNULL(tbl_company.CompanyRegistrationNumber,'N/A') AS CompanyRegistrationNumber,
		ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
		ISNULL(tbl_company.EmergencyNumber,'N/A') AS EmergencyNumber,
		ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_company.SecondEmailID,'N/A') AS SecondEmailID,
		ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
		ISNULL(tbl_company.LicenseType,'N/A') AS LicenseType,
		ISNULL(tbl_company.LicenseStatus,'N/A') AS LicenseStatus,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseIssueDate,105),'N/A') AS LicenseIssueDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseExpiryDate,105),'N/A') AS LicenseExpiryDate,
		ISNULL(tbl_company.LeaseFacilityType,'N/A') AS LeaseFacilityType,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseStartDate,105),'N/A') AS LeaseStartDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseExpiryDate,105),'N/A') AS LeaseExpiryDate,
		ISNULL(tbl_company.LeaseStatus,'N/A') AS LeaseStatus,
		ISNULL(tbl_company.UnitLocation,'N/A') AS UnitLocation,
		ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.FirstName +' '+tbl_shareholder.LastName,'N/A')
            FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
				WHERE tbl_shareholder.CompanyId = tbl_company.Id
				AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				FOR XML PATH('')
		),1,1,''),'N/A') AS ShareholderName,
		ISNULL(STUFF((SELECT TOP(1) ',' + ISNULL(tbl_shareholder.SharePercentage,'N/A')
            FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
				WHERE tbl_shareholder.CompanyId = tbl_company.Id
				AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				FOR XML PATH('')
		),1,1,''),'N/A') AS ShareholderSharePercentage,
		CONVERT(BIT, ISNULL(STUFF((SELECT TOP(1) ',' + CONVERT(NVARCHAR(2),ISNULL(tbl_shareholder.IsActive,0))
            FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
				WHERE tbl_shareholder.CompanyId = tbl_company.Id
				AND tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.IsActive <> 0
   				FOR XML PATH('')
		),1,1,''),0)) AS ShareholderIsActive,
		ISNULL(tbl_company.IsActive,0) AS IsActive,
		ISNULL(tbl_company.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_mapping.SalesPersonId
	WHERE tbl_company.IsDelete <> 1 
		AND tbl_salesPerson.Id = @SalesPersonId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyDetailsForPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <06-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <15-Nov-2022>
-- Description:	<<USP_Admin_GetCompanyDetailsForPermission N'DIBN715'>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyDetailsForPermission]
	@AccountNumber NVARCHAR(MAX) = NULL,
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @countOfUser INT =NULL,@CompanyId INT = NULL;
	IF @Email IS NOT NULL AND @AccountNumber IS NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_Company
		WHERE (tbl_Company.EmailID = @Email OR tbl_Company.SecondEmailID = @Email) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1) 
		BEGIN
			SET @CompanyId = (SELECT Id FROM [dbo].[Tbl_Company] WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0)
			SET @countOfUser = (SELECT COUNT(Id) FROM [dbo].[Tbl_Company_User_Mapping] WHERE CompanyId = @CompanyId AND IsDelete <> 1)
			IF @countOfUser > 0
			BEGIN
				SELECT TOP(1) ISNULL(tbl_user.Id,0) AS Id
				FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.CompanyId = tbl_Company.Id
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
				WHERE (tbl_Company.EmailID = @Email OR tbl_Company.SecondEmailID = @Email) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
			END
			ELSE 
			BEGIN
				SELECT Id AS Id FROM [dbo].[Tbl_Company] tbl_Company
				WHERE (tbl_Company.EmailID = @Email OR tbl_Company.SecondEmailID = @Email) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
			END
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
	ELSE IF @AccountNumber IS NOT NULL AND @Email IS NULL
	BEGIN
		IF EXISTS(
			SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
			WHERE (tbl_Company.AccountNumber = @AccountNumber) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
		)
		BEGIN
			SET @CompanyId = (SELECT Id FROM [dbo].[Tbl_Company] WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0)
			SET @countOfUser = (SELECT COUNT(Id) FROM [dbo].[Tbl_Company_User_Mapping] WHERE CompanyId = @CompanyId AND IsDelete <> 1)
			IF @countOfUser > 0
			BEGIN
				SELECT TOP(1) ISNULL(tbl_user.Id,0) AS Id
				FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.CompanyId = tbl_Company.Id
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
				WHERE (tbl_Company.AccountNumber = @AccountNumber) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
			END
			ELSE 
			BEGIN
				SELECT Id FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
				WHERE (tbl_Company.AccountNumber = @AccountNumber) AND tbl_Company.IsActive <> 0 AND tbl_Company.IsDelete <> 1
			END
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyDocuments]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <19-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetCompanyDocuments>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyDocuments]
	@CompanyId INT = NULL,
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(tbl_company_document_mapping.ID,0) AS ID,
		ISNULL(tbl_company_document_mapping.FileName,'N/A') AS [FileName],
		ISNULL(tbl_company_document_mapping.Extension,'N/A') AS Extension,
		ISNULL(tbl_company_document_mapping.Title,'N/A') AS Title,
		ISNULL(tbl_company_document_mapping.Description,'N/A') AS [Description],
		tbl_company_document_mapping.DataBinary AS DataBinary,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company_document_mapping.IssueDate,105),'N/A') AS IssueDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company_document_mapping.ExpiryDate,105),'N/A') AS ExpiryDate,
		ISNULL(tbl_company_document_mapping.AuthorityName,'N/A') AS AuthorityName,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company_document_mapping.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company_document_mapping.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
		ISNULL(tbl_company_document_mapping.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company_document_mapping.IsDeleted,0) AS IsDeleted,
		ISNULL(tbl_company_document_mapping.DocumentTypeId,0) AS DocumentTypeId,
		ISNULL(tbl_companydocumenttype.Name,'N/A') AS DocumentTypeName
	FROM [dbo].[Tbl_Company_Document_Mapping] tbl_company_document_mapping WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_CompanyDocumentType] tbl_companydocumenttype ON tbl_companydocumenttype.ID = tbl_company_document_mapping.DocumentTypeId
	WHERE tbl_company_document_mapping.CompanyId = @CompanyId AND (tbl_company_document_mapping.ID=@Id OR @Id IS NULL)
	AND tbl_company_document_mapping.IsDeleted <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyEmployeeActiveStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- USP_Admin_GetCompanyEmployeeActiveStatus
-- Author:		<Yashasvi Sharma>
-- Create date: <03-06-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get active status
-- USP_Admin_GetCompanyEmployeeActiveStatus 358
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyEmployeeActiveStatus]
	@Id int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_user.IsActive,0) AS IsActive
	FROM [dbo].[Tbl_User] tbl_user
	WHERE tbl_user.IsDelete <> 1 
	AND tbl_user.Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyEmployeeCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyEmployeeCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Company employee count
-- USP_Admin_GetCompanyEmployeeCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyEmployeeCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		COUNT(*) 
	FROM [dbo].[Tbl_User] tbl_user LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping ON tbl_user.Id = tbl_mapping.UserId  
    LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_rolemapping ON tbl_rolemapping.UserId = tbl_user.Id  
    LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolemapping.RoleID 
    WHERE tbl_mapping.CompanyId = @CompanyId AND (tbl_role.RoleName NOT LIKE N'Company Owner' AND tbl_role.RoleName NOT LIKE N'DIBN') 
    AND tbl_user.IsDelete <> 1 AND tbl_roleMapping.IsDelete <> 1  
    AND tbl_user.AccountNumber NOT LIKE 'TBC01';
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyId]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(tbl_company_user_mapping.CompanyId,0) AS CompanyId
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
	WHERE tbl_user.Id = @UserId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyInvoiceDetailByCompanyIdWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Invoice List with Pagination By Company Id>
-- <USP_Admin_GetCompanyInvoiceDetailByCompanyIdWithPagination 95,0,20,N'Currency',NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyInvoiceDetailByCompanyIdWithPagination]
	@CompanyId INT = NULL,
	@skipRows INT = NULL,
	@rowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortBy NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		@conditions NVARCHAR(MAX) = NULL,
		@groupByClause NVARCHAR(MAX) = NULL,
		@orderByClause NVARCHAR(MAX) = NULL,
		@paginationClause NVARCHAR(MAX) = NULL,
		@selectQuery NVARCHAR(MAX) = NULL


	SET @query = N'
					SELECT 
						ISNULL(tbl_companyInvoiceDetail.InvoiceNumber,''N/A'') AS InvoiceNumber, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_companyInvoiceDetail.Services,''N/A'') AS [Service], 
						ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105),''N/A'') AS [Date], 
						MAX(tbl_companyInvoiceDetail.GrandTotal) AS GrandTotal, 
						ISNULL(MAX(tbl_companyInvoiceDetail.Currency),''AED'') AS Currency, 
						ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy, 
						ISNULL(tbl_user.FirstName +'' ''+ tbl_user.LastName,''N/A'') AS Username 
					FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy  
				'

	SET @conditions = N' WHERE tbl_companyInvoiceDetail.CompanyId = @CompanyId 
						 AND tbl_companyInvoiceDetail.Id IN (SELECT DISTINCT 
						 MAX(Id) 
						 FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK) 
						 WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
						 AND (b.IsDelete <> 1 OR b.IsDelete IS NULL) 
						 GROUP BY b.InvoiceNumber ) 
						 AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL) 
						'

	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
								@searchPrefix IS NULL
								OR tbl_companyInvoiceDetail.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_companyInvoiceDetail.Services LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105) = '''+@searchPrefix+''' 
								OR tbl_companyInvoiceDetail.GrandTotal LIKE ''%'+@searchPrefix+'%'' 
								OR ISNULL(tbl_companyInvoiceDetail.Currency,''AED'') LIKE ''%'+@searchPrefix+'%'' 
							)'
	END

	SET @groupByClause = N' GROUP BY tbl_companyInvoiceDetail.InvoiceNumber,tbl_company.CompanyName,tbl_companyInvoiceDetail.Services,
							tbl_companyInvoiceDetail.InvoiceCreatedOn,tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.Currency,
							tbl_companyInvoiceDetail.CreatedBy,tbl_user.FirstName,tbl_user.LastName
						'

	SET @orderByClause = N' ORDER BY '
		
		IF @sortBy IS NULL OR @sortBy = ''
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber,PATINDEX(''%[0-9]%'',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortBy = 'Invoice No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber)))) '
			+ ' ASC '
		END

		IF @sortBy = 'Invoice No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_companyInvoiceDetail.InvoiceNumber, PATINDEX(''%[0-9]%'',tbl_companyInvoiceDetail.InvoiceNumber), LEN(tbl_companyInvoiceDetail.InvoiceNumber)))) '
			+ ' DESC '
		END

		IF @sortBy = 'Created Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.InvoiceCreatedOn FROM [dbo].[Tbl_CompanyInvoiceDetail] formField WHERE formField.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber) '
			+ ' ASC '
		END

		IF @sortBy = 'Created Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (SELECT TOP 1 formField.InvoiceCreatedOn FROM [dbo].[Tbl_CompanyInvoiceDetail] formField WHERE formField.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber) '
			+ ' DESC '
		END

		IF @sortBy = 'Service' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Services '
			+ ' ASC '
		END

		IF @sortBy = 'Service' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Services '
			+ ' DESC '
		END

		IF @sortBy = 'Currency' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Currency '
			+ ' ASC '
		END

		IF @sortBy = 'Currency' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.Currency '
			+ ' DESC '
		END

		IF @sortBy = 'Amount' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.GrandTotal '
			+ ' ASC '
		END

		IF @sortBy = 'Amount' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' tbl_companyInvoiceDetail.GrandTotal '
			+ ' DESC '
		END

	SET @paginationClause = N' OFFSET @skipRows ROWS 
								FETCH NEXT @rowsOfPage ROWS ONLY 
							'
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@paginationClause

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@skipRows INT,@rowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@skipRows,@rowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyInvoiceDetailByCompanyIdWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get all Company Invoice List with Pagination By Company Id>
-- <USP_Admin_GetCompanyInvoiceDetailByCompanyIdWithPaginationCount 41,0,20,N'Amount',N'8307.00'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyInvoiceDetailByCompanyIdWithPaginationCount]
	@CompanyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
		@conditions NVARCHAR(MAX) = NULL,
		@groupByClause NVARCHAR(MAX) = NULL,
		@orderByClause NVARCHAR(MAX) = NULL,
		@paginationClause NVARCHAR(MAX) = NULL,
		@selectQuery NVARCHAR(MAX) = NULL


	SET @query = N'
					SELECT 
						ISNULL(tbl_companyInvoiceDetail.InvoiceNumber,''N/A'') AS InvoiceNumber 
					FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy  
				'

	SET @conditions = N' WHERE tbl_companyInvoiceDetail.CompanyId = @CompanyId 
						 AND tbl_companyInvoiceDetail.Id IN (SELECT DISTINCT 
						 MAX(Id) 
						 FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK) 
						 WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
						 AND (b.IsDelete <> 1 OR b.IsDelete IS NULL) 
						 GROUP BY b.InvoiceNumber ) 
						 AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL) 
						'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		
		SET @conditions = @conditions + ' AND (
								@searchPrefix IS NULL
								OR tbl_companyInvoiceDetail.InvoiceNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_companyInvoiceDetail.Services LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105) = '''+@searchPrefix+''' 
								OR tbl_companyInvoiceDetail.GrandTotal LIKE ''%'+@searchPrefix+'%'' 
								OR ISNULL(tbl_companyInvoiceDetail.Currency,''AED'') LIKE ''%'+@searchPrefix+'%'' 
							)'
	END

	SET @groupByClause = N' GROUP BY tbl_companyInvoiceDetail.InvoiceNumber,tbl_company.CompanyName,tbl_companyInvoiceDetail.Services,
							tbl_companyInvoiceDetail.InvoiceCreatedOn,tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.Currency,
							tbl_companyInvoiceDetail.CreatedBy,tbl_user.FirstName,tbl_user.LastName
						'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyInvoiceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <06-Sept-2022>
-- <USP_Admin_GetCompanyInvoiceDetails 1,N'DIBN999',51>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyInvoiceDetails]
	@Status INT = NULL,
	@InvoiceNumber NVARCHAR(MAX) =NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	IF @Status = 1
	BEGIN
		SELECT DISTINCT 
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_company.IsTRN,0) AS IsTRN,
			ISNULL(tbl_company.TRN,'---') AS TRN,
			ISNULL(tbl_companyInvoiceDetail.Currency,'AED') AS Currency,
			ISNULL(CONVERT(NVARCHAR(50),tbl_company.TRNCreationDate,23),'---') AS TRNCreationDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.CreatedOn,23),'---') AS CreatedOn,
			ISNULL(tbl_company.Country,'---') AS Country,
			ISNULL(tbl_company.UnitLocation,'---') AS UnitLocation,
			ISNULL(tbl_companyInvoiceDetail.Services,'---') AS [Service],
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105),'N/A') AS [Date]
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 )
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)

		SELECT DISTINCT 
			tbl_companyInvoiceDetail.Id AS Id,
			ISNULL(tbl_companyInvoiceDetail.ProductName,'N/A') AS ProductName,
			ISNULL(tbl_companyInvoiceDetail.Quantity,0) AS Quantity,
			ISNULL(tbl_companyInvoiceDetail.Amount,0) AS Amount,
			ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
			ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat,
			ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
			ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 )
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		ORDER BY tbl_companyInvoiceDetail.Id ASC 

		SELECT TOP 1
			ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
			ISNULL(tbl_companyInvoiceDetail.GrandTotal,0) AS GrandTotal,
			SUM(tbl_companyInvoiceDetail.VatAmount) AS VatAmount,
			SUM(tbl_companyInvoiceDetail.Vat) AS Vat
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 )
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		GROUP BY tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.VatAmount,tbl_companyInvoiceDetail.Vat,tbl_companyInvoiceDetail.Id
		ORDER BY tbl_companyInvoiceDetail.Id DESC

		SELECT 
			ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
			ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
			ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
			ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND tbl_companyInvoiceDetail.Vat <> 0 
		AND (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 )
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		GROUP BY tbl_companyInvoiceDetail.VatAmount,tbl_companyInvoiceDetail.Vat,tbl_companyInvoiceDetail.TotalAmount,tbl_companyInvoiceDetail.Id

		SELECT DISTINCT
			ISNULL(tbl_companyInvoiceDetail.InvoiceNumber,'N/A') AS InvoiceNumber
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 )
		AND tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL

	END
	ELSE IF @Status = 2
	BEGIN
		DECLARE @NewInvoiceNumber INT = NULL;

		SET @NewInvoiceNumber = (SELECT CAST(RAND() * 1000 AS INT));

		SET @InvoiceNumber = N'Invoice'+CAST(@NewInvoiceNumber AS nvarchar(MAX));

		IF EXISTS(SELECT Id FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE InvoiceNumber LIKE @InvoiceNumber)
		BEGIN
			SET @NewInvoiceNumber = (SELECT CAST(RAND() * 1000 AS INT));

			SET @InvoiceNumber = N'Invoice'+CAST(@NewInvoiceNumber AS nvarchar(MAX));
		END;
		SELECT CASE WHEN ISNULL(MAX(InvoiceNumber),'N/A') ='N/A' THEN 'Invoice1000'
					ELSE @InvoiceNumber END AS InvoiceNumber
		FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK)
		WHERE IsDelete <> 1 OR IsDelete IS NULL
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			tbl_companyInvoiceDetail.InvoiceNumber AS InvoiceNumber,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_companyInvoiceDetail.Services,'N/A') AS [Service],
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,105),'N/A') AS [Date],
			MAX(tbl_companyInvoiceDetail.GrandTotal) AS GrandTotal,
			ISNULL(MAX(tbl_companyInvoiceDetail.Currency),'AED') AS Currency,
			ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username
		FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy
		WHERE (tbl_companyInvoiceDetail.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 )
			AND tbl_companyInvoiceDetail.Id IN (SELECT DISTINCT
																MAX(Id) 
															 FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK)
															 WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
															 AND (b.IsDelete <> 1 OR b.IsDelete IS NULL)
															 GROUP BY b.InvoiceNumber 
															 )
			AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		GROUP BY 
			tbl_companyInvoiceDetail.InvoiceNumber,
			tbl_company.CompanyName,
			tbl_companyInvoiceDetail.InvoiceCreatedOn,
			tbl_companyInvoiceDetail.GrandTotal,
			tbl_companyInvoiceDetail.CreatedBy,
			tbl_user.FirstName,
			tbl_user.LastName,
			tbl_companyInvoiceDetail.Services
		ORDER BY tbl_companyInvoiceDetail.InvoiceNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyInvoiceDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetCompanyInvoiceDetailsById 1>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyInvoiceDetailsById]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;
	
	DECLARE @InvoiceNumber NVARCHAR(MAX)=NULL ,@GrandTotal Decimal(18,2) = NULL;
	SET @InvoiceNumber = (SELECT InvoiceNumber FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE Id=@Id AND IsDelete<> 1 OR IsDelete IS NULL)
	SET @GrandTotal= (SELECT MAX(GrandTotal) FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE InvoiceNumber = @InvoiceNumber AND IsDelete<> 1 OR IsDelete IS NULL)

	SELECT DISTINCT 
		ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
		ISNULL(tbl_companyInvoiceDetail.ProductName,'N/A') AS ProductName,
		ISNULL(tbl_companyInvoiceDetail.Quantity,0) AS Quantity,
		ISNULL(tbl_companyInvoiceDetail.Amount,0) AS Amount,
		ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
		ISNULL(tbl_companyInvoiceDetail.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat,
		ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
		ISNULL(@GrandTotal,0) AS GrandTotal,
		ISNULL(tbl_companyInvoiceDetail.InvoiceNumber,'N/A') AS InvoiceNumber
	FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
	WHERE tbl_companyInvoiceDetail.Id = @Id AND tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL AND tbl_companyInvoiceDetail.InvoiceNumber = @InvoiceNumber
	GROUP BY 
		tbl_companyInvoiceDetail.Id,tbl_companyInvoiceDetail.ProductName,tbl_companyInvoiceDetail.Quantity,tbl_companyInvoiceDetail.Amount,tbl_companyInvoiceDetail.TotalAmount
		,tbl_companyInvoiceDetail.CompanyId,tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.InvoiceNumber,tbl_company.CompanyName,tbl_companyInvoiceDetail.Vat,tbl_companyInvoiceDetail.VatAmount
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyInvoiceDetailsByInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetCompanyInvoiceDetailsByInvoice N'DIBN110'>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyInvoiceDetailsByInvoice]
	@Invoice NVARCHAR(MAX)=NULL 
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @GrandTotal Decimal(18,2) = NULL;
	SET @GrandTotal= (SELECT MAX(GrandTotal) FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE InvoiceNumber = @Invoice AND IsDelete<> 1 OR IsDelete IS NULL)

	SELECT DISTINCT 
		ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
		ISNULL(tbl_companyInvoiceDetail.ProductName,'N/A') AS ProductName,
		ISNULL(tbl_companyInvoiceDetail.Quantity,0) AS Quantity,
		ISNULL(tbl_companyInvoiceDetail.Amount,0) AS Amount,
		ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
		ISNULL(tbl_companyInvoiceDetail.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat,
		ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
		ISNULL(tbl_companyInvoiceDetail.Services,'N/A') AS Services,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreatedOn,23),'N/A') AS InvoiceCreatedOn,
		ISNULL(@GrandTotal,0) AS GrandTotal,
		@Invoice AS InvoiceNumber
	FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetail WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_companyInvoiceDetail.CompanyId = tbl_company.Id
	WHERE (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL) AND tbl_companyInvoiceDetail.InvoiceNumber = @Invoice
	GROUP BY 
		tbl_companyInvoiceDetail.Id,tbl_companyInvoiceDetail.ProductName,tbl_companyInvoiceDetail.Quantity,tbl_companyInvoiceDetail.Amount,tbl_companyInvoiceDetail.TotalAmount
		,tbl_companyInvoiceDetail.CompanyId,tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.InvoiceNumber,tbl_company.CompanyName,tbl_companyInvoiceDetail.Vat,tbl_companyInvoiceDetail.VatAmount,
		tbl_companyInvoiceDetail.Services,tbl_companyInvoiceDetail.InvoiceCreatedOn
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyListForExport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyListForExport
-- Author:			<Yashasvi Sharma>
-- Created date:	21/Jan/2023
-- Description:		Get Company List for Export
-- USP_Admin_GetCompanyListForExport
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyListForExport]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_company.AccountNumber AS CompanyCode,
		tbl_company.CompanyName AS CompanyName
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.Id <> (
		SELECT Id FROM [dbo].[Tbl_Company]
		WHERE CompanyName LIKE 'DIBN'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyNameById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-June-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Return Company name based on passed company Id>
-- <SP_Admin_GetCompanyNameById 2>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyNameById]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		tbl_company.CompanyName AS CompanyName
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	WHERE tbl_company.IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyOpenServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyOpenServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company's Open Service Request Count
-- USP_Admin_GetCompanyOpenServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyOpenServiceRequestCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK) 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id  
    WHERE (tbl_serviceRequest.CompanyId = @CompanyId) 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL) 
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;


	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    WHERE (tbl_serviceRequest.CompanyId = @CompanyId) 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyOpenTicketCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyOpenTicketCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company's Open Support Ticket Count
-- USP_Admin_GetCompanyOpenTicketCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyOpenTicketCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		COUNT(*) AS OpenTickets
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WHERE tbl_supportTicket.TicketStatus = 1 
    AND tbl_supportTicket.ID IN(SELECT MAX(ID) FROM [dbo].[Tbl_SupportTicket] b 
    WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber) AND (IsDelete <> 1 OR IsDelete IS NULL) 
    AND tbl_supportTicket.CompanyId = @CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyOwnerRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyOwnerRoleId
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company Owner Role Id
-- USP_Admin_GetCompanyOwnerRoleId
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyOwnerRoleId]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT RoleID 
	FROM [dbo].[Tbl_Role] 
	WHERE RoleName LIKE 'Company Owner'
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyPermissionByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetCompanyPermissionByCompanyId>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyPermissionByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(tbl_companypermission.CompanyPermissionId,0) AS CompanyPermissionId,
		ISNULL(tbl_companypermission.CompanyId,0) AS CompanyId,
		ISNULL(tbl_companypermission.ModuleId,0) AS ModuleId,
		ISNULL(tbl_companypermission.PermissionId,0) AS PermissionId,
		ISNULL(tbl_companypermission.IsActive,0) AS IsActive,
		ISNULL(tbl_companypermission.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companypermission.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companypermission.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_CompanyPermission] tbl_companypermission WITH(NOLOCK)
	WHERE tbl_companypermission.CompanyId = @CompanyId AND tbl_companypermission.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyPermissionCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyPermissionCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Company permission count
-- USP_Admin_GetCompanyPermissionCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyPermissionCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		COUNT(*) 
	FROM [dbo].[Tbl_CompanyPermission] tbl_companyPermssion 
	WHERE CompanyId =@CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyPermissionModuleByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- Create date: <06-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetCompanyPermissionModuleByCompanyId 1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyPermissionModuleByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_CompanyPermission] tbl_compoanypermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_compoanypermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_compoanypermission.CompanyId
	WHERE tbl_company.Id = @CompanyId AND tbl_compoanypermission.IsDelete<> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyPermissionNameByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- Create date: <06-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetCompanyPermissionNameByCompanyId 1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyPermissionNameByCompanyId]
	@CompanyId INT = NULL,
	@Module NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_permission.PermissionName AS PermissionName
	FROM [dbo].[Tbl_CompanyPermission] tbl_companypermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_permission.PermissionId = tbl_companypermission.PermissionId
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_companypermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companypermission.CompanyId
	WHERE tbl_company.Id =@CompanyId AND tbl_companypermission.IsDelete<> 1 AND tbl_module.ModuleName = @Module
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyRejectedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyRejectedServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company's Rejected or Cancelled Service Request Count
-- USP_Admin_GetCompanyRejectedServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyRejectedServiceRequestCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    WHERE (tbl_serviceRequest.CompanyId = @CompanyId  ) 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5 );

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    WHERE (tbl_serviceRequest.CompanyId = @CompanyId  ) 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5 );
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyServiceCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyServiceCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	10/Oct/2024
-- Description:		Get Count of Company Services For Admin Panel
-- USP_Admin_GetCompanyServiceCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyServiceCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) AS CompanyServices
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_companyServiceRequest.IsDelete <> 1) 
    AND tbl_companyServiceRequest.StatusId <> 3 AND tbl_companyServiceRequest.StatusId <> 4 AND tbl_companyServiceRequest.StatusId <> 5

	SELECT DISTINCT 
		COUNT(*) AS CompanyServices
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_companyServiceRequest.IsDelete <> 1) 
    AND tbl_companyServiceRequest.StatusId = 3
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyServiceIdByCompanyType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetServiceIdByCompanyType
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Service Id
-- USP_Admin_GetServiceIdByCompanyType
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyServiceIdByCompanyType]
	@ServiceName NVARCHAR(MAX) = NULL,
	@companyType NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ID 
	FROM [dbo].[Tbl_CompanyServices] 
    WHERE ServiceName LIKE '%'+@ServiceName+'%' 
	AND CompanyType LIKE @companyType;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyServiceRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyServiceRequestByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceFormFieldValue.ServiceId AS ServiceId,
		tbl_serviceFormFieldValue.SerialNumber AS SerialNumber,
		tbl_serviceForm.FormName AS Form,
		tbl_company.CompanyName AS CompanyName,
		tbl_user.FirstName +' '+ tbl_user.LastName +' ( '+tbl_user.EmailID+' )' AS RequestedBy
	FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
	WHERE CompanyId = @CompanyId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetCompanyServicesRequestByCompanyId 0,0,N'',0
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyServicesRequestByCompanyId]
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@Company NVARCHAR(MAX) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;
		
	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
				(SELECT TOP(1) Status 
				FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber 
				ORDER BY StepId DESC)
			END AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
			THEN
				(SELECT TOP(1) tbl_serviceRequestStatus.Status 
				FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber
				ORDER BY StepId DESC
				) 
			ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser,
				ISNULL(
				(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				) ,'N/A') AS AssignOn,
			ISNULL(STUFF(
			(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
				LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
				WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
			FOR XML PATH ('')), 1, 1, ''
			) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
			AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
			AND (tbl_serviceRequest.IsDelete <> 1)
			AND tbl_service.IsCompanyService <> 0
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
			WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
			AND b.IsDelete <> 1
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
			GROUP BY b.SerialNumber)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
		tbl_service.IsCompanyService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
		tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
		tbl_user.LastName,tbl_company.Id
		ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status 
					FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber 
					ORDER BY StepId DESC)
				END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber
					ORDER BY StepId DESC
					) 
				ELSE 'N/A'
				END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn,
				 ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
						WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
					FOR XML PATH ('')), 1, 1, ''
					) ,'N/A') AS SalesPerson
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_service.IsCompanyService <> 0
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND tbl_serviceRequest.Status = 3
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
			tbl_service.IsCompanyService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName,tbl_company.Id
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status 
					FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber 
					ORDER BY StepId DESC)
				END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber
					ORDER BY StepId DESC
					) 
				ELSE 'N/A'
				END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn,
				 ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
						WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
					FOR XML PATH ('')), 1, 1, ''
					) ,'N/A') AS SalesPerson
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_service.IsCompanyService <> 0
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
			tbl_service.IsCompanyService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName,tbl_company.Id
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyShareholderCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyShareholderCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Company shareholder count
-- USP_Admin_GetCompanyShareholderCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyShareholderCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT COUNT(*) 
	FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder
	WHERE tbl_shareholder.CompanyId = @CompanyId   
	AND tbl_shareholder.IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyShareholders]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- SP_Admin_GetCompanyShareholders 30
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyShareholders]
	@ID INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_shareholder.FirstName +' '+tbl_shareholder.LastName,'N/A') AS ShareholderName,
		ISNULL(tbl_shareholder.SharePercentage,'N/A') AS ShareholderSharePercentage,
		ISNULL(tbl_shareholder.IsActive,0) AS ShareholderIsActive
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder ON tbl_company.Id = tbl_shareholder.CompanyId
	WHERE tbl_company.Id = @ID AND tbl_company.IsDelete <> 1  AND tbl_shareholder.IsDelete<> 1 AND tbl_shareholder.IsActive <> 0
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanySubType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<USP_Admin_GetCompanySubType Sharma>
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get Company Sub Type Prefix
-- USP_Admin_GetCompanySubType 'abu'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanySubType]
	@prefix nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT  
		tbl_company.SubType AS SubCompanyType
	FROM [dbo].[Tbl_CompanySubType] tbl_company WITH(NOLOCK)
	WHERE 
	(tbl_company.SubType LIKE @prefix + '%' OR @prefix IS NULL)
	AND tbl_company.IsDelete <> 1
	GROUP BY tbl_company.SubType
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanySubTypes]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get Company's Sub Type
-- USP_Admin_GetCompanySubTypes
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanySubTypes]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT  
		tbl_company.CompanyType AS SubCompanyType
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.CompanyType IS NOT NULL
	GROUP BY tbl_company.CompanyType
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanySupportTicketWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <14-02-2023>
-- Description : Get assigned Support Ticket
-- USP_Admin_GetCompanySupportTicketWithPagination 2,1,50,N'',N'SR No.',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanySupportTicketWithPagination]
	@CompanyId INT = NULL,
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.ID,0) AS ID,
		ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.Id,0)
		ELSE ISNULL(tbl_supportTicket.UserId,0)
		END AS UserId,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
		ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		END AS Username,
		ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_supportTicket.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 1
			ELSE  2
		END AS TicketStatusId,
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_supportTicket.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
		ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
		ISNULL(STUFF(
		(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
		WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
		FOR XML PATH ('')), 1, 1, ''
		) ,'N/A') AS AssignedUser
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_supportTicket.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_supportTicket.CompanyId = @CompanyId)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_supportTicket.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_supportTicket.TrackingNumber,CHARINDEX('R',tbl_supportTicket.TrackingNumber)+1,LEN(tbl_supportTicket.TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_supportTicket.TrackingNumber,CHARINDEX('R',tbl_supportTicket.TrackingNumber)+1,LEN(tbl_supportTicket.TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN tbl_company.CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN tbl_company.CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN 
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END DESC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.CreatedOn
		END ASC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.CreatedOn
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_supportTicket.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END ASC,	
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_supportTicket.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END DESC
	--OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	--FETCH NEXT @RowsOfPage ROWS ONLY


	SELECT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_supportTicket.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_supportTicket.CompanyId = @CompanyId)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0)
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_supportTicket.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanySupportTicketWithPaginationBySalesPerson]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <14-02-2023>
-- Description : Get assigned Support Ticket
-- USP_Admin_GetCompanySupportTicketWithPaginationBySalesPerson 9,1,50,N'',N'SR No.',N'asc'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanySupportTicketWithPaginationBySalesPerson]
	@SalesPerson INT = NULL,
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.ID,0) AS ID,
		ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.Id,0)
		ELSE ISNULL(tbl_supportTicket.UserId,0)
		END AS UserId,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
		THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
		ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		END AS Username,
		ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_supportTicket.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 1
			ELSE  2
		END AS TicketStatusId,
		CASE 
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
			tbl_supportTicket.TrackingNumber AND 
			(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
			ORDER BY Id Desc) = 1  THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
		ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
		ISNULL(STUFF(
		(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
		WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
		FOR XML PATH ('')), 1, 1, ''
		) ,'N/A') AS AssignedUser
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_supportTicket.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_company.Id = tbl_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_mapping.SalesPersonId = @SalesPerson)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0)
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_supportTicket.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_supportTicket.TrackingNumber,CHARINDEX('R',tbl_supportTicket.TrackingNumber)+1,LEN(tbl_supportTicket.TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN (SELECT CONVERT(INT,SUBSTRING(tbl_supportTicket.TrackingNumber,CHARINDEX('R',tbl_supportTicket.TrackingNumber)+1,LEN(tbl_supportTicket.TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN tbl_company.CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN tbl_company.CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN 
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				CASE WHEN tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL
				THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A')
				ELSE ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				END
		END DESC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.CreatedOn
		END ASC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.CreatedOn
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN tbl_supportTicket.Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN tbl_supportTicket.Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A')
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_supportTicket.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END ASC,	
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				CASE 
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE 
					tbl_supportTicket.TrackingNumber AND 
					(b.IsDelete <> 1 OR b.IsDelete IS NULL OR b.IsDelete =0) 
					ORDER BY Id Desc) = 1 
					THEN 'Open'
					ELSE  'Close'
				END
		END DESC
	--OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	--FETCH NEXT @RowsOfPage ROWS ONLY


	SELECT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_supportTicket.TrackingNumber = tbl_supportTicket.TrackingNumber
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_company.Id = tbl_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId 
	AND (tbl_supportTicket.SalesPersonId <> 0 AND tbl_supportTicket.SalesPersonId IS NOT NULL)
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_mapping.SalesPersonId = @SalesPerson)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (
		@searchPrefix IS NULL
		OR tbl_supportTicket.TrackingNumber LIKE @searchPrefix +'%'
		OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
		OR tbl_supportTicket.Title LIKE '%'+ @searchPrefix +'%'
		OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
		OR tbl_user.FirstName LIKE '%'+ @searchPrefix +'%'
		OR CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105) LIKE '%'+ @searchPrefix +'%'
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	GROUP BY tbl_supportTicket.TrackingNumber,tbl_supportTicket.ID,tbl_supportTicket.CompanyId,
	tbl_company.CompanyName,tbl_supportTicket.UserId,tbl_user.FirstName,tbl_user.LastName,tbl_supportTicket.Title,
	tbl_supportTicket.Description,tbl_supportTicket.ParentId,tbl_supportTicket.IsActive,tbl_supportTicket.IsDelete,
	tbl_supportTicket.CreatedOn,tbl_supportTicket.CreatedBy,tbl_salesPerson.Id,tbl_salesPerson.FirstName,tbl_salesPerson.LastName
	,tbl_supportTicket.SalesPersonId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanySupportTicketWithPaginationBySalesPersonId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- SP Name:			USP_Admin_GetCompanySupportTicketWithPaginationBySalesPersonId
-- Author:			<Yashasvi Sharma>
-- Created date:	08/July/2023
-- Description:		Get support tickets for admin panel with pagination
-- USP_Admin_GetCompanySupportTicketWithPaginationBySalesPersonId 0,20,N'',N'TR No.','asc',NULL,8
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanySupportTicketWithPaginationBySalesPersonId]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@Status INT = NULL,
	@SalesPersonId INT = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##SalesPersonSupportTicketTablePaginationTbl') IS NOT NULL
	BEGIN
		DROP TABLE ##SalesPersonSupportTicketTablePaginationTbl
	END
	
	SELECT DISTINCT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(
		(
			tbl_company.CompanyName
		),'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.UserId <> 0 AND tbl_supportTicket.UserId IS NOT NULL
			THEN tbl_user.FirstName + ' ' + tbl_user.LastName
			ELSE tbl_salesPerson.FirstName + ' ' + tbl_salesPerson.LastName
		END AS UserName,
		ISNULL(
			tbl_supportTicket.Title
		,'N/A') AS Title,
		ISNULL(
			CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105)
		,'N/A') AS [CreatedOn],
		tbl_supportTicket.CreatedOn AS CreatedOnDate,
		(SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber) AS [TicketStatusId],
		CASE 
			WHEN (SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC) = 1  
			THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(
			STUFF(
				(
					SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
					FOR XML PATH ('')
				), 1, 1, '') 
		,'N/A') AS AssignedUser,
		ISNULL(
			(SELECT TOP (1) 
				CONVERT(nvarchar(50),tbl_assign1.CreatedOn,105) 
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
			)
		,'N/A') AS AssignedOn,
		(
			SELECT TOP (1) 
				tbl_assign1.CreatedOn
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
		) AS AssignedOnDate
	INTO ##SalesPersonSupportTicketTablePaginationTbl
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_supportTicket.SalesPersonId = tbl_salesPerson.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_salesPerson_Company_Mapping ON tbl_company.Id = tbl_salesPerson_Company_Mapping.CompanyId 
	AND (tbl_salesPerson_Company_Mapping.IsDelete <> 1 OR tbl_salesPerson_Company_Mapping.IsDelete IS NULL)
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_companySalesPerson ON tbl_salesPerson_Company_Mapping.SalesPersonId = tbl_companySalesPerson.Id
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND tbl_companySalesPerson.Id = @SalesPersonId
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	AND ((SELECT TOP 1 TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC)= @Status OR @Status IS NULL OR @Status = 0)

	SELECT * FROM ##SalesPersonSupportTicketTablePaginationTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN 
				CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN 
				CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN 
				UserName
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				UserName
		END DESC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'asc' 
			THEN 
				CreatedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'desc' 
			THEN 
				CreatedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN 
				Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN 
				Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				AssignedUser
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				AssignedUser
		END DESC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'asc' 
			THEN 
				AssignedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'desc' 
			THEN 
				AssignedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				TicketStatus
		END ASC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				TicketStatus
		END DESC

	OFFSET @pageNumber ROWS 
	FETCH NEXT @rowsOfPage ROWS ONLY


	SELECT COUNT(*) AS TotalSupportTickets FROM ##SalesPersonSupportTicketTablePaginationTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCompanyType
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Company's Type (Mainland/Freezone)
-- USP_Admin_GetCompanyType
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyType]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		CompanyType AS CompanyType 
	FROM [dbo].[Tbl_Company] 
	WHERE Id = @CompanyId
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyUsers]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <13-Dec-2022>
-- Modify By : <,modify by>
-- Modify date : <,modify on>
-- Description:	<USP_Admin_GetCompanyUsers>
-- =============================================
-- USP_Admin_GetCompanyUsers 2
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyUsers]
	@ID INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @roleId INT = NULL;
	SET @roleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')

	SELECT DISTINCT
			tbl_user.Id AS UserId,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
			ISNULL(tbl_user.AccountNumber,'N/A') AS UserAccountNumber,
			tbl_user.IsActive AS IsActive,
			tbl_user.IsLogin AS IsLogin
	FROM [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping
	LEFT JOIN [dbo].[Tbl_Company] tbl_company  ON tbl_company_user_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_company_user_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_role_mapping ON tbl_role_mapping.UserId = tbl_user.Id
	WHERE tbl_company_user_mapping.CompanyId = @ID 
	AND tbl_company_user_mapping.IsDelete <> 1
	AND tbl_user.IsDelete <> 1
	AND tbl_role_mapping.RoleID = @roleId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyWiseLog]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetCompanyWiseLog 2
CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyWiseLog]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	---------- Company Create & Update details																Yashasvi TBC (30-11-2022)   
	SELECT 
		ISNULL(tbl_Company.AccountNumber,'N/A') AS [AccountNumber],
		ISNULL(tbl_Company.CompanyName,'N/A') AS [CompanyName],
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_Company.CreatedOn),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_Company.CreatedOn),'N/A') AS [CreatedOnTime]
	FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_Company.CreatedBy
	WHERE tbl_Company.IsDelete <> 1 AND tbl_Company.Id = @CompanyId

	SELECT 
		ISNULL(tbl_Company.AccountNumber,'N/A') AS [AccountNumber],
		ISNULL(tbl_Company.CompanyName,'N/A') AS [CompanyName],
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_Company.ModifyOn),105),'N/A') AS [ModifyOnDate],
		ISNULL(Convert(nvarchar(20),tbl_Company.ModifyOn),'N/A') AS [ModifyOnTime]
	FROM [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_Company.ModifyBy
	WHERE tbl_Company.IsDelete <> 1 AND tbl_Company.Id = @CompanyId

	---------- Company Document Create & Update details																Yashasvi TBC (30-11-2022)
	SELECT 
		ISNULL(tbl_CompanyDocument.FileName + tbl_CompanyDocument.Extension,'N/A') AS [DocumentFileName],
		ISNULL(tbl_CompanyDocumetType.Name,'N/A') AS [DocumentType],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_CompanyDocument.IssueDate),105),'N/A') AS [IssueDate],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_CompanyDocument.ExpiryDate),105),'N/A') AS [ExpiryDate],
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_CompanyDocument.CreatedOnUtc),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_CompanyDocument.CreatedOnUtc),'N/A') AS [CreatedOnTime],
		ISNULL(tbl_CompanyDocument.IsDeleted,0) AS IsDelete
	FROM [dbo].[Tbl_Company_Document_Mapping] tbl_CompanyDocument WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_CompanyDocument.CompanyId
	LEFT JOIN [dbo].[Tbl_CompanyDocumentType] tbl_CompanyDocumetType WITH(NOLOCK) ON tbl_CompanyDocumetType.ID = tbl_CompanyDocument.DocumentTypeId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_CompanyDocument.CreatedBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1

	SELECT 
		ISNULL(tbl_CompanyDocument.FileName + tbl_CompanyDocument.Extension,'N/A') AS [DocumentFileName],
		ISNULL(tbl_CompanyDocumetType.Name,'N/A') AS [DocumentType],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_CompanyDocument.IssueDate),105),'N/A') AS [IssueDate],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_CompanyDocument.ExpiryDate),105),'N/A') AS [ExpiryDate],
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_CompanyDocument.ModifyOnUtc),105),'N/A') AS [ModifyOnDate],
		ISNULL(Convert(nvarchar(20),tbl_CompanyDocument.ModifyOnUtc),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_CompanyDocument.IsDeleted,0) AS IsDelete
	FROM [dbo].[Tbl_Company_Document_Mapping] tbl_CompanyDocument WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_CompanyDocument.CompanyId
	LEFT JOIN [dbo].[Tbl_CompanyDocumentType] tbl_CompanyDocumetType WITH(NOLOCK) ON tbl_CompanyDocumetType.ID = tbl_CompanyDocument.DocumentTypeId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_CompanyDocument.ModifyBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1

	---------- Shareholder Create & Update details																Yashasvi TBC (30-11-2022)
	SELECT 
		ISNULL(tbl_shareholders.FirstName,'N/A') AS [ShareholderFirstName],
		ISNULL(tbl_shareholders.LastName,'N/A') AS [ShareholderLastName],
		ISNULL(tbl_shareholders.SharePercentage,'N/A') AS [ShareholderSharePercentage],
		ISNULL(tbl_company.CompanyName,'N/A') AS [AssignedCompanyName],
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_shareholders.CreatedOnUtc),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_shareholders.CreatedOnUtc),'N/A') AS [CreatedOnTime],
		ISNULL(tbl_shareholders.IsActive,0) AS IsActive,
		ISNULL(tbl_shareholders.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholders WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_shareholders.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_shareholders.CreatedBy
	WHERE tbl_company.Id = @CompanyId AND tbl_company.IsDelete <> 1

	SELECT 
		ISNULL(tbl_shareholders.FirstName,'N/A') AS [ShareholderFirstName],
		ISNULL(tbl_shareholders.LastName,'N/A') AS [ShareholderLastName],
		ISNULL(tbl_shareholders.SharePercentage,'N/A') AS [ShareholderSharePercentage],
		ISNULL(tbl_company.CompanyName,'N/A') AS [AssignedCompanyName],
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_shareholders.ModifyOnUtc),105),'N/A') AS [ModifyOnDate],
		ISNULL(Convert(nvarchar(20),tbl_shareholders.ModifyOnUtc),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_shareholders.IsActive,0) AS IsActive,
		ISNULL(tbl_shareholders.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholders WITH(NOLOCK) 
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_shareholders.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_shareholders.ModifyBy
	WHERE tbl_company.Id = @CompanyId AND tbl_company.IsDelete <> 1

	---------- Shareholder Document Create & Update details																Yashasvi TBC (30-11-2022)
	SELECT 
		ISNULL(tbl_ShareholderDocument.FileName + tbl_ShareholderDocument.Extension,'N/A') AS [FileName],
		ISNULL(tbl_ShareholderDocument.Title,'N/A') AS [Title],
		ISNULL(tbl_Shareholder.FirstName,'N/A') AS [ShareholderFirstName],
		ISNULL(tbl_Shareholder.LastName,'N/A') AS [ShareholderLastName],
		ISNULL(tbl_Shareholder.SharePercentage,'N/A') AS [ShareholderSharePercentage],
		ISNULL(tbl_company.CompanyName,'N/A') AS [AssignedCompanyName],
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_ShareholderDocument.CreatedOnUtc),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_ShareholderDocument.CreatedOnUtc),'N/A') AS [CreatedOnTime],
		ISNULL(tbl_ShareholderDocument.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_ShareholderDocuments] tbl_ShareholderDocument WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_Shareholder WITH(NOLOCK) ON tbl_Shareholder.Id = tbl_ShareholderDocument.ShareholderId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_Shareholder.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_ShareholderDocument.CreatedBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1

	SELECT 
		ISNULL(tbl_ShareholderDocument.FileName + tbl_ShareholderDocument.Extension,'N/A') AS [FileName],
		ISNULL(tbl_ShareholderDocument.Title,'N/A') AS [Title],
		ISNULL(tbl_Shareholder.FirstName,'N/A') AS [ShareholderFirstName],
		ISNULL(tbl_Shareholder.LastName,'N/A') AS [ShareholderLastName],
		ISNULL(tbl_Shareholder.SharePercentage,'N/A') AS [ShareholderSharePercentage],
		ISNULL(tbl_company.CompanyName,'N/A') AS [AssignedCompanyName],
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_ShareholderDocument.ModifyOnUtc),105),'N/A') AS [ModifyOnDate],
		ISNULL(Convert(nvarchar(20),tbl_ShareholderDocument.ModifyOnUtc),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_ShareholderDocument.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_ShareholderDocuments] tbl_ShareholderDocument WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_Shareholder WITH(NOLOCK) ON tbl_Shareholder.Id = tbl_ShareholderDocument.ShareholderId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_Shareholder.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_ShareholderDocument.ModifyBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1

	---------- Company Owner/Employee Create & Update details																Yashasvi TBC (30-11-2022)
	SELECT DISTINCT
		ISNULL(tbl_user.FirstName,'N/A') AS [UserFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [UserLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [UserAccountNumber],
		ISNULL(tbl_company.CompanyName,'N/A') AS [AssignedCompanyName],
		ISNULL(STUFF((SELECT ', ' + tbl_role.RoleName 
				FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id
				LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
				WHERE tbl_user1.Id = tbl_user.Id 
				AND tbl_user_role_mapping.IsDelete <> 1
				FOR XML PATH('')),1,1,'') ,'N/A') AS [AssignedRole],
		ISNULL(tbl_createdUser.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_createdUser.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_createdUser.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_user.CreatedOnUtc),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_user.CreatedOnUtc),'N/A') AS [CreatedOnTime],
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_company_user_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_createdUser WITH(NOLOCK) ON tbl_user.CreatedBy = tbl_createdUser.Id
	WHERE tbl_Company.IsDelete <> 1 AND tbl_Company.Id = @CompanyId
	--AND tbl_company_user_mapping.IsDelete <> 1

	SELECT DISTINCT
		ISNULL(tbl_user.FirstName,'N/A') AS [UserFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [UserLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [UserAccountNumber],
		ISNULL(tbl_company.CompanyName,'N/A') AS [AssignedCompanyName],
		ISNULL(STUFF((SELECT ', ' + tbl_role.RoleName 
				FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id
				LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
				WHERE tbl_user1.Id = tbl_user.Id 
				AND tbl_user_role_mapping.IsDelete <> 1
				FOR XML PATH('')),1,1,''),'N/A') AS [AssignedRole],
		ISNULL(tbl_createdUser.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_createdUser.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_createdUser.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_user.ModifyOnUTC),105),'N/A') AS [ModifyOnDate],
		ISNULL(Convert(nvarchar(20),tbl_user.ModifyOnUTC),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_company_user_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_createdUser WITH(NOLOCK) ON tbl_user.ModifyBy = tbl_createdUser.Id
	WHERE tbl_Company.IsDelete <> 1 AND tbl_Company.Id = @CompanyId
	--AND tbl_company_user_mapping.IsDelete <> 1

	---------- Sales Person Assign & Remove																				Yashasvi TBC (30-11-2022)
	SELECT 
		ISNULL(tbl_salesPerson.FirstName,'N/A') AS [SalesPersonFirstName],
		ISNULL(tbl_salesPerson.LastName,'N/A') AS [SalesPersonLastName],
		ISNULL(tbl_salesPerson.EmailId,'N/A') AS [SalesPersonEmailId],
		ISNULL(tbl_salesperson_company_mapping.IsDelete,0) AS IsDelete,
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_salesperson_company_mapping.CreatedOnUtc),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_salesperson_company_mapping.CreatedOnUtc),'N/A') AS [CreatedOnTime]
	FROM [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_salesperson_company_mapping WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON tbl_salesPerson.Id = tbl_salesperson_company_mapping.SalesPersonId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_salesperson_company_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_salesperson_company_mapping.CreatedBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1
	AND tbl_salesperson_company_mapping.IsDelete <> 1

	SELECT 
		ISNULL(tbl_salesPerson.FirstName,'N/A') AS [SalesPersonFirstName],
		ISNULL(tbl_salesPerson.LastName,'N/A') AS [SalesPersonLastName],
		ISNULL(tbl_salesPerson.EmailId,'N/A') AS [SalesPersonEmailId],
		ISNULL(tbl_salesperson_company_mapping.IsDelete,0) AS IsDelete,
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_salesperson_company_mapping.CreatedOnUtc),105),'N/A') AS [ModifyOnDate],
		ISNULL(Convert(nvarchar(20),tbl_salesperson_company_mapping.CreatedOnUtc),'N/A') AS [ModifyOnTime]
	FROM [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_salesperson_company_mapping WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON tbl_salesPerson.Id = tbl_salesperson_company_mapping.SalesPersonId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_salesperson_company_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_salesperson_company_mapping.ModifyBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1
	--AND tbl_salesperson_company_mapping.IsDelete = 1
	AND CONVERT(DATE,tbl_salesperson_company_mapping.CreatedOnUtc) = (
		SELECT TOP 1 CONVERT(DATE,CreatedOnUtc)
		FROM [dbo].[Tbl_SalesPerson_Company_Mapping] WITH(NOLOCK)
		WHERE CompanyId = @CompanyId
		ORDER BY Id DESC
	)

	--------- Payment Account Summary																					Yashasvi TBC (20-01-2023)
	SELECT DISTINCT
		tbl_payment.Amount AS Amount,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		tbl_payment.PaymentMode AS PaymentMode,
		tbl_payment.Description AS Description,
		ISNULL(tbl_payment.Quantity,1) AS Quantity,
		CASE WHEN tbl_payment.TotalAmount IS NULL THEN tbl_payment.Amount
		ELSE tbl_payment.TotalAmount END AS PaymentCredit,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [TransactionDate],
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(CONVERT(nvarchar(25),tbl_payment.CreatedOnUTC,105),'N/A') AS CreatedOnDate,
		ISNULL(Convert(nvarchar(20),tbl_payment.CreatedOnUTC),'N/A') AS [CreatedOnTime],
		ISNULL(tbl_payment.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_payment.CreatedBy 
	WHERE tbl_payment.CompanyId = @CompanyId
	AND tbl_payment.CreatedBy IS NOT NULL

	SELECT DISTINCT
		tbl_payment.Amount AS Amount,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		tbl_payment.PaymentMode AS PaymentMode,
		tbl_payment.Description AS Description,
		ISNULL(tbl_payment.Quantity,1) AS Quantity,
		CASE WHEN tbl_payment.TotalAmount IS NULL THEN tbl_payment.Amount
		ELSE tbl_payment.TotalAmount END AS PaymentCredit,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [TransactionDate],
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(CONVERT(nvarchar(25),tbl_payment.ModifyOnUTC,105),'N/A') AS ModifyOnDate,
		ISNULL(Convert(nvarchar(20),tbl_payment.ModifyOnUTC),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_payment.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_payment.ModifyBy 
	WHERE tbl_payment.CompanyId = @CompanyId
	AND tbl_payment.ModifyBy IS NOT NULL

	--------- Expense Account Summary																					Yashasvi TBC (20-01-2023)
	SELECT DISTINCT
		tbl_portalExpenses.TransactionId AS TransactionId,
		tbl_portalExpenses.ExpensesTitle AS ExpensesTitle,
		CASE 
			WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
			ELSE tbl_portalExpenses.GrandTotal END AS ExpenseAmount,
		ISNULL(tbl_portalExpenses.Quantity,1) AS Quantity,
		ISNULL(tbl_portalExpenses.Vat,'0') AS Vat,
		ISNULL(tbl_portalExpenses.VatAmount,'0') AS VatAmount,
		CASE 
			WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
			ELSE tbl_portalExpenses.GrandTotal END AS GrandTotal,
		ISNULL(tbl_user.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		CASE WHEN tbl_portalExpenses.TransactionCreatedOnUtc IS NULL
		THEN 
			ISNULL(CONVERT(nvarchar(25),tbl_portalExpenses.CreatedOnUtc,105),'N/A')
		ELSE
			ISNULL(CONVERT(nvarchar(25),tbl_portalExpenses.TransactionCreatedOnUtc,105),'N/A')
		END AS CreatedOnDate,
		CASE WHEN tbl_portalExpenses.TransactionCreatedOnUtc IS NULL
		THEN
			ISNULL(CONVERT(nvarchar(20),tbl_portalExpenses.CreatedOnUtc),'N/A')
		ELSE
			ISNULL(Convert(nvarchar(20),tbl_portalExpenses.TransactionCreatedOnUtc),'N/A') 
		END AS [CreatedOnTime],
		ISNULL(tbl_portalExpenses.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_portalExpenses.CreatedBy
	WHERE tbl_portalExpenses.CompanyId = @CompanyId
	AND tbl_portalExpenses.CreatedBy IS NOT NULL

	SELECT DISTINCT
		tbl_portalExpenses.TransactionId AS TransactionId,
		tbl_portalExpenses.ExpensesTitle AS ExpensesTitle,
		CASE 
			WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
			ELSE tbl_portalExpenses.GrandTotal END AS ExpenseAmount,
		ISNULL(tbl_portalExpenses.Vat,'0') AS Vat,
		ISNULL(tbl_portalExpenses.VatAmount,'0') AS VatAmount,
		CASE 
			WHEN tbl_portalExpenses.GrandTotal IS NULL THEN tbl_portalExpenses.TotalAmount 
			ELSE tbl_portalExpenses.GrandTotal END AS GrandTotal,
		ISNULL(tbl_portalExpenses.Quantity,1) AS Quantity,
		ISNULL(tbl_user.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_user.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_user.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(CONVERT(nvarchar(25),tbl_portalExpenses.ModifyOnUtc,105),'N/A') AS ModifyOnDate,
		ISNULL(Convert(nvarchar(20),tbl_portalExpenses.ModifyOnUtc),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_portalExpenses.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_portalExpenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_portalExpenses.ModifyBy
	WHERE tbl_portalExpenses.CompanyId = @CompanyId 
	AND tbl_portalExpenses.ModifyBy IS NOT NULL

	--------- Service Request																							Yashasvi TBC (22-08-2023)
	SELECT 
		tbl_companyServiceRequest.SerialNumber AS SerialNumber,
		tbl_companyServiceRequest.RequestedService AS RequestedService,
		tbl_companyServiceRequest.RequestedBy AS RequestedBy,
		CASE WHEN tbl_serviceRequest.Description IS NULL OR tbl_serviceRequest.Description = ''
		THEN tbl_serviceRequest.Title ELSE tbl_serviceRequest.Description END AS Description,
		CONVERT(NVARCHAR(20),tbl_companyServiceRequest.CreatedOn,105) AS ServiceRequestCreatedOn,
		CONVERT(NVARCHAR(20),tbl_companyServiceRequest.CreatedOn) AS ServiceRequestCreatedOnTime,
		(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName) AS ServiceRequestResponseCreatedBy,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.CreatedOn,105) AS ServiceRequestResponseCreatedOn,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.CreatedOn) AS ServiceRequestResponseCreatedOnTime
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_companyServiceRequest.SerialNumber = tbl_serviceRequest.SerialNumber
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceRequest.CreatedBy = tbl_serviceCreatedBy.Id
	WHERE tbl_companyServiceRequest.CompanyId = @CompanyId
	AND tbl_companyServiceRequest.SerialNumber IS NOT NULL

	UNION 

	SELECT 
		tbl_employeeServiceRequest.SerialNumber AS SerialNumber,
		tbl_employeeServiceRequest.RequestedService AS RequestedService,
		tbl_employeeServiceRequest.RequestedBy AS RequestedBy,
		CASE WHEN tbl_serviceRequest.Description IS NULL OR tbl_serviceRequest.Description = ''
		THEN tbl_serviceRequest.Title ELSE tbl_serviceRequest.Description END AS Description,
		CONVERT(NVARCHAR(20),tbl_employeeServiceRequest.CreatedOn,105) AS ServiceRequestCreatedOn,
		CONVERT(NVARCHAR(20),tbl_employeeServiceRequest.CreatedOn) AS ServiceRequestCreatedOnTime,
		(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName) AS ServiceRequestResponseCreatedBy,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.CreatedOn,105) AS ServiceRequestResponseCreatedOn,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.CreatedOn) AS ServiceRequestResponseCreatedOnTime
	FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_employeeServiceRequest.SerialNumber = tbl_serviceRequest.SerialNumber
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceRequest.CreatedBy = tbl_serviceCreatedBy.Id
	WHERE tbl_employeeServiceRequest.CompanyId = @CompanyId
	AND tbl_employeeServiceRequest.SerialNumber IS NOT NULL
	ORDER BY ServiceRequestResponseCreatedOnTime desc

	SELECT 
		tbl_companyServiceRequest.SerialNumber AS SerialNumber,
		tbl_companyServiceRequest.RequestedService AS RequestedService,
		(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName) AS ServiceRequestResponseCreatedBy,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.ModifyOn,105) AS ServiceRequestResponseCreatedOn,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.ModifyOn) AS ServiceRequestResponseCreatedOnTime,
		CONVERT(NVARCHAR(20),tbl_companyServiceRequest.CreatedOn) AS ServiceRequestCreatedOnTime,
		tbl_companyServiceRequest.IsDelete AS IsDelete
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_companyServiceRequest.SerialNumber = tbl_serviceRequest.SerialNumber
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceRequest.ModifyBy = tbl_serviceCreatedBy.Id
	WHERE tbl_companyServiceRequest.CompanyId = @CompanyId
	AND tbl_companyServiceRequest.SerialNumber IS NOT NULL AND tbl_companyServiceRequest.IsDelete = 1

	UNION 

	SELECT 
		tbl_employeeServiceRequest.SerialNumber AS SerialNumber,
		tbl_employeeServiceRequest.RequestedService AS RequestedService,
		(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName) AS ServiceRequestResponseCreatedBy,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.ModifyOn,105) AS ServiceRequestResponseCreatedOn,
		CONVERT(NVARCHAR(20),tbl_serviceRequest.ModifyOn) AS ServiceRequestResponseCreatedOnTime,
		CONVERT(NVARCHAR(20),tbl_employeeServiceRequest.CreatedOn) AS ServiceRequestCreatedOnTime,
		tbl_employeeServiceRequest.IsDelete AS IsDelete
	FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) ON tbl_employeeServiceRequest.SerialNumber = tbl_serviceRequest.SerialNumber
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceRequest.CreatedBy = tbl_serviceCreatedBy.Id
	WHERE tbl_employeeServiceRequest.CompanyId = @CompanyId
	AND tbl_employeeServiceRequest.SerialNumber IS NOT NULL AND tbl_employeeServiceRequest.IsDelete = 1
	ORDER BY ServiceRequestResponseCreatedOnTime 

	---------- Support Ticket																						Yashasvi TBC (22-08-2023)
	SELECT 
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.Title,'N/A') AS [Title],
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		CASE WHEN tbl_supportTicket.SalesPersonId IS NULL OR tbl_supportTicket.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName +' ('+ tbl_serviceCreatedBy.AccountNumber +')','N/A')
		ELSE 
			(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_supportTicket.SalesPersonId )
		END AS RequestedBy,
		ISNULL(CONVERT(NVARCHAR(20),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(20),tbl_supportTicket.CreatedOn),'N/A') AS CreatedOnTime
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_supportTicket.CreatedBy = tbl_serviceCreatedBy.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_supportTicket.CompanyId
	WHERE tbl_company.Id = @CompanyId
	AND tbl_supportTicket.TrackingNumber IS NOT NULL
	AND tbl_supportTicket.CreatedBy IS NOT NULL
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID) From [dbo].[Tbl_SupportTicket] b WITH(NOLOCK)
		WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber
	)

	SELECT 
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.Title,'N/A') AS [Title],
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		CASE WHEN tbl_supportTicket.SalesPersonId IS NULL OR tbl_supportTicket.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName +' ('+ tbl_serviceCreatedBy.AccountNumber +')','N/A')
		ELSE 
			(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_supportTicket.SalesPersonId )
		END AS RequestedBy,
		ISNULL(CONVERT(NVARCHAR(20),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(20),tbl_supportTicket.CreatedOn),'N/A') AS CreatedOnTime
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_supportTicket.CreatedBy = tbl_serviceCreatedBy.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_supportTicket.CompanyId
	WHERE tbl_company.Id = @CompanyId 
	AND tbl_supportTicket.TrackingNumber IS NOT NULL
	AND tbl_supportTicket.CreatedBy IS NOT NULL


	SELECT 
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.Title,'N/A') AS RequestedService,
		ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName +' ('+ tbl_serviceCreatedBy.AccountNumber +')','N/A') AS ModifyBy,
		ISNULL(CONVERT(NVARCHAR(20),tbl_supportTicket.ModifyOn,105),'N/A') AS ModifyOn,
		ISNULL(CONVERT(NVARCHAR(20),tbl_supportTicket.ModifyOn),'N/A') AS ModifyOnTime,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_supportTicket.ModifyBy = tbl_serviceCreatedBy.Id
	WHERE tbl_supportTicket.CompanyId = @CompanyId
	AND tbl_supportTicket.TrackingNumber IS NOT NULL
	AND tbl_supportTicket.ModifyBy IS NOT NULL
	AND tbl_supportTicket.ID IN (
		SELECT MAX(ID) From [dbo].[Tbl_SupportTicket] b WITH(NOLOCK)
		WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber
	)
	--------- Employee/User Document																						Yashasvi TBC (21-08-2023)
	SELECT 
		ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') AS [Employee],
		ISNULL(tbl_documents.FileName + tbl_documents.Extension,'N/A') AS [DocumentFileName],
		ISNULL(tbl_documents.Title,'N/A') AS [DocumentType],
		ISNULL(tbl_createdBy.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_createdBy.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_createdBy.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_documents.CreatedOnUtc),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_documents.CreatedOnUtc),'N/A') AS [CreatedOnTime],
		ISNULL(tbl_user_document_mapping.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_Company_User_Document_Mapping] tbl_user_document_mapping WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_user_document_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Documents] tbl_documents WITH(NOLOCK) ON tbl_documents.Id = tbl_user_document_mapping.DocumentId
	LEFT JOIN [dbo].[Tbl_User] tbl_createdBy WITH(NOLOCK) ON tbl_createdBy.Id = tbl_documents.CreatedBy
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_user_document_mapping.UserId
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1

	SELECT 
		ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') AS [Employee],
		ISNULL(tbl_documents.FileName + tbl_documents.Extension,'N/A') AS [DocumentFileName],
		ISNULL(tbl_documents.Title,'N/A') AS [DocumentType],
		ISNULL(tbl_modifyBy.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_modifyBy.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_modifyBy.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_documents.CreatedOnUtc),105),'N/A') AS [ModifyOn],
		ISNULL(Convert(nvarchar(20),tbl_documents.CreatedOnUtc),'N/A') AS ModifyOnTime,
		ISNULL(tbl_user_document_mapping.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_Company_User_Document_Mapping] tbl_user_document_mapping WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_user_document_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Documents] tbl_documents WITH(NOLOCK) ON tbl_documents.Id = tbl_user_document_mapping.DocumentId
	LEFT JOIN [dbo].[Tbl_User] tbl_modifyBy WITH(NOLOCK) ON tbl_modifyBy.Id = tbl_documents.ModifyBy
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_user_document_mapping.UserId
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1

	--------- Company Invoice																						Yashasvi TBC (21-08-2023)
	SELECT DISTINCT
		ISNULL(tbl_companyInvoice.InvoiceNumber,'N/A') AS [InvoiceNumber],
		ISNULL(tbl_companyInvoice.Services,'N/A') AS Service,
		ISNULL(tbl_companyInvoice.GrandTotal,0) AS InvoiceTotal,
		ISNULL(tbl_createdBy.FirstName,'N/A') AS [CreatedByFirstName],
		ISNULL(tbl_createdBy.LastName,'N/A') AS [CreatedByLastName],
		ISNULL(tbl_createdBy.AccountNumber,'N/A') AS [CreatedByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_companyInvoice.CreatedOn),105),'N/A') AS [CreatedOnDate],
		ISNULL(Convert(nvarchar(20),tbl_companyInvoice.CreatedOn),'N/A') AS [CreatedOnTime]
	FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoice WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoice.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_createdBy WITH(NOLOCK) ON tbl_createdBy.Id = tbl_companyInvoice.CreatedBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1
	AND (tbl_companyInvoice.IsDelete <> 1 OR tbl_companyInvoice.IsDelete IS NULL)
	AND tbl_companyInvoice.Id = ( 
		SELECT DISTINCT 
		MAX(Id) 
		FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK) 
		WHERE b.InvoiceNumber = tbl_companyInvoice.InvoiceNumber 
		GROUP BY b.InvoiceNumber 
	) 

	SELECT DISTINCT
		ISNULL(tbl_companyInvoice.InvoiceNumber,'N/A') AS [InvoiceNumber],
		ISNULL(tbl_companyInvoice.Services,'N/A') AS Service,
		ISNULL(tbl_companyInvoice.GrandTotal,0) AS InvoiceTotal,
		ISNULL(tbl_modifyBy.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_modifyBy.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_modifyBy.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_companyInvoice.ModifyOn),105),'N/A') AS [ModifyOn],
		ISNULL(Convert(nvarchar(20),tbl_companyInvoice.ModifyOn),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_companyInvoice.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoice WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoice.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_modifyBy WITH(NOLOCK) ON tbl_modifyBy.Id = tbl_companyInvoice.ModifyBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1
	AND (tbl_companyInvoice.IsDelete = 1 OR tbl_companyInvoice.IsDelete IS NULL)
	AND tbl_companyInvoice.Id = ( 
		SELECT DISTINCT 
		MAX(Id) 
		FROM [dbo].[Tbl_CompanyInvoiceDetail] b WITH(NOLOCK) 
		WHERE b.InvoiceNumber = tbl_companyInvoice.InvoiceNumber 
		GROUP BY b.InvoiceNumber 
	) 

	SELECT DISTINCT
		ISNULL(tbl_companyInvoice.InvoiceNumber,'N/A') AS [InvoiceNumber],
		ISNULL(tbl_companyInvoice.Services,'N/A') AS Service,
		ISNULL(tbl_companyInvoice.ProductName,'N/A') AS Title,
		ISNULL(tbl_companyInvoice.Amount,0) AS Amount,
		ISNULL(tbl_companyInvoice.Quantity,0) AS Quantity,
		ISNULL(tbl_companyInvoice.TotalAmount,0) AS TotalAmount,
		ISNULL(tbl_companyInvoice.Vat,0) AS Vat,
		ISNULL(tbl_companyInvoice.VatAmount,0) AS VatAmount,
		ISNULL(tbl_companyInvoice.GrandTotal,0) AS GrandTotal,
		ISNULL(tbl_modifyBy.FirstName,'N/A') AS [ModifyByFirstName],
		ISNULL(tbl_modifyBy.LastName,'N/A') AS [ModifyByLastName],
		ISNULL(tbl_modifyBy.AccountNumber,'N/A') AS [ModifyByAccountNumber],
		ISNULL(Convert(nvarchar(20),Convert(date,tbl_companyInvoice.ModifyOn),105),'N/A') AS [ModifyOn],
		ISNULL(Convert(nvarchar(20),tbl_companyInvoice.ModifyOn),'N/A') AS [ModifyOnTime],
		ISNULL(tbl_companyInvoice.IsDelete,0) AS IsDelete
	FROM [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoice WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoice.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_modifyBy WITH(NOLOCK) ON tbl_modifyBy.Id = tbl_companyInvoice.CreatedBy
	WHERE tbl_Company.Id = @CompanyId AND tbl_Company.IsDelete <> 1
	AND (tbl_companyInvoice.ModifyBy <> 0 OR tbl_companyInvoice.ModifyBy IS NULL)

END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCompanyWiseSupportTicketWithPaginationByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- SP Name:			USP_Admin_GetCompanyWiseSupportTicketWithPaginationByCompanyId
-- Author:			<Yashasvi Sharma>
-- Created date:	08/July/2023
-- Description:		Get support tickets for admin panel with pagination
-- USP_Admin_GetCompanyWiseSupportTicketWithPaginationByCompanyId 0,50,N'',N'TR No.','asc',2
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCompanyWiseSupportTicketWithPaginationByCompanyId]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@Status INT = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##CompanyWiseSupportTicketPaginationByCompanyIdTbl') IS NOT NULL
	BEGIN
		DROP TABLE ##CompanyWiseSupportTicketPaginationByCompanyIdTbl
	END
	
	SELECT DISTINCT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(
		(
			tbl_company.CompanyName
		),'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.UserId <> 0 AND tbl_supportTicket.UserId IS NOT NULL
			THEN tbl_user.FirstName + ' ' + tbl_user.LastName
			ELSE tbl_salesPerson.FirstName + ' ' + tbl_salesPerson.LastName
		END AS UserName,
		ISNULL(
			tbl_supportTicket.Title
		,'N/A') AS Title,
		ISNULL(
			CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105)
		,'N/A') AS [CreatedOn],
		tbl_supportTicket.CreatedOn AS CreatedOnDate,
		(SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber) AS [TicketStatusId],
		CASE 
			WHEN (SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC) = 1  
			THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(
			STUFF(
				(
					SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
					FOR XML PATH ('')
				), 1, 1, '') 
		,'N/A') AS AssignedUser,
		ISNULL(
			(SELECT TOP (1) 
				CONVERT(nvarchar(50),tbl_assign1.CreatedOn,105) 
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
			)
		,'N/A') AS AssignedOn,
		(
			SELECT TOP (1) 
				tbl_assign1.CreatedOn
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
		) AS AssignedOnDate
	INTO ##CompanyWiseSupportTicketPaginationByCompanyIdTbl
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_supportTicket.SalesPersonId = tbl_salesPerson.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	AND ((SELECT TOP 1 TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC)= @Status OR @Status IS NULL OR @Status = 0)
	AND tbl_company.Id = @CompanyId


	SELECT * FROM ##CompanyWiseSupportTicketPaginationByCompanyIdTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN 
				CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN 
				CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN 
				UserName
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				UserName
		END DESC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'asc' 
			THEN 
				CreatedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'desc' 
			THEN 
				CreatedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN 
				Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN 
				Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				AssignedUser
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				AssignedUser
		END DESC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'asc' 
			THEN 
				AssignedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'desc' 
			THEN 
				AssignedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				TicketStatus
		END ASC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				TicketStatus
		END DESC

	OFFSET @pageNumber ROWS 
	FETCH NEXT @rowsOfPage ROWS ONLY


	SELECT COUNT(*) AS TotalSupportTickets FROM ##CompanyWiseSupportTicketPaginationByCompanyIdTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCountOfAssignedSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCountOfAssignedSupportTicket
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Assigned Support Ticket
-- USP_Admin_GetCountOfAssignedSupportTicket 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCountOfAssignedSupportTicket]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_assignedSupportTicket.TrackingNumber
    FROM [dbo].[Tbl_AssignSupportTicket] tbl_assignedSupportTicket 
	LEFT JOIN [dbo].[Tbl_SupportTicket] tbl_supportTicket ON tbl_supportTicket.TrackingNumber = tbl_assignedSupportTicket.TrackingNumber 
    WHERE tbl_assignedSupportTicket.UserId = @UserId AND tbl_supportTicket.ID IN ( 
    SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_SupportTicket]  b WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber 
    GROUP BY TrackingNumber 
    ) 
    AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL) 
    GROUP BY tbl_assignedSupportTicket.TrackingNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCountOfBannersWithActiveStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCountOfBannersWithActiveStatus
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Company Document
-- USP_Admin_GetCountOfBannersWithActiveStatus
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCountOfBannersWithActiveStatus]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT COUNT(Id) 
	FROM [dbo].[Tbl_Banner] 
	WHERE IsDelete <> 1 AND IsActive <> 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCountOfMainlandAndFreezoneCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCountOfMainlandAndFreezoneCompany
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Mainland and Freezone Company
-- USP_Admin_GetCountOfMainlandAndFreezoneCompany
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCountOfMainlandAndFreezoneCompany]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		COUNT(tbl_company.Id) 
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company.Id = tbl_company_user_mapping.CompanyId 
    LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK)  ON tbl_company_user_mapping.UserId = tbl_user.Id 
    LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholderData WITH(NOLOCK)  ON tbl_company.Id = tbl_shareholderData.CompanyId 
    WHERE tbl_company.IsDelete <> 1  
	AND tbl_company.CompanyName NOT LIKE N'DIBN' 
	AND tbl_company.CompanyType LIKE 'Dubai Mainland' 
	GROUP BY tbl_company.Id

	SELECT 
		COUNT(tbl_company.Id) 
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company.Id = tbl_company_user_mapping.CompanyId 
    LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK)  ON tbl_company_user_mapping.UserId = tbl_user.Id 
    LEFT JOIN [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholderData WITH(NOLOCK)  ON tbl_company.Id = tbl_shareholderData.CompanyId 
    WHERE tbl_company.IsDelete <> 1  
	AND tbl_company.CompanyName NOT LIKE N'DIBN' 
	AND tbl_company.CompanyType LIKE 'Freezone' 
	GROUP BY tbl_company.Id
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCountofManager]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetCountofManager
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Tracking Number By Id
-- USP_Admin_GetCountofManager
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetCountofManager]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		COUNT(*) 
	FROM [dbo].[Tbl_User] tbl_user LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping ON tbl_user.Id = tbl_mapping.UserId  
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_rolemapping ON tbl_user.Id = tbl_rolemapping.UserId  
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolemapping.RoleID 
	WHERE tbl_mapping.CompanyId = @CompanyId  AND tbl_mapping.IsDelete <> 1
	AND tbl_role.RoleName LIKE 'Manager' OR tbl_role.RoleName LIKE 'Managers'
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCurrentRoleModuleByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author : <Yashasvi Sharma>
-- Create date: <12-Oct-2024>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	USP_Admin_GetCurrentRoleModuleByRoleId
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCurrentRoleModuleByRoleId]
	@Role NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_RolePermission] tbl_rolepermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_permission.PermissionId = tbl_rolepermission.PermissionId
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_rolepermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolepermission.RoleID
	WHERE tbl_role.RoleName LIKE @Role AND tbl_rolepermission.IsDelete<> 1 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCurrentRolePermissionNameByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author : <Yashasvi Sharma>
-- Create date: <12-Oct-2024>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_GetCurrentRolePermissionNameByRoleId N'Employee',N'MyRequests'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCurrentRolePermissionNameByRoleId]
	@Role NVARCHAR(MAX) = NULL,
	@Module NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_permission.PermissionName AS PermissionName
	FROM [dbo].[Tbl_RolePermission] tbl_rolepermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_permission.PermissionId = tbl_rolepermission.PermissionId
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_rolepermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolepermission.RoleID
	WHERE tbl_role.RoleName LIKE @Role AND tbl_rolepermission.IsDelete<> 1 AND tbl_module.ModuleName LIKE @Module
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetCurrentUserModuleByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author : <Yashasvi Sharma>
-- Create date: <12-Oct-2024>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	USP_Admin_GetCurrentUserModuleByRoleId 285
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetCurrentUserModuleByRoleId]
	@UserId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_UserPermission] tbl_userPermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_permission.PermissionId = tbl_userPermission.PermissionId
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_userPermission.ModuleId
	WHERE tbl_userPermission.UserId = @UserId
	AND tbl_userPermission.IsDelete<> 1 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetDownloadDocumentList]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetDownloadDocumentList
-- Author:			<Yashasvi Sharma>
-- Created date:	04/Dec/2023
-- Description:		Download Document List
-- USP_Admin_GetDownloadDocumentList 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetDownloadDocumentList]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_downloadDocument.Id AS Id,
		ISNULL(tbl_downloadDocument.FileName,'N/A') AS [FileName],
		ISNULL(tbl_downloadDocument.EmailAddress,'N/A') AS EmailAddress,
		tbl_downloadDocument.FromDate AS FromDate,
		tbl_downloadDocument.ToDate AS ToDate,
		ISNULL(CONVERT(nvarchar(50),tbl_downloadDocument.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(tbl_user.FirstName+' '+tbl_user.LastName+'('+tbl_user.AccountNumber+')','N/A') AS CreatedBy,
		ISNULL(tbl_downloadDocument.Status,'N/A') AS [SendedStatus]
	FROM [dbo].[Tbl_DownloadDocument] tbl_downloadDocument
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_downloadDocument.CreatedBy = tbl_user.Id AND tbl_downloadDocument.CreatedBy IS NOT NULL
	ORDER BY tbl_downloadDocument.Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetEmailDocuments]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetEmailDocuments]
	@Id INT = NULL,
	@EmailId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(tbl_emailDocument.Id,0) AS Id,
		ISNULL(tbl_emailDocument.EmailId,0) AS EmailId,
		ISNULL(tbl_emailDocument.Filename,'N/A') AS Filename,
		ISNULL(tbl_emailDocument.Extension,'N/A') AS Extension,
		tbl_emailDocument.DataBinary AS DataBinary,
		ISNULL(tbl_emailDocument.IsActive,0) AS IsActive,
		ISNULL(tbl_emailDocument.IsDelete,0) AS IsDelete,
		ISNULL(tbl_emailDocument.CreatedBy,0) AS CreatedBy,
		ISNULL(CONVERT(nvarchar(50),tbl_emailDocument.CreatedOn,105),'N/A') AS CreatedOn
	FROM [dbo].[Tbl_EmailDocument] tbl_emailDocument WITH(NOLOCK)
	WHERE IsDelete <> 1 
	AND (tbl_emailDocument.EmailId = @EmailId OR @EmailId IS NULL) 
	AND (tbl_emailDocument.Id = @Id OR @Id IS NULL)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetEmailList]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetEmailList]
	@Id INT = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(tbl_email.Id,0) AS Id,
		ISNULL(tbl_email.CompanyId,0) AS CompanyId,
		ISNULL(tbl_email.MailFrom,'N/A') AS MailFrom,
		ISNULL(tbl_email.MailFromPassword,'N/A') AS MailFromPassword,
		ISNULL(tbl_email.MailTo,'N/A') AS MailTo,
		ISNULL(tbl_email.Subject,'N/A') AS Subject,
		ISNULL(tbl_email.MailBody,'N/A') AS MailBody,
		ISNULL(tbl_email.CreatedBy,0) AS CreatedBy,
		ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
		ISNULL(tbl_Company.CompanyName,'N/A') AS Company,
		ISNULL(CONVERT(NVARCHAR(50),tbl_email.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_email.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_Email] tbl_email WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company ON tbl_Company.Id = tbl_email.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_email.CreatedBy
	WHERE tbl_email.IsDelete <> 1 
	AND (tbl_email.Id = @Id OR @Id IS NULL OR @Id = 0) 
	AND (tbl_email.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetEmployeeCountForAdminDashboard]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetEmployeeCountForAdminDashboard
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Employee Count for Admin Panel
-- USP_Admin_GetEmployeeCountForAdminDashboard
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetEmployeeCountForAdminDashboard]
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @roleId INT = NULL
	SET @roleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')

	SELECT 
		COUNT(*) AS companyOwners
	FROM [dbo].[Tbl_User] tbl_user  
    LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id   
    LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId   
    WHERE tbl_user.IsDelete <> 1 AND tbl_userRoleMapping.RoleID <> @roleId 
    AND tbl_user.IsActive = 1 
    AND tbl_userRoleMapping.IsDelete <> 1  
	AND tbl_mapping.CompanyId <> 1
    AND tbl_user.AccountNumber NOT LIKE 'TBC01'

	SELECT 
		COUNT(*) AS employees
	FROM [dbo].[Tbl_User] tbl_user  
    LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id   
    LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId   
    WHERE tbl_user.IsDelete <> 1 AND tbl_userRoleMapping.RoleID = @roleId 
    AND tbl_user.IsActive = 1
    AND tbl_userRoleMapping.IsDelete <> 1 
	AND tbl_mapping.CompanyId <> 1
    AND tbl_user.AccountNumber NOT LIKE 'TBC01'
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetEmployeeServiceCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetEmployeeServiceCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	10/Oct/2024
-- Description:		Get Count of Employee Services For Admin Panel
-- USP_Admin_GetEmployeeServiceCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetEmployeeServiceCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) AS EmployeeServices
	FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_employeeServiceRequest.IsDelete <> 1) 
    AND tbl_employeeServiceRequest.StatusId <> 3 AND tbl_employeeServiceRequest.StatusId <> 4 AND tbl_employeeServiceRequest.StatusId <> 5

	SELECT DISTINCT 
		COUNT(*) AS EmployeeServices
	FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_employeeServiceRequest.IsDelete <> 1) 
    AND tbl_employeeServiceRequest.StatusId = 3
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetEmployeeServiceIdByCompanyType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetEmployeeServiceIdByCompanyType
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Service Id
-- USP_Admin_GetEmployeeServiceIdByCompanyType
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetEmployeeServiceIdByCompanyType]
	@ServiceName NVARCHAR(MAX) = NULL,
	@companyType NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ID 
	FROM [dbo].[Tbl_EmployeeServices] 
    WHERE ServiceName LIKE '%'+@ServiceName+'%' 
	AND CompanyType LIKE @companyType;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetEmployeeServiceRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetEmployeeServiceRequestByCompanyId 0,0,N'',0
CREATE PROCEDURE [dbo].[USP_Admin_GetEmployeeServiceRequestByCompanyId]
	@CompanyId INT = NULL,
	@SalesPersonId INT = NULL,
	@Company NVARCHAR(MAX) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;
		
	IF @Status = 0 OR @Status IS NULL
	BEGIN
		SELECT DISTINCT
			tbl_serviceRequest.SerialNumber AS SerialNumber,
			ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
			ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
			ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
					THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
					ELSE	
						(SELECT 'N/A')
			END,'N/A') AS ApplicantName,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
			THEN 
				ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
			ELSE 
				(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
			END AS RequestedBy,
			ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
				(SELECT TOP(1) Status 
				FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber 
				ORDER BY StepId DESC)
			END AS [StatusId],
			CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
			THEN
				(SELECT TOP(1) tbl_serviceRequestStatus.Status 
				FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
				WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber
				ORDER BY StepId DESC
				) 
			ELSE 'N/A'
			END AS Status,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser,
				ISNULL(
				(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
				WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				ORDER BY tbl_assign.Id DESC
				) ,'N/A') AS AssignOn,
			ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
						WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
					FOR XML PATH ('')), 1, 1, ''
					) ,'N/A') AS SalesPerson
		FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
		LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
		WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
			AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
			AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
			AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
			AND (tbl_serviceRequest.IsDelete <> 1)
			AND tbl_service.IsEmployeeService <> 0
			AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
			WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
			AND b.IsDelete <> 1
			AND ((tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4) OR @Status IS NULL)
			GROUP BY b.SerialNumber)
		GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
		tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
		tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
		tbl_user.LastName,tbl_company.Id 
		ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status 
					FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber 
					ORDER BY StepId DESC)
				END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber
					ORDER BY StepId DESC
					) 
				ELSE 'N/A'
				END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn,
				 ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
						WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
					FOR XML PATH ('')), 1, 1, ''
					) ,'N/A') AS SalesPerson
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_service.IsEmployeeService <> 0
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND tbl_serviceRequest.Status = 3
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
			tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName,tbl_company.Id 
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
	ELSE IF @Status = 4 OR @Status = 5
	BEGIN
		SELECT DISTINCT
				tbl_serviceRequest.SerialNumber AS SerialNumber,
				ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId,
				ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
				ISNULL(CASE WHEN tbl_service.IsEmployeeService = 1
						THEN (SELECT ISNULL(tbl_Formvalue.FieldValue,'N/A') FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_Formvalue WITH(NOLOCK)
							  LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_formField ON tbl_formField.Id = tbl_Formvalue.FieldId
							  WHERE tbl_formField.FieldName LIKE '%Applicant Name%' 
							  AND tbl_Formvalue.ServiceId = tbl_serviceFormFieldValue.ServiceId 
							  AND tbl_Formvalue.FormId = tbl_serviceFormFieldValue.FormId
							  AND tbl_Formvalue.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber)
						ELSE	
							(SELECT 'N/A')
				END,'N/A') AS ApplicantName,
				ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
				CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
				THEN 
					ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
				ELSE 
					(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
				END AS RequestedBy,
				ISNULL((SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),request.CreatedOn,105),'N/A')
				FROM [dbo].[Tbl_ServiceFormFieldValue] request WITH(NOLOCK)
				WHERE request.SerialNumber LIKE tbl_serviceRequest.SerialNumber
				),'N/A')  AS CreatedOn,
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
					(SELECT TOP(1) Status 
					FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber 
					ORDER BY StepId DESC)
				END AS [StatusId],
				CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
				THEN
					(SELECT TOP(1) tbl_serviceRequestStatus.Status 
					FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
					WHERE SerialNumber LIKE tbl_serviceRequest.SerialNumber
					ORDER BY StepId DESC
					) 
				ELSE 'N/A'
				END AS Status,
				ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
					FOR XML PATH ('')), 1, 1, ''
				 ) ,'N/A') AS AssignedUser,
				 ISNULL(
					(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK)
					WHERE tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber
				 ) ,'N/A') AS AssignOn,
				 ISNULL(STUFF(
					(SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
						WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1
					FOR XML PATH ('')), 1, 1, ''
					) ,'N/A') AS SalesPerson
			FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue  WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
			LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
			LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
			LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
			WHERE (tbl_serviceFormFieldValue.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
				AND (tbl_company.CompanyName LIKE @Company+'%' OR @Company IS NULL)
				AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
				AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL OR tbl_serviceFormFieldValue.IsDelete =0)
				AND (tbl_serviceRequest.IsDelete <> 1)
				AND tbl_service.IsEmployeeService <> 0
				AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
				WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
				AND b.IsDelete <> 1
				AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status =5)
				GROUP BY b.SerialNumber)
			GROUP BY tbl_serviceRequest.SerialNumber,tbl_serviceFormFieldValue.ServiceId,tbl_serviceForm.FormName,
			tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_serviceFormFieldValue.SalesPersonId,tbl_serviceRequest.CreatedOn,
			tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.SerialNumber,tbl_user.FirstName,
			tbl_user.LastName,tbl_company.Id 
			ORDER BY tbl_serviceRequest.SerialNumber 
	END
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetExpenseDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- SP_Admin_GetExpenseDetailsById 1
CREATE PROCEDURE [dbo].[USP_Admin_GetExpenseDetailsById]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ISNULL(Id,0) AS Id,
		ISNULL(CompanyId,0) AS CompanyId,
		ISNULL(TransactionId,'N/A') AS TransactionId,
		ISNULL(ExpensesTitle,'N/A') AS ExpensesTitle,
		ISNULL(ExpensesAmount,'N/A') AS ExpensesAmount,
		ISNULL(Quantity,0) AS Quantity,
		ISNULL(TotalAmount,'0') AS TotalAmount,
		ISNULL(Vat,'0') AS Vat,
		ISNULL(VatAmount,'0') AS VatAmount,
		ISNULL(GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),CreatedOnUtc,21),'N/A') AS CreatedOnUtc
	FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE IsDelete <> 1 AND Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetExpenseModificationDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <13-May-2023>
-- Modify By : <>
-- Modify date : <>
-- <USP_Admin_GetExpenseModificationDetailsById>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetExpenseModificationDetailsById]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @username NVARCHAR(MAX) = NULL,@modifyTime NVARCHAR(50) = NULL
	SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) LEFT JOIN 
		[dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
		WHERE tbl_portalExpense.Id = @Id)

	SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) WHERE Id = @Id)

	SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetHistoryofExpenses]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetHistoryofExpenses]
	@FromDate NVARCHAR(MAX) = NULL,
	@ToDate NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @FromDate IS NOT NULL AND @ToDate IS NOT NULL
	BEGIN
		SELECT DISTINCT
			tbl_payment.Id AS PaymentTransactionId,
			tbl_payment.CompanyId AS CompanyId,
			ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_payment.Description,'N/A') AS Description,
			ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
			tbl_payment.Amount AS Amount,
			ISNULL(tbl_payment.Quantity,1) AS Quantity,
			tbl_payment.TotalAmount AS PaymentCredit,
			CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
			ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
		LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
		WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
		AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
		AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
		GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
		tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount

		SELECT DISTINCT
			ISNULL(tbl_expenses.Id,0) AS Id,
			ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
			ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
			ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
			ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
			ISNULL(tbl_expenses.Quantity,1) AS Quantity,
			ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
			ISNULL(tbl_expenses.Vat,'0') AS Vat,
			ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
			ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
			ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
		FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
		LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
		WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
		GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
		tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
		tbl_expenses.ModifyOnUtc
	END 
	ELSE
	BEGIN
		SELECT DISTINCT
			tbl_payment.Id AS PaymentTransactionId,
			tbl_payment.CompanyId AS CompanyId,
			ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
			ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_payment.Description,'N/A') AS Description,
			tbl_payment.Amount AS Amount,
			ISNULL(tbl_payment.Quantity,1) AS Quantity,
			tbl_payment.TotalAmount AS PaymentCredit,
			CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
			ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
		LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
		WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
		AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
		GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
		tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount

		SELECT DISTINCT
			ISNULL(tbl_expenses.Id,0) AS Id,
			ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
			ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
			ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
			ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
			ISNULL(tbl_expenses.Quantity,1) AS Quantity,
			ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
			ISNULL(tbl_expenses.Vat,'0') AS Vat,
			ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
			ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
			ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
		FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
		LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
		WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
		GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
		tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
		tbl_expenses.ModifyOnUtc
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetHistoryofExpenses_Test]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetHistoryofExpenses_Test 1,20,N'',N'Transaction Id',N'asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetHistoryofExpenses_Test]
	@PageNumber  INT = 0,
	@RowsOfPage INT = 0,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;
	
	WITH TransactionTbl
	AS
	(
	SELECT 
		tbl_payment.Id AS Id,
		tbl_payment.CompanyId AS CompanyId,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id) AS TransactionIdNo,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		tbl_payment.Amount AS Amount,
		ISNULL(tbl_payment.Quantity,1) AS Quantity,
		tbl_payment.TotalAmount AS TotalAmount,
		'0' AS Vat,
		'0' AS VatAmount,
		ISNULL(tbl_payment.TotalAmount,'0') AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		CONVERT(date,tbl_payment.TransectionDate) AS CreatedOn,
		ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
		'Credit' AS TransactionType
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (@searchPrefix IS NULL 
		OR tbl_payment.TransactionId LIKE @searchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
		OR tbl_payment.Description LIKE '%'+@searchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_payment.Amount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_payment.TotalAmount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	)
	GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	
	UNION ALL
	
	SELECT 
		tbl_expenses.Id AS Id,
		ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS Amount,
		ISNULL(tbl_expenses.Quantity,1) AS Quantity,
		ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
		ISNULL(tbl_expenses.Vat,'0') AS Vat,
		ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		CONVERT(date,tbl_expenses.CreatedOnUtc) AS CreatedOn,
		ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId,
		'Debit' AS TransactionType
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	AND (@searchPrefix IS NULL 
		OR tbl_expenses.TransactionId LIKE @searchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
		OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_expenses.ExpensesAmount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.GrandTotal) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.Vat) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.VatAmount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	)
	GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.CreatedOnUtc
	)

	SELECT * 
	FROM TransactionTbl
	ORDER BY 
		CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
			THEN TransactionIdNo
		END ASC,
		CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
			THEN TransactionIdNo
		END ASC,
		CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
			THEN TransactionIdNo
		END DESC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc'
			THEN CreatedOn
		END ASC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc'
			THEN CreatedOn
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
			THEN CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
			THEN CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Type' AND @sortDirection = 'asc'
			THEN TransactionType
		END ASC,
		CASE WHEN @sortColumn = 'Type' AND @sortDirection = 'desc'
			THEN TransactionType
		END DESC,
		CASE WHEN @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
			THEN GrandTotal
		END ASC,
		CASE WHEN @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
			THEN GrandTotal
		END DESC,
		CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
			THEN Id
		END ASC
	OFFSET @PageNumber ROWS
	FETCH NEXT @RowsOfPage ROWS ONLY;


	WITH TransactionTblCount
	AS
	(
	SELECT 
		tbl_payment.Id AS Id
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (@searchPrefix IS NULL 
		OR tbl_payment.TransactionId LIKE @searchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
		OR tbl_payment.Description LIKE '%'+@searchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_payment.Amount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_payment.TotalAmount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	)
	GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	
	UNION ALL
	
	SELECT 
		tbl_expenses.Id AS Id
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	AND (@searchPrefix IS NULL 
		OR tbl_expenses.TransactionId LIKE @searchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
		OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_expenses.ExpensesAmount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.GrandTotal) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.Vat) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.VatAmount) LIKE @searchPrefix
		OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	)
	GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.CreatedOnUtc
	)

	SELECT COUNT(*) AS TransactionCount
	FROM TransactionTblCount

	--SELECT 
	--	tbl_payment.Id AS PaymentTransactionId,
	--	tbl_payment.CompanyId AS CompanyId,
	--	ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
	--	(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
	--	ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
	--	ISNULL(tbl_payment.Description,'N/A') AS Description,
	--	tbl_payment.Amount AS Amount,
	--	ISNULL(tbl_payment.Quantity,1) AS Quantity,
	--	tbl_payment.TotalAmount AS PaymentCredit,
	--	CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
	--	ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
	--	CONVERT(date,tbl_payment.TransectionDate) AS CreatedOn
	--FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	--LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	--WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	--AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	--AND (@searchPrefix IS NULL 
	--	OR tbl_payment.TransactionId LIKE @searchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
	--	OR tbl_payment.Description LIKE '%'+@searchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_payment.Amount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TotalAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	--)
	--GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	--tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	--ORDER BY 
	--	CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
	--		THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id )
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'asc' 
	--		THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id )
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
	--		THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id )
	--	END DESC,
	--	CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc'
	--		THEN tbl_payment.TransectionDate
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc'
	--		THEN tbl_payment.TransectionDate
	--	END DESC,
	--	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
	--		THEN tbl_Company.CompanyName
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
	--		THEN tbl_Company.CompanyName
	--	END DESC,
	--	CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'asc'
	--		THEN tbl_payment.Description
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'desc'
	--		THEN tbl_payment.Description
	--	END DESC,
	--	CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
	--		THEN tbl_payment.Id
	--	END ASC
	--OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	--FETCH NEXT @RowsOfPage ROWS ONLY

	--SELECT 
	--	tbl_expenses.Id AS Id,
	--	ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
	--	ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
	--	ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
	--	ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
	--	ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
	--	ISNULL(tbl_expenses.Quantity,1) AS Quantity,
	--	ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
	--	(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
	--	ISNULL(tbl_expenses.Vat,'0') AS Vat,
	--	ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
	--	ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
	--	ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
	--	ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
	--	ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
	--	CONVERT(date,tbl_expenses.CreatedOnUtc) AS CreatedOn,
	--	ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
	--FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	--WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	--AND (@searchPrefix IS NULL 
	--	OR tbl_expenses.TransactionId LIKE @searchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
	--	OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.ExpensesAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.GrandTotal) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.Vat) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.VatAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	--)
	--GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	--tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
	--tbl_expenses.ModifyOnUtc
	--ORDER BY 
	--	CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
	--		THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
	--		THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
	--		THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )
	--	END DESC,
	--	CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc'
	--		THEN tbl_expenses.CreatedOnUtc
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc'
	--		THEN tbl_expenses.CreatedOnUtc
	--	END DESC,
	--	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
	--		THEN tbl_Company.CompanyName
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
	--		THEN tbl_Company.CompanyName
	--	END DESC,
	--	CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'asc'
	--		THEN tbl_expenses.ExpensesTitle
	--	END ASC,
	--	CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'desc'
	--		THEN tbl_expenses.ExpensesTitle
	--	END DESC,
	--	CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
	--		THEN tbl_expenses.Id
	--	END ASC
	--OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	--FETCH NEXT @RowsOfPage ROWS ONLY


	--SELECT 
	--	COUNT(tbl_payment.Id) AS TransactionCount
	--FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	--LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	--WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	--AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	--AND (@searchPrefix IS NULL 
	--	OR tbl_payment.TransactionId LIKE @searchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
	--	OR tbl_payment.Description LIKE '%'+@searchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_payment.Amount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TotalAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	--)
	--GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	--tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	

	--SELECT 
	--	COUNT(tbl_expenses.Id) AS ExpenseCount
	--FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	--WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	--AND (@searchPrefix IS NULL 
	--	OR tbl_expenses.TransactionId LIKE @searchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@searchPrefix +'%'
	--	OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.ExpensesAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.GrandTotal) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.Vat) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.VatAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@searchPrefix) +'%'
	--)
	--GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	--tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
	--tbl_expenses.ModifyOnUtc

	
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetHistoryofExpenses_Test_2]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetHistoryofExpenses_Test_2 0,20,N'Transaction Id No',N'119',N'Created On',N'desc'
CREATE PROCEDURE [dbo].[USP_Admin_GetHistoryofExpenses_Test_2]
	--@searchPrefix NVARCHAR(MAX) = NULL,
	--@sortColumn NVARCHAR(MAX) = NULL,
	--@sortDirection NVARCHAR(MAX) = NULL
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;
	

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) ='',
		@subQuery AS NVARCHAR(MAX) ='';
	
	SET @query = 
	N'WITH tblTransactionTbl AS (
		SELECT 
		tbl_payment.Id AS Id,
		tbl_payment.CompanyId AS CompanyId,
		tbl_payment.TransactionId AS TransactionId,
		CONVERT(INT,(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id)) AS TransactionIdNo,
		ISNULL(tbl_Company.CompanyName,''N/A'') AS CompanyName,
		ISNULL(tbl_payment.Description,''N/A'') AS Description,
		tbl_payment.Amount AS Amount,
		ISNULL(tbl_payment.Quantity,1) AS Quantity,
		tbl_payment.TotalAmount AS TotalAmount,
		''0'' AS Vat,
		''0'' AS VatAmount,
		ISNULL(tbl_payment.TotalAmount,''0'') AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		CONVERT(date,tbl_payment.TransectionDate) AS CreatedOn,
		ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
		''Credit'' AS TransactionType,
		tbl_payment.IsDelete AS IsDelete,
		tbl_paymentReceipt.IsDelete AS PaymentReceiptIsDelete,
		tbl_Company.IsDelete AS CompanyIsDelete
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount,
	tbl_payment.IsDelete,tbl_paymentReceipt.IsDelete,tbl_Company.IsDelete
	
	UNION ALL
	
	SELECT 
		tbl_expenses.Id AS Id,
		ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
		tbl_expenses.TransactionId AS TransactionId,
		CONVERT(INT,(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX(''N'',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )) AS TransactionIdNo,
		ISNULL(tbl_Company.CompanyName,''N/A'') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,''N/A'') AS Description,
		ISNULL(tbl_expenses.ExpensesAmount,''N/A'') AS Amount,
		ISNULL(tbl_expenses.Quantity,1) AS Quantity,
		ISNULL(tbl_expenses.TotalAmount,''0'') AS TotalAmount,
		ISNULL(tbl_expenses.Vat,''0'') AS Vat,
		ISNULL(tbl_expenses.VatAmount,''0'') AS VatAmount,
		ISNULL(tbl_expenses.GrandTotal,''0'') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),''N/A'') AS [Date],
		CONVERT(date,tbl_expenses.CreatedOnUtc) AS CreatedOn,
		ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId,
		''Debit'' AS TransactionType,
		tbl_expenses.IsDelete AS IsDelete,
		''0'' AS PaymentReceiptIsDelete,
		tbl_Company.IsDelete AS CompanyIsDelete
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.CreatedOnUtc,tbl_Company.IsDelete,
	tbl_expenses.IsDelete)'

	IF @searchBy IS NOT NULL AND @searchPrefix IS NOT NULL
	BEGIN
		SET @conditions = N' WHERE (IsDelete <> 1 OR IsDelete IS NULL)
		AND (PaymentReceiptIsDelete <> 1 OR PaymentReceiptIsDelete IS NULL) 
		AND (CompanyIsDelete <> 1 OR CompanyIsDelete IS NULL) '

		IF @searchBy = N'Transaction Id'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),TransactionId) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Transaction Id No'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),TransactionIdNo) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Created On'
		BEGIN
			SET @conditions = @conditions + N' AND [Date] LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = N'Company'
		BEGIN
			SET @conditions = @conditions + N' AND CompanyName LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = N'Description'
		BEGIN
			SET @conditions = @conditions + N' AND Description LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = N'Type'
		BEGIN
			SET @conditions = @conditions + N' AND TransactionType LIKE ''%'+@searchPrefix+'%'''
		END

		IF @searchBy = N'Amount'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),Amount) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Quantity'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),Quantity) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Total Amount'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),TotalAmount) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Vat(%)'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),Vat) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Vat Amount'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),VatAmount) = '''+@searchPrefix+''''
		END

		IF @searchBy = N'Grand Total'
		BEGIN
			SET @conditions = @conditions + N' AND CONVERT(NVARCHAR(50),GrandTotal) = '''+@searchPrefix+''''
		END
	END
	ELSE
	BEGIN
	SET @conditions = N' WHERE (IsDelete <> 1 OR IsDelete IS NULL)
		AND (PaymentReceiptIsDelete <> 1 OR PaymentReceiptIsDelete IS NULL) 
		AND (CompanyIsDelete <> 1 OR CompanyIsDelete IS NULL) '

		SET @conditions = @conditions + N' AND (@searchPrefix IS NULL)'
	END

	SET @subQuery = N'SELECT * FROM tblTransactionTbl '

	SET @orderByClause = N'ORDER BY '

	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionIdNo '
		+ ' ASC '
	END

	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionIdNo '
		+ ' DESC '
	END

	IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn '
		+ ' ASC '
	END

	IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn '
		+ ' DESC '
	END

	IF @sortColumn = 'Company' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName '
		+ ' ASC '
	END

	IF @sortColumn = 'Company' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName '
		+ ' DESC '
	END

	IF @sortColumn = 'Type' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionType '
		+ ' ASC '
	END

	IF @sortColumn = 'Type' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' TransactionType '
		+ ' DESC '
	END

	IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CONVERT(DECIMAL(18,2),GrandTotal) '
		+ ' ASC '
	END

	IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CONVERT(DECIMAL(18,2),GrandTotal) '
		+ ' DESC '
	END

	SET @pagination = N'OFFSET @PageNumber ROWS
						FETCH NEXT @RowsOfPage ROWS ONLY;'

	SET @selectQuery = @query +' '+ @subQuery +' ' + @conditions + ' '+@orderByClause +' '+@pagination 

	EXEC SP_EXECUTESQL @selectQuery
	,N'@PageNumber INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX),@conditions NVARCHAR(MAX)'
	,@PageNumber,@RowsOfPage,@searchPrefix,@conditions;

	SET @subQuery = N'SELECT COUNT(*) AS TransactionCount FROM tblTransactionTbl'

	SET @selectQuery = @query +' '+ @subQuery +' ' + @conditions 

	EXEC SP_EXECUTESQL @selectQuery
	,N'@searchPrefix NVARCHAR(MAX),@conditions NVARCHAR(MAX)'
	,@searchPrefix,@conditions;

	--IF OBJECT_ID(N'tempdb..##TransactionTbl') IS NOT NULL
	--BEGIN
	--	DROP TABLE ##TransactionTbl
	--END

	--SELECT 
	--	tbl_payment.Id AS Id,
	--	tbl_payment.CompanyId AS CompanyId,
	--	tbl_payment.TransactionId AS TransactionId,
	--	CONVERT(INT,(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id)) AS TransactionIdNo,
	--	ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
	--	ISNULL(tbl_payment.Description,'N/A') AS Description,
	--	tbl_payment.Amount AS Amount,
	--	ISNULL(tbl_payment.Quantity,1) AS Quantity,
	--	tbl_payment.TotalAmount AS TotalAmount,
	--	'0' AS Vat,
	--	'0' AS VatAmount,
	--	ISNULL(tbl_payment.TotalAmount,'0') AS GrandTotal,
	--	CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
	--	CONVERT(date,tbl_payment.TransectionDate) AS CreatedOn,
	--	ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
	--	'Credit' AS TransactionType
	--INTO ##TransactionTbl
	--FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	--LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	--WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	--AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	--GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	--tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	
	--UNION ALL
	
	--SELECT 
	--	tbl_expenses.Id AS Id,
	--	ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
	--	tbl_expenses.TransactionId AS TransactionId,
	--	CONVERT(INT,(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )) AS TransactionIdNo,
	--	ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
	--	ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
	--	ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS Amount,
	--	ISNULL(tbl_expenses.Quantity,1) AS Quantity,
	--	ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
	--	ISNULL(tbl_expenses.Vat,'0') AS Vat,
	--	ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
	--	ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
	--	ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
	--	CONVERT(date,tbl_expenses.CreatedOnUtc) AS CreatedOn,
	--	ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId,
	--	'Debit' AS TransactionType
	--FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	--WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	--GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	--tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.CreatedOnUtc

	--SET @query = 'SELECT * FROM ##TransactionTbl'

	--IF @searchBy IS NOT NULL AND @searchPrefix IS NOT NULL
	--BEGIN
	--	IF @searchBy = N'Transaction Id'
	--	BEGIN
	--		SET @conditions = N' WHERE TransactionId = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Transaction Id No'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),TransactionIdNo) = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Created On'
	--	BEGIN
	--		SET @conditions = N' WHERE [Date] LIKE ''%'+@searchPrefix+'%'''
	--	END

	--	IF @searchBy = N'Company'
	--	BEGIN
	--		SET @conditions = N' WHERE CompanyName LIKE ''%'+@searchPrefix+'%'''
	--	END

	--	IF @searchBy = N'Description'
	--	BEGIN
	--		SET @conditions = N' WHERE Description LIKE ''%'+@searchPrefix+'%'''
	--	END

	--	IF @searchBy = N'Type'
	--	BEGIN
	--		SET @conditions = N' WHERE TransactionType LIKE ''%'+@searchPrefix+'%'''
	--	END

	--	IF @searchBy = N'Amount'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),Amount) = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Quantity'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),Quantity) = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Total Amount'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),TotalAmount) = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Vat(%)'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),Vat) = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Vat Amount'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),VatAmount) = '''+@searchPrefix+''''
	--	END

	--	IF @searchBy = N'Grand Total'
	--	BEGIN
	--		SET @conditions = N' WHERE CONVERT(NVARCHAR(50),GrandTotal) = '''+@searchPrefix+''''
	--	END
	--END
	--ELSE
	--BEGIN
	--	SET @conditions = N' WHERE (@searchPrefix IS NULL)'
	--END

	--SET @orderByClause = N'ORDER BY '

	--IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' TransactionIdNo '
	--	+ ' ASC '
	--END

	--IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' TransactionIdNo '
	--	+ ' DESC '
	--END

	--IF @sortColumn = 'Created On' AND @sortDirection = 'asc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' CreatedOn '
	--	+ ' ASC '
	--END

	--IF @sortColumn = 'Created On' AND @sortDirection = 'desc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' CreatedOn '
	--	+ ' DESC '
	--END

	--IF @sortColumn = 'Company' AND @sortDirection = 'asc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' CompanyName '
	--	+ ' ASC '
	--END

	--IF @sortColumn = 'Company' AND @sortDirection = 'desc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' CompanyName '
	--	+ ' DESC '
	--END

	--IF @sortColumn = 'Type' AND @sortDirection = 'asc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' TransactionType '
	--	+ ' ASC '
	--END

	--IF @sortColumn = 'Type' AND @sortDirection = 'desc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' TransactionType '
	--	+ ' DESC '
	--END

	--IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' CONVERT(DECIMAL(18,2),GrandTotal) '
	--	+ ' ASC '
	--END

	--IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
	--BEGIN
	--	SET @orderByClause = @orderByClause 
	--	+ ' CONVERT(DECIMAL(18,2),GrandTotal) '
	--	+ ' DESC '
	--END

	--SET @pagination = N'OFFSET @PageNumber ROWS
	--					FETCH NEXT @RowsOfPage ROWS ONLY;'

	--SET @selectQuery = @query +' '+ @conditions +' '+@orderByClause +' '+@pagination 

	--EXEC SP_EXECUTESQL @selectQuery
	--,N'@PageNumber INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)'
	--,@PageNumber,@RowsOfPage,@searchPrefix

	--SET @query = 'SELECT COUNT(*) AS TransactionCount FROM ##TransactionTbl'

	--SET @countingQuery = @query +' '+ @conditions

	--EXEC SP_EXECUTESQL @countingQuery
	--,N'@searchPrefix NVARCHAR(MAX)'
	--,@searchPrefix

	--SELECT 
	--	tbl_payment.Id AS PaymentTransactionId,
	--	tbl_payment.CompanyId AS CompanyId,
	--	ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
	--	(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
	--	ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
	--	ISNULL(tbl_payment.Description,'N/A') AS Description,
	--	tbl_payment.Amount AS Amount,
	--	ISNULL(tbl_payment.Quantity,1) AS Quantity,
	--	tbl_payment.TotalAmount AS PaymentCredit,
	--	CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
	--	ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId,
	--	CONVERT(date,tbl_payment.TransectionDate) AS CreatedOn
	--FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	--LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	--WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	--AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	--AND (@SearchPrefix IS NULL 
	--	OR tbl_payment.TransactionId LIKE @SearchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
	--	OR tbl_payment.Description LIKE '%'+@SearchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_payment.Amount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TotalAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	--)
	--GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	--tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	
	--SELECT 
	--	tbl_expenses.Id AS Id,
	--	ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
	--	ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
	--	ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
	--	ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
	--	ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
	--	ISNULL(tbl_expenses.Quantity,1) AS Quantity,
	--	ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
	--	(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
	--					FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
	--	ISNULL(tbl_expenses.Vat,'0') AS Vat,
	--	ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
	--	ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
	--	ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
	--	ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
	--	ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
	--	CONVERT(date,tbl_expenses.CreatedOnUtc) AS CreatedOn,
	--	ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
	--FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	--WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	--AND (@SearchPrefix IS NULL 
	--	OR tbl_expenses.TransactionId LIKE @SearchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
	--	OR tbl_expenses.ExpensesTitle LIKE '%'+@SearchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.ExpensesAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.GrandTotal) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.Vat) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.VatAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	--)
	--GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	--tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
	--tbl_expenses.ModifyOnUtc

	--SELECT 
	--	COUNT(tbl_payment.Id) AS TransactionCount
	--FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	--LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	--WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	--AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	--AND (@SearchPrefix IS NULL 
	--	OR tbl_payment.TransactionId LIKE @SearchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
	--	OR tbl_payment.Description LIKE '%'+@SearchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_payment.Amount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TotalAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	--)
	--GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	--tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	

	--SELECT 
	--	COUNT(tbl_expenses.Id) AS ExpenseCount
	--FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	--LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	--LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	--WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	--AND (@SearchPrefix IS NULL 
	--	OR tbl_expenses.TransactionId LIKE @SearchPrefix +'%'
	--	OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
	--	OR tbl_expenses.ExpensesTitle LIKE '%'+@SearchPrefix +'%'
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.ExpensesAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.GrandTotal) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.Vat) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.VatAmount) LIKE @searchPrefix
	--	OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	--)
	--GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	--tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
	--tbl_expenses.ModifyOnUtc
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetHistoryofExpenses_Test1]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetHistoryofExpenses_Test ,25,N'',N'Transaction Id',N'asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetHistoryofExpenses_Test1]
	@PageNumber  INT = 0,
	@RowsOfPage INT = 0,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.Id AS PaymentTransactionId,
		tbl_payment.CompanyId AS CompanyId,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		tbl_payment.Amount AS Amount,
		ISNULL(tbl_payment.Quantity,1) AS Quantity,
		tbl_payment.TotalAmount AS PaymentCredit,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		ISNULL(tbl_paymentReceipt.Id,0) AS ExpenseReceiptId
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	AND (@SearchPrefix IS NULL 
		OR tbl_payment.TransactionId LIKE @SearchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
		OR tbl_payment.Description LIKE '%'+@SearchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	)
	GROUP BY tbl_payment.Id,tbl_payment.CompanyId,tbl_Company.CompanyName,tbl_payment.Description,tbl_payment.TransactionId,
	tbl_payment.Quantity,tbl_payment.TotalAmount,tbl_payment.TransectionDate,tbl_paymentReceipt.Id,tbl_payment.Amount
	ORDER BY 
		CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'asc' 
			THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id )
		END ASC,
		CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
			THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id )
		END DESC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc'
			THEN CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105)
		END ASC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc'
			THEN CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105)
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
			THEN tbl_Company.CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
			THEN tbl_Company.CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'asc'
			THEN tbl_payment.Description
		END ASC,
		CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'desc'
			THEN tbl_payment.Description
		END DESC,
		CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
			THEN tbl_payment.Id
		END ASC
	OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	FETCH NEXT @RowsOfPage ROWS ONLY

	SELECT 
		tbl_expenses.Id AS Id,
		ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
		ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
		ISNULL(tbl_expenses.Quantity,1) AS Quantity,
		ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.Vat,'0') AS Vat,
		ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
		ISNULL((SELECT Id FROM [dbo].[Tbl_Expense_Receipt] WITH(NOLOCK) WHERE RecieptId = tbl_expenses.Id AND IsDelete <> 1),0) AS ExpenseReceiptId
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	AND (@SearchPrefix IS NULL 
		OR tbl_expenses.TransactionId LIKE @SearchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
		OR tbl_expenses.ExpensesTitle LIKE '%'+@SearchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	)
	GROUP BY tbl_expenses.Id,tbl_expenses.CompanyId,tbl_expenses.TransactionId,tbl_Company.CompanyName,tbl_expenses.ExpensesTitle,tbl_expenses.ExpensesAmount,
	tbl_expenses.Quantity,tbl_expenses.TotalAmount,tbl_expenses.Vat,tbl_expenses.VatAmount,tbl_expenses.GrandTotal,tbl_expenses.IsDelete,tbl_expenses.CreatedOnUtc,
	tbl_expenses.ModifyOnUtc
	ORDER BY 
		CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
			THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )
		END ASC,
		CASE WHEN @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
			THEN (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id )
		END DESC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'asc'
			THEN CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105)
		END ASC,
		CASE WHEN @sortColumn = 'Created On' AND @sortDirection = 'desc'
			THEN CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105)
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
			THEN tbl_Company.CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
			THEN tbl_Company.CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'asc'
			THEN tbl_expenses.ExpensesTitle
		END ASC,
		CASE WHEN @sortColumn = 'Description' AND @sortDirection = 'desc'
			THEN tbl_expenses.ExpensesTitle
		END DESC,
		CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
			THEN tbl_expenses.Id
		END ASC
	OFFSET (@PageNumber-1)*@RowsOfPage ROWS
	FETCH NEXT @RowsOfPage ROWS ONLY

		SELECT 
			COUNT(tbl_payment.Id) AS TransactionCount
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
		LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
		WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
		AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
		AND (@SearchPrefix IS NULL 
			OR tbl_payment.TransactionId LIKE @SearchPrefix +'%'
			OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
			OR tbl_payment.Description LIKE '%'+@SearchPrefix +'%'
			OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
		)
		

	SELECT 
		COUNT(tbl_expenses.Id) AS ExpenseCount
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1
	AND (@SearchPrefix IS NULL 
		OR tbl_expenses.TransactionId LIKE @SearchPrefix +'%'
		OR tbl_Company.CompanyName LIKE '%'+@SearchPrefix +'%'
		OR tbl_expenses.ExpensesTitle LIKE '%'+@SearchPrefix +'%'
		OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+ CONVERT(NVARCHAR(50),@SearchPrefix) +'%'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetInActiveEmployee]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <08-02-2022,06-09-2022>
-- Description:	<Get all in-active employees whoes IsActive is zero>
-- <USP_Admin_GetInActiveEmployee>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetInActiveEmployee]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT DISTINCT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id
			FOR XML PATH('')),1,1,'') AS RoleName,
		ISNULL(tbl_user.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),'N/A') AS EmployeementCardExpiryDate,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin,
		ISNULL(tbl_company.Id,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_company_mapping ON tbl_user_company_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_user_company_mapping.CompanyId
	WHERE (tbl_company.Id = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0) 
	AND tbl_user.IsActive = 0  
	AND tbl_user.IsDelete <> 1 
	AND tbl_company.IsDelete <> 1
	AND tbl_user_company_mapping.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN' 
	GROUP BY tbl_user.Id,tbl_user.AccountNumber,tbl_user.FirstName,tbl_user.LastName,tbl_user.Nationality,tbl_user.EmailID,tbl_user.PhoneNumber,tbl_user.CountryOfRecidence,
	tbl_user.TelephoneNumber,tbl_user.PassportNumber,tbl_user.Designation,tbl_user.VisaExpiryDate,tbl_user.InsuranceCompany,tbl_user.InsuranceExpiryDate,tbl_user.IsActive,
	tbl_user.IsDelete,tbl_user.EmployeementCardExpiryDate,tbl_user.CreatedOnUTC,tbl_user.ModifyOnUTC,tbl_user.IsLogin,tbl_company.CompanyName,tbl_user.PassportExpiryDate,
	tbl_company.Id
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLastAddedTransactionCode]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_GetLastAddedTransactionCode
-- Author:		<Yashasvi Sharma>
-- Create date: <26-September-2024>
-- Modify By : <>
-- Modify date : <>
-- USP_Admin_GetLastAddedTransactionCode N'Debit'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetLastAddedTransactionCode]
	@id int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		TransactionId AS TransactionId
	FROM [dbo].[Tbl_AccountManagementStaging] WITH(NOLOCK)
	WHERE Id = @id

	--IF @accountType = 'Credit'
	--BEGIN
	--	SELECT TOP 1 
	--		TransactionId AS TransactionId
	--	FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	--	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	--	ORDER BY Id DESC
	--END
	--ELSE IF @accountType = 'Debit'
	--BEGIN
	--	SELECT TOP 1 
	--		TransactionId AS TransactionId
	--	FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	--	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	--	ORDER BY Id DESC
	--END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLastServiceRequestNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetLastServiceRequestNumber
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get last service request number
-- USP_Admin_GetLastServiceRequestNumber 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetLastServiceRequestNumber]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT MAX(SerialNumber) 
	FROM [dbo].[Tbl_ServiceFormFieldValue] 
	WHERE (IsDelete <> 0 OR IsDelete IS NULL)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLastStatusOfSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetLastStatusOfSupportTicket
-- Author:			<Yashasvi Sharma>
-- Created date:	06/July/2023
-- Description:		Get last status of Support Ticket
-- USP_Admin_GetLastStatusOfSupportTicket N'TR201'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetLastStatusOfSupportTicket]
	@TrackingNumber nvarchar(500) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP 1 
		tbl_supportTicket.TicketStatus AS [TicketStatus]
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket
	WHERE tbl_supportTicket.TrackingNumber = @TrackingNumber
	AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL)
	ORDER BY ID DESC
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLastStepNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetLastStepNumber]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @LastStepId INT = NULL;
	SET @LastStepId = ( SELECT MAX(StepId)
						FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
						WHERE SerialNumber LIKE @SerialNumber
				      )


	SET @LastStepId = @LastStepId +1;

	SELECT @LastStepId

END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLastStepnumberByServiceId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetLastStepnumberByServiceId 147,139
CREATE PROCEDURE [dbo].[USP_Admin_GetLastStepnumberByServiceId]
	@ServiceId INT = NULL,
	@FormId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	IF EXISTS(SELECT StepNumber FROM [dbo].[Tbl_ServiceFormDataField] WITH(NOLOCK) WHERE ServiceId = @ServiceId AND FormId = @FormId AND IsDelete <> 1 AND IsActive <>0)
	BEGIN
		SELECT TOP(1) 
			ISNULL(serviceformfield.StepNumber,0) AS StepNumber
		FROM [dbo].[Tbl_ServiceFormDataField] serviceformfield WITH(NOLOCK)
		WHERE serviceformfield.ServiceId = @ServiceId AND serviceformfield.FormId = @FormId
		AND IsDelete <> 1 AND IsActive <>0
		ORDER BY StepNumber DESC
	END
	ELSE 
	BEGIN
		SELECT 0 AS StepNumber
	END
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLatestStatusOfRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--SP_Admin_GetLatestStatusOfRequest N'SR104'
CREATE PROCEDURE [dbo].[USP_Admin_GetLatestStatusOfRequest]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1)
		Status
	FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
	WHERE SerialNumber LIKE @SerialNumber
	ORDER BY StepId DESC
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetListOfDocumentAuthority]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetListOfDocumentAuthority
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Authority List
-- USP_Admin_GetListOfDocumentAuthority
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetListOfDocumentAuthority]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		AuthorityName AS AuthorityName  
	FROM [dbo].[Tbl_Company_Document_Mapping] 
	WHERE IsDeleted <> 1 AND AuthorityName IS NOT NULL
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLogs]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetLogs]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(Id,0) AS Id,
		ISNULL(Message,'N/A') AS [Message],
		ISNULL(MessageTemplate,'N/A') AS MessageTemplate,
		ISNULL(Level,'N/A') AS [Level],
		ISNULL(TimeStamp,'N/A') AS [TimeStamp],
		ISNULL(Exception,'N/A') AS Exception,
		ISNULL(LogEvent,'N/A') AS LogEvent,
		ISNULL(Username,'N/A') AS Username,
		ISNULL(IP,'N/A') AS [IP]
	FROM [dbo].[Tbl_Log] WITH(NOLOCK) --[DIBN_LOG].
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	ORDER BY Id DESC
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetLossCompanyListReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <16-08-2023>
-- Modify By : <Modify By>
-- Modify date : <Modify On>
-- Description:	Get Company list which have negative portal balance
-- USP_Admin_GetLossCompanyListReport
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetLossCompanyListReport]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_company.AccountNumber AS AccountNumber,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_portalBalance.BalanceAmount,'0') AS PortalBalance,
		ISNULL(STUFF((SELECT DISTINCT ',' + tbl_user1.FirstName + ' ' + tbl_user1.LastName 
		FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId
		LEFT JOIN [dbo].[Tbl_Role] tbl_roles WITH(NOLOCK) ON tbl_roles.RoleID = tbl_userRoleMapping.RoleID 
		WHERE tbl_user1.Id = tbl_user.Id AND tbl_mapping.IsDelete <> 1 
		AND tbl_mapping.CompanyId = tbl_company.Id
		AND tbl_userRoleMapping.RoleID = (
			SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE 'Company Owner'  
		)
		FOR XML PATH('')),1,1,''),'N/A') AS CompanyOwner,
		ISNULL(tbl_company.EmailID,'N/A') AS Email
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_PortalBalance] tbl_portalBalance WITH(NOLOCK) ON tbl_portalBalance.CompanyId = tbl_company.Id 
	WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName NOT LIKE N'DIBN'
	AND CONVERT(decimal(18,2),tbl_portalBalance.BalanceAmount) < 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetMainCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <13-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get Main Company>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetMainCompany]
AS
SET NOCOUNT ON;
BEGIN
	

	SELECT DISTINCT
		ISNULL(tbl_company.Id,0) AS Id,
		ISNULL(tbl_company.DibnUserNumber,'N/A') AS DIBNUserNumber,
		ISNULL(tbl_company.AccountNumber,'N/A') AS AccountNumber,
		--ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_company.ShareCapital,'N/A') AS ShareCapital,
		ISNULL(tbl_company.CompanyRegistrationNumber,'N/A') AS CompanyRegistrationNumber,
		ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
		ISNULL(tbl_company.EmergencyNumber,'N/A') AS EmergencyNumber,
		ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_company.SecondEmailID,'N/A') AS SecondEmailID,
		ISNULL(tbl_company.LicenseType,'N/A') AS LicenseType,
		ISNULL(tbl_company.LicenseStatus,'N/A') AS LicenseStatus,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseIssueDate,105),'N/A') AS LicenseIssueDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LicenseExpiryDate,105),'N/A') AS LicenseExpiryDate,
		ISNULL(tbl_company.LeaseFacilityType,'N/A') AS LeaseFacilityType,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseStartDate,105),'N/A') AS LeaseStartDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.LeaseExpiryDate,105),'N/A') AS LeaseExpiryDate,
		ISNULL(tbl_company.LeaseStatus,'N/A') AS LeaseStatus,
		ISNULL(tbl_company.UnitLocation,'N/A') AS UnitLocation,
		ISNULL(tbl_company.IsActive,0) AS IsActive,
		ISNULL(tbl_company.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_company.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	LEFT JoIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_company_user_mapping.UserId = tbl_user.Id
	WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName LIKE N'DIBN'
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetMessageTemplateIdByName]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetMessageTemplateIdByName
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get message template Id
-- USP_Admin_GetMessageTemplateIdByName
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetMessageTemplateIdByName]
	@messageTemplateName NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		Id 
	FROM [dbo].[Tbl_MessageTemplate] 
	WHERE [Name] LIKE @messageTemplateName 
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetModules]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetModules>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetModules]
AS
SET NOCOUNT ON;
BEGIN
	

	SELECT 
		ISNULL(tbl_module.ModuleId,0) AS ModuleId,
		ISNULL(tbl_module.ModuleName,'N/A') AS ModuleName,
		ISNULL(tbl_module.ModuleKeyword,'N/A') AS ModuleKeyword,
		ISNULL(tbl_module.IsActive,0) AS IsActive,
		ISNULL(tbl_module.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(MAX),tbl_module.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(MAX),tbl_module.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_Module] tbl_module WITH(NOLOCK)
	WHERE tbl_module.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetMonthlyCompanySubTypeReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get Company's Sub Type monthly report
-- USP_Admin_GetMonthlyCompanySubTypeReport N'Abu Dhabi'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetMonthlyCompanySubTypeReport]
	@subType nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDate datetime2(7) = NULL
	SET @currentDate = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

	SELECT 
		COUNT(tbl_company.Id) AS TotalCompanies,
		tbl_company.CompanyType AS CompanySubType
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsActive <> 0
	AND tbl_company.IsDelete <> 1
	AND tbl_company.CompanyType = @subType 
	AND MONTH(tbl_company.CompanySubTypeUpdated) = MONTH(@currentDate)
	GROUP BY tbl_company.CompanyType
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetNewCompanyInvoiceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <USP_Admin_GetNewCompanyInvoiceDetails 1,N'PI108'>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetNewCompanyInvoiceDetails]
	@Status INT = NULL,
	@InvoiceNumber NVARCHAR(MAX) =NULL,
	@Id INT = NULL,
	@TotalAmount NVARCHAR(100) = NULL,
	@VatAmount NVARCHAR(100) = NULL,
	@UserId INT =NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_companyInvoiceDetail.CompanyName,'N/A') AS CompanyName,
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.CreatedOn,23),'---') AS CreatedOn,
			ISNULL(tbl_companyInvoiceDetail.Currency,'AED') AS Currency,
			ISNULL(tbl_companyInvoiceDetail.Country,'---') AS Country,
			ISNULL(tbl_companyInvoiceDetail.City,'---') AS UnitLocation,
			ISNULL(tbl_companyInvoiceDetail.Service,'---') AS [Service],
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreationDate,105),'N/A') AS [Date]
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)

		SELECT DISTINCT 
			ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
			ISNULL(tbl_companyInvoiceDetail.ProductName,'N/A') AS ProductName,
			ISNULL(tbl_companyInvoiceDetail.Quantity,0) AS Quantity,
			ISNULL(tbl_companyInvoiceDetail.Amount,0) AS Amount,
			ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
			ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat,
			ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
			ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)

		SELECT DISTINCT
			ISNULL(tbl_companyInvoiceDetail.GrandTotal,0) AS GrandTotal,
			ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
			ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		GROUP BY tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.VatAmount,tbl_companyInvoiceDetail.Vat

		SELECT 
			ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
			ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
			ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
			ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND tbl_companyInvoiceDetail.Vat <> 0 
		AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		GROUP BY tbl_companyInvoiceDetail.VatAmount,tbl_companyInvoiceDetail.Vat,tbl_companyInvoiceDetail.TotalAmount,tbl_companyInvoiceDetail.Id

		SELECT DISTINCT
			ISNULL(tbl_companyInvoiceDetail.InvoiceNumber,'N/A') AS InvoiceNumber
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
		WHERE tbl_companyInvoiceDetail.InvoiceNumber LIKE @InvoiceNumber 
		AND tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL

	END
	ELSE IF @Status = 3
	BEGIN

		SELECT DISTINCT
			tbl_companyInvoiceDetail.InvoiceNumber AS InvoiceNumber,
			ISNULL(tbl_companyInvoiceDetail.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_companyInvoiceDetail.Service,'N/A') AS [Service],
			ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreationDate,105),'N/A') AS [Date],
			ISNULL(tbl_companyInvoiceDetail.Currency,'AED') AS Currency,
			MAX(tbl_companyInvoiceDetail.GrandTotal) AS GrandTotal,
			ISNULL(tbl_companyInvoiceDetail.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username
		FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_companyInvoiceDetail.CreatedBy
		WHERE tbl_companyInvoiceDetail.Id IN (SELECT DISTINCT
																MAX(Id) 
															 FROM [dbo].[Tbl_NewCompanyInvoiceDetails] b WITH(NOLOCK)
															 WHERE b.InvoiceNumber = tbl_companyInvoiceDetail.InvoiceNumber 
															 AND (b.IsDelete <> 1 OR b.IsDelete IS NULL)
															 GROUP BY b.InvoiceNumber 
															 )
			AND (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL)
		GROUP BY 
			tbl_companyInvoiceDetail.InvoiceNumber,
			tbl_companyInvoiceDetail.CompanyName,
			tbl_companyInvoiceDetail.InvoiceCreationDate,
			tbl_companyInvoiceDetail.GrandTotal,
			tbl_companyInvoiceDetail.CreatedBy,
			tbl_companyInvoiceDetail.Currency,
			tbl_user.FirstName,
			tbl_user.LastName,
			tbl_companyInvoiceDetail.Service
		ORDER BY tbl_companyInvoiceDetail.InvoiceNumber
	END
	ELSE IF @Status = 4
	BEGIN	
		UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE InvoiceNumber LIKE @InvoiceNumber

		SELECT 1
	END
	ELSE IF @Status = 5
	BEGIN	
		SET NOCOUNT ON;

		DECLARE @GrandTotal DECIMAL(18,2) = NULL,@RemoveAmount DECIMAL(18,2) = NULL,@FinalTotal DECIMAL(18,2)=NULL;
		--SET @GrandTotal = (SELECT MAX(GrandTotal) FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WHERE InvoiceNumber LIKE @InvoiceNumber AND IsDelete <> 1);

		--SET @RemoveAmount = CONVERT(DECIMAL(18,2),@TotalAmount) + CONVERT(DECIMAL(18,2),@VatAmount);

		--SET @FinalTotal =  CONVERT(DECIMAL(18,2),@GrandTotal) - CONVERT(DECIMAL(18,2),@RemoveAmount);

		--UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
		--SET
		--	GrandTotal = @FinalTotal,
		--	ModifyBy = @UserId,
		--	ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		--WHERE InvoiceNumber LIKE @InvoiceNumber


		UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		SET @GrandTotal = (SELECT (SUM(TotalAmount) + SUM(VatAmount)) AS GrandTotal FROM [dbo].[Tbl_NewCompanyInvoiceDetails]
		WHERE InvoiceNumber = @InvoiceNumber AND IsDelete <> 1)


		UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
		SET
			GrandTotal = @GrandTotal
		WHERE InvoiceNumber LIKE @InvoiceNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetNewCompanyInvoiceDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <02-July-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <USP_Admin_GetNewCompanyInvoiceDetailsById>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetNewCompanyInvoiceDetailsById]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @InvoiceNumber NVARCHAR(MAX)=NULL ,@GrandTotal Decimal(18,2) = NULL;
	SET @InvoiceNumber = (SELECT InvoiceNumber FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WHERE Id=@Id AND IsDelete<> 1 OR IsDelete IS NULL)
	SET @GrandTotal= (SELECT MAX(GrandTotal) FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WHERE InvoiceNumber = @InvoiceNumber AND IsDelete<> 1 OR IsDelete IS NULL)

	SELECT DISTINCT 
		ISNULL(tbl_companyInvoiceDetail.Id,0) AS Id,
		ISNULL(tbl_companyInvoiceDetail.ProductName,'N/A') AS ProductName,
		ISNULL(tbl_companyInvoiceDetail.Quantity,0) AS Quantity,
		ISNULL(tbl_companyInvoiceDetail.Amount,0) AS Amount,
		ISNULL(tbl_companyInvoiceDetail.TotalAmount,0) AS TotalAmount,
		ISNULL(tbl_companyInvoiceDetail.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_companyInvoiceDetail.Vat,0) AS Vat,
		ISNULL(tbl_companyInvoiceDetail.VatAmount,0) AS VatAmount,
		ISNULL(@GrandTotal,0) AS GrandTotal,
		ISNULL(tbl_companyInvoiceDetail.InvoiceNumber,'N/A') AS InvoiceNumber
	FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
	WHERE tbl_companyInvoiceDetail.Id = @Id AND tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL AND tbl_companyInvoiceDetail.InvoiceNumber = @InvoiceNumber
	GROUP BY 
		tbl_companyInvoiceDetail.Id,tbl_companyInvoiceDetail.ProductName,tbl_companyInvoiceDetail.Quantity,tbl_companyInvoiceDetail.Amount,tbl_companyInvoiceDetail.TotalAmount
		,tbl_companyInvoiceDetail.CompanyName,tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.InvoiceNumber,tbl_companyInvoiceDetail.Vat,tbl_companyInvoiceDetail.VatAmount
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetNewCompanyInvoiceDetailsByInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <USP_Admin_GetNewCompanyInvoiceDetailsByInvoice N'PI101'>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetNewCompanyInvoiceDetailsByInvoice]
	@Invoice NVARCHAR(MAX)=NULL 
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @GrandTotal Decimal(18,2) = NULL;
	SET @GrandTotal= (SELECT MAX(GrandTotal) FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WHERE InvoiceNumber = @Invoice AND IsDelete<> 1 OR IsDelete IS NULL)

	SELECT DISTINCT 
		ISNULL(tbl_companyInvoiceDetail.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_companyInvoiceDetail.Address,'N/A') AS CompanyAddress,
		ISNULL(tbl_companyInvoiceDetail.City,'N/A') AS CompanyCity,
		ISNULL(tbl_companyInvoiceDetail.ContactNumber,'N/A') AS CompanyContactNumber,
		ISNULL(tbl_companyInvoiceDetail.Country,'N/A') AS CompanyCountry,
		ISNULL(tbl_companyInvoiceDetail.Service,'N/A') AS Services,
		ISNULL(CONVERT(NVARCHAR(50),tbl_companyInvoiceDetail.InvoiceCreationDate,23),'N/A') AS InvoiceCreatedOn,
		ISNULL(@GrandTotal,0) AS GrandTotal,
		@Invoice AS InvoiceNumber
	FROM [dbo].[Tbl_NewCompanyInvoiceDetails] tbl_companyInvoiceDetail WITH(NOLOCK)
	WHERE (tbl_companyInvoiceDetail.IsDelete <> 1 OR tbl_companyInvoiceDetail.IsDelete IS NULL) AND tbl_companyInvoiceDetail.InvoiceNumber = @Invoice
	GROUP BY tbl_companyInvoiceDetail.GrandTotal,tbl_companyInvoiceDetail.InvoiceNumber,
		tbl_companyInvoiceDetail.Service,tbl_companyInvoiceDetail.InvoiceCreationDate,
		tbl_companyInvoiceDetail.CompanyName,tbl_companyInvoiceDetail.Address,
		tbl_companyInvoiceDetail.City,tbl_companyInvoiceDetail.ContactNumber,tbl_companyInvoiceDetail.Country
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetNotificationServices]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get Notification Service List
-- USP_Admin_GetNotificationServices
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetNotificationServices]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_notification.Service,'N/A') AS [Service],
		COUNT(tbl_notification.Id) AS [TotalCount]
	FROM [dbo].[Tbl_Notifications] tbl_notification WITH(NOLOCK)
	WHERE tbl_notification.IsDelete <> 1 
	AND tbl_notification.Service IS NOT NULL
	GROUP BY tbl_notification.Service
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetNotificationsForCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetNotificationsForCompany 2>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetNotificationsForCompany]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	
	SELECT 
		ISNULL(tbl_notification.ID,0) AS ID,
		ISNULL(tbl_notification.CompanyId,0) AS CompanyId,
		ISNULL(tbl_notification.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_notification.UserId,0) AS UserId,
		ISNULL(tbl_notification.Username,'N/A') AS Username,
		ISNULL(tbl_notification.Service,'N/A') AS [Service],
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ExpiryDate,105),'N/A') AS ExpiryDate,
		CASE 
			WHEN tbl_notification.LeftDayToExpire > 0 
			THEN 
			ISNULL(tbl_notification.LeftDayToExpire,0) 
			ELSE 
			-1 
		END AS LeftDayToExpire,
		ISNULL(tbl_notification.SendNotificationAfter,0) AS SendNotificationAfter,
		ISNULL(tbl_notification.MarkAsRead,0) AS MarkAsRead,
		ISNULL(tbl_notification.IsActive,0) AS IsActive,
		ISNULL(tbl_notification.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_Notifications] tbl_notification WITH(NOLOCK)
	WHERE 
	tbl_notification.IsDelete <> 1 AND 
	tbl_notification.SendNotificationAfter > DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_notification.ExpiryDate)
	AND tbl_notification.MarkAsRead <> 1 AND (tbl_notification.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetNotificationsForCompanyWithMarkRead]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetNotificationsForCompany 2>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetNotificationsForCompanyWithMarkRead]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_notification.ID,0) AS ID,
		ISNULL(tbl_notification.CompanyId,0) AS CompanyId,
		ISNULL(tbl_notification.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_notification.UserId,0) AS UserId,
		ISNULL(tbl_notification.Username,'N/A') AS Username,
		ISNULL(tbl_notification.Service,'N/A') AS [Service],
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ExpiryDate,105),'N/A') AS ExpiryDate,
		CASE 
			WHEN tbl_notification.LeftDayToExpire < 0 
			THEN 
				-1
			ELSE 
				ISNULL(tbl_notification.LeftDayToExpire,0) 
		END AS LeftDayToExpire,
		ISNULL(tbl_notification.SendNotificationAfter,0) AS SendNotificationAfter,
		ISNULL(tbl_notification.MarkAsRead,0) AS MarkAsRead,
		ISNULL(tbl_notification.IsActive,0) AS IsActive,
		ISNULL(tbl_notification.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_Notifications] tbl_notification WITH(NOLOCK)
	WHERE tbl_notification.IsDelete <> 1 AND tbl_notification.SendNotificationAfter > DATEDIFF(D,SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',tbl_notification.ExpiryDate)
	AND (tbl_notification.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetOpenEmployeeServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- EXEC USP_Admin_GetOpenEmployeeServicesRequestByCompanyId 1,10,null,'Created By','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetOpenEmployeeServicesRequestByCompanyId]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	IF OBJECT_ID(N'tempdb..#openServiceRequest') IS NOT NULL BEGIN	DROP TABLE #openServiceRequest END
	
	SELECT DISTINCT ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForms.FormName,'N/A') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName, 
		ISNULL((SELECT tbl_serviceFormFieldValues.FieldValue FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues 
		LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
			WHERE tbl_serviceformField.FieldName LIKE '%Applicant Name%'
			AND tbl_serviceFormFieldValues.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber),'N/A') AS ApplicantName,
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName,'N/A')
		ELSE 
			ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName ,'N/A') 
		END AS RequestedBy, 
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),'N/A') AS CreatedOn,
		ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
		ISNULL(
			tbl_serviceRequestStatus.Status
		,'N/A') AS Status,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
					FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('')), 1, 1, ''),'N/A') AS AssignedUser, 
		ISNULL((SELECT TOP(1) 
			ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
			WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,'N/A') AS AssignOn,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
		WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
		WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
		FOR XML PATH ('')), 1, 1, ''),'N/A') AS SalesPerson
		INTO #openServiceRequest
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId
		WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
		AND (tbl_serviceRequest.IsDelete <> 1)  AND tbl_service.IsEmployeeService <> 0 AND tbl_serviceRequest.Id = 
						(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
							WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							AND b.IsDelete <> 1
							ORDER BY b.StepId DESC )
		AND (@searchPrefix IS NULL 
			OR tbl_serviceFormFieldValue.SerialNumber LIKE @searchPrefix +'%'
			OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceForms.FormName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceRequestStatus.Status LIKE '%' + @searchPrefix +'%')
		AND tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5

	SET @orderByClause = N'ORDER BY ' 
			
	IF @sortColumn = '' OR @sortColumn IS NULL
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' DESC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' ASC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' DESC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' ASC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+' ASC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+' ASC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+ ' DESC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+' ASC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+ ' DESC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+' ASC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+ ' DESC'
	END

	SET @pagination = ' OFFSET (@PageNumber-1)*@RowsOfPage ROWS
						FETCH NEXT @RowsOfPage ROWS ONLY'
	
	SET @selectQuery = 'select * from #openServiceRequest ' +@orderByClause +' '+@pagination
	
	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@PageNumber INT,@RowsOfPage INT',@searchPrefix,@PageNumber,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetOpenServiceCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetOpenServiceCount 2,2>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetOpenServiceCount]
	@Status INT = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		SELECT COUNT(*) 
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		WHERE tbl_serviceRequest.Status <> 1 
			AND tbl_serviceRequest.Status <> 4 
			AND tbl_serviceRequest.Id IN(
					SELECT DISTINCT MAX(Id) 
					FROM [dbo].[Tbl_ServiceRequest] b
					WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber 
						AND b.Status<> 1 
						AND b.Status <> 4
					GROUP BY SerialNumber
				)
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT COUNT(*) 
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		WHERE tbl_serviceRequest.Status <> 1 
			AND tbl_serviceRequest.Status <> 4 
			AND tbl_serviceRequest.CompanyId = @CompanyId 
			AND tbl_serviceRequest.Id IN(
					SELECT DISTINCT MAX(Id) 
					FROM [dbo].[Tbl_ServiceRequest] b
					WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber 
						AND b.Status<> 1 
						AND b.Status <> 4
						AND b.CompanyId = @CompanyId 
					GROUP BY SerialNumber
				)
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetOpenServiceCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetOpenServiceCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Open Services For Admin Panel
-- USP_Admin_GetOpenServiceCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetOpenServiceCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) AS CompanyServices
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_companyServiceRequest.IsDelete <> 1) 
    AND tbl_companyServiceRequest.StatusId <> 3 AND tbl_companyServiceRequest.StatusId <> 4 AND tbl_companyServiceRequest.StatusId <> 5

	SELECT DISTINCT
		COUNT(*) AS EmployeeServices
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequests  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequests.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_employeeServiceRequests.IsDelete <> 1) 
    AND tbl_employeeServiceRequests.StatusId <> 3 AND tbl_employeeServiceRequests.StatusId <> 4 AND tbl_employeeServiceRequests.StatusId <> 5
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetOpenSupportTicketCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetOpenSupportTicketCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Open Support Ticket For Admin Panel
-- USP_Admin_GetOpenSupportTicketCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetOpenSupportTicketCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) 
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket
	WHERE tbl_supportTicket.TicketStatus = 1  
    AND tbl_supportTicket.ID IN(SELECT MAX(ID) FROM [dbo].[Tbl_SupportTicket] b  
    WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber ) 
	AND (IsDelete <> 1 OR IsDelete IS NULL);
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceipt]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceipt]
	@Status INT = NULL,
	@Id INT = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 2
	BEGIN
		SELECT 
			ISNULL(tbl_paymentReceipt.Id,0) AS Id,
			ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId,
			ISNULL(tbl_paymentReceipt.SerialNumber,'N/A') AS SerialNumber,
			ISNULL(CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount),0) AS Amount,
			ISNULL(tbl_paymentReceipt.OnAccount,'N/A') AS OnAccount,
			ISNULL(tbl_paymentReceipt.Through,'---') AS Through,
			ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy
		FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId
		WHERE (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
		AND (tbl_PaymentTransaction.IsDelete <> 1 OR tbl_PaymentTransaction.IsDelete IS NULL)
		AND (tbl_paymentReceipt.CompanyId = @CompanyId OR @CompanyId IS NULL)
		ORDER BY tbl_paymentReceipt.Id DESC
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_paymentReceipt.Id,0) AS Id,
			ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId,
			ISNULL(tbl_paymentReceipt.SerialNumber,'N/A') AS SerialNumber,
			ISNULL(tbl_PaymentTransaction.TotalAmount,'0.0') AS Amount,
			ISNULL(tbl_paymentReceipt.OnAccount,'N/A') AS OnAccount,
			ISNULL(tbl_paymentReceipt.Through,'---') AS Through,
			ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy
		FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId
		WHERE tbl_paymentReceipt.Id = @Id 
		--AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	END
	ELSE IF @Status = 4
	BEGIN
		SELECT 
			ISNULL(tbl_paymentReceipt.Id,0) AS Id,
			ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId,
			ISNULL(tbl_paymentReceipt.SerialNumber,'N/A') AS SerialNumber,
			ISNULL(tbl_PaymentTransaction.Amount,'0.0') AS Amount,
			ISNULL(tbl_PaymentTransaction.Quantity,1) AS Quantity,
			ISNULL(tbl_PaymentTransaction.TotalAmount,'0.0') AS TotalAmount,
			ISNULL(tbl_paymentReceipt.OnAccount,'N/A') AS OnAccount,
			ISNULL(tbl_paymentReceipt.Through,'---') AS Through,
			ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,23),'N/A') AS CreatedOn,
			ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy
		FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId
		WHERE tbl_paymentReceipt.Id = @Id AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
	END
	ELSE IF @Status = 5
	BEGIN
		SELECT 
			ISNULL(tbl_paymentReceipt.Id,0) AS Id,
			ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId,
			ISNULL(tbl_paymentReceipt.SerialNumber,'N/A') AS SerialNumber,
			ISNULL(CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount),0) AS Amount,
			ISNULL(tbl_paymentReceipt.OnAccount,'N/A') AS OnAccount,
			ISNULL(tbl_paymentReceipt.Through,'---') AS Through,
			ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy
		FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId
		WHERE (tbl_paymentReceipt.CompanyId = @CompanyId OR @CompanyId IS NULL)
		ORDER BY tbl_paymentReceipt.Id DESC
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceiptHistoryCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <24-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all payment receipt with pagination>
-- <USP_Admin_GetPaymentReceiptHistoryCount NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceiptHistoryCount]
	@searchBy NVARCHAR(MAX) =NULL,
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_paymentReceipt.Id,0) AS Id
					FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id  
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId 
				'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		SET @conditions = ' WHERE '

		SET @conditions = @conditions +' (
							@searchPrefix IS NULL 
							OR tbl_paymentReceipt.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(MAX),CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount)) LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_paymentReceipt.OnAccount LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_paymentReceipt.Through LIKE ''%'+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105) LIKE '''+@searchPrefix+'''
						)'
	END

	SET @groupByClause = N' GROUP BY tbl_paymentReceipt.Id,tbl_paymentReceipt.CompanyId,tbl_company.CompanyName,
							tbl_paymentReceipt.PaymentId,tbl_paymentReceipt.SerialNumber,tbl_PaymentTransaction.TotalAmount,
							tbl_paymentReceipt.OnAccount,tbl_paymentReceipt.Through,tbl_paymentReceipt.CreatedOn,tbl_paymentReceipt.CreatedBy 
						  '
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX)',@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceiptHistoryWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <24-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all payment receipt with pagination>
-- <USP_Admin_GetPaymentReceiptHistoryWithPagination 0,20,N'Test',N'Receipt No.','desc'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceiptHistoryWithPagination]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''


	SET @query = N'
					SELECT 
						ISNULL(tbl_paymentReceipt.Id,0) AS Id, 
						ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId, 
						ISNULL(tbl_paymentReceipt.SerialNumber,''N/A'') AS SerialNumber, 
						ISNULL(CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount),0) AS Amount, 
						ISNULL(tbl_paymentReceipt.OnAccount,''N/A'') AS OnAccount, 
						ISNULL(tbl_paymentReceipt.Through,''---'') AS Through, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105),''N/A'') AS CreatedOn, 
						ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy 
					FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id  
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId 
				'
	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN
		SET @conditions = ' WHERE '

		SET @conditions = @conditions +' (
							@searchPrefix IS NULL 
							OR tbl_paymentReceipt.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(MAX),CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount)) LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_paymentReceipt.OnAccount LIKE ''%'+@searchPrefix+'%'' 
							OR tbl_paymentReceipt.Through LIKE ''%'+@searchPrefix+'%'' 
							OR CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105) LIKE '''+@searchPrefix+'''
						)'
	END

	SET @groupByClause = N' GROUP BY tbl_paymentReceipt.Id,tbl_paymentReceipt.CompanyId,tbl_company.CompanyName,
							tbl_paymentReceipt.PaymentId,tbl_paymentReceipt.SerialNumber,tbl_PaymentTransaction.TotalAmount,
							tbl_paymentReceipt.OnAccount,tbl_paymentReceipt.Through,tbl_paymentReceipt.CreatedOn,tbl_paymentReceipt.CreatedBy 
						  '

	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
								+ ' ASC '
		END

				IF @sortColumn = 'Receipt No.'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
								+ ' ASC '
		END

		IF @sortColumn = 'Receipt No.'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
								+ ' DESC '
		END

		IF @sortColumn = 'Company'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyName '
								+ ' ASC '
		END

		IF @sortColumn = 'Company'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyName '
								+ ' DESC '
		END

		IF @sortColumn = 'Amount'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount) '
								+ ' ASC '
		END

		IF @sortColumn = 'Amount'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount) '
								+ ' DESC '
		END

		IF @sortColumn = 'On Account Of'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.OnAccount '
								+ ' ASC '
		END

		IF @sortColumn = 'On Account Of'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.OnAccount '
								+ ' DESC '
		END

		IF @sortColumn = 'Through'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.Through '
								+ ' ASC '
		END

		IF @sortColumn = 'Through'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.Through '
								+ ' DESC '
		END

		IF @sortColumn = 'Created Date'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.CreatedOn '
								+ ' ASC '
		END

		IF @sortColumn = 'Created Date'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.CreatedOn '
								+ ' DESC '
		END

	SET @pagination =  ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

	PRINT @conditions

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceiptsByCompanyIdWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-March-2023>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all payment receipt with pagination>
-- <USP_Admin_GetPaymentReceiptsByCompanyIdWithPagination 41,0,20,NULL,NULL,N'Receipt No.',N'asc'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceiptsByCompanyIdWithPagination]
	@CompanyId INT = NULL,
	@skipRows INT = NULL,
	@rowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortBy NVARCHAR(MAX) = NULL,
	@sortingDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
			@conditions NVARCHAR(MAX) = NULL,
			@groupByClause NVARCHAR(MAX) = NULL,
			@orderByClause NVARCHAR(MAX) = NULL,
			@paginationClause NVARCHAR(MAX) = NULL,
			@selectQuery NVARCHAR(MAX) = NULL

	SET @query = N'
					SELECT 
						ISNULL(tbl_paymentReceipt.Id,0) AS Id, 
						ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId, 
						ISNULL(tbl_paymentReceipt.SerialNumber,''N/A'') AS SerialNumber, 
						ISNULL(CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount),0) AS Amount, 
						ISNULL(tbl_paymentReceipt.OnAccount,''N/A'') AS OnAccount, 
						ISNULL(tbl_paymentReceipt.Through,''---'') AS Through, 
						ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105),''N/A'') AS CreatedOn, 
						ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy
					FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId 
				'

	SET @conditions = N' WHERE (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL) 
						AND (tbl_PaymentTransaction.IsDelete <> 1 OR tbl_PaymentTransaction.IsDelete IS NULL) 
						AND tbl_paymentReceipt.CompanyId = @CompanyId 
						'

	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN

		SET @conditions = @conditions +' AND (
								@searchPrefix IS NULL 
								OR tbl_paymentReceipt.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(MAX),CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount)) LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.OnAccount LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.Through LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105) = '''+@searchPrefix+''' 
							)'
	END

	SET @groupByClause = N' GROUP BY tbl_paymentReceipt.Id,tbl_paymentReceipt.CompanyId,tbl_company.CompanyName,tbl_paymentReceipt.PaymentId, 
							tbl_paymentReceipt.SerialNumber,tbl_PaymentTransaction.TotalAmount,tbl_paymentReceipt.OnAccount,
							tbl_paymentReceipt.Through,tbl_paymentReceipt.CreatedOn,tbl_paymentReceipt.CreatedBy
						'

	SET @orderByClause = N' ORDER BY '
		
		IF @sortBy IS NULL OR @sortBy = ''
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
							+ ' ASC '
		END

		IF @sortBy = 'Receipt No.' AND @sortingDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
							+ ' ASC '
		END

		IF @sortBy = 'Receipt No.' AND @sortingDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
							+ ' DESC '
		END

		IF @sortBy = 'Amount' AND @sortingDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount) '
								+ ' ASC '
		END

		IF @sortBy = 'Amount' AND @sortingDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount) '
								+ ' DESC '
		END

		IF @sortBy = 'On Account Of'  AND @sortingDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.OnAccount '
								+ ' ASC '
		END

		IF @sortBy = 'On Account Of'  AND @sortingDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.OnAccount '
								+ ' DESC '
		END

		IF @sortBy = 'Through'  AND @sortingDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.Through '
								+ ' ASC '
		END

		IF @sortBy = 'Through'  AND @sortingDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.Through '
								+ ' DESC '
		END

		IF @sortBy = 'Created Date'  AND @sortingDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.CreatedOn '
								+ ' ASC '
		END

		IF @sortBy = 'Created Date'  AND @sortingDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.CreatedOn '
								+ ' DESC '
		END

	SET @paginationClause =  ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+ @orderByClause +' '+ @paginationClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceiptsByCompanyIdWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-March-2023>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all payment receipt with pagination>
-- <USP_Admin_GetPaymentReceiptsByCompanyIdWithPaginationCount 41,NULL,NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceiptsByCompanyIdWithPaginationCount]
	@CompanyId INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query NVARCHAR(MAX) = NULL,
			@conditions NVARCHAR(MAX) = NULL,
			@groupByClause NVARCHAR(MAX) = NULL,
			@orderByClause NVARCHAR(MAX) = NULL,
			@paginationClause NVARCHAR(MAX) = NULL,
			@selectQuery NVARCHAR(MAX) = NULL

	SET @query = N'
					SELECT 
						ISNULL(tbl_paymentReceipt.Id,0) AS Id
					FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId 
				'

	SET @conditions = N' WHERE (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL) 
						AND (tbl_PaymentTransaction.IsDelete <> 1 OR tbl_PaymentTransaction.IsDelete IS NULL) 
						AND tbl_paymentReceipt.CompanyId = @CompanyId 
						'

	IF @searchPrefix != '' AND @searchPrefix IS NOT NULL
	BEGIN

		SET @conditions = @conditions +' AND (
								@searchPrefix IS NULL 
								OR tbl_paymentReceipt.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(MAX),CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount)) LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.OnAccount LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.Through LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105) = '''+@searchPrefix+''' 
							)'
	END

	SET @groupByClause = N' GROUP BY tbl_paymentReceipt.Id,tbl_paymentReceipt.CompanyId,tbl_company.CompanyName,tbl_paymentReceipt.PaymentId, 
							tbl_paymentReceipt.SerialNumber,tbl_PaymentTransaction.TotalAmount,tbl_paymentReceipt.OnAccount,
							tbl_paymentReceipt.Through,tbl_paymentReceipt.CreatedOn,tbl_paymentReceipt.CreatedBy
						'
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@searchPrefix NVARCHAR(MAX)',@CompanyId,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceiptWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <24-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all payment receipt with pagination>
-- <USP_Admin_GetPaymentReceiptWithPagination 0,50,NULL,N'Receipt No.',N'asc'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceiptWithPagination]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	

	SET @query = N'SELECT 
						ISNULL(tbl_paymentReceipt.Id,0) AS Id, 
						ISNULL(tbl_paymentReceipt.CompanyId,0) AS CompanyId, 
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName, 
						ISNULL(tbl_paymentReceipt.PaymentId,0) AS PaymentId, 
						ISNULL(tbl_paymentReceipt.SerialNumber,''N/A'') AS SerialNumber, 
						ISNULL(CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount),0) AS Amount, 
						ISNULL(tbl_paymentReceipt.OnAccount,''N/A'') AS OnAccount, 
						ISNULL(tbl_paymentReceipt.Through,''---'') AS Through,
						ISNULL(CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105),''N/A'') AS CreatedOn, 
						ISNULL(tbl_paymentReceipt.CreatedBy,0) AS CreatedBy 
					FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId 
				'

	SET @conditions = N' WHERE (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL) 
						 AND (tbl_PaymentTransaction.IsDelete <> 1 OR tbl_PaymentTransaction.IsDelete IS NULL) 
						'

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		
		SET @conditions = @conditions +' AND (
								@searchPrefix IS NULL 
								OR tbl_paymentReceipt.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(MAX),CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount)) LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.OnAccount LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.Through LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105) LIKE '''+@searchPrefix+'''
							)'
	END

	SET @groupByClause = N' GROUP BY tbl_paymentReceipt.Id,tbl_paymentReceipt.CompanyId,tbl_company.CompanyName,tbl_paymentReceipt.PaymentId,
							tbl_paymentReceipt.SerialNumber,tbl_PaymentTransaction.TotalAmount,
							tbl_paymentReceipt.OnAccount,tbl_paymentReceipt.Through,tbl_paymentReceipt.CreatedOn,tbl_paymentReceipt.CreatedBy '

	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn IS NULL OR @sortColumn = ''
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
								+ ' ASC '
		END

		IF @sortColumn = 'Receipt No.'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
								+ ' ASC '
		END

		IF @sortColumn = 'Receipt No.'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' (SELECT CONVERT(INT,SUBSTRING(tbl_paymentReceipt.SerialNumber,PATINDEX(''%[0-9]%'',tbl_paymentReceipt.SerialNumber), LEN(tbl_paymentReceipt.SerialNumber)))) '
								+ ' DESC '
		END

		IF @sortColumn = 'Company'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyName '
								+ ' ASC '
		END

		IF @sortColumn = 'Company'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_company.CompanyName '
								+ ' DESC '
		END

		IF @sortColumn = 'Amount'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount) '
								+ ' ASC '
		END

		IF @sortColumn = 'Amount'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount) '
								+ ' DESC '
		END

		IF @sortColumn = 'On Account Of'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.OnAccount '
								+ ' ASC '
		END

		IF @sortColumn = 'On Account Of'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.OnAccount '
								+ ' DESC '
		END

		IF @sortColumn = 'Through'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.Through '
								+ ' ASC '
		END

		IF @sortColumn = 'Through'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.Through '
								+ ' DESC '
		END

		IF @sortColumn = 'Created Date'  AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.CreatedOn '
								+ ' ASC '
		END

		IF @sortColumn = 'Created Date'  AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause + N' tbl_paymentReceipt.CreatedOn '
								+ ' DESC '
		END

	SET @pagination =  ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPaymentReceiptWithPaginationCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <24-Dec-2022>
-- Modify By : <,name>
-- Modify date : <,date>
-- Description:	<Get all payment receipt with pagination>
-- <USP_Admin_GetPaymentReceiptWithPaginationCount NULL>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPaymentReceiptWithPaginationCount]
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	

	SET @query = N'SELECT 
						ISNULL(tbl_paymentReceipt.Id,0) AS Id
					FROM [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PaymentTransection] tbl_PaymentTransaction WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_PaymentTransaction.Id 
					LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_paymentReceipt.CompanyId 
				'

	SET @conditions = N' WHERE (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL) 
						 AND (tbl_PaymentTransaction.IsDelete <> 1 OR tbl_PaymentTransaction.IsDelete IS NULL) 
						'

	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		
		SET @conditions = @conditions +' AND (
								@searchPrefix IS NULL 
								OR tbl_paymentReceipt.SerialNumber LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(MAX),CONVERT(DECIMAL(18,2),tbl_PaymentTransaction.TotalAmount)) LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.OnAccount LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_paymentReceipt.Through LIKE ''%'+@searchPrefix+'%'' 
								OR CONVERT(NVARCHAR(50),tbl_paymentReceipt.CreatedOn,105) LIKE '''+@searchPrefix+'''
							)'
	END

	SET @groupByClause = N' GROUP BY tbl_paymentReceipt.Id,tbl_paymentReceipt.CompanyId,tbl_company.CompanyName,tbl_paymentReceipt.PaymentId,
							tbl_paymentReceipt.SerialNumber,tbl_PaymentTransaction.TotalAmount,
							tbl_paymentReceipt.OnAccount,tbl_paymentReceipt.Through,tbl_paymentReceipt.CreatedOn,tbl_paymentReceipt.CreatedBy '

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX)',@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetPermission>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPermission]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_permission.PermissionId,0) AS PermissionId,
		ISNULL(tbl_permission.PermissionName,'N/A') AS PermissionName,
		ISNULL(tbl_permission.IsActive,0) AS IsActive,
		ISNULL(tbl_permission.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_permission.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_permission.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_Permission] tbl_permission WITH(NOLOCK)
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPortalBalanceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <27-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetPortalBalanceDetails 7>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetPortalBalanceDetails]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_portalbalance.Id,0) AS Id,
		ISNULL(tbl_portalbalance.BalanceAmount,'N/A') AS PortalBalance,
		ISNULL(tbl_portalbalance.CompanyId,0) AS CompanyId,
		ISNULL(tbl_Company.CompanyName,0) AS CompanyName,
		ISNULL(tbl_portalbalance.UserId,0) AS UserId,
		ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') AS Username,
		ISNULL(tbl_user.EmailID,'N/A') AS UserEmailId,
		ISNULL(CONVERT(NVARCHAR(50),tbl_portalbalance.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_portalbalance.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_PortalBalance] tbl_portalbalance WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_portalbalance.CompanyId = tbl_Company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_portalbalance.UserId = tbl_user.Id 
	WHERE tbl_portalbalance.CompanyId = @CompanyId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetPortalBalanceOfMainCompanyForDashboard]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetPortalBalanceOfMainCompanyForDashboard
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get balance details of main company
-- USP_Admin_GetPortalBalanceOfMainCompanyForDashboard
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetPortalBalanceOfMainCompanyForDashboard]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(SUM(CONVERT(DECIMAL(30,2),tbl_payment.TotalAmount)),0) AS Credit 
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_payment.CompanyId = tbl_company.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	AND (tbl_company.IsDelete <> 1 OR tbl_company.IsDelete IS NULL)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),tbl_expense.GrandTotal)),0) AS Debit 
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expense WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_expense.CompanyId = tbl_company.Id
	WHERE (tbl_expense.IsDelete<> 1 OR tbl_expense.IsDelete IS NULL)
	AND (tbl_company.IsDelete <> 1 OR tbl_company.IsDelete IS NULL)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetProfitCompanyListReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <16-08-2023>
-- Modify By : <Modify By>
-- Modify date : <Modify On>
-- Description:	Get Company list which have positive portal balance
-- USP_Admin_GetProfitCompanyListReport
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetProfitCompanyListReport]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_company.AccountNumber AS AccountNumber,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_portalBalance.BalanceAmount,'0') AS PortalBalance,
		ISNULL(STUFF((SELECT DISTINCT ',' + tbl_user1.FirstName + ' ' + tbl_user1.LastName 
		FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK) ON tbl_mapping.CompanyId = tbl_company.Id 
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_mapping.UserId = tbl_user.Id 
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_userRoleMapping WITH(NOLOCK) ON tbl_user.Id = tbl_userRoleMapping.UserId
		LEFT JOIN [dbo].[Tbl_Role] tbl_roles WITH(NOLOCK) ON tbl_roles.RoleID = tbl_userRoleMapping.RoleID 
		WHERE tbl_user1.Id = tbl_user.Id AND tbl_mapping.IsDelete <> 1 
		AND tbl_mapping.CompanyId = tbl_company.Id
		AND tbl_userRoleMapping.RoleID = (
			SELECT RoleID FROM [dbo].[Tbl_Role] tbl_role WHERE tbl_role.RoleName LIKE 'Company Owner'  
		)
		FOR XML PATH('')),1,1,''),'N/A') AS CompanyOwner,
		ISNULL(tbl_company.EmailID,'N/A') AS Email
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_PortalBalance] tbl_portalBalance WITH(NOLOCK) ON tbl_portalBalance.CompanyId = tbl_company.Id
	WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName NOT LIKE N'DIBN'
	AND CONVERT(decimal(18,2),tbl_portalBalance.BalanceAmount) > 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetProfitLossCompanyList]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================================
-- SP Name :			USP_Admin_GetProfitLossCompanyList 
-- Author :				<Yashasvi Sharma>
-- Created Date :		<21-June-2023>
-- Description :		Get Company List for Profit Loss Report
-- USP_Admin_GetProfitLossCompanyList
-- =============================================================

CREATE PROCEDURE [dbo].[USP_Admin_GetProfitLossCompanyList]
	@skipRows INT = NULL,
	@rowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_company.Id AS Id,
		tbl_company.CompanyName AS CompanyName,
		tbl_company.AccountNumber AS CompanyAccountNumber
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN'
	AND (
		@searchPrefix IS NULL
		OR tbl_company.CompanyName LIKE '%' + @searchPrefix + '%'
		OR tbl_company.AccountNumber LIKE '%' + @searchPrefix + '%'
	)
	GROUP BY tbl_company.Id,tbl_company.CompanyName,tbl_company.AccountNumber
	ORDER BY 
	CASE WHEN @sortColumn IS NULL AND @sortDirection IS NULL
		THEN tbl_company.Id 
	END ASC,
	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc'
		THEN tbl_company.CompanyName
	END ASC,
	CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc'
		THEN tbl_company.CompanyName
	END DESC,
	CASE WHEN @sortColumn = 'Company Account Number' AND @sortColumn = 'asc'
		THEN (SELECT CONVERT(int,SUBSTRING(tbl_company.AccountNumber,PATINDEX('%[0-9]%',tbl_company.AccountNumber),LEN(tbl_company.AccountNumber))))
	END ASC,
	CASE WHEN @sortColumn = 'Company Account Number' AND @sortColumn = 'desc'
		THEN (SELECT CONVERT(int,SUBSTRING(tbl_company.AccountNumber,PATINDEX('%[0-9]%',tbl_company.AccountNumber),LEN(tbl_company.AccountNumber)))) 
	END DESC
	OFFSET @skipRows ROWS
	FETCH NEXT @rowsOfPage ROWS ONLY

	SELECT COUNT(*) AS CompanyCount
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN'
	AND (
		@searchPrefix IS NULL
		OR tbl_company.CompanyName LIKE '%'+@searchPrefix+'%'
		OR tbl_company.AccountNumber LIKE '%'+@searchPrefix+'%'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetReadedNotifications]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_GetNotificationsForCompany 2>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetReadedNotifications]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_notification.ID,0) AS ID,
		ISNULL(tbl_notification.CompanyId,0) AS CompanyId,
		ISNULL(tbl_notification.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_notification.UserId,0) AS UserId,
		ISNULL(tbl_notification.Username,'N/A') AS Username,
		ISNULL(tbl_notification.Service,'N/A') AS [Service],
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ExpiryDate,105),'N/A') AS ExpiryDate,
		CASE 
			WHEN tbl_notification.LeftDayToExpire < 0 
			THEN 
				-1
			ELSE 
				ISNULL(tbl_notification.LeftDayToExpire,0) 
		END AS LeftDayToExpire,
		ISNULL(tbl_notification.SendNotificationAfter,0) AS SendNotificationAfter,
		ISNULL(tbl_notification.MarkAsRead,0) AS MarkAsRead,
		ISNULL(tbl_notification.IsActive,0) AS IsActive,
		ISNULL(tbl_notification.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_notification.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_Notifications] tbl_notification WITH(NOLOCK)
	WHERE tbl_notification.IsDelete <> 1 AND tbl_notification.SendNotificationAfter > DATEDIFF(D,GETUTCDATE(),tbl_notification.ExpiryDate)
	AND tbl_notification.MarkAsRead <> 0 AND (tbl_notification.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRejectedEmployeeServicesRequestByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- EXEC USP_Admin_GetRejectedEmployeeServicesRequestByCompanyId 1,10,null,'Created By','asc'
CREATE PROCEDURE [dbo].[USP_Admin_GetRejectedEmployeeServicesRequestByCompanyId]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
	@conditions AS NVARCHAR(MAX) ='',
	@groupByClause AS NVARCHAR(MAX) ='',
	@selectQuery AS NVARCHAR(MAX) ='',
	@orderByClause AS NVARCHAR(MAX) ='',
	@pagination AS NVARCHAR(MAX) ='',
	@countingQuery AS NVARCHAR(MAX) =''

	IF OBJECT_ID(N'tempdb..#rejectedServiceRequest') IS NOT NULL BEGIN	DROP TABLE #openServiceRequest END
	
	SELECT DISTINCT ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceFormFieldValue.ServiceId,0) AS ServiceId, 
		ISNULL(tbl_serviceForms.FormName,'N/A') AS RequestedService, 
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName, 
		ISNULL((SELECT tbl_serviceFormFieldValues.FieldValue FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValues 
		LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceformField ON tbl_serviceFormFieldValues.FieldId = tbl_serviceformField.Id
			WHERE tbl_serviceformField.FieldName LIKE '%Applicant Name%'
			AND tbl_serviceFormFieldValues.SerialNumber LIKE tbl_serviceFormFieldValue.SerialNumber),'N/A') AS ApplicantName,
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_serviceCreatedBy.FirstName +' '+ tbl_serviceCreatedBy.LastName,'N/A')
		ELSE 
			ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName ,'N/A') 
		END AS RequestedBy, 
		ISNULL((SELECT TOP 1 CONVERT(NVARCHAR(20),formField.CreatedOn,105) FROM [dbo].[Tbl_ServiceFormFieldValue] 
			formField WITH(NOLOCK) WHERE formField.SerialNumber = tbl_serviceFormFieldValue.SerialNumber ),'N/A') AS CreatedOn,
		ISNULL(tbl_serviceRequest.Status,0) AS [StatusId],
		ISNULL(
			tbl_serviceRequestStatus.Status
		,'N/A') AS Status,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
					FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
					LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
					WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber FOR XML PATH ('')), 1, 1, ''),'N/A') AS AssignedUser, 
		ISNULL((SELECT TOP(1) 
			ISNULL(CONVERT(NVARCHAR(50),tbl_assign1.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK) 
			WHERE tbl_assign1.SerialNumber = tbl_serviceFormFieldValue.SerialNumber) ,'N/A') AS AssignOn,
		ISNULL(STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
		WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
		WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
		FOR XML PATH ('')), 1, 1, ''),'N/A') AS SalesPerson
		INTO #rejectedServiceRequest
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK) ON tbl_serviceRequest.SerialNumber =  tbl_serviceFormFieldValue.SerialNumber
		LEFT JOIN [dbo].[Tbl_User] tbl_serviceCreatedBy WITH(NOLOCK) ON tbl_serviceFormFieldValue.CreatedBy = tbl_serviceCreatedBy.Id 
		LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForms WITH(NOLOCK) ON tbl_serviceFormFieldValue.FormId = tbl_serviceForms.Id 
		LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_serviceFormFieldValue.ServiceId = tbl_service.Id 
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId 
		LEFT JOIN [dbo].[Tbl_AssignServiceRequest] tbl_assign WITH(NOLOCK) ON tbl_assign.SerialNumber = tbl_serviceRequest.SerialNumber 
		LEFT JOIN [dbo].[Tbl_User] tbl_assignUser WITH(NOLOCK) ON tbl_assignUser.Id = tbl_assign.UserId 
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_serviceFormFieldValue.SalesPersonId = tbl_salesPerson.Id 
		LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK) ON tbl_serviceRequest.Status = tbl_serviceRequestStatus.DisplayId
		WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 AND (tbl_serviceFormFieldValue.IsDelete <> 1 OR tbl_serviceFormFieldValue.IsDelete IS NULL) 
		AND (tbl_serviceRequest.IsDelete <> 1)  AND tbl_service.IsEmployeeService <> 0 AND tbl_serviceRequest.Id = 
						(   SELECT TOP 1 b.Id FROM [dbo].[Tbl_ServiceRequest] b WITH(NOLOCK)
							WHERE b.SerialNumber = tbl_serviceFormFieldValue.SerialNumber
							AND b.IsDelete <> 1
							ORDER BY b.StepId DESC )
		AND (@searchPrefix IS NULL 
			OR tbl_serviceFormFieldValue.SerialNumber LIKE @searchPrefix +'%'
			OR tbl_company.CompanyName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceForms.FormName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceCreatedBy.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.FirstName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_salesPerson.LastName LIKE '%'+ @searchPrefix +'%'
			OR tbl_serviceRequestStatus.Status LIKE '%' + @searchPrefix +'%')
		AND (tbl_serviceRequest.Status = 4 OR tbl_serviceRequest.Status = 5)

	SET @orderByClause = N'ORDER BY ' 
			
	IF @sortColumn = '' OR @sortColumn IS NULL
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' ASC'
	END

	IF @sortColumn = 'SR No.' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' (SELECT CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX(''R'',SerialNumber)+1,LEN(SerialNumber))))'
		+ ' DESC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' ASC'
	END

	IF @sortColumn = 'Created By' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedBy'
		+ ' DESC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' ASC'
	END

	IF @sortColumn = 'Created Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CreatedOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+' ASC'
	END

	IF @sortColumn = 'Assigned Date' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' AssignOn'
		+ ' DESC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+' ASC'
	END

	IF @sortColumn = 'Company Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' CompanyName'
		+ ' DESC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+' ASC'
	END

	IF @sortColumn = 'Service Request Type' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' RequestedService'
		+ ' DESC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+' ASC'
	END

	IF @sortColumn = 'Applicant Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderByClause = @orderByClause 
		+ ' ApplicantName'
		+ ' DESC'
	END

	SET @pagination = ' OFFSET (@PageNumber-1)*@RowsOfPage ROWS
						FETCH NEXT @RowsOfPage ROWS ONLY'
	
	SET @selectQuery = 'select * from #rejectedServiceRequest ' +@orderByClause +' '+@pagination
	
	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX),@PageNumber INT,@RowsOfPage INT',@searchPrefix,@PageNumber,@RowsOfPage
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRejectedServiceCountForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRejectedServiceCountForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Count of Rejected or Canclled Services For Admin Panel
-- USP_Admin_GetRejectedServiceCountForAdmin
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRejectedServiceCountForAdmin]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		COUNT(*) AS CompanyServices
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_companyServiceRequest 
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_companyServiceRequest.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_companyServiceRequest.IsDelete <> 1) 
    AND (tbl_companyServiceRequest.StatusId = 4 OR tbl_companyServiceRequest.StatusId = 5);

	SELECT DISTINCT 
		COUNT(*) AS EmployeeServices
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_employeeServiceRequests  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK) ON tbl_employeeServiceRequests.ServiceId = tbl_service.Id  
    WHERE tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1 
    AND (tbl_employeeServiceRequests.IsDelete <> 1) 
    AND (tbl_employeeServiceRequests.StatusId = 4 OR tbl_employeeServiceRequests.StatusId = 5);
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRemainingSharePercentage]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRemainingSharePercentage
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Remaining Share Percentage Count for passed company
-- USP_Admin_GetRemainingSharePercentage
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetRemainingSharePercentage]
	@companyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT tbl_shareholder.CompanyId FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder  
                    WHERE tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.CompanyId = @companyId) 
	BEGIN
		SELECT SUM(CONVERT(INT,tbl_shareholder.SharePercentage))  
        FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WHERE tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.CompanyId = @companyId 
	END  
    ELSE 
	BEGIN 
		SELECT -1 
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRepeatedTransactionNumbers]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_GetRepeatedTransactionNumbers
-- Author:		<Yashasvi Sharma>
-- Create date: <22-March-2024>
-- Modify By : <>
-- Modify date : <>
-- get repeated transaction numbers 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRepeatedTransactionNumbers]
AS
BEGIN
	SET NOCOUNT ON;

	--DECLARE @PlanHandle VARBINARY(64);

	--SELECT  @PlanHandle = deps.plan_handle
	--FROM    sys.dm_exec_procedure_stats AS deps
	--WHERE   deps.object_id = OBJECT_ID('dbo.USP_Admin_GetRepeatedTransactionNumbers') AND deps.database_id = DB_ID();

	--IF @PlanHandle IS NOT NULL
	--BEGIN
	--    DBCC FREEPROCCACHE(@PlanHandle);
	--END

	DECLARE @repeated nvarchar(max) = null,@sql nvarchar(max)= null;

	WITH
	transactionTbl
	AS
	(
	SELECT 
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))))
		FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment
	WHERE (IsDelete IS NULL OR IsDelete <> 1)
	UNION ALL 
	SELECT 
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
		FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses
	WHERE (IsDelete IS NULL OR IsDelete <> 1)
	)

	SELECT @repeated = STUFF((SELECT ',' + (CONVERT(nvarchar(50),TransactionIdNo)) FROM transactionTbl 
	GROUP BY TransactionIdNo
	HAVING COUNT(TransactionIdNo) > 1
	ORDER BY TransactionIdNo DESC 
   				   FOR XML PATH('')
			),1,1,'');

	WITH
	transactionTbl
	AS
	(
		SELECT 
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))))
		FROM [dbo].[Tbl_PaymentTransection] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
			Id AS Id,
			'Credit' AS TransactionType
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment
		WHERE (IsDelete IS NULL OR IsDelete <> 1)
		UNION ALL 
		SELECT 
			(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
			FROM [dbo].[Tbl_PortalBalanceExpenses] WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
			Id AS Id,
			'Debit' AS TransactionType
		FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses
		WHERE (IsDelete IS NULL OR IsDelete <> 1)
	)

	SELECT * 
	FROM transactionTbl
	WHERE TransactionIdNo IN (SELECT TransactionIdNo = Item FROM dbo.SplitInts(@repeated,','))
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRequestDetailsBySerialNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetRequestDetailsBySerialNumber N'SR113'
CREATE PROCEDURE [dbo].[USP_Admin_GetRequestDetailsBySerialNumber]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_serviceFormDataField.StepNumber AS StepNumber,
		tbl_serviceFormFieldValue.ServiceId AS ServiceId,
		ISNULL(tbl_serviceFormFieldValue.FormId,0) AS FormId,
		ISNULL(tbl_serviceFormFieldValue.CompanyId,0) AS CompanyId,
		ISNULL(tbl_serviceFormFieldValue.UserId,0) AS UserId,
		ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
		ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
		ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE WHEN tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0
		THEN 
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		ELSE 
			(SELECT ISNULL(FirstName +' '+ LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
		END AS RequestedBy,
		ISNULL(tbl_serviceFormDataField.FieldName,'N/A') AS FieldName,
		ISNULL(tbl_serviceFormFieldValue.FieldValue,'N/A') AS FieldValue,
		ISNULL(tbl_serviceFormFieldValue.FileName,'N/A') AS FileName,
		ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),CAST(tbl_serviceFormFieldValue.CreatedOn AS TIME),0),'N/A') AS CreatedTime,
		CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
				(SELECT TOP(1) Status 
				FROM [dbo].[Tbl_ServiceRequest]
				WHERE SerialNumber LIKE @SerialNumber)
			END AS [StatusId],
		CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
		THEN
			(SELECT TOP(1) tbl_serviceRequestStatus.Status 
			FROM [dbo].[Tbl_ServiceRequest] request
			LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
			WHERE SerialNumber LIKE @SerialNumber) 
		ELSE 'N/A'
		END AS Status
	FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceFormDataField ON tbl_serviceFormFieldValue.FieldId = tbl_serviceFormDataField.Id
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
	LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
	WHERE (tbl_serviceFormFieldValue.SerialNumber LIKE @SerialNumber AND tbl_serviceFormFieldValue.SerialNumber IS NOT NULL)
	AND tbl_serviceRequest.StepId = 0 AND tbl_serviceFormFieldValue.IsDelete <> 1 AND tbl_serviceRequest.IsDelete <> 1
	GROUP BY tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.CompanyId,tbl_serviceFormFieldValue.UserId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_user.FirstName,tbl_user.LastName,
		tbl_user.EmailID,tbl_serviceFormDataField.FieldName,tbl_serviceFormFieldValue.FieldValue,tbl_serviceFormFieldValue.CreatedOn,
		tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FileName,tbl_serviceFormFieldValue.FieldFileValue,tbl_serviceFormDataField.StepNumber,tbl_serviceRequest.CreatedOn,
		tbl_serviceFormFieldValue.SalesPersonId,
		tbl_serviceRequest.SerialNumber
	ORDER BY tbl_serviceFormDataField.StepNumber

	SELECT DISTINCT
		tbl_serviceRequest.StepId AS StepId,
		tbl_serviceRequest.Id AS Id,
		ISNULL(tbl_serviceRequest.ServiceId,0) AS ServiceId,
		ISNULL(tbl_serviceRequest.FormId,0) AS FormId,
		ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
		ISNULL(tbl_serviceRequest.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_serviceRequest.UserId,0) AS UserId,
		CASE WHEN tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0
		THEN 
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		ELSE 
			(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceRequest.SalesPersonId )
		END AS RequestedBy,
		ISNULL(tbl_serviceRequest.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceRequest.Title,'N/A') AS Title,
		ISNULL(tbl_serviceRequest.Description,'N/A') AS Description,
		ISNULL(tbl_serviceRequest.AssignedTo,0) AS AssignedTo,
		ISNULL(tbl_serviceRequest.Status,0) AS StatusId,
		CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
		THEN
			(SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus 
			LEFT JOIN [dbo].[Tbl_ServiceRequest] request ON request.Status = tbl_serviceRequestStatus.DisplayId
			WHERE DisplayId = tbl_serviceRequest.Status AND request.StepId = tbl_serviceRequest.StepId)
		ELSE 'N/A'
		END AS Status,
		ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),CAST(tbl_serviceRequest.CreatedOn AS TIME),0),'N/A') AS CreatedTime
	FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceRequest.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceRequest.UserId
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceRequest.FormId
	WHERE tbl_serviceRequest.SerialNumber LIKE @SerialNumber AND tbl_serviceRequest.StepId <> 0
	AND tbl_serviceRequest.IsDelete <> 1
	GROUP BY tbl_serviceRequest.Id,tbl_serviceRequest.ServiceId,tbl_serviceRequest.FormId,tbl_serviceForm.FormName,tbl_serviceRequest.CompanyId,tbl_company.CompanyName,
			tbl_serviceRequest.UserId,tbl_serviceRequest.StepId,tbl_user.FirstName,tbl_user.LastName,tbl_user.EmailID,tbl_serviceRequest.SerialNumber,tbl_serviceRequest.Title,
			tbl_serviceRequest.Description,tbl_serviceRequest.AssignedTo,tbl_serviceRequest.Status,tbl_serviceRequest.CreatedOn,tbl_serviceRequest.SalesPersonId
	ORDER BY tbl_serviceRequest.StepId asc
END

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRequestDetailsBySerialNumber_TEST]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetRequestDetailsBySerialNumber_TEST N'SR3318'
CREATE PROCEDURE [dbo].[USP_Admin_GetRequestDetailsBySerialNumber_TEST]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_serviceFormDataField.StepNumber AS StepNumber,
		tbl_serviceFormFieldValue.ServiceId AS ServiceId,
		ISNULL(tbl_serviceFormFieldValue.FormId,0) AS FormId,
		ISNULL(tbl_serviceFormFieldValue.CompanyId,0) AS CompanyId,
		ISNULL(tbl_serviceFormFieldValue.UserId,0) AS UserId,
		ISNULL(tbl_serviceFormFieldValue.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
		ISNULL(tbl_service.IsCompanyService,0) AS IsCompanyService,
		ISNULL(tbl_service.IsEmployeeService,0) AS IsEmployeeService,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE 
		WHEN ((tbl_serviceFormFieldValue.SalesPersonId IS NULL OR tbl_serviceFormFieldValue.SalesPersonId = 0) AND (tbl_serviceFormFieldValue.RMTeamId IS NULL OR tbl_serviceFormFieldValue.RMTeamId = 0))
		THEN 
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		WHEN tbl_serviceFormFieldValue.RMTeamId IS NOT NULL OR tbl_serviceFormFieldValue.RMTeamId <> 0
		THEN 
			(SELECT ISNULL(FirstName +' '+ LastName,'N/A') FROM [dbo].[Tbl_RMTeam] WHERE Id = tbl_serviceFormFieldValue.RMTeamId)
		ELSE 
			(SELECT ISNULL(FirstName +' '+ LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceFormFieldValue.SalesPersonId )
		END AS RequestedBy,
		ISNULL(tbl_serviceFormDataField.FieldName,'N/A') AS FieldName,
		ISNULL(tbl_serviceFormFieldValue.FieldValue,'N/A') AS FieldValue,
		ISNULL(tbl_serviceFormFieldValue.FileName,'N/A') AS FileName,
		ISNULL(CONVERT(NVARCHAR(50),tbl_serviceFormFieldValue.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),CAST(tbl_serviceFormFieldValue.CreatedOn AS TIME),0),'N/A') AS CreatedTime,
		CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL THEN 
				(SELECT TOP(1) Status 
				FROM [dbo].[Tbl_ServiceRequest]
				WHERE SerialNumber LIKE @SerialNumber)
			END AS [StatusId],
		CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
		THEN
			(SELECT TOP(1) tbl_serviceRequestStatus.Status 
			FROM [dbo].[Tbl_ServiceRequest] request
			LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
			WHERE SerialNumber LIKE @SerialNumber) 
		ELSE 'N/A'
		END AS Status
	FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceFormDataField ON tbl_serviceFormFieldValue.FieldId = tbl_serviceFormDataField.Id
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
	LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
	WHERE (tbl_serviceFormFieldValue.SerialNumber LIKE @SerialNumber AND tbl_serviceFormFieldValue.SerialNumber IS NOT NULL)
	AND tbl_serviceRequest.StepId = 0 AND tbl_serviceFormFieldValue.IsDelete <> 1 AND tbl_serviceRequest.IsDelete <> 1
	GROUP BY tbl_serviceFormFieldValue.ServiceId,tbl_serviceFormFieldValue.FormId,tbl_serviceFormFieldValue.CompanyId,tbl_serviceFormFieldValue.UserId,tbl_serviceFormFieldValue.SerialNumber,
		tbl_serviceForm.FormName,tbl_service.IsCompanyService,tbl_service.IsEmployeeService,tbl_company.CompanyName,tbl_user.FirstName,tbl_user.LastName,
		tbl_user.EmailID,tbl_serviceFormDataField.FieldName,tbl_serviceFormFieldValue.FieldValue,tbl_serviceFormFieldValue.CreatedOn,
		tbl_serviceRequest.Status,tbl_serviceFormFieldValue.FileName,tbl_serviceFormDataField.StepNumber,tbl_serviceRequest.CreatedOn,
		tbl_serviceFormFieldValue.SalesPersonId,
		tbl_serviceRequest.SerialNumber,
		tbl_serviceFormFieldValue.RMTeamId
	ORDER BY tbl_serviceFormDataField.StepNumber

	SELECT DISTINCT
		tbl_serviceRequest.StepId AS StepId,
		tbl_serviceRequest.Id AS Id,
		ISNULL(tbl_serviceRequest.ServiceId,0) AS ServiceId,
		ISNULL(tbl_serviceRequest.FormId,0) AS FormId,
		ISNULL(tbl_serviceForm.FormName,'N/A') AS RequestedService,
		ISNULL(tbl_serviceRequest.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_serviceRequest.UserId,0) AS UserId,
		CASE WHEN ((tbl_serviceRequest.SalesPersonId IS NULL OR tbl_serviceRequest.SalesPersonId = 0) AND (tbl_serviceRequest.RMTeamId IS NULL OR tbl_serviceRequest.RMTeamId = 0))
		THEN 
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A')
		WHEN tbl_serviceRequest.RMTeamId IS NOT NULL OR tbl_serviceRequest.RMTeamId <> 0
		THEN 
			(SELECT ISNULL(FirstName +' '+ LastName,'N/A') FROM [dbo].[Tbl_RMTeam] WHERE Id = tbl_serviceRequest.RMTeamId)
		ELSE 
			(SELECT ISNULL(FirstName +' '+ LastName ,'N/A') FROM [dbo].[Tbl_SalesPersons] WHERE Id = tbl_serviceRequest.SalesPersonId )
		END AS RequestedBy,
		ISNULL(tbl_serviceRequest.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(tbl_serviceRequest.Title,'N/A') AS Title,
		ISNULL(tbl_serviceRequest.Description,'N/A') AS Description,
		ISNULL(tbl_serviceRequest.AssignedTo,0) AS AssignedTo,
		ISNULL(tbl_serviceRequest.Status,0) AS StatusId,
		CASE WHEN (tbl_serviceRequest.Status) IS NOT NULL
		THEN
			(SELECT TOP 1 tbl_serviceRequestStatus.Status FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus 
			LEFT JOIN [dbo].[Tbl_ServiceRequest] request ON request.Status = tbl_serviceRequestStatus.DisplayId
			WHERE DisplayId = tbl_serviceRequest.Status AND request.StepId = tbl_serviceRequest.StepId)
		ELSE 'N/A'
		END AS Status,
		ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequest.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),CAST(tbl_serviceRequest.CreatedOn AS TIME),0),'N/A') AS CreatedTime
	FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceRequest.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceRequest.UserId
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceRequest.FormId
	WHERE tbl_serviceRequest.SerialNumber LIKE @SerialNumber AND tbl_serviceRequest.StepId <> 0
	AND tbl_serviceRequest.IsDelete <> 1
	GROUP BY tbl_serviceRequest.Id,tbl_serviceRequest.ServiceId,tbl_serviceRequest.FormId,tbl_serviceForm.FormName,tbl_serviceRequest.CompanyId,tbl_company.CompanyName,
			tbl_serviceRequest.UserId,tbl_serviceRequest.StepId,tbl_user.FirstName,tbl_user.LastName,tbl_user.EmailID,tbl_serviceRequest.SerialNumber,tbl_serviceRequest.Title,
			tbl_serviceRequest.Description,tbl_serviceRequest.AssignedTo,tbl_serviceRequest.Status,tbl_serviceRequest.CreatedOn,tbl_serviceRequest.SalesPersonId,
			tbl_serviceRequest.RMTeamId
	ORDER BY tbl_serviceRequest.StepId asc
END

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRequestNotificationByAssignId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <16-June-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <17-June-2022>
-- Description:	To get all request notifications
-- USP_Admin_GetRequestNotificationByAssignId 291
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetRequestNotificationByAssignId]
	@UserId INT = NULL,
	@StartDate NVARCHAR(50) = NULL,
	@EndDate NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;

	SELECT DISTINCT
		tbl_requestNotification.Id,
		ISNULL(tbl_requestNotification.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.RequestCreatedOn, 100), 7)),'N/A') AS RequestCreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_requestNotification.Type,'N/A') AS Type,
		ISNULL(tbl_requestNotification.AssignedUserId,0) AS AssignedUserId,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.AssignedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.AssignedOn, 100), 7)),'N/A') AS AssignedOn,
		ISNULL(tbl_requestNotification.AssignedBy,0) AS AssignedById,
		ISNULL(tbl_requestNotification.Title,'N/A') AS Title,
		ISNULL(tbl_requestNotification.Description,'N/A') AS Description,
		ISNULL(tbl_requestNotification.ResponseType,'N/A') AS ResponseType,
		ISNULL(CASE WHEN AssignedUserId IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb 
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedUserId
			WHERE tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
			)
		END,'N/A') AS AssignedUser,
		ISNULL(CASE WHEN AssignedBy IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedBy
			WHERE tbl_notification.AssignedBy = tbl_requestNotification.AssignedBy
			AND tbl_notification.Id = tbl_requestNotification.Id	
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS AssignedBy,
		ISNULL(CASE WHEN tbl_requestNotification.TrackingNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.SupportTicketCreatedBy
			WHERE tbl_notification.SupportTicketCreatedBy = tbl_requestNotification.SupportTicketCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS SupportTicketCreatedBy,
		ISNULL(CASE WHEN tbl_requestNotification.TrackingNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_SalesPersons] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.SupportTicketCreatedBySalesPerson
			WHERE tbl_notification.SupportTicketCreatedBy = tbl_requestNotification.SupportTicketCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.TrackingNumber LIKE tbl_requestNotification.TrackingNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS SupportTicketCreatedBySalesPerson,
		ISNULL(tbl_requestNotification.SupportTicketCreatedBy,0) AS SupportTicketCreatedById,
		ISNULL(tbl_requestNotification.AssignedUserMarkAsRead,0) AS AssignedUserMarkAsRead
	FROM [dbo].[Tbl_AssignSupportTicket] tbl_assignSupportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_requestNotification ON tbl_requestNotification.TrackingNumber = tbl_assignSupportTicket.TrackingNumber
	WHERE tbl_requestNotification.IsDelete <> 1 AND tbl_requestNotification.IsActive <> 0 AND (tbl_assignSupportTicket.UserId = @UserId AND (tbl_requestNotification.SupportTicketCreatedBy <> @UserId
	OR tbl_requestNotification.SupportTicketCreatedBy IS NULL))
	AND (CONVERT(date,tbl_requestNotification.CreatedOn) >= CONVERT(date,@StartDate) AND CONVERT(date,tbl_requestNotification.CreatedOn) <= CONVERT(date,@EndDate)
	AND (tbl_requestNotification.AssignedUserMarkAsRead = 1 OR tbl_requestNotification.AssignedUserMarkAsRead = 0)
	OR (@EndDate IS NULL AND @StartDate IS NULL AND tbl_requestNotification.AssignedUserMarkAsRead <> 1))
	ORDER BY tbl_requestNotification.Id DESC

	SELECT DISTINCT
		tbl_requestNotification.Id,
		ISNULL(tbl_requestNotification.SerialNumber,'N/A') AS SerialNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.RequestCreatedOn, 100), 7)),'N/A') AS RequestCreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.RequestCreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(tbl_requestNotification.Type,'N/A') AS Type,
		ISNULL(tbl_requestNotification.AssignedUserId,0) AS AssignedUserId,
		ISNULL(CONVERT(NVARCHAR(50),tbl_requestNotification.AssignedOn,105)+' '+ LTRIM(RIGHT(CONVERT(VARCHAR(20), tbl_requestNotification.AssignedOn, 100), 7)),'N/A') AS AssignedOn,
		ISNULL(tbl_requestNotification.AssignedBy,0) AS AssignedById,
		ISNULL(tbl_requestNotification.Title,'N/A') AS Title,
		ISNULL(tbl_requestNotification.Description,'N/A') AS Description,
		ISNULL(tbl_requestNotification.ResponseType,'N/A') AS ResponseType,
		ISNULL(CASE WHEN AssignedUserId IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb 
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedUserId
			WHERE  tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
				AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
				AND tbl_notification.Id = tbl_requestNotification.Id
			)
		END,'N/A') AS AssignedUser,
		ISNULL(CASE WHEN AssignedBy IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.AssignedBy
			WHERE tbl_notification.AssignedBy = tbl_requestNotification.AssignedBy
			AND tbl_notification.Id = tbl_requestNotification.Id	
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS AssignedBy,
		ISNULL(CASE WHEN tbl_requestNotification.SerialNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_User] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.ServiceCreatedBy
			WHERE tbl_notification.ServiceCreatedBy = tbl_requestNotification.ServiceCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS ServiceCreatedBy,
		ISNULL(CASE WHEN tbl_requestNotification.SerialNumber IS NOT NULL
			THEN (SELECT userTb.FirstName +' '+ userTb.LastName FROM [dbo].[Tbl_SalesPersons] userTb
			LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_notification ON userTb.Id = tbl_notification.ServiceCreatedBySalesPerson
			WHERE tbl_notification.ServiceCreatedBy = tbl_requestNotification.ServiceCreatedBy
			AND tbl_notification.Id = tbl_requestNotification.Id
			AND tbl_notification.SerialNumber LIKE tbl_requestNotification.SerialNumber
			AND tbl_notification.IsDelete <> 1 AND tbl_notification.IsActive <> 0
			AND tbl_notification.Id = tbl_requestNotification.Id
		)
		END,'N/A') AS ServiceCreatedBySalesPerson,
		ISNULL(tbl_requestNotification.ServiceCreatedBy,0) AS ServiceCreatedById,
		ISNULL(tbl_requestNotification.AssignedUserMarkAsRead,0) AS AssignedUserMarkAsRead
	FROM [dbo].[Tbl_AssignServiceRequest] tbl_assignServiceRequest WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_RequestNotification] tbl_requestNotification ON tbl_requestNotification.SerialNumber = tbl_assignServiceRequest.SerialNumber
	WHERE tbl_requestNotification.IsDelete <> 1 AND tbl_requestNotification.IsActive <> 0 AND (tbl_assignServiceRequest.UserId = @UserId 
	OR (tbl_requestNotification.ServiceCreatedBy IS NULL AND tbl_requestNotification.ServiceCreatedBy <> @UserId))
	AND (CONVERT(date,tbl_requestNotification.CreatedOn) >= CONVERT(date,@StartDate) AND CONVERT(date,tbl_requestNotification.CreatedOn) <= CONVERT(date,@EndDate)
	AND (tbl_requestNotification.AssignedUserMarkAsRead = 1 OR tbl_requestNotification.AssignedUserMarkAsRead = 0)
	OR (@EndDate IS NULL AND @StartDate IS NULL AND tbl_requestNotification.AssignedUserMarkAsRead <> 1))
	ORDER BY tbl_requestNotification.Id DESC
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRMTeamCloseServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRMTeamCloseServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	10/Oct/2024
-- Description:		Get RM Team's Close Service Request Count
-- USP_Admin_GetRMTeamCloseServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRMTeamCloseServiceRequestCount]
	@RMTeamId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
	LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId   
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id    
	WHERE tbl_RMTeam.Id = @RMTeamId 
	AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
	AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
	AND tbl_serviceRequest.StatusId = 3 ;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
	FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
	LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId   
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id    
	WHERE tbl_RMTeam.Id =  @RMTeamId 
	AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
	AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
	AND tbl_serviceRequest.StatusId = 3 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRMTeamDetailsForPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	<<USP_Admin_GetRMTeamDetailsForPermission N'DIBN696'>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetRMTeamDetailsForPermission]
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @countOfUser INT =NULL,@CompanyId INT = NULL;
	IF @Email IS NOT NULL 
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam
		WHERE (tbl_RMTeam.EmailAddress = @Email) AND tbl_RMTeam.IsActive <> 0 AND tbl_RMTeam.IsDelete <> 1) 
		BEGIN
			SELECT 
				ISNULL(tbl_RMTeam.Id,0) AS Id
			FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
			WHERE (tbl_RMTeam.EmailAddress = @Email) AND tbl_RMTeam.IsActive <> 0 AND tbl_RMTeam.IsDelete <> 1
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRMTeamOpenServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRMTeamOpenServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	10/Oct/2024
-- Description:		Get RM Team's Open Service Request Count
-- USP_Admin_GetRMTeamOpenServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRMTeamOpenServiceRequestCount]
	@RMTeamId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId   
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id    
    WHERE tbl_RMTeam.Id = @RMTeamId 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId   
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id   
    WHERE tbl_RMTeam.Id = @RMTeamId
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRMTeamPersonName]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRMTeamPersonName
-- Author:			<Yashasvi Sharma>
-- Created date:	10/Oct/2024
-- Description:		Get RM Team Person Name
-- USP_Admin_GetRMTeamPersonName
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRMTeamPersonName]
	@email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		FirstName AS FirstName,
		LastName AS LastName  
	FROM [dbo].[Tbl_RMTeam]
	WHERE EmailAddress LIKE @email AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRMTeamRejectedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRMTeamRejectedServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get RM Team's Rejected or Cancelled Service Request Count
-- USP_Admin_GetRMTeamRejectedServiceRequestCount 11
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRMTeamRejectedServiceRequestCount]
	@RMTeamId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId   
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id    
    WHERE tbl_RMTeam.Id =  @RMTeamId 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5)

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber 
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_RMTeamMapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_RMTeamMapping.CompanyId   
	LEFT JOIN [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK) ON  tbl_RMTeamMapping.RMTeamId = tbl_RMTeam.Id    
    WHERE tbl_RMTeam.Id =   @RMTeamId 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5)
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRolePermissionByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetRolePermissionByRoleId 2>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetRolePermissionByRoleId]
	@RoleId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		ISNULL(tbl_rolePermission.RolePermissionId,0) AS RolePermissionId,
		ISNULL(tbl_rolePermission.RoleID,0) AS RoleID,
		ISNULL(tbl_rolePermission.ModuleId,0) AS ModuleId,
		ISNULL(tbl_rolePermission.PermissionId,0) AS PermissionId,
		ISNULL(tbl_rolePermission.IsActive,0) AS IsActive,
		ISNULL(tbl_rolePermission.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_rolePermission.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_rolePermission.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_RolePermission] tbl_rolePermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolePermission.RoleID
	WHERE tbl_role.RoleID = @RoleId AND tbl_rolePermission.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRolePermissionCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRolePermissionCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Role Permission Count
-- USP_Admin_GetRolePermissionCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRolePermissionCount]
	@Role NVARCHAR(100) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		COUNT(*)
	FROM [dbo].[Tbl_RolePermission] tbl_rolePermssion 
    LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolePermssion.RoleID WHERE 
    tbl_role.RoleName LIKE @Role
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRolePermissionModuleByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetRolePermissionModuleByRoleId N'Admin'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetRolePermissionModuleByRoleId]
	@Role NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_RolePermission] tbl_rolepermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_rolepermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolepermission.RoleID
	WHERE tbl_role.RoleName LIKE @Role AND tbl_rolepermission.IsDelete<> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRolePermissionNameByRoleId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetRolePermissionNameByRoleId N'Employee',N'MyRequests'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetRolePermissionNameByRoleId]
	@Role NVARCHAR(MAX) = NULL,
	@Module NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_permission.PermissionName AS PermissionName
	FROM [dbo].[Tbl_RolePermission] tbl_rolepermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_permission.PermissionId = tbl_rolepermission.PermissionId
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_rolepermission.ModuleId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_rolepermission.RoleID
	WHERE tbl_role.RoleName LIKE '%' + @Role +'%' AND tbl_rolepermission.IsDelete<> 1 AND tbl_module.ModuleName LIKE '%' +@Module+'%'
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRoleWiseCompanyEmployeeCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRoleWiseCompanyEmployeeCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Role wise company employee count
-- USP_Admin_GetRoleWiseCompanyEmployeeCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRoleWiseCompanyEmployeeCount]
	@Role NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RoleID INT = NULL
	SET @RoleID = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE @Role)

	SELECT 
		COUNT(*) 
	FROM [dbo].[Tbl_Company_User_Mapping] tbl_CompanyMapping  
    LEFT JOIN [dbo].[Tbl_User] ON tbl_user.Id = tbl_CompanyMapping.UserId  
    LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id  
    WHERE tbl_CompanyMapping.CompanyId =   @CompanyId   AND tbl_CompanyMapping.UserId <> 0 AND tbl_user.IsDelete <> 1  
    AND tbl_CompanyMapping.IsDelete  <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1  
    AND tbl_roleMapping.RoleID  = @RoleID
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetRoleWiseCompanyOwnerCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetRoleWiseCompanyOwnerCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Role wise company onwer count
-- USP_Admin_GetRoleWiseCompanyOwnerCount 12
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetRoleWiseCompanyOwnerCount]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RoleID INT = NULL
	SET @RoleID = (SELECT RoleID FROM [dbo].[Tbl_Role] WHERE RoleName LIKE 'Company Owner')

	SELECT ISNULL(COUNT(tbl_companyMapping.UserId),0) FROM [dbo].[Tbl_Company_User_Mapping] tbl_companyMapping  
    LEFT JOIN[dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_companyMapping.UserId  
    LEFT JOIN[dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_user.Id = tbl_roleMapping.UserId  
    WHERE tbl_companyMapping.IsDelete <> 1 AND tbl_companyMapping.CompanyId = @CompanyId  AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1  
    AND tbl_roleMapping.RoleID = @RoleID
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSalesPersonCloseServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetSalesPersonCloseServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Sales person's Close Service Request Count
-- USP_Admin_GetSalesPersonCloseServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSalesPersonCloseServiceRequestCount]
	@SalesPerson INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
	FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id  
	WHERE tbl_salesPerson.Id = @SalesPerson 
	AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
	AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
	AND tbl_serviceRequest.StatusId = 3 ;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
	FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
	LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id  
	WHERE tbl_salesPerson.Id =  @SalesPerson 
	AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
	AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
	AND tbl_serviceRequest.StatusId = 3 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSalesPersonDetailsForLogin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2023>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Get Sales Person Details For Login>
-- <USP_Admin_GetSalesPersonDetailsForLogin 9>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetSalesPersonDetailsForLogin]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_salesPersons.Id,0) AS Id,
		ISNULL(tbl_salesPersons.EmailId,'N/A') AS EmailId,
		(SELECT TOP(1) tbl_pass.Password FROM [dbo].[Tbl_Password] tbl_pass WHERE tbl_pass.SalesPersonId = @Id ORDER BY Id DESC) AS [Password]
	FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_salesPersons.Designation
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_companyMapping.CompanyId
	LEFT JOIN [dbo].[Tbl_Password] tbl_password WITH(NOLOCK) ON tbl_password.SalesPersonId = tbl_salesPersons.Id
	WHERE tbl_salesPersons.IsDelete <> 1 AND tbl_salesPersons.Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSalesPersonDetailsForPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <06-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <15-Nov-2022>
-- Description:	<<USP_Admin_GetSalesPersonDetailsForPermission N'DIBN696'>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetSalesPersonDetailsForPermission]
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @countOfUser INT =NULL,@CompanyId INT = NULL;
	IF @Email IS NOT NULL 
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] tbl_salesPerson
		WHERE (tbl_salesPerson.EmailId = @Email) AND tbl_salesPerson.IsActive <> 0 AND tbl_salesPerson.IsDelete <> 1) 
		BEGIN
			SELECT 
				ISNULL(tbl_salesPerson.Id,0) AS Id
			FROM [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK)
			WHERE (tbl_salesPerson.EmailId = @Email) AND tbl_salesPerson.IsActive <> 0 AND tbl_salesPerson.IsDelete <> 1
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSalesPersonName]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetSalesPersonName
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Sales Person Name
-- USP_Admin_GetSalesPersonName
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSalesPersonName]
	@email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		FirstName AS FirstName,
		LastName AS LastName  
	FROM [dbo].[Tbl_SalesPersons]
	WHERE EmailId LIKE @email AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSalesPersonOpenServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetSalesPersonOpenServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Sales person's Open Service Request Count
-- USP_Admin_GetSalesPersonOpenServiceRequestCount 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSalesPersonOpenServiceRequestCount]
	@SalesPerson INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
    LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id  
    WHERE tbl_salesPerson.Id = @SalesPerson 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
    LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id  
    WHERE tbl_salesPerson.Id = @SalesPerson
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND tbl_serviceRequest.StatusId <> 3 AND tbl_serviceRequest.StatusId <> 4 AND tbl_serviceRequest.StatusId <> 5 ;
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSalesPersonRejectedServiceRequestCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetSalesPersonRejectedServiceRequestCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Sales person's Rejected or Cancelled Service Request Count
-- USP_Admin_GetSalesPersonRejectedServiceRequestCount 11
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSalesPersonRejectedServiceRequestCount]
	@SalesPerson INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber
    FROM [dbo].[Tbl_CompanyServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
    LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id  
    WHERE tbl_salesPerson.Id =  @SalesPerson 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5)

	SELECT DISTINCT 
		tbl_serviceRequest.SerialNumber AS SerialNumber 
    FROM [dbo].[Tbl_EmployeeServiceRequests] tbl_serviceRequest WITH(NOLOCK)  
    LEFT JOIN [dbo].[Tbl_Service] tbl_service WITH(NOLOCK)  ON tbl_serviceRequest.ServiceId = tbl_service.Id   
    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping  WITH(NOLOCK) ON tbl_serviceRequest.CompanyId = tbl_mapping.CompanyId  
    LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK) ON  tbl_mapping.SalesPersonId = tbl_salesPerson.Id  
    WHERE tbl_salesPerson.Id =   @SalesPerson 
    AND tbl_service.IsActive <> 0 AND tbl_service.IsDelete <> 1  
    AND (tbl_serviceRequest.IsDelete <> 1 OR tbl_serviceRequest.IsDelete IS NULL)  
    AND (tbl_serviceRequest.StatusId = 4 OR tbl_serviceRequest.StatusId = 5)
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSelectedCompanyDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <03-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Admin_GetSelectedCompanyDetails 2>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetSelectedCompanyDetails]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT 
		tbl_company.Id
		FROM [dbo].[Tbl_Company] tbl_company
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mappin ON tbl_company_user_mappin.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mappin.UserId
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_roleMapping.RoleID = tbl_role.RoleID
		LEFT JOIN [dbo].[Tbl_Password] tbl_password ON tbl_password.UserId = tbl_user.Id
		WHERE tbl_company.Id = @CompanyId 
		AND tbl_company.IsActive <>0 
		AND tbl_company.IsDelete <> 1 
		AND tbl_role.RoleName LIKE 'Company Owner'
		AND tbl_user.IsActive<> 0 
		AND tbl_user.IsDelete <>1)
	BEGIN
		SELECT TOP (1)
			tbl_user.AccountNumber AS DIBNUserNumber,
			tbl_password.Password AS [Password]
		FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mappin ON tbl_company_user_mappin.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mappin.UserId
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_roleMapping.RoleID = tbl_role.RoleID
		LEFT JOIN [dbo].[Tbl_Password] tbl_password ON tbl_password.UserId = tbl_user.Id
		WHERE tbl_company.Id = @CompanyId 
		AND tbl_company.IsActive<>0 
		AND tbl_company.IsDelete <> 1 
		AND tbl_user.IsActive<> 0 
		AND tbl_role.RoleName LIKE 'Company Owner'
		AND tbl_user.IsDelete <>1
		ORDER BY tbl_user.Id DESC
	END
	ELSE
	BEGIN
		SELECT 
			tbl_company.AccountNumber AS DIBNUserNumber,
			tbl_company.Cmp_Pass AS [Password]
		FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
		WHERE tbl_company.Id = @CompanyId
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSerialNumberOfService]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetSerialNumberOfService]
AS
BEGIN	
	SET NOCOUNT ON;
	DECLARE @NewSerialNumber NVARCHAR(MAX) = NULL,@SerialNumber INT = NULL;
	IF EXISTS(SELECT Id FROM [dbo].[Tbl_ServiceFormFieldValue] WHERE IsDelete <> 1)
	BEGIN
		SET @SerialNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX('R',SerialNumber)+1,LEN(SerialNumber)))) 
							FROM [dbo].[Tbl_ServiceFormFieldValue] WITH(NOLOCK));
		SET @SerialNumber = @SerialNumber + 1
		SET  @NewSerialNumber ='SR'+ CONVERT(NVARCHAR(100),@SerialNumber);
	END
	ELSE
	BEGIN
		SET  @NewSerialNumber = 'SR101';
	END
	SELECT @NewSerialNumber
END;


GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceFormField]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- SP_Admin_GetServiceFormField 5,37
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceFormField]
	@ServiceId INT = NULL,
	@FormId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		serviceformfield.StepNumber AS StepNumber,
		ISNULL(serviceformfield.Id,0) AS FieldId,
		ISNULL(serviceformfield.FieldName,'N/A') AS FieldName,
		ISNULL(serviceformfield.IsRequired,0) AS IsRequired,
		ISNULL(serviceformfield.IsRequiredMessage,'N/A') AS IsRequiredMessage,
		ISNULL(serviceformfield.IsDocumentUpload,0) AS IsDocumentUpload,
		ISNULL(serviceformfield.ServiceId,0) AS ServiceId,
		ISNULL(serviceformfield.FormId,0) AS FormId,
		ISNULL(serviceforms.FormName,'N/A') AS FormName,
		ISNULL(serviceformfield.IsActive,0) AS IsActive,
		ISNULL(serviceformfield.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),serviceformfield.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(serviceformfield.CreatedBy,0) AS CreatedBy,
		ISNULL(CONVERT(NVARCHAR(50),serviceformfield.ModifyOn,105),'N/A') AS ModifyOn,
		ISNULL(serviceformfield.ModifyBy,0) AS ModifyBy,
		ISNULL(tbl_service.AllowDisplay,0) AS AllowDisplay,
		ISNULL(tbl_service.DisplayName,'N/A') AS DisplayName,
		ISNULL(tbl_service.HasMultipleForms,0) AS HasMultipleForms,
		ISNULL(tbl_service.FormConstrains,'N/A') AS FormConstrains,
		ISNULL(tbl_companyService.CompanyType,'N/A') AS CompanyType
	FROM [dbo].[Tbl_ServiceFormDataField] serviceformfield WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceForms] serviceforms ON serviceforms.Id = serviceformfield.FormId
	LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = serviceformfield.ServiceId
	LEFT JOIN [dbo].[Tbl_CompanyServices] tbl_companyService ON tbl_companyService.Id = tbl_service.ServiceId
	WHERE serviceformfield.FormId = @FormId AND serviceformfield.ServiceId = @ServiceId
	AND serviceformfield.IsActive <> 0
	ORDER BY serviceformfield.StepNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceFormFieldCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- USP_Admin_GetServiceFormFieldCount 135,true,false
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceFormFieldCount]
	@ServiceId INT = NULL,
	@IsCompayService BIT = NULL,
	@IsEmployeeService BIT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @FormServiceId INT = NULL,@CountOfFields INT = NULL,@FormId INT = NULL,@FormName NVARCHAR(MAX) = NULL;
	SET @FormServiceId = (
							SELECT
								Id 
							FROM [dbo].[Tbl_Service] WITH(NOLOCK)
							WHERE ServiceId = @ServiceId 
							AND IsCompanyService = @IsCompayService 
							AND IsEmployeeService = @IsEmployeeService 
							AND IsActive <> 0 
							AND IsDelete <> 1
						);
	SET @CountOfFields = (
							SELECT 
								COUNT(Id) 
							FROM [dbo].[Tbl_ServiceFormDataField] WITH(NOLOCK)
							WHERE ServiceId = @FormServiceId 
							AND IsActive <> 0 
							AND IsDelete <> 1
						);
	SET @FormId = (
							SELECT 
								Id
							FROM [dbo].[Tbl_ServiceForms] WITH(NOLOCK)
							WHERE ServiceId = @FormServiceId 
							AND IsActive <> 0 
							AND IsDelete <> 1
						);

	SET @FormName = (
						SELECT FormName 
						FROM [Tbl_ServiceForms] 
						WHERE ServiceId = @FormServiceId 
							AND IsActive <> 0 
							AND IsDelete <> 1
					)

	SELECT @FormServiceId AS FormServiceId,
		   @CountOfFields AS CountOfFields,
		   @FormId AS FormId,
		   @FormName AS FormName

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceIdByName]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetServiceIdByName N'Renewal of License with Location change '>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceIdByName]
	@ServiceName NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT 
		ID AS ServiceId , 
		1 AS IsCompanyService ,
		0 AS IsEmployeeService
	FROM [dbo].[Tbl_CompanyServices] tbl_companyService WITH(NOLOCK)
	WHERE tbl_companyService.ServiceName LIKE @ServiceName
		AND tbl_companyService.ParentId <> 0 
		AND tbl_companyService.IsDelete <> 1
		AND tbl_companyService.IsActive <> 0

		
	SELECT 
		ID AS ServiceId , 
		0 AS IsCompanyService ,
		1 AS IsEmployeeService
	FROM [dbo].[Tbl_EmployeeServices] tbl_employeeService WITH(NOLOCK)
	WHERE tbl_employeeService.ServiceName LIKE @ServiceName
		AND tbl_employeeService.ParentId <> 0 
		AND tbl_employeeService.IsDelete <> 1
		AND tbl_employeeService.IsActive <> 0

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestBasicDetailsForNotification]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetServiceRequestBasicDetailsForNotification
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get last added response details for notification
-- USP_Admin_GetServiceRequestBasicDetailsForNotification
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestBasicDetailsForNotification]
	@serialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1)
		Id AS Id, 
		SerialNumber AS SerialNumber 
	FROM [dbo].[Tbl_ServiceRequest] 
	WHERE SerialNumber LIKE @serialNumber AND IsDelete <> 1 AND IsActive <> 0 
	GROUP BY Id,SerialNumber,ServiceId,FormId,CompanyId,Title,Status,StepId 
	ORDER BY Id DESC
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestCurrentStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_GetServiceRequestCurrentStatus N'SR2000'
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestCurrentStatus]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1) ISNULL(tbl_serviceRequestStatus.Status,'N/A') AS [Status]
	FROM [dbo].[Tbl_ServiceRequest] request WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus ON tbl_serviceRequestStatus.DisplayId = request.Status
	WHERE SerialNumber = @SerialNumber
	ORDER BY StepId DESC
	
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestDocumentById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--SP_Admin_GetServiceRequestDocumentById 9
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestDocumentById]
	@ServiceId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(Id,0) AS Id,
		ISNULL(ServiceResponseId,0) AS ServiceResponseId,
		ISNULL(FileName,'N/A') AS FileName,
		DataBinary AS DataBinary,
		ISNULL(CompanyId,0) AS CompanyId,
		ISNULL(ServiceId,0) AS ServiceId
	FROM [dbo].[Tbl_ServiceRequestDocument] WITH(NOLOCK)
	WHERE ServiceResponseId = @ServiceId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestFormName]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetServiceRequestFormName
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Service Request Form Name
-- USP_Admin_GetServiceRequestFormName
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestFormName]
	@formId INT = NULL,
	@serialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @serialNumber IS NULL AND @formId IS NOT NULL AND @formId <> 0
	BEGIN
		SELECT 
			FormName 
		FROM [dbo].[Tbl_ServiceForms] 
		WHERE Id= @formId
	END
	ELSE IF @serialNumber IS NOT NULL
	BEGIN
		SELECT DISTINCT 
			tbl_serviceForm.FormName 
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest 
        LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.ServiceId = tbl_serviceRequest.ServiceId 
        WHERE tbl_serviceRequest.SerialNumber LIKE @serialNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestResponseCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- SP_Admin_GetServiceRequestResponseCount 'SR1002'
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestResponseCount]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT COUNT(*) AS [Count]
	FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK)
	WHERE SerialNumber LIKE @SerialNumber AND ([Status] = 2 OR [Status] = 4)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestResponseDetailsForNotification]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetServiceRequestResponseDetailsForNotification
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get last added response details for notification
-- USP_Admin_GetServiceRequestResponseDetailsForNotification
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestResponseDetailsForNotification]
	@serialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1) 
		Id AS Id, 
		SerialNumber AS SerialNumber,  
		ServiceId AS ServiceId, 
        FormId AS FormId ,  
		CompanyId As CompanyId , 
		Title As Title , 
		Status As Status , 
		StepId AS StepId 
    FROM [dbo].[Tbl_ServiceRequest]
	WHERE SerialNumber LIKE @serialNumber AND IsDelete <> 1 AND IsActive <> 0  
    GROUP BY Id,SerialNumber,ServiceId,FormId,CompanyId,Title,Status,StepId  
    ORDER BY Id DESC;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceRequestsForChart]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- SP_Admin_GetServiceRequestsForChart 4

CREATE PROCEDURE [dbo].[USP_Admin_GetServiceRequestsForChart]
	@Status INT = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		SELECT
			(SELECT DISTINCT COUNT(*) AS OpenService FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)  
			WHERE tbl_serviceRequest.Status = 3 AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b  
			WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber AND b.Status = 3  
			GROUP BY SerialNumber)
			) AS CloseServiceCount,

			(
				SELECT DISTINCT Year(tbl_serviceRequest.CreatedOn) AS OpenService 
				FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
				WHERE tbl_serviceRequest.Status = 3 AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b  
																					WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber AND b.Status = 3  
																					GROUP BY SerialNumber
					
				)
				GROUP BY Year(tbl_serviceRequest.CreatedOn)
			) AS CloseServiceYear
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT
			(SELECT DISTINCT COUNT(*) FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK) 
            WHERE tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 AND  
            tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b 
            WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber AND b.Status <> 4 AND b.Status <> 5 AND b.Status <> 3  
            GROUP BY SerialNumber)
			) AS OpenServiceCount,

			(SELECT DISTINCT Year(tbl_serviceRequest.CreatedOn) FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest WITH(NOLOCK)
            WHERE tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 AND  
            tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b 
            WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber AND b.Status <> 4 AND b.Status <> 5 AND b.Status <> 3  
            GROUP BY SerialNumber)
			GROUP BY Year(tbl_serviceRequest.CreatedOn)
			) AS OpenServiceYear
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT 
			COUNT(*) AS CloseServiceCount, 
			DATENAME(MONTH,tbl_serviceRequest.CreatedOn) AS CloseServiceMonth
		FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest  WITH(NOLOCK)
		WHERE tbl_serviceRequest.Status = 3 AND tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b  
		WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber AND b.Status = 3  
		GROUP BY SerialNumber)
		GROUP BY DATENAME(MONTH,tbl_serviceRequest.CreatedOn)
	END
	ELSE IF @Status = 4
	BEGIN
			SELECT DISTINCT COUNT(*) AS OpenServiceCount ,
			DATENAME(MONTH,tbl_serviceRequest.CreatedOn) AS OpenServiceMonth
			FROM [dbo].[Tbl_ServiceRequest] tbl_serviceRequest  WITH(NOLOCK)
            WHERE tbl_serviceRequest.Status <> 3 AND tbl_serviceRequest.Status <> 4 AND tbl_serviceRequest.Status <> 5 AND  
            tbl_serviceRequest.Id IN(SELECT DISTINCT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] b 
            WHERE b.SerialNumber = tbl_serviceRequest.SerialNumber AND b.Status <> 4 AND b.Status <> 5 AND b.Status <> 3  
            GROUP BY SerialNumber)
			GROUP BY DATENAME(MONTH,tbl_serviceRequest.CreatedOn)
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetServiceSuggestionForInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetServiceSuggestionForInvoice
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of already added Product(s) as suggestion while creating Invoice
-- USP_Admin_GetServiceSuggestionForInvoice N'Cancellation'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetServiceSuggestionForInvoice]
	@prefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	SELECT DISTINCT 
		ServiceName AS ServiceName
	FROM [dbo].[Tbl_CompanyServices] WITH(NOLOCK)
	WHERE ServiceName LIKE '%'+@prefix+'%' AND IsDelete <> 1
	AND ParentId <> 0
	UNION ALL
	SELECT DISTINCT 
		ServiceName AS ServiceName 
	FROM [dbo].[Tbl_EmployeeServices] WITH(NOLOCK)
	WHERE ServiceName LIKE '%'+@prefix+'%' AND IsDelete <> 1
	AND ParentId <> 0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSuggestionForPortalExpense]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetSuggestionForPortalExpense
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get list of already added Product(s) as suggestion while adding new portal expense
-- USP_Admin_GetSuggestionForPortalExpense N'V'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSuggestionForPortalExpense]
	@prefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT 
		ExpensesTitle AS ExpensesTitle 
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalBalanceExpenses WITH(NOLOCK)
    WHERE ExpensesTitle LIKE @prefix +'%' 
	AND IsDelete <> 1
	UNION ALL
	SELECT DISTINCT 
		[Description] AS ExpensesTitle 
	FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
    WHERE [Description] LIKE @prefix +'%' 
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSupportsTicketsWithPaginationForAdmin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- SP Name:			USP_Admin_GetSupportsTicketsWithPaginationForAdmin
-- Author:			<Yashasvi Sharma>
-- Created date:	08/July/2023
-- Description:		Get support tickets for admin panel with pagination
-- USP_Admin_GetSupportsTicketsWithPaginationForAdmin 0,50,N'',N'TR No.','asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSupportsTicketsWithPaginationForAdmin]
	@PageNumber  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminSupportTablePaginationTbl') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminSupportTablePaginationTbl
	END

	SELECT DISTINCT
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(
		(
			tbl_company.CompanyName
		),'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.UserId <> 0 AND tbl_supportTicket.UserId IS NOT NULL
			THEN tbl_user.FirstName + ' ' + tbl_user.LastName
			ELSE tbl_salesPerson.FirstName + ' ' + tbl_salesPerson.LastName
		END AS UserName,
		ISNULL(
			tbl_supportTicket.Title
		,'N/A') AS Title,
		ISNULL(
			CONVERT(nvarchar(50),tbl_supportTicket.CreatedOn,105)
		,'N/A') AS [CreatedOn],
		tbl_supportTicket.CreatedOn AS CreatedOnDate,
		(SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber) AS [TicketStatusId],
		CASE 
			WHEN (SELECT TOP 1 tbl_supports.TicketStatus FROM [dbo].[Tbl_SupportTicket] tbl_supports WHERE tbl_supports.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC) = 1  
			THEN 'Open'
			ELSE  'Close'
		END AS TicketStatus,
		ISNULL(
			STUFF(
				(
					SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
					LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
					WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
					FOR XML PATH ('')
				), 1, 1, '') 
		,'N/A') AS AssignedUser,
		ISNULL(
			(SELECT TOP (1) 
				CONVERT(nvarchar(50),tbl_assign1.CreatedOn,105) 
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
			)
		,'N/A') AS AssignedOn,
		(
			SELECT TOP (1) 
				tbl_assign1.CreatedOn
			FROM [Tbl_AssignSupportTicket] tbl_assign1 
			WHERE tbl_assign1.TrackingNumber = tbl_supportTicket.TrackingNumber
			ORDER BY tbl_assign1.Id DESC
		) AS AssignedOnDate
	INTO ##AdminSupportTablePaginationTbl
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_supportTicket.SalesPersonId = tbl_salesPerson.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1)
		GROUP BY TrackingNumber
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	AND ((SELECT TOP 1 TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber = tbl_supportTicket.TrackingNumber ORDER BY ID DESC)= @Status OR @Status IS NULL OR @Status = 0)

	SELECT * FROM ##AdminSupportTablePaginationTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)
	ORDER BY 
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'asc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END ASC,
		CASE WHEN @sortColumn = 'TR No.' AND @sortDirection = 'desc' 
			THEN 
				(SELECT CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber))))
		END DESC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'asc' 
			THEN 
				CompanyName
		END ASC,
		CASE WHEN @sortColumn = 'Company' AND @sortDirection = 'desc' 
			THEN 
				CompanyName
		END DESC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'asc' 
			THEN 
				UserName
		END ASC,
		CASE WHEN @sortColumn = 'Created By' AND @sortDirection = 'desc' 
			THEN 
				UserName
		END DESC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'asc' 
			THEN 
				CreatedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Created Date' AND @sortDirection = 'desc' 
			THEN 
				CreatedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'asc' 
			THEN 
				Title
		END ASC,
		CASE WHEN @sortColumn = 'Title' AND @sortDirection = 'desc' 
			THEN 
				Title
		END DESC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'asc' 
			THEN 
				AssignedUser
		END ASC,
		CASE WHEN @sortColumn = 'Assigned User' AND @sortDirection = 'desc' 
			THEN 
				AssignedUser
		END DESC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'asc' 
			THEN 
				AssignedOnDate
		END ASC,
		CASE WHEN @sortColumn = 'Assigned Date' AND @sortDirection = 'desc' 
			THEN 
				AssignedOnDate
		END DESC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'asc' 
			THEN 
				TicketStatus
		END ASC,
		CASE WHEN @sortColumn = 'Status' AND @sortDirection = 'desc' 
			THEN 
				TicketStatus
		END DESC

	OFFSET @pageNumber ROWS 
	FETCH NEXT @rowsOfPage ROWS ONLY


	SELECT COUNT(*) AS TotalSupportTickets FROM ##AdminSupportTablePaginationTbl
	WHERE  (
		@searchPrefix IS NULL
		OR TrackingNumber LIKE @searchPrefix +'%'
		OR Title LIKE '%'+ @searchPrefix +'%'
		OR UserName LIKE '%'+@searchPrefix+'%' 
		OR CompanyName LIKE '%'+@searchPrefix+'%' 
		OR CreatedOn LIKE '%'+ @searchPrefix +'%'
		OR AssignedUser LIKE '%'+ @searchPrefix +'%'
		OR TicketStatus LIKE '%'+ @searchPrefix +'%'
		OR AssignedOnDate LIKE '%'+ @searchPrefix +'%'
	)

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetSupportTicketsByTrackingNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <19-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Support Ticket>
-- SP_Admin_GetSupportTicketsByTrackingNumber N'TR103'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetSupportTicketsByTrackingNumber]
	@TrackingNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_supportTicket.ID,0) AS ID,
		ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		CASE WHEN tbl_supportTicket.UserId <> 0 THEN ISNULL(tbl_supportTicket.UserId,0) ELSE 0 END AS UserId,
		CASE WHEN tbl_supportTicket.UserId <> 0 THEN ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') ELSE 'N/A' END AS Username,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 THEN ISNULL(tbl_supportTicket.SalesPersonId,0) ELSE 0 END AS SalesPersonId,
		CASE WHEN tbl_supportTicket.SalesPersonId <> 0 THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A') ELSE 'N/A' END AS SalesPersonName,
		ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
		ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
		ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
		ISNULL(tbl_supportTicket.TicketStatus,0) AS TicketStatusId,
		CASE WHEN tbl_supportTicket.TicketStatus = 1 THEN 'Open'
		END AS TicketStatus,
		CASE WHEN tbl_supportTicket.TicketStatus 
			= 2 THEN 'Open - Closed' 
		END AS NewTicketStatus,
		ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
		ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
		ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),CAST(tbl_supportTicket.CreatedOn AS TIME),0),'N/A') AS CreatedTime,
		ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
		ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.ModifyOn,22),'N/A') AS ModifyOn,
		ISNULL(tbl_supportTicket.ModifyBy,0) AS ModifyBy
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId
	WHERE tbl_supportTicket.TrackingNumber LIKE @TrackingNumber 
	AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTemporaryAccountDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetTemporaryAccountDetailsById
-- Author:			<Yashasvi Sharma>
-- Created date:	23/Aug/2023
-- Description:		Get Temporary Account Management Details By Id
-- USP_Admin_GetTemporaryAccountDetailsById 1
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTemporaryAccountDetailsById]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_temporaryAccountManagement.Id,0) AS Id,
		ISNULL(tbl_temporaryAccountManagement.CompanyId,0) AS CompanyId,
		ISNULL(tbl_temporaryAccountManagement.TransactionId,'') AS TransactionId,
		ISNULL(tbl_temporaryAccountManagement.Description,'N/A') AS Description,
		ISNULL(tbl_temporaryAccountManagement.Amount,0) AS Amount,
		ISNULL(tbl_temporaryAccountManagement.Quantity,0) AS Quantity,
		ISNULL(tbl_temporaryAccountManagement.TotalAmount,0) AS TotalAmount,
		ISNULL(tbl_temporaryAccountManagement.Vat,0) AS Vat,
		ISNULL(tbl_temporaryAccountManagement.VatAmount,0) AS VatAmount,
		ISNULL(tbl_temporaryAccountManagement.GrandTotal,0) AS GrandTotal,
		ISNULL(tbl_temporaryAccountManagement.EntryType,'') AS EntryType,
		ISNULL(tbl_temporaryAccountManagement.PaymentMode,'') AS PaymentMode,
		ISNULL(CONVERT(NVARCHAR(20),CONVERT(DATE,tbl_temporaryAccountManagement.TransactionDate)),'') AS TransactionDate
	FROM [dbo].[Tbl_TempAccountManagement] tbl_temporaryAccountManagement
	WHERE tbl_temporaryAccountManagement.Id = @Id
	AND tbl_temporaryAccountManagement.IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTemporaryAccountManagement_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetTemporaryAccountManagement_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	21/Aug/2023
-- Description:		Get Temporary Account Management With Pagination
-- USP_Admin_GetTemporaryAccountManagement_Pagination 0,20,N'500',N'Vat (%)',N'desc' 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTemporaryAccountManagement_Pagination]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) =NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
					SELECT 
						ISNULL(tbl_tempAccountManagement.Id,0) AS Id,
						ISNULL(tbl_tempAccountManagement.CompanyId,0) AS CompanyId,
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName,
						ISNULL(tbl_tempAccountManagement.TransactionId,''N/A'') AS TransactionId,
						ISNULL(tbl_tempAccountManagement.TransactionIdNo,0) AS TransactionIdNo,
						ISNULL(tbl_tempAccountManagement.Description,''N/A'') AS Description,
						ISNULL(tbl_tempAccountManagement.Amount,0) AS Amount,
						ISNULL(tbl_tempAccountManagement.Quantity,0) AS Quantity,
						ISNULL(tbl_tempAccountManagement.TotalAmount,0) AS TotalAmount,
						ISNULL(tbl_tempAccountManagement.Vat,0) AS Vat,
						ISNULL(tbl_tempAccountManagement.VatAmount,0) AS VatAmount,
						ISNULL(tbl_tempAccountManagement.GrandTotal,0) AS GrandTotal,
						ISNULL(tbl_tempAccountManagement.EntryType,''N/A'') AS EntryType,
						ISNULL(tbl_tempAccountManagement.PaymentMode,''N/A'') AS PaymentMode,
						ISNULL(CONVERT(NVARCHAR(50),tbl_tempAccountManagement.TransactionDate,105),''N/A'') AS TransactionDate,
						ISNULL(CONVERT(NVARCHAR(50),tbl_tempAccountManagement.CreatedOnUtc,105),''N/A'') AS CreatedOnUtc,
						ISNULL(tbl_createdBy.FirstName +'' ''+ tbl_createdBy.LastName,''N/A'') AS CreatedBy,
						ISNULL(tbl_tempAccountManagement.IsApproved,0) AS IsApproved,
						ISNULL(tbl_approvedBy.FirstName +'' ''+ tbl_approvedBy.LastName,''N/A'') AS ApprovedBy,
						ISNULL(CONVERT(NVARCHAR(50),tbl_tempAccountManagement.ApprovedOnUtc,105),''N/A'') AS ApprovedOnUtc,
						ISNULL(tbl_tempAccountManagement.IsRejected,0) AS IsRejected,
						ISNULL(tbl_rejectedBy.FirstName +'' ''+ tbl_rejectedBy.LastName,''N/A'') AS RejectedBy,
						ISNULL(CONVERT(NVARCHAR(50),tbl_tempAccountManagement.RejectedOnUtc,105),''N/A'') AS RejectedOnUtc
					FROM [dbo].[Tbl_TempAccountManagement] tbl_tempAccountManagement
					LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_tempAccountManagement.CompanyId = tbl_company.Id
					LEFT JOIN [dbo].[Tbl_User] tbl_approvedBy ON tbl_tempAccountManagement.ApprovedBy = tbl_approvedBy.Id 
					AND (tbl_tempAccountManagement.ApprovedBy IS NOT NULL OR tbl_tempAccountManagement.ApprovedBy <> 0 )
					LEFT JOIN [dbo].[Tbl_User] tbl_rejectedBy ON tbl_tempAccountManagement.RejectedBy = tbl_rejectedBy.Id
					AND (tbl_tempAccountManagement.RejectedBy IS NOT NULL OR tbl_tempAccountManagement.RejectedBy <> 0 )
					LEFT JOIN [dbo].[Tbl_User] tbl_createdBy ON tbl_tempAccountManagement.CreatedBy = tbl_createdBy.Id
					WHERE (tbl_tempAccountManagement.IsDelete <> 1 OR tbl_tempAccountManagement.IsDelete IS NULL) 
					AND (tbl_tempAccountManagement.IsApproved <> 1) 
				'
	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		
		SET @conditions = @conditions +' AND (
								@searchPrefix IS NULL 
								OR tbl_tempAccountManagement.TransactionId LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_tempAccountManagement.Description LIKE ''%'+@searchPrefix+'%''  
								OR CONVERT(NVARCHAR(50),tbl_tempAccountManagement.Vat)  LIKE ''%'+@searchPrefix+'%''
								OR CONVERT(NVARCHAR(50),tbl_tempAccountManagement.VatAmount)  LIKE ''%'+@searchPrefix+'%''
								OR CONVERT(NVARCHAR(50),tbl_tempAccountManagement.GrandTotal)  LIKE ''%'+@searchPrefix+'%''
								OR tbl_approvedBy.FirstName +'' ''+ tbl_approvedBy.LastName LIKE ''%'+@searchPrefix+'%''
								OR tbl_createdBy.FirstName +'' ''+ tbl_createdBy.LastName LIKE ''%'+@searchPrefix+'%''
								OR tbl_rejectedBy.FirstName +'' ''+ tbl_rejectedBy.LastName LIKE ''%'+@searchPrefix+'%''  
							)'
	END

	SET @groupByClause = N'GROUP BY tbl_tempAccountManagement.Id,tbl_tempAccountManagement.CompanyId,tbl_tempAccountManagement.TransactionId,tbl_tempAccountManagement.TransactionIdNo,
	tbl_tempAccountManagement.Description,tbl_tempAccountManagement.Amount,tbl_tempAccountManagement.Quantity,tbl_tempAccountManagement.TotalAmount,
	tbl_tempAccountManagement.Vat,tbl_tempAccountManagement.VatAmount,tbl_tempAccountManagement.GrandTotal,tbl_tempAccountManagement.EntryType,
	tbl_tempAccountManagement.PaymentMode,tbl_tempAccountManagement.TransactionDate,tbl_tempAccountManagement.IsApproved,tbl_approvedBy.FirstName,
	tbl_approvedBy.LastName,tbl_tempAccountManagement.ApprovedOnUtc,tbl_tempAccountManagement.IsRejected,
	tbl_rejectedBy.FirstName,tbl_rejectedBy.LastName,tbl_tempAccountManagement.RejectedOnUtc,tbl_company.CompanyName,
	tbl_createdBy.FirstName,tbl_createdBy.LastName,tbl_tempAccountManagement.CreatedOnUtc
	'
	SET @orderByClause = N' ORDER BY '

	IF @sortColumn IS NULL OR @sortColumn = ''
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.TransactionIdNo'
							+ ' ASC '
	END
	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.TransactionIdNo'
							+ ' ASC '
	END
	IF @sortColumn = 'Transaction Id' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.TransactionIdNo'
							+ ' DESC '
	END
	IF @sortColumn = 'Company' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_company.CompanyName'
							+ ' ASC '
	END
	IF @sortColumn = 'Company' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_company.CompanyName'
							+ ' DESC '
	END
	IF @sortColumn = 'Description' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.Description'
							+ ' ASC '
	END
	IF @sortColumn = 'Description' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.Description'
							+ ' DESC '
	END
	IF @sortColumn = 'Vat (%)' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.Vat'
							+ ' ASC '
	END
	IF @sortColumn = 'Vat (%)' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.Vat'
							+ ' DESC '
	END
	IF @sortColumn = 'Vat Amount' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.VatAmount'
							+ ' ASC '
	END
	IF @sortColumn = 'Vat Amount' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.VatAmount'
							+ ' DESC '
	END
	IF (@sortColumn = 'Credit(AED)' OR @sortColumn = 'Debit(AED)') AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.GrandTotal'
							+ ' ASC '
	END
	IF (@sortColumn = 'Credit(AED)' OR @sortColumn = 'Debit(AED)') AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.GrandTotal'
							+ ' DESC '
	END
	IF @sortColumn = 'Approved By' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_approvedBy.FirstName +'' ''+ tbl_approvedBy.LastName'
							+ ' ASC '
	END
	IF @sortColumn = 'Approved By' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_approvedBy.FirstName +'' ''+ tbl_approvedBy.LastName'
							+ ' DESC '
	END
	IF @sortColumn = 'Rejected By' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_rejectedBy.FirstName +'' ''+ tbl_rejectedBy.LastName'
							+ ' ASC '
	END
	IF @sortColumn = 'Rejected By' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_rejectedBy.FirstName +'' ''+ tbl_rejectedBy.LastName'
							+ ' DESC '
	END
	IF @sortColumn = 'Date' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.TransactionDate'
							+ ' ASC '
	END
	IF @sortColumn = 'Date' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_tempAccountManagement.TransactionDate'
							+ ' DESC '
	END
	IF @sortColumn = 'Created By' AND @sortDirection = 'ASC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_createdBy.FirstName +'' ''+ tbl_createdBy.LastName'
							+ ' ASC '
	END
	IF @sortColumn = 'Created By' AND @sortDirection = 'DESC'
	BEGIN
		SET @orderByClause = @orderByClause + N' tbl_createdBy.FirstName +'' ''+ tbl_createdBy.LastName'
							+ ' DESC '
	END

	SET @pagination =  ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination 

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTemporaryAccountManagement_Pagination_Count]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetTemporaryAccountManagement_Pagination_Count
-- Author:			<Yashasvi Sharma>
-- Created date:	21/Aug/2023
-- Description:		Get Temporary Account Management Count
-- USP_Admin_GetTemporaryAccountManagement_Pagination_Count N'test'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTemporaryAccountManagement_Pagination_Count]
	@searchPrefix NVARCHAR(MAX) =NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	
	SET @query = N'
					SELECT 
						COUNT(tbl_tempAccountManagement.Id) AS TotalAccountManagement
					FROM [dbo].[Tbl_TempAccountManagement] tbl_tempAccountManagement
					LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_tempAccountManagement.CompanyId = tbl_company.Id
					LEFT JOIN [dbo].[Tbl_User] tbl_approvedBy ON tbl_tempAccountManagement.ApprovedBy = tbl_approvedBy.Id 
					AND (tbl_tempAccountManagement.ApprovedBy IS NOT NULL OR tbl_tempAccountManagement.ApprovedBy <> 0 )
					LEFT JOIN [dbo].[Tbl_User] tbl_rejectedBy ON tbl_tempAccountManagement.RejectedBy = tbl_rejectedBy.Id
					AND (tbl_tempAccountManagement.RejectedBy IS NOT NULL OR tbl_tempAccountManagement.RejectedBy <> 0 )
					LEFT JOIN [dbo].[Tbl_User] tbl_createdBy ON tbl_tempAccountManagement.CreatedBy = tbl_createdBy.Id
					WHERE (tbl_tempAccountManagement.IsDelete <> 1 OR tbl_tempAccountManagement.IsDelete IS NULL)
					AND (tbl_tempAccountManagement.IsApproved <> 1) 
				'
	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		
		SET @conditions = @conditions +' AND (
								@searchPrefix IS NULL 
								OR tbl_tempAccountManagement.TransactionId LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
								OR tbl_tempAccountManagement.Description LIKE ''%'+@searchPrefix+'%''  
								OR CONVERT(NVARCHAR(50),tbl_tempAccountManagement.Vat)  LIKE ''%'+@searchPrefix+'%''
								OR CONVERT(NVARCHAR(50),tbl_tempAccountManagement.VatAmount)  LIKE ''%'+@searchPrefix+'%''
								OR CONVERT(NVARCHAR(50),tbl_tempAccountManagement.GrandTotal)  LIKE ''%'+@searchPrefix+'%''
								OR tbl_approvedBy.FirstName +'' ''+ tbl_approvedBy.LastName LIKE ''%'+@searchPrefix+'%''
								OR tbl_createdBy.FirstName +'' ''+ tbl_createdBy.LastName LIKE ''%'+@searchPrefix+'%''
								OR tbl_rejectedBy.FirstName +'' ''+ tbl_rejectedBy.LastName LIKE ''%'+@searchPrefix+'%''  
							)'
	END

	SET @groupByClause = N'GROUP BY tbl_tempAccountManagement.Id,tbl_tempAccountManagement.CompanyId,tbl_tempAccountManagement.TransactionId,tbl_tempAccountManagement.TransactionIdNo,
	tbl_tempAccountManagement.Description,tbl_tempAccountManagement.Amount,tbl_tempAccountManagement.Quantity,tbl_tempAccountManagement.TotalAmount,
	tbl_tempAccountManagement.Vat,tbl_tempAccountManagement.VatAmount,tbl_tempAccountManagement.GrandTotal,tbl_tempAccountManagement.EntryType,
	tbl_tempAccountManagement.PaymentMode,tbl_tempAccountManagement.TransactionDate,tbl_tempAccountManagement.IsApproved,tbl_approvedBy.FirstName,
	tbl_approvedBy.LastName,tbl_tempAccountManagement.ApprovedOnUtc,tbl_tempAccountManagement.IsRejected,
	tbl_rejectedBy.FirstName,tbl_rejectedBy.LastName,tbl_tempAccountManagement.RejectedOnUtc,tbl_company.CompanyName
	'
	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause 

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX)',@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTemporaryAccountManagementLog]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetTemporaryAccountManagementLog
-- Author:			<Yashasvi Sharma>
-- Created date:	24/Aug/2023
-- Description:		Get Temporary Account Management Log
-- USP_Admin_GetTemporaryAccountManagementLog
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTemporaryAccountManagementLog]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_log.Id,0) AS Id,
		ISNULL(tbl_log.TransactionId,'N/A') AS TransactionId,
		ISNULL(CONVERT(NVARCHAR(50),tbl_log.TransactionDate,105),'N/A') AS TransactionDate,
		ISNULL(tbl_log.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_log.Description,'N/A') AS Description,
		ISNULL(tbl_log.EntryType,'N/A') AS EntryType,
		ISNULL(tbl_log.Amount,0) AS Amount,
		ISNULL(tbl_log.Quantity,0) AS Quantity,
		ISNULL(tbl_log.TotalAmount,0) AS TotalAmount,
		ISNULL(tbl_log.Vat,0) AS Vat,
		ISNULL(tbl_log.VatAmount,0) AS VatAmount,
		ISNULL(tbl_log.GrandTotal,0) AS GrandTotal,
		ISNULL(tbl_log.CreatedBy,0) AS CreatedBy,
		ISNULL(tbl_log.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_log.CreatedOn,105),'N/A') AS CreatedOn,
		tbl_log.CreatedOn AS CreatedOnUtc,
		ISNULL(tbl_createdBy.FirstName +' '+tbl_createdBy.LastName +'('+ tbl_createdBy.AccountNumber +')','N/A') AS CreatedByUser,
		ISNULL(tbl_log.ModifyBy,0) AS ModifyBy,
		ISNULL(CONVERT(NVARCHAR(50),tbl_log.ModifyOn,105),'N/A') AS ModifyOn,
		tbl_log.ModifyOn AS ModifyOnUtc,
		ISNULL(tbl_modifyBy.FirstName +' '+tbl_modifyBy.LastName +'('+ tbl_modifyBy.AccountNumber +')','N/A') AS ModifyByUser,
		ISNULL(tbl_log.ApprovedBy,0) AS ApprovedBy,
		ISNULL(CONVERT(NVARCHAR(50),tbl_log.ApprovedOn,105),'N/A') AS ApprovedOn,
		tbl_log.ApprovedOn AS ApprovedOnUtc,
		ISNULL(tbl_approvedBy.FirstName +' '+tbl_approvedBy.LastName +'('+ tbl_approvedBy.AccountNumber +')','N/A') AS ApprovedByUser,
		ISNULL(tbl_log.RejectedBy,0) AS RejectedBy,
		ISNULL(CONVERT(NVARCHAR(50),tbl_log.RejectedOn,105),'N/A') AS RejectedOn,
		tbl_log.RejectedOn AS RejectedOnUtc,
		ISNULL(tbl_rejectedBy.FirstName +' '+tbl_rejectedBy.LastName +'('+ tbl_rejectedBy.AccountNumber +')','N/A') AS RejectedByUser
	FROM [dbo].[Tbl_TemporaryAccountManagementLog] tbl_log
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_log.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_createdBy ON tbl_log.CreatedBy = tbl_createdBy.Id AND (tbl_log.CreatedBy IS NOT NULL)
	LEFT JOIN [dbo].[Tbl_User] tbl_modifyBy ON tbl_log.ModifyBy = tbl_modifyBy.Id AND (tbl_log.ModifyBy IS NOT NULL)
	LEFT JOIN [dbo].[Tbl_User] tbl_approvedBy ON tbl_log.ApprovedBy = tbl_approvedBy.Id AND (tbl_log.ApprovedBy IS NOT NULL)
	LEFT JOIN [dbo].[Tbl_User] tbl_rejectedBy ON tbl_log.RejectedBy = tbl_rejectedBy.Id AND (tbl_log.RejectedBy IS NOT NULL)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTitleOfSupportTicketByTrackingNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetTitleOfSupportTicketByTrackingNumber
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Title of Support Ticket
-- USP_Admin_GetTitleOfSupportTicketByTrackingNumber
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTitleOfSupportTicketByTrackingNumber]
	@trackingNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT TOP(1) 
		Title 
	FROM [dbo].[Tbl_SupportTicket] 
	WHERE TrackingNumber LIKE @trackingNumber
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTrackingNumberById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetTrackingNumberById
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Tracking Number By Id
-- USP_Admin_GetTrackingNumberById
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTrackingNumberById]
	@id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		TrackingNumber 
	FROM [dbo].[Tbl_SupportTicket] WHERE Id = @id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTransactionModificationDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <13-May-2023>
-- Modify By : <>
-- Modify date : <>
-- <USP_Admin_GetTransactionModificationDetailsById>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetTransactionModificationDetailsById]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @username NVARCHAR(MAX) = NULL,@modifyTime NVARCHAR(50) = NULL
	SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) LEFT JOIN 
		[dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
		WHERE tbl_portalExpense.Id = @Id)

	SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK) WHERE Id = @Id)

	SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTransactionNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetTransactionNumber]
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @TransactionId NVARCHAR(50) = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));

			SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
			BEGIN
				SET @TransactionId = (SELECT MAX(TransactionId) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			END
			ELSE
			BEGIN
				SET @TransactionId = (SELECT MAX(TransactionId) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			END
		END
		ELSE
		BEGIN
			SET @TransactionId = (SELECT MAX(TransactionId) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL));

		END
	END
	ELSE
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @TransactionId = (SELECT MAX(TransactionId) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));

		END
		ELSE
		BEGIN
			SET  @TransactionId = 'TRN101';
		END
	END

	SELECT @TransactionId AS TransactionId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetTypeOfAccountByEmail]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <31-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<Use to check Whether entered Company name was already exists or not.>>
-- SP_Admin_CheckExistingEmail N'yashasvi1@thebridgecode.com'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetTypeOfAccountByEmail]
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Email IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WHERE ( EmailID LIKE @Email + '%' OR SecondEmailID LIKE @Email +'%') AND IsDelete<> 1)
		BEGIN
			SELECT 'CompanyAccount' AS [Type]
			FROM [dbo].[Tbl_Company] WITH(NOLOCK)
			WHERE ( EmailID LIKE @Email + '%' OR SecondEmailID LIKE @Email +'%') 
			AND IsDelete<> 1 AND IsActive <> 0
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WHERE EmailID LIKE @Email + '%' AND IsDelete<> 1)
		BEGIN
			SELECT 'User' AS [Type]
			FROM [dbo].[Tbl_User] WITH(NOLOCK)
			WHERE EmailID LIKE @Email + '%' 
			AND IsDelete<> 1
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WHERE EmailId LIKE @Email + '%' AND IsDelete<> 1)
		BEGIN
			SELECT 'SalesPerson' AS [Type]
			FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK)
			WHERE EmailId LIKE @Email + '%' 
			AND IsDelete<> 1
		END
		ELSE 
		BEGIN
			SELECT -1
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserDetailsForPermiaaion]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <06-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <15-Nov-2022>
-- Description:	<<USP_Admin_GetUserDetailsForPermiaaion N'DIBN696'>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetUserDetailsForPermiaaion]
	@AccountNumber NVARCHAR(MAX) = NULL,
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @countOfUser INT =NULL,@CompanyId INT = NULL;
	IF @Email IS NOT NULL AND @AccountNumber IS NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		WHERE tbl_user.EmailID = @Email AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1) 
		BEGIN
			SELECT 
				ISNULL(tbl_user.Id,0) AS Id
			FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
			WHERE tbl_user.EmailID = @Email AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK)
		WHERE (tbl_salesPerson.EmailId = @Email) AND tbl_salesPerson.IsActive <> 0 AND tbl_salesPerson.IsDelete <> 1) 
		BEGIN
			SELECT 
				ISNULL(tbl_salesPerson.Id,0) AS Id
			FROM [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK)
			WHERE (tbl_salesPerson.EmailId = @Email) AND tbl_salesPerson.IsActive <> 0 AND tbl_salesPerson.IsDelete <> 1
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
		WHERE (tbl_RMTeam.EmailAddress = @Email) AND tbl_RMTeam.IsActive <> 0 AND tbl_RMTeam.IsDelete <> 1) 
		BEGIN
			SELECT 
				ISNULL(tbl_RMTeam.Id,0) AS Id
			FROM [dbo].[Tbl_RMTeam] tbl_RMTeam WITH(NOLOCK)
			WHERE (tbl_RMTeam.EmailAddress = @Email) AND tbl_RMTeam.IsActive <> 0 AND tbl_RMTeam.IsDelete <> 1
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
	ELSE IF @AccountNumber IS NOT NULL AND @Email IS NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
					WHERE tbl_user.AccountNumber = @AccountNumber AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1
				)
		BEGIN
			SELECT 
				ISNULL(tbl_user.Id,0) AS Id
			FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
			WHERE tbl_user.AccountNumber = @AccountNumber AND tbl_user.IsActive <> 0 AND tbl_user.IsDelete <> 1
		END
		ELSE
		BEGIN
			SELECT 0 AS Id
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserIdByEmail]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <31-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<Use to check Whether entered Company name was already exists or not.>>
-- SP_Admin_CheckExistingEmail N'yashasvi1@thebridgecode.com'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetUserIdByEmail]
	@Email NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Email IS NOT NULL
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WHERE ( EmailID LIKE @Email + '%' OR SecondEmailID LIKE @Email +'%') AND IsDelete<> 1)
		BEGIN
			SELECT Id As Id,
				CompanyName AS Username
			FROM [dbo].[Tbl_Company] WITH(NOLOCK)
			WHERE ( EmailID LIKE @Email + '%' OR SecondEmailID LIKE @Email +'%') 
			AND IsDelete<> 1 AND IsActive <> 0
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WHERE EmailID LIKE @Email + '%' AND IsDelete<> 1)
		BEGIN
			SELECT Id AS Id,
			FirstName +' '+ LastName AS Username
			FROM [dbo].[Tbl_User] WITH(NOLOCK)
			WHERE EmailID LIKE @Email + '%' 
			AND IsDelete<> 1
		END
		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WHERE EmailId LIKE @Email + '%' AND IsDelete<> 1)
		BEGIN
			SELECT Id AS Id,
			FirstName +' '+ LastName AS Username
			FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK)
			WHERE EmailId LIKE @Email + '%' 
			AND IsDelete<> 1
		END
		ELSE 
		BEGIN
			SELECT -1
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUsernameForServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetUsernameForServiceRequest
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Get Username for Service request response
-- USP_Admin_GetUsernameForServiceRequest
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetUsernameForServiceRequest]
	@userId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(FirstName +' '+ LastName,'N/A')
	FROM [dbo].[Tbl_User] WHERE Id= @userId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserPermissionByUserId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetUserPermissionByUserId>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetUserPermissionByUserId]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_userpermission.UserPermissionId,0) AS UserPermissionId,
		ISNULL(tbl_userpermission.UserId,0) AS UserId,
		ISNULL(tbl_userpermission.ModuleId,0) AS ModuleId,
		ISNULL(tbl_userpermission.PermissionId,0) AS PermissionId,
		ISNULL(tbl_userpermission.IsActive,0) AS IsActive,
		ISNULL(tbl_userpermission.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_userpermission.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(CONVERT(NVARCHAR(50),tbl_userpermission.ModifyOn,105),'N/A') AS ModifyOn
	FROM [dbo].[Tbl_UserPermission] tbl_userpermission WITH(NOLOCK)
	WHERE tbl_userpermission.UserId = @UserId AND tbl_userpermission.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserPermissionCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_GetUserPermissionCount
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Check User Permission Count
-- USP_Admin_GetUserPermissionCount
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetUserPermissionCount]
	@userId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WHERE IsActive <> 0 AND IsDelete <> 1 AND Id =  @userId) 
    BEGIN 
		SELECT Count(*) FROM [dbo].[Tbl_UserPermission] WHERE UserId =  @userId AND IsDelete <> 1 
	END
    ELSE 
	BEGIN 
		SELECT -1 
	END;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserPermissionModuleByUserId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author : <Yashasvi Sharma>
-- Create date: <06-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetUserPermissionModuleByUserId 1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetUserPermissionModuleByUserId]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	SELECT DISTINCT 
		tbl_module.ModuleName AS ModuleName
	FROM [dbo].[Tbl_UserPermission] tbl_userpermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Module] tbl_module WITH(NOLOCK) ON tbl_module.ModuleId = tbl_userpermission.ModuleId
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_userpermission.UserId
	WHERE tbl_user.Id = @UserId AND tbl_userpermission.IsDelete<> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserPermissionNameByUserId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- Create date: <06-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_GetUserPermissionNameByUserId 17,N'MyRequest'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_GetUserPermissionNameByUserId]
	@UserId INT = NULL,
	@Module NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @ModuleId INT = NULL;
	SET @ModuleId = (SELECT ModuleId FROM [dbo].[Tbl_Module] tbl_module WHERE tbl_module.ModuleName = @Module)
	
	SELECT DISTINCT 
		tbl_permission.PermissionName AS PermissionName
	FROM [dbo].[Tbl_UserPermission] tbl_userpermission WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Permission] tbl_permission ON tbl_permission.PermissionId = tbl_userpermission.PermissionId
	LEFT JOIN [dbo].[Tbl_Module] tbl_module ON tbl_module.ModuleId = tbl_userpermission.ModuleId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_userpermission.UserId
	WHERE tbl_userpermission.UserId =@UserId AND tbl_userpermission.IsDelete<> 1 AND tbl_userpermission.ModuleId = @ModuleId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserRole]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetUserRole]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT DISTINCT
		tbl_usermapping.RoleID,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_usermapping ON tbl_user.Id = tbl_usermapping.UserId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_usermapping.RoleID = tbl_role.RoleID
	LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_company_user_mapping.CompanyId 
	WHERE tbl_user.Id = @UserId AND tbl_usermapping.IsDelete <> 1
	GROUP BY tbl_usermapping.RoleID,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_company_user_mapping.CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetUserRoleName]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_GetUserRoleName]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT DISTINCT
		tbl_usermapping.RoleID,tbl_role.RoleName,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_usermapping ON tbl_user.Id = tbl_usermapping.UserId
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_usermapping.RoleID = tbl_role.RoleID
	LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_company_user_mapping.CompanyId 
	WHERE tbl_user.Id = @UserId AND tbl_usermapping.IsDelete <> 1
	GROUP BY tbl_usermapping.RoleID,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_company_user_mapping.CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetWeeklyCompanySubTypeReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get Company's Sub Type weekly report
-- USP_Admin_GetWeeklyCompanySubTypeReport N'Sharjah'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetWeeklyCompanySubTypeReport]
	@subType nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @startingDate date = NULL,@endingDate date = NULL;
	SET @startingDate = (Select CONVERT(date,dateadd(wk, datediff(wk, 0, getdate()), 0)))
	SET @endingDate  = (Select CONVERT(date,dateadd(day,-1,dateadd(wk, datediff(wk, 0, getdate()) + 1, 0))))

	SELECT 
		COUNT(tbl_company.Id) AS TotalCompanies,
		tbl_company.CompanyType AS CompanySubType
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsActive <> 0
	AND tbl_company.IsDelete <> 1
	AND tbl_company.CompanyType = @subType 
	AND (CONVERT(date,tbl_company.CompanySubTypeUpdated) >= @startingDate AND CONVERT(date,tbl_company.CompanySubTypeUpdated) <= @endingDate)
	GROUP BY tbl_company.CompanyType
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_GetYearlyCompanySubTypeReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get Company's Sub Type yearly report
-- USP_Admin_GetYearlyCompanySubTypeReport N'Abu Dhabi'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_GetYearlyCompanySubTypeReport]
	@subType nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDate datetime2(7) = NULL
	SET @currentDate = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

	SELECT 
		COUNT(tbl_company.Id) AS TotalCompanies,
		tbl_company.CompanyType AS CompanySubType
	FROM [dbo].[Tbl_Company] tbl_company
	WHERE tbl_company.IsActive <> 0
	AND tbl_company.IsDelete <> 1
	AND tbl_company.CompanyType = @subType 
	AND YEAR(tbl_company.CompanySubTypeUpdated) = YEAR(@currentDate)
	GROUP BY tbl_company.CompanyType

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Insert_AssignedCompanyRMTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		USP_Admin_Insert_AssignedCompanyRMTeam
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description: save assigned company
-- USP_Admin_Insert_AssignedCompanyRMTeam
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Insert_AssignedCompanyRMTeam]
	@Id int = NULL,
	@CompanyId int = NULL,
	@UserId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam_Company_Mapping] WITH(NOLOCK) WHERE IsDelete <> 1 AND CompanyId = @CompanyId AND RMTeamId = @Id)
	BEGIN
		INSERT INTO [dbo].[Tbl_RMTeam_Company_Mapping](
			RMTeamId,
			CompanyId,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@Id,
			@CompanyId,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Insert_DownloadDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_Insert_DownloadDocument
-- Author:			<Yashasvi Sharma>
-- Created date:	01/Dec/2023
-- Description:		Download Document List
-- USP_Admin_Insert_DownloadDocument 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Insert_DownloadDocument]
	@FileName NVARCHAR(MAX) = NULL,
	@FileExtension NVARCHAR(50) = NULL,
	@EmailAddress NVARCHAR(150) = NULL,
	@ActionMethod NVARCHAR(MAX) = NULL,
	@Controller NVARCHAR(MAX) = NULL,
	@FromDate NVARCHAR(50)= NULL,
	@ToDate NVARCHAR(50) = NULL,
	@Month nchar(50) = NULL,
	@Year nchar(50) = NULL,
	@IsSended BIT = NULL,
	@SendedStatus NVARCHAR(MAX) = NULL,
	@CreatedBy INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_DownloadDocument] WHERE FileName = @FileName )
	BEGIN
		INSERT INTO [dbo].[Tbl_DownloadDocument](
			FileName,
			FileExtension,
			EmailAddress,
			ActionMethod,
			Controller,
			FromDate,
			ToDate,
			[Month],
			[Year],
			CreatedOnUtc,
			CreatedBy,
			[Status]
		)
		VALUES(
			@FileName,
			@FileExtension,
			@EmailAddress,
			@ActionMethod,
			@Controller,
			@FromDate,
			@ToDate,
			@Month,
			@Year,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			@CreatedBy,
			@SendedStatus
		)
	END
	ELSE
	BEGIN
		UPDATE [dbo].[Tbl_DownloadDocument] 
		SET
			IsSended = @IsSended,
			[Status] = @SendedStatus,
			SendedOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE FileName = @FileName
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Insert_Update_Company]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		USP_Admin_Insert_Update_Company
-- Create date: <29-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get users
-- USP_Admin_Insert_Update_Company 'c'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Insert_Update_Company]
	@Id int = NULL,
	@CompanyType nvarchar(max) = NULL,
	@CompanyCode nvarchar(max) = NULL,
	@OwnerId int =NULL,
	@OwnerName nvarchar(max) = NULL,
	@CompanyName nvarchar(max) = NULL,
	@MobileCountry nvarchar(max) = NULL,
	@MobileNumber nvarchar(max) = NULL,
	@EmailAddress nvarchar(max) = NULL,
	@CompanyCreationDate nvarchar(50) = NULL,
	@City nvarchar(max) = NULL,
	@Country nvarchar(max) = NULL,
	@IsTRNNumber bit = NULL,
	@TRNNumber nvarchar(max) = NULL,
	@TRNCreation nvarchar(50) = NULL,
	@IsCorporateText bit = NULL,
	@CorporateText nvarchar(max) = NULL,
	@IsActive bit = NULL,
	@UserId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Id IS NULL OR @Id = 0
	BEGIN
		INSERT INTO [dbo].[Tbl_Company](
			CompanyType,
			AccountNumber,
			CompanyName,
			MCountryCode,
			MobileNumber,
			EmailID,
			CompanyStartingDate,
			City,
			Country,
			IsTRN,
			TRN,
			TRNCreationDate,
			IsCorportaeText,
			CorporateText,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOn
		)
		VALUES(
			@CompanyType,
			@CompanyCode,
			@CompanyName,
			@MobileCountry,
			@MobileNumber,
			@EmailAddress,
			@CompanyCreationDate,
			@City,
			@Country,
			@IsTRNNumber,
			@TRNNumber,
			@TRNCreation,
			@IsCorporateText,
			@CorporateText,
			@IsActive,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @Id = (SELECT CONVERT(int,SCOPE_IDENTITY()))

		IF @OwnerId IS NULL
			SET @OwnerId = 0

		IF @OwnerId = 0 AND @OwnerName IS NOT NULL AND @OwnerName <> ''
		BEGIN
			DECLARE @ownerRoleId int = NULL
			DECLARE @clientNewCode nvarchar(max) = NULL,@clientCode nvarchar(max) = NULL,
			@intNumber int = NULL,@latestClientCode nvarchar(max) = NULL,@zeroText nvarchar(100) = NULL,@existsText nvarchar(100) = NULL

			SET @zeroText = (
							SELECT TOP (1) SUBSTRING(AccountNumber, CHARINDEX('0', AccountNumber)-1, LEN(AccountNumber)) 
							FROM [dbo].[Tbl_User]  WITH(NOLOCK)
							WHERE (IsDelete <> 1 OR IsDelete IS NULL)
							ORDER BY Id DESC
						)

			SET @existsText = (SELECT replace(@zeroText, '0', ''))

			IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WHERE (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				SET @latestClientCode = (
											SELECT TOP (1) AccountNumber
											FROM [dbo].[Tbl_User]  WITH(NOLOCK)
											WHERE (IsDelete <> 1 OR IsDelete IS NULL)
											ORDER BY Id DESC
										)
				SET @clientCode = (
										SELECT TOP (1) SUBSTRING(AccountNumber, PATINDEX('%[0-9]%', AccountNumber), LEN(AccountNumber)) 
										FROM [dbo].[Tbl_User]  WITH(NOLOCK)
										WHERE (IsDelete <> 1 OR IsDelete IS NULL)
										ORDER BY Id DESC
									)

				SET @existsText = (SELECT replace(@clientCode, SUBSTRING(@clientCode, PATINDEX('%[1-9]%', @clientCode), LEN(@clientCode)), ''))

				SET @intNumber = (
									SELECT TOP (1) PATINDEX('%[^A-Za-z]%', AccountNumber)
									FROM [dbo].[Tbl_User]  WITH(NOLOCK)
									WHERE (IsDelete <> 1 OR IsDelete IS NULL)
									ORDER BY Id DESC
								)

				SET @clientCode = CONVERT(int,@clientCode) + 1

				WHILE(@intNumber >0)
				BEGIN
					SET @latestClientCode = STUFF(@latestClientCode, @intNumber, 1, '' )    
					SET @intNumber = PATINDEX('%[^A-Za-z]%', @latestClientCode)    
				END
				IF @existsText IS NOT NULL AND @existsText <> ''
				BEGIN
					SET @clientNewCode = @latestClientCode +  CONVERT(nvarchar(100),@existsText) +  CONVERT(nvarchar(100),@clientCode)
				END
				ELSE
				BEGIN
					SET @clientNewCode = @latestClientCode + CONVERT(nvarchar(100),@clientCode)
				END
			END
			ELSE
			BEGIN
				SET @clientNewCode = 'DIBN101'
			END
			SET @ownerRoleId = (SELECT tbl_role.RoleID FROM [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) WHERE tbl_role.RoleName = 'Company Owner' AND tbl_role.IsDelete <> 1)

			INSERT INTO [dbo].[Tbl_User]
			(
				FirstName,
				AccountNumber,
				IsActive,
				IsDelete,
				CreatedBy,
				CreatedOnUTC
			)
			VALUES(
				@OwnerName,
				@clientNewCode,
				1,
				0,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)

			SET @OwnerId = (SELECT MAX(Id) FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE IsDelete <> 1)

			INSERT INTO [dbo].[Tbl_User_Role_Mapping](
				RoleID,
				UserId,
				CreatedBy,
				CreatedOnUtc
			)
			VALUES(
				@ownerRoleId,
				@OwnerId,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		END

		INSERT INTO [dbo].[Tbl_Company_User_Mapping](
			CompanyId,
			UserId,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@Id,
			@OwnerId,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		IF @CompanyType IS NOT NULL AND @CompanyType NOT LIKE ''
		BEGIN
			UPDATE [dbo].[Tbl_Company]
			SET 
				CompanySubTypeUpdated = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @Id
		END

		SELECT @Id AS Id
	END
	ELSE IF @Id IS NOT NULL AND @Id <> 0
	BEGIN
		DECLARE @previousOwnerId int = NULL
		
		IF EXISTS(SELECT TOP 1 Id FROM [dbo].[Tbl_Company_User_Mapping] WITH(NOLOCK) WHERE CompanyId = @Id AND UserId = 0 AND IsDelete <> 1)
		BEGIN
			SET @previousOwnerId = (SELECT TOP 1 UserId FROM [dbo].[Tbl_Company_User_Mapping] WITH(NOLOCK) WHERE CompanyId = @Id AND UserId = 0 AND IsDelete <> 1)
		END
		ELSE
		BEGIN
			SET @previousOwnerId = (SELECT TOP 1 UserId FROM [dbo].[Tbl_Company_User_Mapping] WITH(NOLOCK) WHERE CompanyId = @Id AND IsDelete <> 1)
		END

		UPDATE [dbo].[Tbl_Company]
		SET 
			CompanyType = @CompanyType,
			AccountNumber = @CompanyCode,
			CompanyName = @CompanyName,
			MCountryCode = @MobileCountry,
			MobileNumber = @MobileNumber,
			EmailID = @EmailAddress,
			CompanyStartingDate = @CompanyCreationDate,
			City = @City,
			Country = @Country,
			IsTRN = @IsTRNNumber,
			TRN = @TRNNumber,
			TRNCreationDate = @TRNCreation,
			IsCorportaeText = @IsCorporateText,
			CorporateText = @CorporateText,
			IsActive = @IsActive,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		IF @OwnerId IS NULL
				SET @OwnerId = 0

		IF @OwnerId = 0 AND @OwnerName IS NOT NULL AND @OwnerName <> ''
		BEGIN
			SET @zeroText = (
							SELECT TOP (1) SUBSTRING(AccountNumber, CHARINDEX('0', AccountNumber)-1, LEN(AccountNumber)) 
							FROM [dbo].[Tbl_User]  WITH(NOLOCK)
							WHERE (IsDelete <> 1 OR IsDelete IS NULL)
							ORDER BY Id DESC
						)

			SET @existsText = (SELECT replace(@zeroText, '0', ''))

			IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WHERE (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				SET @latestClientCode = (
											SELECT TOP (1) AccountNumber
											FROM [dbo].[Tbl_User]  WITH(NOLOCK)
											WHERE (IsDelete <> 1 OR IsDelete IS NULL)
											ORDER BY Id DESC
										)
				SET @clientCode = (
										SELECT TOP (1) SUBSTRING(AccountNumber, PATINDEX('%[0-9]%', AccountNumber), LEN(AccountNumber)) 
										FROM [dbo].[Tbl_User]  WITH(NOLOCK)
										WHERE (IsDelete <> 1 OR IsDelete IS NULL)
										ORDER BY Id DESC
									)

				SET @existsText = (SELECT replace(@clientCode, SUBSTRING(@clientCode, PATINDEX('%[1-9]%', @clientCode), LEN(@clientCode)), ''))

				SET @intNumber = (
									SELECT TOP (1) PATINDEX('%[^A-Za-z]%', AccountNumber)
									FROM [dbo].[Tbl_User]  WITH(NOLOCK)
									WHERE (IsDelete <> 1 OR IsDelete IS NULL)
									ORDER BY Id DESC
								)

				SET @clientCode = CONVERT(int,@clientCode) + 1

				WHILE(@intNumber >0)
				BEGIN
					SET @latestClientCode = STUFF(@latestClientCode, @intNumber, 1, '' )    
					SET @intNumber = PATINDEX('%[^A-Za-z]%', @latestClientCode)    
				END
				IF @existsText IS NOT NULL AND @existsText <> ''
				BEGIN
					SET @clientNewCode = @latestClientCode +  CONVERT(nvarchar(100),@existsText) +  CONVERT(nvarchar(100),@clientCode)
				END
				ELSE
				BEGIN
					SET @clientNewCode = @latestClientCode + CONVERT(nvarchar(100),@clientCode)
				END
			END
			ELSE
			BEGIN
				SET @clientNewCode = 'DIBN101'
			END
			SET @ownerRoleId = (SELECT tbl_role.RoleID FROM [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) WHERE tbl_role.RoleName = 'Company Owner' AND tbl_role.IsDelete <> 1)

			INSERT INTO [dbo].[Tbl_User]
			(
				FirstName,
				AccountNumber,
				IsActive,
				IsDelete,
				CreatedBy,
				CreatedOnUTC
			)
			VALUES(
				@OwnerName,
				@clientNewCode,
				1,
				0,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)

			SET @OwnerId = (SELECT MAX(Id) FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE IsDelete <> 1)

			INSERT INTO [dbo].[Tbl_User_Role_Mapping](
				RoleID,
				UserId,
				CreatedBy,
				CreatedOnUtc
			)
			VALUES(
				@ownerRoleId,
				@OwnerId,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		END

		IF @previousOwnerId IS NOT NULL AND @previousOwnerId <> 0
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_Company_User_Mapping] WITH(NOLOCK) WHERE CompanyId = @Id AND UserId = @OwnerId AND IsDelete <> 1)
			BEGIN
				INSERT INTO [dbo].[Tbl_Company_User_Mapping](
					CompanyId,
					UserId,
					CreatedBy,
					CreatedOnUtc
				)
				VALUES(
					@Id,
					@OwnerId,
					@UserId,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				)
			END
		END
		ELSE
		BEGIN
			UPDATE [dbo].[Tbl_Company_User_Mapping]
			SET
				UserId = @OwnerId,
				ModifyBy = @UserId,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE UserId = @previousOwnerId AND CompanyId = @Id
		END

		SELECT @Id AS Id
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Insert_Update_CompanySubType]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_Insert_Update_CompanySubType
-- Author:			<Yashasvi Sharma>
-- Created date:	16/Oct/2024
-- Description:		Insert or update company types
-- USP_Admin_Insert_Update_CompanySubType 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Insert_Update_CompanySubType]
	@Id int = NULL,
	@MainType nvarchar(250) = NULL,
	@SubType nvarchar(250) = NULL,
	@UserId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @previousSubType nvarchar(max) = NULL,@previousMainType nvarchar(max) = NULL

	IF @Id IS NULL OR @Id = 0
	BEGIN
		IF NOT EXISTS(
			SELECT Id FROM [dbo].[Tbl_CompanySubType] tbl_subType WITH(NOLOCK)
			WHERE tbl_subType.SubType = @SubType AND tbl_subType.MainType = @MainType
			AND tbl_subType.IsDelete <> 1
		)
		BEGIN
			INSERT INTO [dbo].[Tbl_CompanySubType](
				MainType,
				SubType,
				IsActive,
				IsDelete,
				CreatedBy,
				CreatedOnUtc
			)
			VALUES(
				@MainType,
				@SubType,
				1,
				0,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)

			SELECT CONVERT(int,SCOPE_IDENTITY()) AS Id
		END
		ELSE
		BEGIN
			SELECT -1
		END
	END
	ELSE IF @Id IS NOT NULL AND @Id <> 0
	BEGIN
		IF NOT EXISTS(
			SELECT Id FROM [dbo].[Tbl_CompanySubType] tbl_subType WITH(NOLOCK)
			WHERE tbl_subType.SubType = @SubType AND tbl_subType.MainType = @MainType
			AND tbl_subType.IsDelete <> 1
			AND tbl_subType.Id <> @Id
		)
		BEGIN
			SET @previousSubType =  (
										SELECT tbl_subType.SubType FROM [dbo].[Tbl_CompanySubType] tbl_subType WITH(NOLOCK)
										WHERE tbl_subType.IsDelete <> 1
										AND tbl_subType.Id = @Id
									)

			SET @previousMainType =  (
										SELECT tbl_subType.MainType FROM [dbo].[Tbl_CompanySubType] tbl_subType WITH(NOLOCK)
										WHERE tbl_subType.IsDelete <> 1
										AND tbl_subType.Id = @Id
									)

			UPDATE [dbo].[Tbl_CompanySubType]
			SET
				MainType = @MainType,
				SubType = @SubType,
				ModifyBy = @UserId,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @Id

			UPDATE [dbo].[Tbl_Company]
			SET
				CompanyType = @MainType,
				SubCompanyType = @SubType,
				ModifyBy = @UserId,
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE CompanyType = @previousMainType AND SubCompanyType = @previousSubType
			AND IsDelete <> 1

			SELECT @Id AS Id
		END
		ELSE
		BEGIN
			SELECT -1 AS Id
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Insert_Update_RmTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<USP_Admin_Insert_Update_RmTeam Sharma>
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	RM Team Add/Update
-- USP_Admin_Insert_Update_RmTeam
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Insert_Update_RmTeam]
	@Id int = NULL,
	@Firstname nvarchar(250) = NULL,
	@Lastname nvarchar(250) = NULL,
	@EmailAddress nvarchar(250) = NULL,
	@MobileCode nvarchar(100) = NULL,
	@MobileNumber nvarchar(50) = NULL,
	@CountryOfResidence nvarchar(max) = NULL,
	@PassportNo nvarchar(100) = NULL,
	@PassportExpiryDate nvarchar(50) = NULL,
	@VisaExpiryDate nvarchar(50) = NULL,
	@Designation nvarchar(max) = NULL,
	@InsuranceCompany nvarchar(max) = NULL,
	@InsuranceExpiryDate nvarchar(50) = NULL,
	@IsLoginAllowed bit = NULL,
	@IsActive bit = NULL,
	@UserId int = NULL,
	@Password nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Id IS NULL OR @Id = 0
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId = @EmailAddress AND IsDelete <> 1)
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WITH(NOLOCK) WHERE EmailAddress = @EmailAddress AND IsDelete <> 1)
			BEGIN
				INSERT INTO [dbo].[Tbl_RMTeam](
					Firstname,
					Lastname,
					EmailAddress,
					Password,
					MobileCode,
					MobileNumber,
					CountryofResidence,
					PassportNumber,
					PassportExpiryDate,
					VisaExpiryDate,
					Designation,
					InsuranceCompany,
					InsuranceExpiryDate,
					IsLoginAllowed,
					IsActive,
					IsDelete,
					CreatedBy,
					CreatedOnUtc
				)
				VALUES(
					@Firstname,
					@Lastname,
					@EmailAddress,
					@Password,
					@MobileCode,
					@MobileNumber,
					@CountryOfResidence,
					@PassportNo,
					@PassportExpiryDate,
					@VisaExpiryDate,
					@Designation,
					@InsuranceCompany,
					@InsuranceExpiryDate,
					@IsLoginAllowed,
					@IsActive,
					0,
					@UserId,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				)

				SELECT CONVERT(int,SCOPE_IDENTITY()) AS Id
			END
			ELSE
			BEGIN
				SELECT -1 AS Id
			END
		END
		ELSE
		BEGIN
			SELECT -1 AS Id
		END
	END
	ELSE IF @Id IS NOT NULL AND @Id <> 0
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId = @EmailAddress AND IsDelete <> 1)
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WITH(NOLOCK) WHERE EmailAddress = @EmailAddress AND Id <> @Id AND IsDelete <> 1)
			BEGIN
				UPDATE [dbo].[Tbl_RMTeam]
				SET
					Firstname = @Firstname,
					Lastname = @Lastname,
					EmailAddress = @EmailAddress,
					Password = @Password,
					MobileCode = @MobileCode,
					MobileNumber = @MobileNumber,
					CountryofResidence = @CountryOfResidence,
					PassportNumber = @PassportNo,
					PassportExpiryDate = @PassportExpiryDate,
					VisaExpiryDate = @VisaExpiryDate,
					Designation = @Designation,
					InsuranceCompany = @InsuranceCompany,
					InsuranceExpiryDate = @InsuranceExpiryDate,
					IsLoginAllowed = @IsLoginAllowed,
					IsActive = @IsActive,
					ModifyBy = @UserId,
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @Id

				SELECT @Id AS Id
			END
		END
		ELSE
		BEGIN
			SELECT -1 AS Id
		END
	END
	ELSE
	BEGIN
		SELECT -1 AS Id
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Insert_Update_Temp_AccountManagement]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_Insert_Update_Temp_AccountManagement
-- Author:			<Yashasvi Sharma>
-- Created date:	08/Aug/2023
-- Description:		Insert or Update Data in Temporary stored Account Managment
-- USP_Admin_Insert_Update_Temp_AccountManagement 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Insert_Update_Temp_AccountManagement]
	@Id INT = NULL,
	@CompanyId INT = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@Amount DECIMAL(18,2) = NULL,
	@Quantity INT = NULL,
	@TotalAmount DECIMAL(18,2) = NULL,
	@Vat DECIMAL(18,2) = NULL,
	@VatAmount DECIMAL(18,2) = NULL,
	@GrandTotal DECIMAL(18,2) = NULL,
	@EntryType NVARCHAR(50) = NULL,
	@PaymentMode NVARCHAR(50) = NULL,
	@TransactionDate NVARCHAR(50) = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @TransactionId NVARCHAR(50) = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;

	IF @Id IS NULL OR @Id = 0
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_TempAccountManagement] WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @TransactionId = (SELECT MAX(SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))) 
								FROM [dbo].[Tbl_TempAccountManagement]);
			SET @TransactionId = @TransactionId + 1
			SET  @TransactionCode ='TempTRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
		ELSE
		BEGIN
			SET  @TransactionCode = 'TempTRN101';
		END

		INSERT INTO [dbo].[Tbl_TempAccountManagement](
			CompanyId,
			TransactionId,
			TransactionIdNo,
			Description,
			Amount,
			Quantity,
			TotalAmount,
			Vat,
			VatAmount,
			GrandTotal,
			EntryType,
			PaymentMode,
			TransactionDate,
			IsDelete,
			CreatedBy,
			CreatedOnUtc,
			IsApproved
		)
		VALUES(
			@CompanyId,
			@TransactionCode,
			@TransactionId,
			@Description,
			@Amount,
			@Quantity,
			@TotalAmount,
			@Vat,
			@VatAmount,
			@GrandTotal,
			@EntryType,
			@PaymentMode,
			@TransactionDate,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			0
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_TempAccountManagement])

		SELECT @returnId
	END
	ELSE
	BEGIN
		UPDATE [dbo].[Tbl_TempAccountManagement]
		SET 
			CompanyId = @CompanyId,
			Description = @Description,
			Amount = @Amount,
			Quantity = @Quantity,
			TotalAmount = @TotalAmount,
			Vat = @Vat,
			VatAmount = @VatAmount,
			GrandTotal = @GrandTotal,
			EntryType = @EntryType,
			PaymentMode = @PaymentMode,
			TransactionDate = @TransactionDate,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		SET @returnId = @Id

		SELECT @returnId
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_MarkAsReadServiceNotification]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_MarkAsReadServiceNotification
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Set Mark as read for service request notification
-- USP_Admin_MarkAsReadServiceNotification 
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_MarkAsReadServiceNotification]
	@UserId INT = NULL,
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	Update [dbo].[Tbl_AssignServiceRequest] 
	SET 
		MarkAsRead = 1 
	WHERE UserId = @UserId
	AND SerialNumber LIKE @SerialNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_PaymentTransectionOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <25-11-2022>
-- <USP_Admin_PaymentTransectionOperation>
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_PaymentTransectionOperation]
	@Id INT = NULL,
	@UserId INT = NULL,
	@CompanyId INT = NULL,
	@TransactionNumber NVARCHAR(50) = NULL,
	@CurrentAmount NVARCHAR(50) = NULL,
	@PortalAmount NVARCHAR(50) = NULL,
	@PaymentMode NVARCHAR(50) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@PaymentStatus NVARCHAR(50) = NULL,
	@TotalAmount NVARCHAR(50) = NULL,
	@Quantity INT = NULL,
	@CreatedOn NVARCHAR(50) = NULL,
	@PaymentReceiptId INT = NULL,
	@Through NVARCHAR(MAX) = NULL,
	@Status INT = NULL,
	@CreatedOnUTC NVARCHAR(50) = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;
	DECLARE @Amount NVARCHAR(50) = NULL,@ChangeAmount NVARCHAR(50)=NULL,@PortalId INT = NULL,@NewBalance decimal(18,2) = NULL;
	DECLARE @username NVARCHAR(MAX) = NULL,@modifyTime NVARCHAR(MAX) = NULL
	DECLARE @returnResult INT = NULL,@currentTransactionId NVARCHAR(MAX) = NULL
	IF @Status = 1 AND @Id IS NULL
	BEGIN	
		DECLARE @TransactionId INT = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
			BEGIN
				SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));

				SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
									FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
				IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
				BEGIN
					SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
					SET @TransactionId = @TransactionId + 1
					SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
				END
				ELSE
				BEGIN
					SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
									FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
					SET @TransactionId = @TransactionId + 1
					SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
				END
			END
			ELSE
			BEGIN
				SET @TransactionId = (SELECT MAX(SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))) 
									FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
		END
		ELSE
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
			ELSE
			BEGIN
				SET  @TransactionCode = 'TRN101';
			END
		END
		IF @CreatedOn IS NULL
		BEGIN
			SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
		END
		IF @TransactionNumber IS NULL
		BEGIN
			INSERT INTO [dbo].[Tbl_PaymentTransection](
				UserId,
				CompanyId,
				TransactionId,
				Amount,
				PaymentMode,
				Description,
				PaymentStatus,
				Quantity,
				TotalAmount,
				TransectionDate,
				CreatedBy,
				CreatedOnUtc
			)
			VALUES(
				@UserId,
				@CompanyId,
				@TransactionCode,
				@CurrentAmount,
				@PaymentMode,
				@Description,
				@PaymentStatus,
				@Quantity,
				@TotalAmount,
				@CreatedOn,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)

			SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK))
		END
		ELSE
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE TransactionId = @TransactionNumber AND (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE TransactionId = @TransactionNumber AND (IsDelete <> 1 OR IsDelete IS NULL))
				BEGIN
					INSERT INTO [dbo].[Tbl_PaymentTransection](
						UserId,
						CompanyId,
						TransactionId,
						Amount,
						PaymentMode,
						Description,
						PaymentStatus,
						Quantity,
						TotalAmount,
						TransectionDate,
						CreatedBy,
						CreatedOnUtc
					)
					VALUES(
						@UserId,
						@CompanyId,
						@TransactionNumber,
						@CurrentAmount,
						@PaymentMode,
						@Description,
						@PaymentStatus,
						@Quantity,
						@TotalAmount,
						@CreatedOn,
						@UserId,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					)

					SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK))
				END
				ELSE
				BEGIN
					SET @returnId = -1
				END
			END
			ELSE
			BEGIN
				SET @returnId = -1
			END
		END

		SELECT @returnId
	END
	IF @Status = 1 AND @Id IS NOT NULL
	BEGIN	
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
		BEGIN
			SET @ChangeAmount = (SELECT TOP(1) TotalAmount FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE CompanyId = @CompanyId AND Id = @Id ORDER BY Id DESC)
		
			IF @PaymentMode IS NOT NULL
			BEGIN
				UPDATE [dbo].[Tbl_PaymentTransection]
				SET 
					UserId = @UserId,
					CompanyId = @CompanyId,
					Amount = @PortalAmount,
					PaymentMode = @PaymentMode,
					Description = @Description,
					PaymentStatus = @PaymentStatus,
					Quantity = @Quantity,
					TotalAmount = @TotalAmount,
					TransectionDate = @CreatedOnUTC,
					ModifyBy=@UserId,
					ModifyOnUtc =  SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @Id
			END
			ELSE
			BEGIN
				UPDATE [dbo].[Tbl_PaymentTransection]
				SET 
					UserId = @UserId,
					CompanyId = @CompanyId,
					Amount = @PortalAmount,
					Description = @Description,
					PaymentStatus = @PaymentStatus,
					Quantity = @Quantity,
					TotalAmount = @TotalAmount,
					TransectionDate = @CreatedOnUTC,
					ModifyBy = @UserId,
					ModifyOnUtc =  SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @Id
			END

			UPDATE [dbo].[Tbl_PaymentReceipt]
			SET
				OnAccount = @Description
			WHERE PaymentId = @Id

			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
			BEGIN
				SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId AND IsCompletelyUsed <> 1);
				IF @PortalId > 0
				BEGIN
					SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
					IF CONVERT(decimal(18,2),@TotalAmount) > CONVERT(decimal(18,2),@ChangeAmount)
					BEGIN
						SET @NewBalance = CONVERT(decimal(18,2),@TotalAmount) - CONVERT(decimal(18,2),@ChangeAmount)

						SET @NewBalance = CONVERT(decimal(18,2),@Amount) + CONVERT(decimal(18,2),@NewBalance)

						UPDATE [dbo].[Tbl_PortalBalance]
						SET
							BalanceAmount = @NewBalance,
							ModifyBy = @UserId,
							ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						WHERE CompanyId = @CompanyId
					END
					ELSE IF CONVERT(decimal(18,2),@TotalAmount) < CONVERT(decimal(18,2),@ChangeAmount)
					BEGIN
						SET @NewBalance = CONVERT(decimal(18,2),@ChangeAmount) - CONVERT(decimal(18,2),@TotalAmount)

						SET @NewBalance = CONVERT(decimal(18,2),@Amount) - CONVERT(decimal(18,2),@NewBalance)

						UPDATE [dbo].[Tbl_PortalBalance]
						SET
							BalanceAmount = @NewBalance,
							ModifyBy = @UserId,
							ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						WHERE CompanyId = @CompanyId
					END
				END
			END

			IF @PaymentReceiptId IS NOT NULL AND @PaymentReceiptId <> 0
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
				BEGIN
					UPDATE [dbo].[Tbl_PaymentReceipt]
					SET
						CreatedOn = @CreatedOn,
						Through = @Through,
						OnAccount = @Description,
						ModifyBy = @UserId,
						ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					WHERE Id = @PaymentReceiptId
				END
			END
			SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))

			SET @username = (SELECT FirstName + ' ' + LastName +' (' + AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.Id = @UserId)

			SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK)
			WHERE Id = @Id AND CompanyId = @CompanyId)

			SELECT @username As Username,@modifyTime AS ModifyTime, 1 AS ResponseData,@currentTransactionId AS TransactionId
		END
		ELSE
		BEGIN
			SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)

			SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) LEFT JOIN 
				[dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
				WHERE tbl_portalExpense.Id = @Id AND tbl_portalExpense.CompanyId = @CompanyId)

			SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK)
			WHERE Id = @Id AND CompanyId = @CompanyId)

			SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData,@currentTransactionId AS TransactionId
		END
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT 
			ISNULL(tbl_payment.Id,0) AS Id,
			ISNULL(tbl_payment.UserId,0) AS UserId,
			ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') AS Username,
			ISNULL(tbl_payment.CompanyId,0) AS CompanyId,
			ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_payment.Amount,'0.0') AS Amount,
			ISNULL(tbl_payment.Quantity,'1') AS Quantity,
			ISNULL(tbl_payment.TotalAmount,'0.0') AS TotalAmount,
			ISNULL(tbl_payment.PaymentMode,'N/A') AS PaymentMode,
			ISNULL(tbl_payment.Description,'N/A') AS Description,
			ISNULL(tbl_payment.PaymentStatus,'N/A') AS PaymentStatus,
			ISNULL(CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,21),'N/A') AS TransectionDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_payment.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_payment.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_payment.UserId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_payment.CompanyId
		WHERE tbl_payment.CompanyId = @CompanyId AND (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_payment.Id,0) AS Id,
			ISNULL(tbl_payment.UserId,0) AS UserId,
			ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') AS Username,
			ISNULL(tbl_payment.CompanyId,0) AS CompanyId,
			ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_payment.Amount,'0.0') AS Amount,
			ISNULL(tbl_payment.PaymentMode,'N/A') AS PaymentMode,
			ISNULL(tbl_payment.Description,'N/A') AS Description,
			ISNULL(tbl_payment.PaymentStatus,'N/A') AS PaymentStatus,
			ISNULL(tbl_payment.Quantity,'1') AS Quantity,
			ISNULL(tbl_payment.TotalAmount,'0.0') AS TotalAmount,
			ISNULL(CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,21),'N/A') AS TransectionDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_payment.CreatedOnUtc,101),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_payment.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_payment.UserId
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_payment.CompanyId
		WHERE tbl_payment.CompanyId = @CompanyId AND tbl_payment.Id = @Id AND (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL)
	END
	ELSE IF @Status = 4
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
		BEGIN
			DECLARE @CurrentBalance DECIMAL(18,2) = NULL
			SET @CurrentBalance = (SELECT CONVERT(decimal(18,2),TotalAmount) FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
			SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
			BEGIN
				SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
				IF @PortalId >0
				BEGIN
					SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
					IF CONVERT(decimal(18,2),@CurrentBalance) > CONVERT(decimal(18,2),@Amount)
					BEGIN
						SET @NewBalance = CONVERT(decimal(18,2),@Amount) - CONVERT(decimal(18,2),@CurrentBalance);
						UPDATE [dbo].[Tbl_PortalBalance]
						SET
							BalanceAmount = @NewBalance,
							ModifyBy = @UserId,
							ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						WHERE CompanyId = @CompanyId
					END
					ELSE 
					BEGIN
						SET @NewBalance = CONVERT(decimal(18,2),@Amount) - CONVERT(decimal(18,2),@CurrentBalance);
						UPDATE [dbo].[Tbl_PortalBalance]
						SET
							BalanceAmount = @NewBalance,
							ModifyBy = @UserId,
							ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						WHERE CompanyId = @CompanyId
					END
				END
			END

			UPDATE [dbo].[Tbl_PaymentTransection]
			SET 
				IsDelete = 1,
				ModifyBy = @UserId,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @Id

			UPDATE [dbo].[Tbl_PaymentReceipt]
			SET 
				IsDelete = 1,
				ModifyBy = @UserId,
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE PaymentId = @Id

			SET @username = (SELECT FirstName + ' ' + LastName +' (' + AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.Id = @UserId)

			SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK)
			WHERE Id = @Id AND CompanyId = @CompanyId)

			SELECT @username As Username,@modifyTime AS ModifyTime, 1 AS ResponseData,@currentTransactionId AS TransactionId
		END
		ELSE 
		BEGIN
			SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)
			SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) LEFT JOIN 
				[dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
				WHERE tbl_portalExpense.Id = @Id AND tbl_portalExpense.CompanyId = @CompanyId)

			SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PaymentTransection] tbl_portalExpense WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)

			SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData,@currentTransactionId AS TransactionId
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_PortalBalanceExpensesOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <27-Jan-2022>
-- Modify By : <Yashasvi Sharma,Yashasvi Sharma>
-- Modify date : <28-Jan-2022,25-11-2022>
-- <USP_Admin_PortalBalanceExpensesOperation>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_PortalBalanceExpensesOperation]
	@Id INT = NULL,
	@CompanyId INT = NULL,
	@ExpensesTitle NVARCHAR(MAX) = NULL,
	@ExpenseAmount NVARCHAR(50) = NULL,
	@Quantity INT = NULL,
	@TotalAmount NVARCHAR(50) = NULL,
	@RemainingPortalBalance NVARCHAR(50) = NULL,
	@UserId INT = NULL,
	@Vat NVARCHAR(10) = NULL,
	@VatAmount NVARCHAR(50) = NULL,
	@GrandTotal NVARCHAR(50) = NULL,
	@CreatedOnUtc NVARCHAR(50) = NULL,
	@CreatedOnDate NVARCHAR(50) = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @Amount NVARCHAR(50) = NULL,@ChangeAmount NVARCHAR(50)=NULL,@PortalId INT = NULL;

	IF @CreatedOnUtc IS NULL
	BEGIN
		SET @CreatedOnUtc = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	END
	IF @Status = 1 AND @Id IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
			CompanyId,
			ExpensesTitle,
			ExpensesAmount,
			Quantity,
			TotalAmount,
			Vat,
			VatAmount,
			GrandTotal,
			IsDelete,
			CreatedBy,												-- To Store By Which User this Expense is Added				Yashasvi [TBC] (25-11-2022)
			CreatedOnUtc
		)
		VALUES(
			@CompanyId,
			@ExpensesTitle,
			@ExpenseAmount,
			@Quantity,
			@TotalAmount,
			@Vat,
			@VatAmount,
			@GrandTotal,
			0,
			@UserId,
			@CreatedOnUtc
		)

		IF @CompanyId IS NOT NULL
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
			BEGIN
				SET @PortalId = (SELECT Top(1) Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId ORDER BY Id DESC);
				SET @Amount = (SELECT Top(1) BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId ORDER BY Id DESC);
				
				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @RemainingPortalBalance,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId
			END
			ELSE
			BEGIN
				INSERT INTO [dbo].[Tbl_PortalBalance](
					UserId,
					CompanyId,
					BalanceAmount,
					CreatedBy,
					CreatedOnUtc,
					IsCompletelyUsed
				)
				VALUES(
					@UserId,
					@CompanyId,
					@RemainingPortalBalance,
					@UserId,							-- To Store By Which User this Expense is Added				Yashasvi [TBC] (25-11-2022)
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
					0
				)
			END
		END

		SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	END
	ELSE IF @Status = 1 AND @Id IS NOT NULL
	BEGIN
		SET @Amount = (SELECT TotalAmount FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE CompanyId = @CompanyId AND Id = @Id);
		SET @ChangeAmount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
		DECLARE @Diff NVARCHAR(50) = NULL;
		IF  CONVERT(DECIMAL(18,2),@Amount) >  CONVERT(DECIMAL(18,2),@GrandTotal)
		BEGIN
			SET @Diff = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
		END
		ELSE 
		BEGIN
			SET @Diff =CONVERT(DECIMAL(18,2),@GrandTotal) - CONVERT(DECIMAL(18,2),@Amount);
		END
		IF CONVERT(DECIMAL(18,2),@Amount) > CONVERT(DECIMAL(18,2),@GrandTotal) AND CONVERT(DECIMAL(18,2),@Amount) <> CONVERT(DECIMAL(18,2),@GrandTotal)
		BEGIN
			
			IF CONVERT(DECIMAL(18,2),@ChangeAmount) < 0
			BEGIN
				SET @Amount = CONVERT(DECIMAL(18,2),@ChangeAmount)- CONVERT(DECIMAL(18,2),@Diff);
				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @Amount,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId
			END
			ELSE
			BEGIN
				SET @Amount = CONVERT(DECIMAL(18,2),@ChangeAmount) + CONVERT(DECIMAL(18,2),@Diff);
				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @Amount,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId
			END

			UPDATE [dbo].[Tbl_PortalBalanceExpenses]
			SET
				CompanyId = @CompanyId,
				ExpensesTitle = @ExpensesTitle,
				ExpensesAmount = @ExpenseAmount,
				Quantity = @Quantity,
				TotalAmount = @TotalAmount,
				Vat = @Vat,
				VatAmount = @VatAmount,
				GrandTotal = @GrandTotal,
				CreatedOnUtc = @CreatedOnDate,
				ModifyBy = @UserId,
				ModifyOnUtc= SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @Id
		END
		ELSE 
		IF CONVERT(DECIMAL(18,2),@Amount) < CONVERT(DECIMAL(18,2),@GrandTotal) AND CONVERT(DECIMAL(18,2),@Amount) <> CONVERT(DECIMAL(18,2),@GrandTotal)
		BEGIN

			IF CONVERT(DECIMAL(18,2),@ChangeAmount) < 0
			BEGIN
				SET @Amount = CONVERT(DECIMAL(18,2),@ChangeAmount)- CONVERT(DECIMAL(18,2),@Diff);
				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @Amount,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId
			END
			ELSE
			BEGIN
				SET @Amount = CONVERT(DECIMAL(18,2),@ChangeAmount) - CONVERT(DECIMAL(18,2),@Diff);
				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @Amount,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId
			END

			UPDATE [dbo].[Tbl_PortalBalanceExpenses]
			SET
				CompanyId = @CompanyId,
				ExpensesTitle = @ExpensesTitle,
				ExpensesAmount = @ExpenseAmount,
				Quantity = @Quantity,
				TotalAmount = @TotalAmount,
				Vat = @Vat,
				VatAmount = @VatAmount,
				GrandTotal = @GrandTotal,
				ModifyBy = @UserId,
				ModifyOnUtc= SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @Id
		END
		ELSE
		BEGIN
			UPDATE [dbo].[Tbl_PortalBalanceExpenses]
			SET
				CompanyId = @CompanyId,
				ExpensesTitle = @ExpensesTitle,
				ExpensesAmount = @ExpenseAmount,
				Quantity = @Quantity,
				TotalAmount = @TotalAmount,
				Vat = @Vat,
				VatAmount = @VatAmount,
				GrandTotal = @GrandTotal,
				CreatedOnUtc = @CreatedOnDate,
				ModifyBy = @UserId,
				ModifyOnUtc= SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @Id
		END
		SELECT @Id
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_expenses.Id,0) AS Id,
			ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
			ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
			ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
			ISNULL(tbl_expenses.Quantity,0) AS Quantity,
			ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
			ISNULL(tbl_expenses.Vat,'0') AS Vat,
			ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
			ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
			ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL(tbl_expense_receipt.Id,0) AS ExpenseReceiptId
		FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
		WHERE tbl_expenses.CompanyId = @CompanyId AND tbl_expenses.IsDelete <> 1

	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_expenses.Id,0) AS Id,
			ISNULL(tbl_expenses.CompanyId,0) AS CompanyId,
			ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS ExpensesTitle,
			ISNULL(tbl_expenses.ExpensesAmount,'N/A') AS ExpensesAmount,
			ISNULL(tbl_expenses.Quantity,0) AS Quantity,
			ISNULL(tbl_expenses.TotalAmount,'0') AS TotalAmount,
			ISNULL(tbl_expenses.Vat,'0') AS Vat,
			ISNULL(tbl_expenses.VatAmount,'0') AS VatAmount,
			ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
			ISNULL(tbl_expenses.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL(tbl_expense_receipt.Id,0) AS ExpenseReceiptId
		FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
		WHERE tbl_expenses.CompanyId = @CompanyId AND tbl_expenses.Id = @Id AND tbl_expenses.IsDelete <> 1
	END
	ELSE IF @Status = 4
	BEGIN
		DECLARE @username NVARCHAR(MAX) = NULL,@modifyTime NVARCHAR(MAX) = NULL,@currentBalance DECIMAL(18,2) = NULL,@currentTransactionId NVARCHAR(MAX) = NULL
		SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);

		IF @PortalId > 0
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
				SET @currentBalance = (SELECT CONVERT(decimal(18,2),GrandTotal) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) 
				WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))

				SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
				IF CONVERT(DECIMAL(18,2),@currentBalance) < 0
				BEGIN
					SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@currentBalance);
				END
				ELSE
				BEGIN
					SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@currentBalance);
				END

				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @ChangeAmount,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId

				UPDATE [dbo].[Tbl_PortalBalanceExpenses]
				SET
					IsDelete = 1,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @Id

				UPDATE [dbo].[Tbl_Expense_Receipt]
				SET
					IsDelete = 1,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE RecieptId = @Id

				SET @username = (SELECT FirstName + ' ' + LastName +' (' + AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.Id = @UserId)

				SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK)
				WHERE Id = @Id AND CompanyId = @CompanyId)

				SELECT @username As Username,@modifyTime AS ModifyTime, 1 AS ResponseData,@currentTransactionId AS TransactionId
			END
			ELSE 
			BEGIN
				SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)
				SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
					WHERE tbl_portalExpense.Id = @Id AND tbl_portalExpense.CompanyId = @CompanyId)

				SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)

				SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData,@currentTransactionId AS TransactionId
			END
		END
		ELSE 
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND IsDelete <> 1 AND (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
				SET @currentBalance = (SELECT CONVERT(decimal(18,2),GrandTotal) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
				WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))
				SET @PortalId = (SELECT Top(1) Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId ORDER BY Id DESC);
				SET @Amount = (SELECT Top(1) BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId ORDER BY Id DESC);
				IF CONVERT(DECIMAL(18,2),@currentBalance) < 0
				BEGIN
					SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@currentBalance);
				END
				ELSE
				BEGIN
					SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@currentBalance);
				END
				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @ChangeAmount,
					IsCompletelyUsed = 0,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId

				UPDATE [dbo].[Tbl_PortalBalanceExpenses]
				SET
					IsDelete = 1,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @Id

				UPDATE [dbo].[Tbl_Expense_Receipt]
				SET
					IsDelete = 1,
					ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE RecieptId = @Id

				SET @username = (SELECT FirstName + ' ' + LastName +' (' + AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.Id = @UserId)

				SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK)
				WHERE Id = @Id AND CompanyId = @CompanyId)

				SELECT @username As Username,@modifyTime AS ModifyTime, 1 AS ResponseData,@currentTransactionId AS TransactionId
			END
			ELSE 
			BEGIN
				SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)
				SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) LEFT JOIN 
					[dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
					WHERE tbl_portalExpense.Id = @Id AND tbl_portalExpense.CompanyId = @CompanyId)

				SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK)
				WHERE Id = @Id AND CompanyId = @CompanyId)

				SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData,@currentTransactionId AS TransactionId
			END
		END
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_PortalBalanceOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <27-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_PortalBalanceOperation>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_PortalBalanceOperation]
	@Id INT = NULL,
	@UserId INT = NULL,
	@CompanyId INT = NULL,
	@PortalAmount NVARCHAR(50) = NULL,
	@IsCompletelyUsed BIT = NULL,
	@Status INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @PortalId INT = NULL, @Amount DECIMAL(18,2) = NULL;
	DECLARE @RemainingPortalBalance NVARCHAR(MAX) = null;


	IF @Status = 1 AND @Id IS NULL
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
		BEGIN
			INSERT INTO [dbo].[Tbl_PortalBalance](
				UserId,
				CompanyId,
				BalanceAmount,
				CreatedOnUtc,
				IsCompletelyUsed
			)
			VALUES(
				@UserId,
				@CompanyId,
				@PortalAmount,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				@IsCompletelyUsed
			)

			SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK)
		END
		ELSE
		BEGIN
			SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
			SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
			SET @Amount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@PortalAmount);

			UPDATE [dbo].[Tbl_PortalBalance]
			SET
				BalanceAmount = @Amount,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @PortalId

			SELECT @PortalId
		END
	END
	ELSE IF @Status = 1 AND @Id IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_PortalBalance]
		SET
			UserId = @UserId,
			CompanyId = @CompanyId,
			BalanceAmount = @PortalAmount,
			ModifyOnUtc= SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			IsCompletelyUsed = @IsCompletelyUsed
		WHERE Id = @Id
	END
	ELSE IF @Status = 2
	BEGIN
		SET @RemainingPortalBalance = (SELECT SUM(CONVERT(DECIMAL(18,2),GrandTotal)) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE CompanyId=@CompanyId AND IsDelete <> 1);
		SELECT 
			ISNULL(tbl_portalbalance.Id,0) AS Id,
			ISNULL(tbl_portalbalance.UserId,0) AS UserId,
			ISNULL(tbl_portalbalance.CompanyId,0) AS CompanyId,
			ISNULL(tbl_portalbalance.BalanceAmount,0) AS PortalAmount,
			ISNULL(@RemainingPortalBalance,'0.0') AS RemainingPortalBalance,
			ISNULL(CONVERT(NVARCHAR(50),tbl_portalbalance.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_portalbalance.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL(tbl_portalbalance.IsCompletelyUsed,0) AS IsCompletelyUsed
		FROM [dbo].[Tbl_PortalBalance] tbl_portalbalance WITH(NOLOCK)
		WHERE CompanyId = @CompanyId 
	END
	ELSE IF @Status = 3
	BEGIN
		SET @RemainingPortalBalance = (SELECT SUM(CONVERT(DECIMAL(18,2),GrandTotal)) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE CompanyId=@CompanyId);
		SELECT 
			ISNULL(tbl_portalbalance.Id,0) AS Id,
			ISNULL(tbl_portalbalance.UserId,0) AS UserId,
			ISNULL(tbl_portalbalance.CompanyId,0) AS CompanyId,
			ISNULL(tbl_portalbalance.BalanceAmount,0) AS PortalAmount,
			ISNULL(@RemainingPortalBalance,'N/A') AS RemainingPortalBalance,
			ISNULL(CONVERT(NVARCHAR(50),tbl_portalbalance.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_portalbalance.ModifyOnUtc,105),'N/A') AS ModifyOnUtc,
			ISNULL(tbl_portalbalance.IsCompletelyUsed,0) AS IsCompletelyUsed
		FROM [dbo].[Tbl_PortalBalance] tbl_portalbalance WITH(NOLOCK)
		WHERE tbl_portalbalance.Id = @Id AND CompanyId = @CompanyId AND IsCompletelyUsed <> 1
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_PortalBalance]
		SET
			IsCompletelyUsed = @IsCompletelyUsed
		WHERE Id = @Id
	END
	ELSE IF @Status = 5
	BEGIN
		IF @PortalAmount = 0
		BEGIN
			UPDATE [dbo].[Tbl_PortalBalance]
			SET
				BalanceAmount = @PortalAmount,
				IsCompletelyUsed = 1
			WHERE CompanyId = @CompanyId AND IsCompletelyUsed <> 1
		END
		ELSE
		BEGIN
			UPDATE [dbo].[Tbl_PortalBalance]
			SET
				BalanceAmount = @PortalAmount
			WHERE CompanyId = @CompanyId AND IsCompletelyUsed <> 1
		END
		SELECT 1
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyCustomSelectedDateReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	21/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates for specific company.
-- USP_Admin_ProfitLossCompanyCustomSelectedDateReport_ExcelPdf 2,N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_ExcelPdf]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND tbl_payment.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Graph 2,N'2023-04-01',N'2023-06-03'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Graph]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN

	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND tbl_payment.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	21/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates of specific company.
-- USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Pagination 2,N'2022-01-01',N'2023-12-31',60,20,N'JANJAES',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_Pagination]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossCompanyCustomSelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossCompanyCustomSelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossCompanyCustomSelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND tbl_payment.CompanyId = @CompanyId
			AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND tbl_expenses.CompanyId = @CompanyId
			AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@FromDate NVARCHAR(30),@ToDate NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@CompanyId,@FromDate,@ToDate,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossCompanyCustomSelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossCompanyCustomSelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyCustomSelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	21/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates for specific company.
-- USP_Admin_ProfitLossCompanyCustomSelectedDateReport_TotalDetails 2,N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyCustomSelectedDateReport_TotalDetails]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyMonthlyDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ==================================================================
-- SP Name:			USP_Admin_ProfitLossCompanyMonthlyDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report of Month wise.
-- USP_Admin_ProfitLossCompanyMonthlyDateReport_Graph N'06',N'2023'
-- ==================================================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyMonthlyDateReport_Graph]
	@CompanyId INT = NULL,
	@Month NVARCHAR(30) = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND tbl_payment.CompanyId = @CompanyId
	AND (YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year AND MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @Month)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND (YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year AND MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Month)
	ORDER BY TransactionDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyMonthlySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyMonthlySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report weekly selected dates.
-- USP_Admin_ProfitLossCompanyMonthlySelectedDateReport_Pagination 2,N'06',N'2023',0,20,N'',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyMonthlySelectedDateReport_Pagination]
	@CompanyId INT = NULL,
	@monthNumber NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossCompanyMonthlySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossCompanyMonthlySelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossCompanyMonthlySelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @monthNumber AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND tbl_payment.CompanyId = @CompanyId
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND tbl_expenses.CompanyId = @CompanyId
			AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @monthNumber AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@monthNumber NVARCHAR(30),@year NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@CompanyId,@monthNumber,@year,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossCompanyMonthlySelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossCompanyMonthlySelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyMonthlySelectedReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyMonthlySelectedReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report of selected month and year of specific company.
-- USP_Admin_ProfitLossCompanyMonthlySelectedReport_ExcelPdf 2,N'01',N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyMonthlySelectedReport_ExcelPdf]
	@CompanyId INT = NULL,
	@MonthNumber NVARCHAR(30) = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND tbl_payment.CompanyId = @CompanyId
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @MonthNumber AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @MonthNumber AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year)
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (MONTH(CONVERT(date,TransectionDate)) = @MonthNumber AND YEAR(CONVERT(date,TransectionDate)) = @Year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @MonthNumber AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year)
END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyMonthlySelectedReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyMonthlySelectedReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	14/June/2023
-- Description:		Get Profit Loss Report of selected month and year of specific company.
-- USP_Admin_ProfitLossCompanyMonthlySelectedReport_TotalDetails 2,N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyMonthlySelectedReport_TotalDetails]
	@CompanyId INT = NULL,
	@MonthNumber NVARCHAR(30) = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (MONTH(CONVERT(date,TransectionDate)) = @MonthNumber AND YEAR(CONVERT(date,TransectionDate)) = @Year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @MonthNumber AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year)

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyWeeklyDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyWeeklyDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report of weekly dates.
-- USP_Admin_ProfitLossCompanyWeeklyDateReport_Graph N'2023-06-19',N'2023-06-25'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyWeeklyDateReport_Graph]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND tbl_payment.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	21/June/2023
-- Description:		Get Profit Loss Report weekly selected dates of specific company.
-- USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_ExcelPdf 2,N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_ExcelPdf]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND tbl_payment.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) 
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	21/June/2023
-- Description:		Get Profit Loss Report weekly selected dates of specific company.
-- USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_Pagination 2,N'2022-01-01',N'2022-12-31',60,20,N'JANJAES',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_Pagination]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossCompanyWeeklySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossCompanyWeeklySelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossCompanyWeeklySelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND tbl_payment.CompanyId = @CompanyId
			AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND tbl_expenses.CompanyId = @CompanyId
			AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@FromDate NVARCHAR(30),@ToDate NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@CompanyId,@FromDate,@ToDate,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossCompanyWeeklySelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossCompanyWeeklySelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	21/June/2023
-- Description:		Get Profit Loss Report weekly selected dates for specific company.
-- USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_TotalDetails 2,N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyWeeklySelectedDateReport_TotalDetails]
	@CompanyId INT = NULL,
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyYearlyDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyYearlyDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report of Yearly.
-- USP_Admin_ProfitLossCompanyYearlyDateReport_Graph N'2023'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyYearlyDateReport_Graph]
	@CompanyId INT = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		MONTH(tbl_payment.TransectionDate) AS TransactionMonth,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year
	AND tbl_payment.CompanyId = @CompanyId
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		MONTH(tbl_expenses.CreatedOnUtc) AS TransactionMonth,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year
	ORDER BY TransactionMonth
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyYearlySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyYearlySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report weekly selected dates of specific company.
-- USP_Admin_ProfitLossCompanyYearlySelectedDateReport_Pagination N'2022',0,20,N'',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyYearlySelectedDateReport_Pagination]
	@CompanyId INT = NULL,
	@year NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossCompanyYearlySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossCompanyYearlySelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossCompanyYearlySelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year
			AND tbl_payment.CompanyId = @CompanyId
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year
			AND tbl_expenses.CompanyId = @CompanyId
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@CompanyId INT,@year NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@CompanyId,@year,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossCompanyYearlySelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossCompanyYearlySelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyYearlySelectedReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyYearlySelectedReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report of selected month and year of specific company.
-- USP_Admin_ProfitLossCompanyYearlySelectedReport_ExcelPdf N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyYearlySelectedReport_ExcelPdf]
	@CompanyId INT = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year
	AND tbl_payment.CompanyId = @CompanyId
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND tbl_expenses.CompanyId = @CompanyId
	AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND YEAR(CONVERT(date,TransectionDate)) = @Year

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year
END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCompanyYearlySelectedReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCompanyYearlySelectedReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	22/June/2023
-- Description:		Get Profit Loss Report of selected  year of specific company.
-- USP_Admin_ProfitLossCompanyYearlySelectedReport_TotalDetails N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCompanyYearlySelectedReport_TotalDetails]
	@CompanyId INT = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND YEAR(CONVERT(date,TransectionDate)) = @Year

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND CompanyId = @CompanyId
	AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCustomSelectedDateReport
-- Author:			<Yashasvi Sharma>
-- Created date:	09/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_ProfitLossCustomSelectedDateReport N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionId ASC

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCustomSelectedDateReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	13/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_ProfitLossCustomSelectedDateReport_ExcelPdf N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_ExcelPdf]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCustomSelectedDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	14/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_ProfitLossCustomSelectedDateReport_Graph N'2023-04-01',N'2023-06-03'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_Graph]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCustomSelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_ProfitLossCustomSelectedDateReport_Pagination N'2022-01-01',N'2022-12-31',60,20,N'JANJAES',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_Pagination]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossCustomSelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossCustomSelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossCustomSelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@FromDate NVARCHAR(30),@ToDate NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@FromDate,@ToDate,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossCustomSelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossCustomSelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCustomSelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	13/June/2023
-- Description:		Get Profit Loss Report between passed custom selected dates.
-- USP_Admin_ProfitLossCustomSelectedDateReport_TotalDetails N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossCustomSelectedDateReport_TotalDetails]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossMonthlyDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossMonthlyDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	19/June/2023
-- Description:		Get Profit Loss Report of Month wise.
-- USP_Admin_ProfitLossMonthlyDateReport_Graph N'06',N'2023'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossMonthlyDateReport_Graph]
	@Month NVARCHAR(30) = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year AND MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @Month)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year AND MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Month)
	ORDER BY TransactionDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossMonthlyReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossMonthlyReport
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report of selected month of selected year.
-- USP_Admin_ProfitLossMonthlyReport N'01',N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossMonthlyReport]
	@month NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @month AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @month AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
	ORDER BY TransactionId ASC

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,TransectionDate)) = @month AND YEAR(CONVERT(date,TransectionDate)) = @year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @month AND YEAR(CONVERT(date,CreatedOnUtc)) = @year)

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossMonthlySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossWeeklySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report weekly selected dates.
-- USP_Admin_ProfitLossMonthlySelectedDateReport_Pagination N'03',N'2022',0,20,N'',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossMonthlySelectedDateReport_Pagination]
	@monthNumber NVARCHAR(30) = NULL,
	@year NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossMonthlySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossMonthlySelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossMonthlySelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @monthNumber AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @monthNumber AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@monthNumber NVARCHAR(30),@year NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@monthNumber,@year,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossMonthlySelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossMonthlySelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossMonthlySelectedReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossMonthlySelectedReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	14/June/2023
-- Description:		Get Profit Loss Report of selected month and year.
-- USP_Admin_ProfitLossMonthlySelectedReport_ExcelPdf N'01',N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossMonthlySelectedReport_ExcelPdf]
	@MonthNumber NVARCHAR(30) = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (MONTH(CONVERT(date,tbl_payment.TransectionDate)) = @MonthNumber AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (MONTH(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @MonthNumber AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year)
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) 
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,TransectionDate)) = @MonthNumber AND YEAR(CONVERT(date,TransectionDate)) = @Year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @MonthNumber AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year)
END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossMonthlySelectedReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossMonthlySelectedReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	14/June/2023
-- Description:		Get Profit Loss Report of selected month and year.
-- USP_Admin_ProfitLossMonthlySelectedReport_TotalDetails N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossMonthlySelectedReport_TotalDetails]
	@MonthNumber NVARCHAR(30) = NULL,
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,TransectionDate)) = @MonthNumber AND YEAR(CONVERT(date,TransectionDate)) = @Year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (MONTH(CONVERT(date,CreatedOnUtc)) = @MonthNumber AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year)

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossWeeklyDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossWeeklyDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	19/June/2023
-- Description:		Get Profit Loss Report of weekly dates.
-- USP_Admin_ProfitLossWeeklyDateReport_Graph N'2023-06-19',N'2023-06-25'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossWeeklyDateReport_Graph]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionDate
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossWeeklySelectedDateReport
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report between passed weekly selected dates.
-- USP_Admin_ProfitLossWeeklySelectedDateReport N'2022-01-01',N'2022-01-07'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionId ASC

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossCustomSelectedDateReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	13/June/2023
-- Description:		Get Profit Loss Report weekly selected dates.
-- USP_Admin_ProfitLossWeeklySelectedDateReport_ExcelPdf N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport_ExcelPdf]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))

END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossWeeklySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report weekly selected dates.
-- USP_Admin_ProfitLossWeeklySelectedDateReport_Pagination N'2022-01-01',N'2022-12-31',60,20,N'JANJAES',N'Transaction Id',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport_Pagination]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossWeeklySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossWeeklySelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossWeeklySelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND (CONVERT(date,tbl_payment.TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_payment.TransectionDate) <= CONVERT(date,@ToDate))
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND (CONVERT(date,tbl_expenses.CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,tbl_expenses.CreatedOnUtc) <= CONVERT(date,@ToDate))
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@FromDate NVARCHAR(30),@ToDate NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@FromDate,@ToDate,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossWeeklySelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossWeeklySelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossWeeklySelectedDateReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	13/June/2023
-- Description:		Get Profit Loss Report weekly selected dates.
-- USP_Admin_ProfitLossWeeklySelectedDateReport_TotalDetails N'2022-01-01',N'2022-12-31'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossWeeklySelectedDateReport_TotalDetails]
	@FromDate NVARCHAR(30) = NULL,
	@ToDate NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,TransectionDate) >= CONVERT(date,@FromDate) AND CONVERT(date,TransectionDate) <= CONVERT(date,@ToDate))

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (CONVERT(date,CreatedOnUtc) >= CONVERT(date,@FromDate) AND CONVERT(date,CreatedOnUtc) <= CONVERT(date,@ToDate))
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossYearlyDateReport_Graph]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossYearlyDateReport_Graph
-- Author:			<Yashasvi Sharma>
-- Created date:	19/June/2023
-- Description:		Get Profit Loss Report of Yearly.
-- USP_Admin_ProfitLossYearlyDateReport_Graph N'2023'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossYearlyDateReport_Graph]
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_payment.TransactionId AS TransactionId,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		MONTH(tbl_payment.TransectionDate) AS TransactionMonth,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT 
	    tbl_expenses.TransactionId AS TransactionId,
		tbl_expenses.GrandTotal AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		MONTH(tbl_expenses.CreatedOnUtc) AS TransactionMonth,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year
	ORDER BY TransactionMonth
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossYearlyReport]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossYearlyReport
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report of selected year.
-- USP_Admin_ProfitLossYearlyReport N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossYearlyReport]
	@year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND (YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year)
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND (YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year)
	ORDER BY TransactionId ASC

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND (YEAR(CONVERT(date,TransectionDate)) = @year)

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND (YEAR(CONVERT(date,CreatedOnUtc)) = @year)

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossYearlySelectedDateReport_Pagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossWeeklySelectedDateReport_Pagination
-- Author:			<Yashasvi Sharma>
-- Created date:	12/June/2023
-- Description:		Get Profit Loss Report weekly selected dates.
-- USP_Admin_ProfitLossYearlySelectedDateReport_Pagination N'2022',0,20,N'',N'Grand Total',N'asc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossYearlySelectedDateReport_Pagination]
	@year NVARCHAR(30) = NULL,
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF OBJECT_ID(N'tempdb..##AdminProfitLossYearlySelectedDateReport') IS NOT NULL
	BEGIN
		DROP TABLE ##AdminProfitLossYearlySelectedDateReport
	END

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''

		SELECT DISTINCT
				tbl_payment.Id AS Id,
				ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_payment.Description,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
				CONVERT(DECIMAL(18,2),tbl_payment.TotalAmount) AS GrandTotal,
				CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
				tbl_payment.TransectionDate AS TransactionDate,
				'Credit' AS Type
			INTO ##AdminProfitLossYearlySelectedDateReport
			FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
			LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
			WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
			AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @year
			AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)
			AND (
				@searchPrefix IS NULL
				OR tbl_payment.TransactionId LIKE '%'+@searchPrefix+'%' 
				OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.Description LIKE '%'+@searchPrefix+'%' 
				OR tbl_payment.TotalAmount LIKE '%'+@searchPrefix+'%' 
				OR CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) LIKE '%'+@searchPrefix+'%' 
			)

			UNION 

			SELECT DISTINCT
				ISNULL(tbl_expenses.Id,0) AS Id,
				ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
				ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
				ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
				(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
				ISNULL(CONVERT(DECIMAL(18,2),'-'+tbl_expenses.GrandTotal),0) AS GrandTotal,
				ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
				tbl_expenses.CreatedOnUtc AS TransactionDate,
				'Debit' AS Type
			FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
			LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
			WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
			AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @year
			AND (
					@searchPrefix IS NULL
					OR tbl_expenses.TransactionId LIKE '%'+@searchPrefix+'%' 
					OR tbl_Company.CompanyName LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.ExpensesTitle LIKE '%'+@searchPrefix+'%' 
					OR tbl_expenses.GrandTotal LIKE '%'+@searchPrefix+'%' 
					OR CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105) LIKE '%'+@searchPrefix+'%' 
				)

	SET @orderByClause = N'ORDER BY ' 
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END
			
		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Id' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionIdNo'
			+ ' DESC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' ASC'
		END

		IF @sortColumn = 'Transaction Date' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' TransactionDate'
			+ ' DESC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' ASC'
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' CompanyName'
			+ ' DESC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' ASC'
		END

		IF @sortColumn = 'Description' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' Description'
			+ ' DESC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' ASC'
		END

		IF @sortColumn = 'Grand Total' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' GrandTotal'
			+ ' DESC'
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query 

	EXEC SP_EXECUTESQL @selectQuery,N'@year NVARCHAR(30),@searchPrefix NVARCHAR(MAX),@skipRows INT,@RowsOfPage INT',
	@year,@searchPrefix,@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT * FROM ##AdminProfitLossYearlySelectedDateReport ' + ' ' + @orderByClause + ' ' + @pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT',
	@skipRows,@RowsOfPage

	SET @selectQuery = 'SELECT COUNT(*) AS TotalAccountEntry FROM ##AdminProfitLossYearlySelectedDateReport '
	EXEC SP_EXECUTESQL @selectQuery
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossYearlySelectedReport_ExcelPdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossYearlySelectedReport_ExcelPdf
-- Author:			<Yashasvi Sharma>
-- Created date:	14/June/2023
-- Description:		Get Profit Loss Report of selected month and year.
-- USP_Admin_ProfitLossYearlySelectedReport_ExcelPdf N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossYearlySelectedReport_ExcelPdf]
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		tbl_payment.Id AS Id,
		ISNULL(tbl_payment.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_payment.Description,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_payment.Id ) AS TransactionIdNo,
		tbl_payment.TotalAmount AS GrandTotal,
		CONVERT(NVARCHAR(50),tbl_payment.TransectionDate,105) AS [Date],
		tbl_payment.TransectionDate AS TransactionDate,
		'Credit' AS Type
	FROM [dbo].[Tbl_PaymentTransection] tbl_payment WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_payment.CompanyId
	LEFT JOIN [dbo].[Tbl_PaymentReceipt] tbl_paymentReceipt WITH(NOLOCK) ON tbl_paymentReceipt.PaymentId = tbl_payment.Id
	WHERE (tbl_payment.IsDelete <> 1 OR tbl_payment.IsDelete IS NULL) 
	AND YEAR(CONVERT(date,tbl_payment.TransectionDate)) = @Year
	AND (tbl_paymentReceipt.IsDelete <> 1 OR tbl_paymentReceipt.IsDelete IS NULL)

	UNION 

	SELECT DISTINCT
		ISNULL(tbl_expenses.Id,0) AS Id,
		ISNULL(tbl_expenses.TransactionId,'N/A') AS TransactionId,
		ISNULL(tbl_Company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_expenses.ExpensesTitle,'N/A') AS Description,
		(SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND Id = tbl_expenses.Id ) AS TransactionIdNo,
		ISNULL(tbl_expenses.GrandTotal,'0') AS GrandTotal,
		ISNULL(CONVERT(NVARCHAR(50),tbl_expenses.CreatedOnUtc,105),'N/A') AS [Date],
		tbl_expenses.CreatedOnUtc AS TransactionDate,
		'Debit' AS Type
	FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_expenses WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Expense_Receipt] tbl_expense_receipt WITH(NOLOCK) ON tbl_expenses.Id = tbl_expense_receipt.RecieptId
	LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_expenses.CompanyId
	WHERE tbl_expenses.IsDelete <> 1 AND tbl_Company.IsDelete <> 1 
	AND YEAR(CONVERT(date,tbl_expenses.CreatedOnUtc)) = @Year
	ORDER BY TransactionIdNo

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND YEAR(CONVERT(date,TransectionDate)) = @Year

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year
END;
			
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ProfitLossYearlySelectedReport_TotalDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_ProfitLossYearlySelectedReport_TotalDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	14/June/2023
-- Description:		Get Profit Loss Report of selected  year.
-- USP_Admin_ProfitLossYearlySelectedReport_TotalDetails N'2022'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_ProfitLossYearlySelectedReport_TotalDetails]
	@Year NVARCHAR(30) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),TotalAmount)),0) AS Credit FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK)
	WHERE (IsDelete <> 1 OR IsDelete IS NULL)
	AND YEAR(CONVERT(date,TransectionDate)) = @Year

	SELECT ISNULL(SUM(CONVERT(DECIMAL(30,2),GrandTotal)),0) AS Debit FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK)
	WHERE (IsDelete<> 1 OR IsDelete IS NULL)
	AND YEAR(CONVERT(date,CreatedOnUtc)) = @Year

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RejectTemporaryAccountManagement]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RejectTemporaryAccountManagement
-- Author:			<Yashasvi Sharma>
-- Created date:	08/Aug/2023
-- Description:		Reject Temporary stored Account Managment
-- USP_Admin_RejectTemporaryAccountManagement
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RejectTemporaryAccountManagement]
	@Id INT = NULL,
	@RejectBy INT = NULL,
	@returnId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_TempAccountManagement]
	SET 
		IsRejected = 1,
		RejectedBy = @RejectBy,
		RejectedOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveAccountManagementStaging]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_RemoveAccountManagementStaging
-- Author:		<Yashasvi Sharma>
-- Create date: <23-March-2024>
-- Modify By : <>
-- Modify date : <>
-- Remove account entry from staging
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveAccountManagementStaging]
	@id INT = NULL
AS
BEGIN
	SET TRANSACTION ISOLATION LEVEL READ COMMITTED
	BEGIN TRAN 
		UPDATE [dbo].[Tbl_AccountManagementStaging] 
		SET 
			IsDeleted = 1
		WHERE Id = @id
	COMMIT TRAN
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveCompanyDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveCompanyDocument
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Company Document
-- USP_Admin_RemoveCompanyDocument
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveCompanyDocument]
	@documentId INT = NULL,
	@userId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDateTime NVARCHAR(MAX) = NULL
	SET @currentDateTime = (SELECT CONVERT(NVARCHAR(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'))

	UPDATE [dbo].[Tbl_Company_Document_Mapping] 
	SET 
		IsDeleted = 1,
		ModifyBy=@userId,
		ModifyOnUtc=@currentDateTime
	WHERE ID = @documentId

	SELECT @documentId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveCompanyInvoice]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_RemoveCompanyInvoice 1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_RemoveCompanyInvoice]
	@Status INT = NULL,
	@UserId INT = NULL,
	@InvoiceNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE InvoiceNumber = @InvoiceNumber
	END
	ELSE IF @Status = 2
	BEGIN
		UPDATE [dbo].[Tbl_CompanyInvoicePdf]
		SET
			IsDelete = 1,
			ModifyBy = @UserId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE InvoiceNumber = @InvoiceNumber
	END

	SELECT 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveCompanyPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_RemoveCompanyPermission>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_RemoveCompanyPermission]
	@CompanyId INT = NULL,
	@ModuleId INT = NULL,
	@PermissionId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @Count INT = NULL;
	SET @Count = (SELECT COUNT(*) FROM [dbo].[Tbl_CompanyPermission] WHERE PermissionId = @PermissionId AND ModuleId =@ModuleId AND CompanyId = @CompanyId)
	IF @Count > 0
	BEGIN
		IF @CompanyId IS NOT NULL AND @PermissionId IS NOT NULL AND @PermissionId IS NOT NULL
		BEGIN
			UPDATE [dbo].[Tbl_CompanyPermission]
			SET
				IsDelete = 1
			WHERE CompanyId = @CompanyId 
				AND ModuleId = @ModuleId 
				AND PermissionId = @PermissionId

			SELECT 1
		END
		ELSE 
		BEGIN
			SELECT -1
		END
	END
	ELSE 
	BEGIN
		SELECT -1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveEmail]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveEmail
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Email
-- USP_Admin_RemoveEmail
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveEmail]
	@id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_Email] 
	SET 
		IsDelete = 1 
	WHERE Id = @id

	UPDATE [dbo].[Tbl_EmailDocument] 
	SET 
		IsDelete = 1 
	WHERE EmailId = @id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveExpiryNotification]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveExpiryNotification
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Notification about Visa,Passport or other Document of Company/Employee regarding expiry
-- USP_Admin_RemoveExpiryNotification
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_RemoveExpiryNotification]
	@id INT = NULL,
	@userId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDateTime NVARCHAR(MAX) = NULL
	SET @currentDateTime = (SELECT CONVERT(NVARCHAR(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'))

	UPDATE [dbo].[Tbl_Notifications]
	SET 
		IsDelete = 1,
		ModifyBy =@userId,
		ModifyOnUtc=@currentDateTime 
	WHERE ID = @id

	SELECT @id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveMessageTemplate]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveMessageTemplate
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Message Template
-- USP_Admin_RemoveMessageTemplate
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveMessageTemplate]
	@id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_MessageTemplate] 
    SET 
		IsDelete = 1 
    WHERE Id =  @id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveRolePermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Dec-2021>
-- Modify By : <Yashasvi Sharma,,>
-- Modify date : <08-01-2022>
-- Description:	<SP_Admin_RemoveRolePermission>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_RemoveRolePermission]
	@RoleId INT = NULL,
	@ModuleId INT = NULL,
	@UserId INT = NULL,
	@PermissionId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @Count INT = NULL;
	SET @Count = (SELECT COUNT(*) FROM [dbo].[Tbl_RolePermission] WHERE PermissionId = @PermissionId AND ModuleId =@ModuleId AND RoleID = @RoleId)
	IF @Count >0
	BEGIN
		IF @RoleId IS NOT NULL AND @PermissionId IS NOT NULL AND @PermissionId IS NOT NULL
		BEGIN
			UPDATE [dbo].[Tbl_RolePermission] 
			SET
				IsDelete = 1,
				ModifyBy = @UserId,
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE RoleID = @RoleId 
				AND ModuleId = @ModuleId 
				AND PermissionId = @PermissionId

			SELECT 1
		END
		ELSE 
		BEGIN
			SELECT -1
		END
	END
	ELSE
	BEGIN
		SELECT -1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveRolePermissions]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveRolePermissions
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Role Permission
-- USP_Admin_RemoveRolePermissions 8
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveRolePermissions]
	@roleId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT RoleID FROM [dbo].[Tbl_RolePermission] WHERE RoleID = @roleId  AND IsDelete <> 1 )
    BEGIN 
		DELETE FROM [dbo].[Tbl_RolePermission] WHERE RoleID = @roleId   
	END;
	SELECT 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveSalesPersonCompanyMapping]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveSalesPersonCompanyMapping
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Assigned Company to Sales Person
-- USP_Admin_RemoveSalesPersonCompanyMapping
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveSalesPersonCompanyMapping]
	@salesPersonId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DELETE FROM [dbo].[Tbl_SalesPerson_Company_Mapping] 
	WHERE SalesPersonId = @salesPersonId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveSelectedLog]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveSelectedLog
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Log
-- USP_Admin_RemoveSelectedLog
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveSelectedLog]
	@id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @id IS NOT NULL AND @id <> 0
	BEGIN
		UPDATE [DIBN_LOG].[dbo].[Tbl_Log]
		SET 
			IsDelete = 1 
		WHERE Id = @id
	END
	ELSE
	BEGIN
		DELETE FROM [DIBN_LOG].[dbo].[Tbl_Log]
	END;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveShareholderDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveShareholderDocument
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove Shareholder's Document
-- USP_Admin_RemoveShareholderDocument
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_RemoveShareholderDocument]
	@userId INT = NULL,
	@shareholderId INT = NULL,
	@documentId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDate NVARCHAR(50) = NULL
	SET @currentDate = (SELECT CONVERT(NVARCHAR(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'))

	UPDATE [dbo].[Tbl_ShareholderDocuments]
    SET 
		IsDelete = 1,
		ModifyBy = @userId, 
		ModifyOnUtc=@currentDate 
	WHERE ShareholderId = @shareholderId 
	AND ID = @documentId;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveUserDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveUserDocument
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove User Document
-- USP_Admin_RemoveUserDocument
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveUserDocument]
	@DocumentId INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDate NVARCHAR(50) = NULL
	SET @currentDate = (SELECT CONVERT(NVARCHAR(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'))
	UPDATE [dbo].[Tbl_Documents] 
	SET 
		IsDelete = 1,
		ModifyBy=@UserId,
		ModifyOnUtc=@currentDate 
	WHERE Id = @DocumentId

	UPDATE [dbo].[Tbl_Company_User_Document_Mapping] 
	SET 
		IsDelete = 1,
		ModifyBy=@UserId, 
		ModifyOnUtc=@currentDate 
	WHERE DocumentId = @DocumentId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveUserPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <28-Dec-2021>
-- Modify By : <Yashasvi Sharma,,>
-- Modify date : <08-01-2022>
-- Description:	<SP_Admin_RemoveUserPermission>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_RemoveUserPermission]
	@UserId INT = NULL,
	@ModuleId INT = NULL,
	@PermissionId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @Count INT = NULL;
	SET @Count = (SELECT COUNT(*) FROM [dbo].[Tbl_UserPermission] WHERE PermissionId = @PermissionId AND ModuleId =@ModuleId AND UserId = @UserId )
	IF @Count>0 
	BEGIN

		IF @UserId IS NOT NULL AND @ModuleId IS NOT NULL AND @PermissionId IS NOT NULL
		BEGIN
			UPDATE [dbo].[Tbl_UserPermission]
			SET
				IsDelete = 1,
				ModifyBy = @UserId,
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE UserId = @UserId 
				AND ModuleId = @ModuleId 
				AND PermissionId = @PermissionId

			SELECT 1
		END
		ELSE 
		BEGIN
			SELECT -1
		END
	END
	ELSE
	BEGIN
		SELECT -1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveUserPermissions]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveUserPermissions
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove User Permission
-- USP_Admin_RemoveUserPermissions
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveUserPermissions]
	@userId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF EXISTS(SELECT UserId FROM [dbo].[Tbl_UserPermission] WHERE UserId = @userId AND IsDelete <> 1 ) 
    BEGIN 
		DELETE FROM [dbo].[Tbl_UserPermission] WHERE UserId =  @userId  
	END
	SELECT 1 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RemoveUserRoleMapping]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_RemoveUserRoleMapping
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Remove User's Role Mapping
-- USP_Admin_RemoveUserRoleMapping
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RemoveUserRoleMapping]
	@userId INT = NULL,
	@id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @currentDate NVARCHAR(MAX) = NULL

	SET @currentDate = (SELECT CONVERT(NVARCHAR(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'))

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId =  @id  AND IsDelete <> 1) 
    BEGIN 
		UPDATE [dbo].[Tbl_User_Role_Mapping] 
		SET
			IsDelete = 1,
			ModifyBy =  @userId,
			ModifyOnUtc =@currentDate  
		WHERE UserId =  @id
    END; 
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_RoleOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Use to do CURD operation on Role Table by Admin.>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_RoleOperation]
	@Status INT = NULL,
	@RoleID INT = NULL,
	@RoleName NVARCHAR(50) = NULL,
	@IsActive bit = NULL,
	@IsDelete bit = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = 0 OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1 AND @RoleID IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_Role](
			RoleName,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOn
		)
		VALUES(
			@RoleName,
			@IsActive,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(RoleID) FROM [dbo].[Tbl_Role])
		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @RoleID IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_Role]
		SET 
			RoleName = @RoleName,
			IsActive = @IsActive,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'			 
		WHERE RoleID = @RoleID

		SET @returnId = @RoleID
		SELECT @returnId
	END
	ELSE IF @Status = 2 
	BEGIN
		SELECT 
			ISNULL(tbl_role.RoleID,0) AS RoleID,
			ISNULL(tbl_role.RoleName,'N/A') AS RoleName,
			ISNULL(tbl_role.IsActive,0) AS IsActive,
			ISNULL(tbl_role.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_role.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_role.ModifyOn,105),'N/A') AS ModifyON
		FROM [dbo].[Tbl_Role] tbl_role WITH(NOLOCK)
		WHERE tbl_role.IsDelete <> 1
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_role.RoleID,0) AS RoleID,
			ISNULL(tbl_role.RoleName,'N/A') AS RoleName,
			ISNULL(tbl_role.IsActive,0) AS IsActive,
			ISNULL(tbl_role.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_role.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_role.ModifyOn,105),'N/A') AS ModifyON
		FROM [dbo].[Tbl_Role] tbl_role WITH(NOLOCK)
		WHERE tbl_role.IsDelete <> 1 AND tbl_role.RoleID = @RoleID
	END
	ELSE IF @Status = 4 
	BEGIN
		UPDATE [dbo].[Tbl_Role]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'		
		WHERE RoleID = @RoleID
		SET @returnId = 1
		SELECT @returnId
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SalesPersonLogin]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_SalesPersonLogin 'yashasvi@thebridgecode.com',N'PWuppuysuiYvGWgoSWh3nyRAZnG6Cq3P'
CREATE PROCEDURE [dbo].[USP_Admin_SalesPersonLogin]
	@EmailId NVARCHAR(MAX) = NULL,
	@AccountNumber NVARCHAR(MAX) =NULL,
	@Password NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	DECLARE @SalesPersonId INT = NULL;
	IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WHERE EmailId = @EmailId  AND IsDelete <> 1 )
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WHERE EmailId = @EmailId  AND IsLogin <> 0 AND IsActive <> 0)
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WHERE EmailId = @EmailId  AND IsActive <> 0)
			BEGIN
				SET @SalesPersonId = (SELECT Id FROM [dbo].[Tbl_SalesPersons] WHERE EmailId LIKE @EmailId AND IsDelete <> 1)
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_Password] WHERE SalesPersonId =@SalesPersonId AND [Password]=@Password)
				BEGIN
					SELECT DISTINCT
						tbl_role.RoleName,MAX(tbl_mapping.CompanyId) AS CompanyId,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
					FROM [dbo].[Tbl_SalesPersons] tbl_salesPerson
					LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_salesPerson.Designation = tbl_role.RoleID
					LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.SalesPersonId = tbl_salesPerson.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_mapping.CompanyId 
					WHERE tbl_salesPerson.Id = @SalesPersonId AND tbl_salesPerson.IsDelete <> 1 AND tbl_mapping.CompanyId = 
					(SELECT MAX(CompanyId) FROM [dbo].[Tbl_SalesPerson_Company_Mapping] WHERE SalesPersonId = tbl_mapping.SalesPersonId AND IsDelete <> 1)
					GROUP BY tbl_salesPerson.Designation,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_mapping.CompanyId
				END
				ELSE 
				BEGIN
					SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
				END
			END
			ELSE
			BEGIN
				SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
			END
		END
		ELSE
		BEGIN
			SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
		END
	END
	ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WHERE EmailAddress = @EmailId  AND IsDelete <> 1 )
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WHERE EmailAddress = @EmailId  AND IsLoginAllowed <> 0 AND IsActive <> 0)
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WHERE EmailAddress = @EmailId  AND IsActive <> 0)
			BEGIN
				SET @SalesPersonId = (SELECT Id FROM [dbo].[Tbl_RMTeam] WHERE EmailAddress LIKE @EmailId AND IsDelete <> 1)
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WHERE Id = @SalesPersonId AND [Password]=@Password AND IsDelete <> 1)
				BEGIN
					SELECT TOP 1
						'RM Team' AS RoleName,
						MAX(tbl_mapping.CompanyId) AS CompanyId,
						COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
					FROM [dbo].[Tbl_RMTeam] tbl_rmTeam
					LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_rmTeam.Designation = tbl_role.RoleName
					LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
					LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_mapping ON tbl_mapping.RMTeamId = tbl_rmTeam.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_mapping.CompanyId 
					WHERE tbl_rmTeam.Id = @SalesPersonId AND tbl_rmTeam.IsDelete <> 1
					AND tbl_mapping.CompanyId = (SELECT MAX(CompanyId) FROM [dbo].[Tbl_RMTeam_Company_Mapping] WHERE RMTeamId = tbl_mapping.RMTeamId AND IsDelete <> 1)
					GROUP BY tbl_rmTeam.Designation,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_mapping.CompanyId
					ORDER BY tbl_rolepermission.PermissionId DESC
				END
				ELSE 
				BEGIN
					SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
				END
			END
			ELSE
			BEGIN
				SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
			END
		END
		ELSE
		BEGIN
			SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
		END
	END
	ELSE
	BEGIN
		SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SalesPersonOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_SalesPersonOperation 3,1
CREATE PROCEDURE [dbo].[USP_Admin_SalesPersonOperation]
	@Status INT = NULL,
	@Id INT = NULL,
	@FirstName NVARCHAR(100) = NULL,
	@LastName NVARCHAR(100) = NULL,
	@EmailId NVARCHAR(100) = NULL,
	@MCode NVARCHAR(MAX) = NULL,
	@PhoneNumber NVARCHAR(30) = NULL,
	@CountryOfRecidence NVARCHAR(100) = NULL,
	@PassportNumber NVARCHAR(100) = NULL,
	@PassportExpiryDate NVARCHAR(50) = NULL,
	@Designation INT = NULL,
	@VisaExpiryDate NVARCHAR(50) = NULL,
	@InsuranceCompany NVARCHAR(MAX) = NULL,
	@InsuranceExpiryDate NVARCHAR(50) = NULL,
	@IsLogin BIT = NULL,
	@IsActive BIT = NULL,
	@Password NVARCHAR(MAX) = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	IF @Status = 1 AND @Id IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_SalesPersons](
			FirstName,
			LastName,
			EmailId,
			MCode,
			PhoneNumber,
			CountryOfRecidence,
			PassportNumber,
			PassportExpiryDate,
			Designation,
			VisaExpiryDate,
			InsuranceCompany,
			InsuarnceExpiryDate,
			IsLogin,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOn
		)
		VALUES(
			@FirstName,
			@LastName,
			@EmailId,
			@MCode,
			@PhoneNumber,
			@CountryOfRecidence,
			@PassportNumber,
			@PassportExpiryDate,
			@Designation,
			@VisaExpiryDate,
			@InsuranceCompany,
			@InsuranceExpiryDate,
			@IsLogin,
			@IsActive,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_SalesPersons])

		IF @Password IS NOT NULL AND @returnId > 0
		BEGIN
			INSERT INTO [dbo].[Tbl_Password](
				SalesPersonId,
				[Password]
			)
			VALUES(
				@returnId,
				@Password
			)
		END

		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @Id IS NOT NULL
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId = @EmailId AND Id <> @Id  AND IsDelete <> 1)
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RMTeam] WITH(NOLOCK) WHERE EmailAddress = @EmailId AND IsDelete <> 1)
			BEGIN
				UPDATE [dbo].[Tbl_SalesPersons]
				SET 
					FirstName = @FirstName,
					LastName = @LastName,
					EmailId = @EmailId,
					MCode = @MCode,
					PhoneNumber = @PhoneNumber,
					CountryOfRecidence = @CountryOfRecidence,
					PassportNumber = @PassportNumber,
					PassportExpiryDate = @PassportExpiryDate,
					Designation = @Designation,
					VisaExpiryDate = @VisaExpiryDate,
					InsuranceCompany = @InsuranceCompany,
					InsuarnceExpiryDate = @InsuranceExpiryDate,
					IsLogin = @IsLogin,
					IsActive = @IsActive,
					ModifyBy = @CreatedBy,
					ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @Id

				IF @Password IS NOT NULL AND @Id > 0
				BEGIN
					UPDATE [dbo].[Tbl_Password]
					SET 
						[Password] = @Password
					WHERE SalesPersonId = @ID
				END

				SELECT @Id
			END
			ELSE
			BEGIN
				SELECT -1
			END
		END
		ELSE
		BEGIN
			SELECT -1
		END
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_salesPersons.Id,0) AS Id,
			ISNULL(tbl_salesPersons.FirstName,'N/A') AS FirstName,
			ISNULL(tbl_salesPersons.LastName,'N/A') AS LastName,
			ISNULL(tbl_salesPersons.EmailId,'N/A') AS EmailId,
			ISNULL(tbl_salesPersons.MCode,'N/A') AS MCode,
			ISNULL(tbl_salesPersons.PhoneNumber,'N/A') AS PhoneNumber,
			ISNULL(tbl_salesPersons.CountryOfRecidence,'N/A') AS CountryOfRecidence,
			ISNULL(tbl_salesPersons.PassportNumber,'N/A') AS PassportNumber,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
			ISNULL(tbl_salesPersons.Designation,0) AS Designation,
			ISNULL(tbl_role.RoleName,'N/A') AS [Role],
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
			ISNULL(tbl_salesPersons.InsuranceCompany,'N/A') AS InsuranceCompany,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.InsuarnceExpiryDate,23),'N/A') AS InsuarnceExpiryDate,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_company.CompanyName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
					WHERE tbl_salesPersons1.Id = tbl_salesPersons.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS Company,
			ISNULL(tbl_salesPersons.IsLogin,0) AS IsLogin,
			ISNULL(tbl_salesPersons.IsActive,0) AS IsActive,
			ISNULL(tbl_salesPersons.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.ModifyOn,105),'N/A') AS ModifyOn
		FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_salesPersons.Designation
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
		LEFT JOIN [dbo].[Tbl_Password] tbl_password ON tbl_password.SalesPersonId = tbl_salesPersons.Id
		WHERE tbl_salesPersons.IsDelete <> 1
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_salesPersons.Id,0) AS Id,
			ISNULL(tbl_salesPersons.FirstName,'N/A') AS FirstName,
			ISNULL(tbl_salesPersons.LastName,'N/A') AS LastName,
			ISNULL(tbl_salesPersons.EmailId,'N/A') AS EmailId,
			(SELECT TOP(1) tbl_pass.Password FROM [dbo].[Tbl_Password] tbl_pass WHERE tbl_pass.SalesPersonId = @Id ORDER BY Id DESC) AS [Password],
			ISNULL(tbl_salesPersons.MCode,'N/A') AS MCode,
			ISNULL(tbl_salesPersons.PhoneNumber,'N/A') AS PhoneNumber,
			ISNULL(tbl_salesPersons.CountryOfRecidence,'N/A') AS CountryOfRecidence,
			ISNULL(tbl_salesPersons.PassportNumber,'N/A') AS PassportNumber,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
			ISNULL(tbl_salesPersons.Designation,0) AS Designation,
			ISNULL(tbl_role.RoleName,'N/A') AS [Role],
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
			ISNULL(tbl_salesPersons.InsuranceCompany,'N/A') AS InsuranceCompany,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.InsuarnceExpiryDate,23),'N/A') AS InsuarnceExpiryDate,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_company.CompanyName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id
					LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
					WHERE tbl_salesPersons1.Id = tbl_salesPersons.Id AND tbl_companyMapping.IsDelete <> 1
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS Company,
			ISNULL(tbl_salesPersons.IsLogin,0) AS IsLogin,
			ISNULL(tbl_salesPersons.IsActive,0) AS IsActive,
			ISNULL(tbl_salesPersons.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_salesPersons.ModifyOn,105),'N/A') AS ModifyOn
		FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_salesPersons.Designation
		LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
		LEFT JOIN [dbo].[Tbl_Password] tbl_password ON tbl_password.SalesPersonId = tbl_salesPersons.Id
		WHERE tbl_salesPersons.IsDelete <> 1 AND tbl_salesPersons.Id = @Id
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_SalesPersons]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id


		UPDATE [dbo].[Tbl_SalesPerson_Company_Mapping]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE SalesPersonId = @Id

		DELETE FROM [dbo].[Tbl_Password]
		WHERE SalesPersonId = @Id

		SELECT @Id
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAccountHistory]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveAccountHistory]
	@TransactionId NVARCHAR(100) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@Amount NVARCHAR(100) = NULL,
	@Quantity INT = NULL,
	@TotalAmount NVARCHAR(100) = NULL,
	@Vat NVARCHAR(50) = NULL,
	@VatAmount NVARCHAR(50) = NULL,
	@GrandTotal NVARCHAR(50) = NULL,
	@ExpenseType NVARCHAR(10) = NULL,
	@PaymentMethod NVARCHAR(100) = NULL,
	@TransactionDate NVARCHAR(20) = NULL,
	@CompanyId INT = NULL,
	@CreatedBy INT = NULL
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;
	
	INSERT INTO [dbo].[Tbl_AccountHistory](
		TransactionId,
		Description,
		Amount,
		Quantity,
		TotalAmount,
		Vat,
		VatAmount,
		GrandTotal,
		ExpenseType,
		PaymentMethod,
		TransactionDate,
		CompanyId,
		CreatedBy,
		CreatedOn
	)
	VALUES(
		@TransactionId,
		@Description,
		@Amount,
		@Quantity,
		@TotalAmount,
		@Vat,
		@VatAmount,
		@GrandTotal,
		@ExpenseType,
		@PaymentMethod,
		@TransactionDate,
		@CompanyId,
		@CreatedBy,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAccountManagementTransactions]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_SaveAccountManagementTransactions
-- Author:		<Yashasvi Sharma>
-- Create date: <22-March-2024>
-- Modify By : <>
-- Modify date : <>
-- Save details of account management transaction from temp table to main tables.
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveAccountManagementTransactions]
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	--DECLARE @PlanHandle VARBINARY(64);

	--SELECT  @PlanHandle = deps.plan_handle
	--FROM    sys.dm_exec_procedure_stats AS deps
	--WHERE   deps.object_id = OBJECT_ID('dbo.USP_Admin_SaveAccountManagementTransactions') AND deps.database_id = DB_ID();

	--IF @PlanHandle IS NOT NULL
	--BEGIN
	--    DBCC FREEPROCCACHE(@PlanHandle);
	--END

	SET TRANSACTION ISOLATION LEVEL READ COMMITTED
	BEGIN TRAN 
	EXEC sp_getapplock @Resource = 'USP_Admin_SaveAccountManagementTransactions', @LockOwner='Transaction', @LockMode = 'Exclusive', @LockTimeout = 200000; 
	DECLARE @UserId int, 
			@CompanyId int, 
			@TransactionType nvarchar(50),
			@Description nvarchar(max), 
			@PaymentMode nvarchar(100),
			@Amount decimal(18,2),
			@Quantity int,
			@TotalAmount decimal(18,2),
			@Vat decimal(18,2),
			@VatAmount decimal(18,2),
			@CreatedOn nvarchar(50),
			@PaymentStatus nvarchar(50),
			@GrandTotal decimal(18,2),
			@Ids int,
			@ChangeAmount NVARCHAR(50)=NULL

	DECLARE @PortalId INT = NULL, @Amounts DECIMAL(18,2) = NULL;
	DECLARE @RemainingPortalBalance NVARCHAR(MAX) = null;
	DECLARE @SerialNumber INT = NULL,@NewSerialNumber NVARCHAR(100) = NULL;
	DECLARE @TransactionId INT = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;
	DECLARE @paymentId INT =0,@paymentReceiptId INT =0
	DECLARE @returnId INT =0

	IF @Id IS NULL OR @Id = 0
	BEGIN
		DECLARE @totalCountOfTransaction INT = 0;
		SET @totalCountOfTransaction = (SELECT COUNT(Id) FROM [dbo].[Tbl_AccountManagementStaging] WHERE (IsDeleted <> 1 OR IsDeleted IS NULL) 
		AND (IsProcessing <> 1 OR IsProcessing IS NULL))

		IF(CONVERT(int,@totalCountOfTransaction) > 0)
		BEGIN
			WHILE(CONVERT(int,@totalCountOfTransaction) > 0)
			BEGIN
				SELECT TOP(1)
					@UserId = UserId,
					@CompanyId = CompanyId,
					@TransactionType = TransactionType,
					@Description = Description,
					@PaymentMode = PaymentMode,
					@Amount = Amount,
					@Quantity = Quantity,
					@TotalAmount = TotalAmount,
					@Vat = Vat,
					@VatAmount = VatAmount,
					@CreatedOn = CreatedOn,
					@PaymentStatus = PaymentStatus,
					@GrandTotal = GrandTotal,
					@Ids = Id,
					@TransactionCode = TransactionId
				FROM [dbo].[Tbl_AccountManagementStaging]
				WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)
				AND (IsProcessing <> 1 OR IsProcessing IS NULL)

				UPDATE [dbo].[Tbl_AccountManagementStaging] 
				SET 
					IsProcessing = 1
				WHERE Id = @Ids
		
				IF @TransactionType = N'Credit'
				BEGIN					
					--EXEC USP_Admin_PaymentTransectionOperation NULL,@UserId,@CompanyId,@TransactionCode,@Amount,@Amount,@PaymentMode,@Description,
					--@PaymentStatus,@TotalAmount,@Quantity,
					--@CreatedOn,NULL,NULL,1,NULL,@paymentId OUTPUT

					--EXEC @paymentReceiptId = USP_Admin_SavePaymentReceipt @CompanyId,@paymentId,NULL,@Description,@UserId,@CreatedOn

					--EXEC USP_Admin_PortalBalanceOperation NULL,@UserId,@CompanyId,@GrandTotal,0,1

					INSERT INTO [dbo].[Tbl_PaymentTransection](
						UserId,
						CompanyId,
						TransactionId,
						Amount,
						PaymentMode,
						Description,
						PaymentStatus,
						Quantity,
						TotalAmount,
						TransectionDate,
						CreatedBy,
						CreatedOnUtc
					)
					VALUES(
						@UserId,
						@CompanyId,
						@TransactionCode,
						@Amount,
						@PaymentMode,
						@Description,
						@PaymentStatus,
						@Quantity,
						@TotalAmount,
						@CreatedOn,
						@UserId,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					)

					SET @paymentId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK))

					IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK))
					BEGIN
						SET @SerialNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX('B',SerialNumber)+1,LEN(SerialNumber)))) 
											FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK));
						SET @SerialNumber = @SerialNumber + 1
						SET  @NewSerialNumber ='RECDB'+ CONVERT(NVARCHAR(100),@SerialNumber);
					END
					ELSE
					BEGIN
						SET  @NewSerialNumber = 'RECDB101';
					END

					IF @CreatedOn IS NULL
					BEGIN
						SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
					END
	
					IF @CompanyId IS NOT NULL
					BEGIN
						INSERT INTO [dbo].[Tbl_PaymentReceipt](
							CompanyId,
							PaymentId,
							SerialNumber,
							Through,
							OnAccount,
							CreatedOn,
							CreatedBy,
							IsDelete
						)
						VALUES(
							@CompanyId,
							@PaymentId,
							@NewSerialNumber,
							N'',
							@Description,
							@CreatedOn,
							@UserId,
							0
						)
					END

					IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
					BEGIN
						INSERT INTO [dbo].[Tbl_PortalBalance](
							UserId,
							CompanyId,
							BalanceAmount,
							CreatedOnUtc,
							IsCompletelyUsed
						)
						VALUES(
							@UserId,
							@CompanyId,
							@TotalAmount,
							SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
							0
						)

						SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK)
					END
					ELSE
					BEGIN
						SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
						SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
						SET @Amount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@TotalAmount);

						UPDATE [dbo].[Tbl_PortalBalance]
						SET
							BalanceAmount = @Amount,
							ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
						WHERE Id = @PortalId

						SELECT @PortalId
					END

					IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
					BEGIN
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
						BEGIN
							SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
										);

							SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
												);

							IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
							BEGIN
								SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
											FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
											);

								SET @TransactionId = @TransactionId + 1

								SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
							END
							ELSE
							BEGIN
								SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
												);
			
								SET @TransactionId = @TransactionId + 1

								SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
							END
						END
						ELSE
						BEGIN
							SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL)
												);

							SET @TransactionId = @TransactionId + 1

							SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
						END
					END
					ELSE
					BEGIN
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
						BEGIN
							SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
											FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
											);

							SET @TransactionId = @TransactionId + 1

							SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
						END
					END

					UPDATE [dbo].[Tbl_AccountManagementStaging]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @Ids

					UPDATE [dbo].[Tbl_PaymentTransection]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @paymentId

					UPDATE [dbo].[Tbl_AccountManagementStaging] 
					SET 
						IsDeleted = 1
					WHERE Id = @Ids
				END
				ELSE IF @TransactionType = N'Debit'
				BEGIN
					INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
						CompanyId,
						TransactionId,
						ExpensesTitle,
						ExpensesAmount,
						Quantity,
						TotalAmount,
						Vat,
						VatAmount,
						GrandTotal,
						IsDelete,
						CreatedBy,
						CreatedOnUtc,
						TransactionCreatedOnUtc
					)
					VALUES(
						@CompanyId,
						@TransactionCode,
						@Description,
						@Amount,
						@Quantity,
						@TotalAmount,
						@Vat,
						@VatAmount,
						@GrandTotal,
						0,
						@UserId,
						@CreatedOn,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					)

					SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK));

					IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
					BEGIN
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
						BEGIN
							SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
										);

							SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
												);

							IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
							BEGIN
								SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
											FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
											);

								SET @TransactionId = @TransactionId + 1

								SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
							END
							ELSE
							BEGIN
								SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
												);
			
								SET @TransactionId = @TransactionId + 1

								SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
							END
						END
						ELSE
						BEGIN
							SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL)
												);

							SET @TransactionId = @TransactionId + 1

							SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
						END
					END
					ELSE
					BEGIN
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
						BEGIN
							SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
											FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
											);

							SET @TransactionId = @TransactionId + 1

							SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
						END
					END

					UPDATE [dbo].[Tbl_PortalBalanceExpenses]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @returnId

					UPDATE [dbo].[Tbl_AccountManagementStaging] 
					SET 
						IsDeleted = 1
					WHERE Id = @Ids
						
					
					IF CONVERT(INT,@returnId) > 0
					BEGIN
						SET @Amount = (SELECT ISNULL(BalanceAmount,'0') AS BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);

						IF @Amount IS NULL
						BEGIN
							SET @Amount = '0'
						END

						IF CONVERT(DECIMAL(18,2),@Amount) <= 0
						BEGIN
							SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
						END
						ELSE 
						BEGIN
							SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
						END

						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
						BEGIN
							UPDATE [dbo].[Tbl_PortalBalance]
							SET
								BalanceAmount = @ChangeAmount,
								ModifyBy = @UserId,
								ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
							WHERE CompanyId = @CompanyId
						END
						ELSE
						BEGIN
							INSERT INTO [dbo].[Tbl_PortalBalance](
								UserId,
								CompanyId,
								BalanceAmount,
								CreatedBy,
								CreatedOnUtc,
								IsCompletelyUsed
							)
							VALUES(
								@UserId,
								@CompanyId,
								@ChangeAmount,
								@UserId,
								SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
								0
							)
						END
					END

					UPDATE [dbo].[Tbl_AccountManagementStaging]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @Ids
					--EXEC @returnId = USP_Admin_SaveAllCompanyExpenses NULL,@CompanyId,@Description,@Amount,@Quantity,@TotalAmount,@Vat,
					--@VatAmount,@GrandTotal,@CreatedOn,@UserId,@TransactionCode
				END

				SET @totalCountOfTransaction = CONVERT(int,@totalCountOfTransaction) - 1
				IF CONVERT(int,@totalCountOfTransaction) = 1
				BEGIN
					IF (SELECT COUNT(Id) FROM [dbo].[Tbl_AccountManagementStaging] WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)) > 0
					BEGIN
						SET @totalCountOfTransaction = (SELECT COUNT(Id) FROM [dbo].[Tbl_AccountManagementStaging] WHERE (IsDeleted <> 1 OR IsDeleted IS NULL) 
						AND (IsProcessing <> 1 OR IsProcessing IS NULL))
					END
				END
			END
		END
	END
	ELSE
	BEGIN
		SELECT TOP(1)
			@UserId = UserId,
			@CompanyId = CompanyId,
			@TransactionType = TransactionType,
			@Description = Description,
			@PaymentMode = PaymentMode,
			@Amount = Amount,
			@Quantity = Quantity,
			@TotalAmount = TotalAmount,
			@Vat = Vat,
			@VatAmount = VatAmount,
			@CreatedOn = CreatedOn,
			@PaymentStatus = PaymentStatus,
			@GrandTotal = GrandTotal,
			@TransactionCode = TransactionId
		FROM [dbo].[Tbl_AccountManagementStaging]
		WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)
		AND Id = @Id

		UPDATE [dbo].[Tbl_AccountManagementStaging] 
		SET 
			IsProcessing = 1
		WHERE Id = @Id
		
		IF @TransactionType = N'Credit'
		BEGIN
			INSERT INTO [dbo].[Tbl_PaymentTransection](
				UserId,
				CompanyId,
				TransactionId,
				Amount,
				PaymentMode,
				Description,
				PaymentStatus,
				Quantity,
				TotalAmount,
				TransectionDate,
				CreatedBy,
				CreatedOnUtc
			)
			VALUES(
				@UserId,
				@CompanyId,
				@TransactionCode,
				@Amount,
				@PaymentMode,
				@Description,
				@PaymentStatus,
				@Quantity,
				@TotalAmount,
				@CreatedOn,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)

			SET @paymentId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK))

			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK))
			BEGIN
				SET @SerialNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX('B',SerialNumber)+1,LEN(SerialNumber)))) 
									FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK));
				SET @SerialNumber = @SerialNumber + 1
				SET  @NewSerialNumber ='RECDB'+ CONVERT(NVARCHAR(100),@SerialNumber);
			END
			ELSE
			BEGIN
				SET  @NewSerialNumber = 'RECDB101';
			END

			IF @CreatedOn IS NULL
			BEGIN
				SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
			END
	
			IF @CompanyId IS NOT NULL
			BEGIN

				INSERT INTO [dbo].[Tbl_PaymentReceipt](
					CompanyId,
					PaymentId,
					SerialNumber,
					Through,
					OnAccount,
					CreatedOn,
					CreatedBy,
					IsDelete
				)
				VALUES(
					@CompanyId,
					@PaymentId,
					@NewSerialNumber,
					N'',
					@Description,
					@CreatedOn,
					@UserId,
					0
				)
			END

			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
			BEGIN
				INSERT INTO [dbo].[Tbl_PortalBalance](
					UserId,
					CompanyId,
					BalanceAmount,
					CreatedOnUtc,
					IsCompletelyUsed
				)
				VALUES(
					@UserId,
					@CompanyId,
					@TotalAmount,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
					0
				)

				SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK)
			END
			ELSE
			BEGIN
				SET @PortalId = (SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
				SET @Amount = (SELECT BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);
				SET @Amount = CONVERT(DECIMAL(18,2),@Amount) + CONVERT(DECIMAL(18,2),@TotalAmount);

				UPDATE [dbo].[Tbl_PortalBalance]
				SET
					BalanceAmount = @Amount,
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE Id = @PortalId

				SELECT @PortalId
			END
			
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
				BEGIN
					SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
								);

					SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
										);

					IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
					BEGIN
						SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
									FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
									);

						SET @TransactionId = @TransactionId + 1

						SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
					END
					ELSE
					BEGIN
						SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
										);
			
						SET @TransactionId = @TransactionId + 1

						SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
					END
				END
				ELSE
				BEGIN
					SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL)
										);

					SET @TransactionId = @TransactionId + 1

					SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
				END
			END
			ELSE
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
				BEGIN
					SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
									FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
									);

					SET @TransactionId = @TransactionId + 1

					SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
				END
			END

			UPDATE [dbo].[Tbl_AccountManagementStaging]
			SET 
				TransactionId = @TransactionCode
			WHERE Id = @Id

			UPDATE [dbo].[Tbl_PaymentTransection]
			SET 
				TransactionId = @TransactionCode
			WHERE Id = @paymentId

			UPDATE [dbo].[Tbl_AccountManagementStaging] 
			SET 
				IsDeleted = 1
			WHERE Id = @Id
		END
		ELSE IF @TransactionType = N'Debit'
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE TransactionId = @TransactionCode AND (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE TransactionId = @TransactionCode AND (IsDelete <> 1 OR IsDelete IS NULL))
				BEGIN
					INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
						CompanyId,
						TransactionId,
						ExpensesTitle,
						ExpensesAmount,
						Quantity,
						TotalAmount,
						Vat,
						VatAmount,
						GrandTotal,
						IsDelete,
						CreatedBy,
						CreatedOnUtc,
						TransactionCreatedOnUtc
					)
					VALUES(
						@CompanyId,
						@TransactionCode,
						@Description,
						@Amount,
						@Quantity,
						@TotalAmount,
						@Vat,
						@VatAmount,
						@GrandTotal,
						0,
						@UserId,
						@CreatedOn,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					)

					SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK));

					IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
					BEGIN
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
						BEGIN
							SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
										);

							SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
												);

							IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
							BEGIN
								SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
											FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
											);

								SET @TransactionId = @TransactionId + 1

								SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
							END
							ELSE
							BEGIN
								SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
												);
			
								SET @TransactionId = @TransactionId + 1

								SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
							END
						END
						ELSE
						BEGIN
							SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
												FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL)
												);

							SET @TransactionId = @TransactionId + 1

							SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
						END
					END
					ELSE
					BEGIN
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionCode)
						BEGIN
							SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
											FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
											);

							SET @TransactionId = @TransactionId + 1

							SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
						END
					END

					UPDATE [dbo].[Tbl_AccountManagementStaging]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @Id

					UPDATE [dbo].[Tbl_PortalBalanceExpenses]
					SET 
						TransactionId = @TransactionCode
					WHERE Id = @returnId

					UPDATE [dbo].[Tbl_AccountManagementStaging] 
					SET 
						IsDeleted = 1
					WHERE Id = @Id
				END
				ELSE
				BEGIN
					SET @returnId = -1
				END
			END
			ELSE
			BEGIN
				SET @returnId = -1
			END

			IF CONVERT(INT,@returnId) > 0
			BEGIN
				SET @Amount = (SELECT ISNULL(BalanceAmount,'0') AS BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);

				IF @Amount IS NULL
				BEGIN
					SET @Amount = '0'
				END

				IF CONVERT(DECIMAL(18,2),@Amount) <= 0
				BEGIN
					SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
				END
				ELSE 
				BEGIN
					SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
				END

				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
				BEGIN
					UPDATE [dbo].[Tbl_PortalBalance]
					SET
						BalanceAmount = @ChangeAmount,
						ModifyBy = @UserId,
						ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					WHERE CompanyId = @CompanyId
				END
				ELSE
				BEGIN
					INSERT INTO [dbo].[Tbl_PortalBalance](
						UserId,
						CompanyId,
						BalanceAmount,
						CreatedBy,
						CreatedOnUtc,
						IsCompletelyUsed
					)
					VALUES(
						@UserId,
						@CompanyId,
						@ChangeAmount,
						@UserId,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
						0
					)
				END
			END
		END
	END
	COMMIT TRAN
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAccountManagementTransactionTemp]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_SaveAccountManagementTransactionTemp
-- Author:		<Yashasvi Sharma>
-- Create date: <22-March-2024>
-- Modify By : <>
-- Modify date : <>
-- Save details of account management transaction into temp table as queue
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveAccountManagementTransactionTemp]
	@UserId int = NULL,
	@CompanyId int = NULL,
	@TransactionType nvarchar(50) = NULL,
	@Description nvarchar(MAX) = NULL,
	@PaymentMode nvarchar(100) = NULL,
	@Amount decimal(18,2) = NULL,
	@Quantity int = NULL,
	@TotalAmount decimal(18,2) = NULL,
	@Vat decimal(18,2) = NULL,
	@VatAmount decimal(18,2) = NULL,
	@GrandTotal decimal(18,2) = NULL,
	@CreatedOn nvarchar(50) = NULL,
	@PaymentStatus nvarchar(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	--DECLARE @PlanHandle VARBINARY(64);

	--SELECT  @PlanHandle = deps.plan_handle
	--FROM    sys.dm_exec_procedure_stats AS deps
	--WHERE   deps.object_id = OBJECT_ID('dbo.USP_Admin_SaveAccountManagementTransactionTemp') AND deps.database_id = DB_ID();

	--IF @PlanHandle IS NOT NULL
	--BEGIN
	--    DBCC FREEPROCCACHE(@PlanHandle);
	--END
	
	DECLARE @TransactionId INT = NULL,@TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;

	SET TRANSACTION ISOLATION LEVEL READ COMMITTED
	BEGIN TRAN 
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_AccountManagementStaging] WHERE (IsDeleted<> 1 OR IsDeleted IS NULL) AND TransactionId IS NOT NULL)
		BEGIN
			SET @TransactionId = (SELECT MAX(SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))) 
								FROM [dbo].[Tbl_AccountManagementStaging] WITH(NOLOCK) WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)
								AND (@TransactionCode IS NULL OR TransactionId != @TransactionCode))
								;
			SET @TransactionId = @TransactionId + 1
			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);

			IF EXISTS(SELECT Id FROM [dbo].[Tbl_AccountManagementStaging] WHERE (IsDeleted<> 1 OR IsDeleted IS NULL) 
			AND TransactionId NOT LIKE @TransactionCode)
			BEGIN
				SET @TransactionId = (SELECT MAX(SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))) 
								FROM [dbo].[Tbl_AccountManagementStaging] WITH(NOLOCK) WHERE (IsDeleted <> 1 OR IsDeleted IS NULL)
								AND (@TransactionCode IS NULL OR TransactionId NOT LIKE @TransactionCode));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
		END
		ELSE
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
				BEGIN
					SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));

					SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
					IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
					BEGIN
						SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
									FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
									AND (@TransactionCode IS NULL OR TransactionId != @TransactionCode));
						SET @TransactionId = @TransactionId + 1
						SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
					END
					ELSE
					BEGIN
						SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
										FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
										AND (@TransactionCode IS NULL OR TransactionId != @TransactionCode));
						SET @TransactionId = @TransactionId + 1
						SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
					END
				END
				ELSE
				BEGIN
					SET @TransactionId = (SELECT MAX(SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId))) 
										FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL)
										AND (@TransactionCode IS NULL OR TransactionId != @TransactionCode));
					SET @TransactionId = @TransactionId + 1
					SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
				END
			END
			ELSE
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
				BEGIN
					SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
									FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
									AND (@TransactionCode IS NULL OR TransactionId != @TransactionCode));
					SET @TransactionId = @TransactionId + 1
					SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
				END
				ELSE
				BEGIN
					SET  @TransactionCode = 'TRN101';
				END
			END
		END

		INSERT INTO [dbo].[Tbl_AccountManagementStaging]
		(
			UserId,
			CompanyId,
			TransactionType,
			[Description],
			PaymentMode,
			Amount,
			Quantity,
			TotalAmount,
			Vat,
			VatAmount,
			GrandTotal,
			CreatedOn,
			PaymentStatus,
			IsDeleted,
			TransactionId
		)
		VALUES
		(
			@UserId,
			@CompanyId,
			@TransactionType,
			@Description,
			@PaymentMode,
			@Amount,
			@Quantity,
			@TotalAmount,
			@Vat,
			@VatAmount,
			@GrandTotal,
			@CreatedOn,
			@PaymentStatus,
			0,
			@TransactionCode
		)

		SELECT CONVERT(INT,(SCOPE_IDENTITY()))
	COMMIT TRAN
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAllCompanyExpenses]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveAllCompanyExpenses]
	@Id INT = NULL,
	@CompanyId INT = NULL,
	@ExpensesTitle NVARCHAR(MAX) = NULL,
	@ExpenseAmount NVARCHAR(50) = NULL,
	@Quantity INT = NULL,
	@TotalAmount NVARCHAR(50) = NULL,
	@Vat NVARCHAR(10) = NULL,
	@VatAmount NVARCHAR(50) = NULL,
	@GrandTotal NVARCHAR(50) = NULL,
	@CreatedOnUtc NVARCHAR(50) = NULL,
	@UserId INT = NULL,
	@TransactionNumber NVARCHAR(50) = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @Amount NVARCHAR(50) = NULL,@ChangeAmount NVARCHAR(50)=NULL,@PortalId INT = NULL;
	DECLARE @TransactionId INT = NULL,@TransactionCode NVARCHAR(50) = NULL, @PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;
	DECLARE @returnResult INT = NULL
	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));

			SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));

			IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
			ELSE
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
				SET @TransactionId = @TransactionId + 1
				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
		END
		ELSE 
		BEGIN
			SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			SET @TransactionId = @TransactionId + 1
			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
	END
	ELSE
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL))
		BEGIN
			SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL));
			SET @TransactionId = @TransactionId + 1
			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
		ELSE
		BEGIN
			SET  @TransactionCode = 'TRN101';
		END
	END
	IF @CreatedOnUtc IS NULL
	BEGIN
		SET @CreatedOnUtc = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	END
	IF @TransactionNumber IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
			CompanyId,
			TransactionId,
			ExpensesTitle,
			ExpensesAmount,
			Quantity,
			TotalAmount,
			Vat,
			VatAmount,
			GrandTotal,
			IsDelete,
			CreatedBy,
			CreatedOnUtc,
			TransactionCreatedOnUtc
		)
		VALUES(
			@CompanyId,
			@TransactionCode,
			@ExpensesTitle,
			@ExpenseAmount,
			@Quantity,
			@TotalAmount,
			@Vat,
			@VatAmount,
			@GrandTotal,
			0,
			@UserId,
			@CreatedOnUtc,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)
		SET @returnResult = (SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK));
	END
	ELSE
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE TransactionId = @TransactionNumber AND (IsDelete <> 1 OR IsDelete IS NULL))
		BEGIN
			IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE TransactionId = @TransactionNumber AND (IsDelete <> 1 OR IsDelete IS NULL))
			BEGIN
				INSERT INTO [dbo].[Tbl_PortalBalanceExpenses](
					CompanyId,
					TransactionId,
					ExpensesTitle,
					ExpensesAmount,
					Quantity,
					TotalAmount,
					Vat,
					VatAmount,
					GrandTotal,
					IsDelete,
					CreatedBy,
					CreatedOnUtc,
					TransactionCreatedOnUtc
				)
				VALUES(
					@CompanyId,
					@TransactionNumber,
					@ExpensesTitle,
					@ExpenseAmount,
					@Quantity,
					@TotalAmount,
					@Vat,
					@VatAmount,
					@GrandTotal,
					0,
					@UserId,
					@CreatedOnUtc,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				)

				SET @returnResult = (SELECT MAX(Id) FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK));
			END
			ELSE
			BEGIN
				SET @returnResult = -1
			END
		END
		ELSE
		BEGIN
			SET @returnResult = -1
		END
	END

	IF CONVERT(INT,@returnResult) > 0
	BEGIN
		SET @Amount = (SELECT ISNULL(BalanceAmount,'0') AS BalanceAmount FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId);

		IF @Amount IS NULL
		BEGIN
			SET @Amount = '0'
		END

		IF CONVERT(DECIMAL(18,2),@Amount) <= 0
		BEGIN
			SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
		END
		ELSE 
		BEGIN
			SET @ChangeAmount = CONVERT(DECIMAL(18,2),@Amount) - CONVERT(DECIMAL(18,2),@GrandTotal);
		END

		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
		BEGIN
			UPDATE [dbo].[Tbl_PortalBalance]
			SET
				BalanceAmount = @ChangeAmount,
				ModifyBy = @UserId,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE CompanyId = @CompanyId
		END
		ELSE
		BEGIN
			INSERT INTO [dbo].[Tbl_PortalBalance](
				UserId,
				CompanyId,
				BalanceAmount,
				CreatedBy,
				CreatedOnUtc,
				IsCompletelyUsed
			)
			VALUES(
				@UserId,
				@CompanyId,
				@ChangeAmount,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				0
			)
		END
	END

	SELECT @returnResult
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAssignedSalesPerson]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_Admin_SaveAssignedSalesPerson 3,0,0,356
CREATE PROCEDURE [dbo].[USP_Admin_SaveAssignedSalesPerson]
	@Status INT = NULL,
	@Id INT = NULL,
	@SalesPersonId INT = NULL,
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1 
	BEGIN
		IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPerson_Company_Mapping] WHERE SalesPersonId = @SalesPersonId AND CompanyId = @CompanyId AND IsDelete <> 1)
		BEGIN
			INSERT INTO [dbo].[Tbl_SalesPerson_Company_Mapping](
				SalesPersonId,
				CompanyId,
				CreatedOnUtc,
				CreatedBy,
				IsDelete
			)
			VALUES(
				@SalesPersonId,
				@CompanyId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				@UserId,
				0
			)
			SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_SalesPerson_Company_Mapping])
			SELECT @returnId
		END
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT 
			tbl_companyMapping.CompanyId AS CompanyId
		FROM [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPersons ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
		WHERE SalesPersonId = @SalesPersonId  AND tbl_companyMapping.IsDelete <> 1
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			tbl_companyMapping.SalesPersonId AS SalesPersonId
		FROM [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPersons ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
		WHERE tbl_company.Id = @CompanyId  AND tbl_companyMapping.IsDelete <> 1
	END
	ELSE IF @Status = 4
	BEGIN
		IF EXISTS(SELECT 
			tbl_companyMapping.SalesPersonId AS SalesPersonId
		FROM [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPersons ON tbl_companyMapping.SalesPersonId = tbl_salesPersons.Id
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
		WHERE tbl_company.Id = @CompanyId  AND tbl_companyMapping.IsDelete <> 1)
		BEGIN
			UPDATE [dbo].[Tbl_SalesPerson_Company_Mapping]
			SET 
				IsDelete = 1,
				ModifyBy = @UserId,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE CompanyId = @CompanyId
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAssignedUserOfSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveAssignedUserOfSupportTicket]
	@Id INT =NULL,
	@TrackingNumber NVARCHAR(MAX) = NULL,
	@UserId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Tbl_AssignSupportTicket](
		TrackingNumber,
		UserId,
		CreatedBy,
		CreatedOn
	)
	VALUES(
		@TrackingNumber,
		@UserId,
		@CreatedBy,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)

	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_AssignSupportTicket])

	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAssignEnquiryFormRequestUser]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveAssignEnquiryFormRequestUser]
	@Id INT = NULL,
	@UserId INT = NULL,
	@RequestId INT = NULL,
	@returnId INT = NULL OUTPUT 
AS
BEGIN
	SET NOCOUNT ON;

	IF @UserId IS NOT NULL AND @UserId <>0
	BEGIN
		INSERT INTO [dbo].[Tbl_AssignEnquiryRequests](
			UserId,
			RequestId,
			IsDelete,
			CreatedOn
		)
		VALUES(
			@UserId,
			@RequestId,
			0,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_AssignEnquiryRequests] WITH(NOLOCK))

		SELECT @returnId
	END

	SELECT 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveAssignServiceRequestUser]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveAssignServiceRequestUser]
	@Id INT = NULL,
	@UserId INT = NULL,
	@SerialNumber NVARCHAR(MAX) = NULL,
	@ServiceId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT 
AS
BEGIN
	SET NOCOUNT ON;

	IF @UserId IS NOT NULL AND @UserId <>0
	BEGIN
		INSERT INTO [dbo].[Tbl_AssignServiceRequest](
			UserId,
			ServiceId,
			SerialNumber,
			CreatedBy,
			CreatedOn
		)
		VALUES(
			@UserId,
			@ServiceId,
			@SerialNumber,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_AssignServiceRequest])

		SELECT @returnId
	END

	SELECT 1
END;

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveCompanyDocuments]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <19-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_SaveCompanyDocuments>
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_SaveCompanyDocuments]
	@FileName NVARCHAR(MAX) = NULL,
	@Extension NVARCHAR(50) = NULL,
	@DataBinary VARBINARY(MAX) = NULL,
	@CompanyId INT = NULL,
	@Title NVARCHAR(MAX) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@SelectedDocumentType INT = NULL,
	@IssueDate NVARCHAR(50) = NULL,
	@ExpiryDate NVARCHAR(50) = NULL,
	@UserId INT = NULL,
	@AuthorityName NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @CompanyId IS NOT NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_Company_Document_Mapping](
			FileName,
			Extension,
			Title,
			Description,
			DataBinary,
			CompanyId,
			IssueDate,
			ExpiryDate,
			AuthorityName,
			CreatedBy,
			CreatedOnUtc,
			IsDeleted,
			DocumentTypeId
		)
		VALUES(
			@FileName,
			@Extension,
			@Title,
			@Description,
			@DataBinary,
			@CompanyId,
			@IssueDate,
			@ExpiryDate,
			@AuthorityName,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			0,
			@SelectedDocumentType
		)

		SELECT MAX(ID) FROM [dbo].[Tbl_Company_Document_Mapping]
	END
	ELSE
	BEGIN
		SELECT -1
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveCompanyInvoiceDeatils]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <06-Sept-2022>
-- <SP_Admin_SaveCompanyInvoiceDeatils>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveCompanyInvoiceDeatils]
	@Id INT = NULL,
	@ProductName NVARCHAR(MAX) = NULL,
	@Quantity INT = NULL,
	@Amount DECIMAL(18,2) = NULL,
	@TotalAmount DECIMAL(18,2) = NULL,
	@GrandTotal DECIMAL(18,2) = NULL,
	@InvoiceNumber NVARCHAR(MAX) = NULL,
	@InvoiceDate NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@Vat DECIMAL(18,2) = NULL,
	@VatAmount DECIMAL(18,2) = NULL,
	@CreatedBy INT = NULL,
	@Service NVARCHAR(MAX) = NULL,
	@Currency NVARCHAR(50) = NULL,
	@returnId NVARCHAR(50) = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @InvoiceGrandTotal DECIMAL(18,2) = NULL

	--IF @InvoiceNumber IS NULL
	--BEGIN
	--	DECLARE @SerialNumber INT = NULL;
	--	IF EXISTS(SELECT Id FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK))
	--	BEGIN
	--		IF EXISTS(SELECT TOP 1 Id FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE InvoiceNumber LIKE 'DCS%' ORDER BY Id DESC)
	--		BEGIN 
	--			SET @SerialNumber = ((SELECT MAX(CONVERT(INT,SUBSTRING(InvoiceNumber,CHARINDEX('S',InvoiceNumber)+1,LEN(InvoiceNumber)))) 
	--									FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK)
	--									WHERE InvoiceNumber LIKE 'DCS%')
	--								)
	--			SET @SerialNumber = @SerialNumber + 1
	--			SET  @InvoiceNumber ='DCS'+ CONVERT(NVARCHAR(100),@SerialNumber);
	--		END
	--		ELSE
	--		BEGIN
	--			SET @SerialNumber = ((SELECT MAX(CONVERT(INT,SUBSTRING(InvoiceNumber,CHARINDEX('N',InvoiceNumber)+1,LEN(InvoiceNumber)))) 
	--									FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK))
	--								)
	--			SET @SerialNumber = @SerialNumber + 1
	--			SET  @InvoiceNumber ='DEVOTION'+ CONVERT(NVARCHAR(100),@SerialNumber);
	--		END
	--	END
	--	ELSE
	--	BEGIN
	--		SET  @InvoiceNumber = 'DCS101';
	--	END
	--END;

	IF @InvoiceNumber IS NULL
	BEGIN
		DECLARE @SerialNumber INT = NULL,
		@lastInvoiceNumber nvarchar(max) = NULL;

		SET @lastInvoiceNumber = (SELECT Top 1 InvoiceNumber FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) ORDER BY Id DESC)

		IF EXISTS(SELECT Id FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK))
		BEGIN
			IF @lastInvoiceNumber LIKE 'DCS%'
			BEGIN 
				SET @SerialNumber = ((SELECT CONVERT(INT,SUBSTRING(@lastInvoiceNumber,CHARINDEX('S',@lastInvoiceNumber)+1,LEN(@lastInvoiceNumber)))))
				SET @SerialNumber = @SerialNumber + 1

				SET  @InvoiceNumber ='DIBN'+ CONVERT(NVARCHAR(100),@SerialNumber);
			END
			ELSE
			BEGIN
				SET @SerialNumber = ((SELECT CONVERT(INT,SUBSTRING(@lastInvoiceNumber,CHARINDEX('N',@lastInvoiceNumber)+1,LEN(@lastInvoiceNumber)))))
				SET @SerialNumber = @SerialNumber + 1
				SET  @InvoiceNumber ='DIBN'+ CONVERT(NVARCHAR(100),@SerialNumber);
			END
		END
		ELSE
		BEGIN
			SET  @InvoiceNumber = 'DIBN101';
		END
	END;

	INSERT INTO [dbo].[Tbl_CompanyInvoiceDetail](
		ProductName,
		Quantity,
		Amount,
		TotalAmount,
		Vat,
		VatAmount,
		GrandTotal,
		InvoiceNumber,
		InvoiceCreatedOn,
		CompanyId,
		Services,
		Currency,
		IsActive,
		IsDelete,
		CreatedOn,
		CreatedBy
	)
	VALUES (
		@ProductName,
		@Quantity,
		@Amount,
		@TotalAmount,
		@Vat,
		@VatAmount,
		@GrandTotal,
		@InvoiceNumber,
		@InvoiceDate,
		@CompanyId,
		@Service,
		@Currency,
		1,
		0,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		@CreatedBy
	)


	SET @InvoiceGrandTotal = (SELECT (SUM(TotalAmount) + SUM(VatAmount)) AS GrandTotal FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK)
	WHERE InvoiceNumber = @InvoiceNumber AND IsDelete <> 1)

	UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
	SET
		GrandTotal = @InvoiceGrandTotal
	WHERE InvoiceNumber LIKE @InvoiceNumber

	IF @Currency IS NULL AND EXISTS(SELECT Id FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE InvoiceNumber LIKE @InvoiceNumber)
	BEGIN
		SET @Currency = (SELECT TOP 1 Currency FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK) WHERE InvoiceNumber LIKE @InvoiceNumber)

		UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
		SET
			Currency = @Currency
		WHERE InvoiceNumber LIKE @InvoiceNumber
	END

	SET @returnId = @InvoiceNumber

	SELECT @returnId AS InvoiceNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveCompanyInvoicePdf]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_SaveCompanyInvoicePdf 2,1>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_SaveCompanyInvoicePdf]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@Id INT = NULL,
	@Name NVARCHAR(MAX) =NULL,
	@Extension NVARCHAR(MAX) = NULL,
	@DataBinary VARBINARY(MAX) =NULL,
	@InvoiceNumber NVARCHAR(MAX) = NULL,
	@InvoiceDate NVARCHAR(MAX) = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	IF @Status = 1
	BEGIN
		IF EXISTS(
			SELECT Id FROM [dbo].[Tbl_CompanyInvoicePdf] WITH(NOLOCK) WHERE InvoiceNumber LIKE @InvoiceNumber
		)
		BEGIN
			UPDATE [dbo].[Tbl_CompanyInvoicePdf]
			SET
				IsDelete = 1
			WHERE InvoiceNumber LIKE @InvoiceNumber

			INSERT INTO [dbo].[Tbl_CompanyInvoicePdf](
				PdfName,
				Extension,
				DataBinary,
				InvoiceNumber,
				IsActive,
				IsDelete,
				CreatedOn,
				CreatedBy
			)
			VALUES(
				@Name,
				@Extension,
				@DataBinary,
				@InvoiceNumber,
				1,
				0,
				@InvoiceDate,
				@CreatedBy
			)
		END
		ELSE 
		BEGIN
			INSERT INTO [dbo].[Tbl_CompanyInvoicePdf](
				PdfName,
				Extension,
				DataBinary,
				InvoiceNumber,
				IsActive,
				IsDelete,
				CreatedOn,
				CreatedBy
			)
			VALUES(
				@Name,
				@Extension,
				@DataBinary,
				@InvoiceNumber,
				1,
				0,
				@InvoiceDate,
				@CreatedBy
			)
		END

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_CompanyInvoicePdf] WITH(NOLOCK))
		SELECT @returnId
	END
	ELSE IF @Status =2 
	BEGIN
		SELECT DISTINCT
			tbl_companypdf.Id AS Id,
			tbl_companypdf.PdfName AS [Name],
			tbl_companypdf.Extension AS Extension,
			tbl_companypdf.DataBinary AS DataBinary,
			tbl_companypdf.InvoiceNumber AS InvoiceNumber,
			tbl_Company.CompanyName AS Company,
			CONVERT(nvarchar(50),tbl_companypdf.CreatedOn,105) AS CreatedOn,
			ISNULL(tbl_companypdf.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username
		FROM [dbo].[Tbl_CompanyInvoicePdf] tbl_companypdf WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_CompanyInvoiceDetail] tbl_companyInvoiceDetails WITH(NOLOCK) ON tbl_companyInvoiceDetails.InvoiceNumber LIKE tbl_companypdf.InvoiceNumber
		LEFT JOIN [dbo].[Tbl_Company] tbl_Company WITH(NOLOCK) ON tbl_Company.Id = tbl_companyInvoiceDetails.CompanyId
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_companypdf.CreatedBy
		WHERE (tbl_companyInvoiceDetails.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0 ) AND
		(tbl_companypdf.Id = @Id OR @Id IS NULL OR @Id = 0) AND tbl_companypdf.IsDelete <> 1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveCompanyPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Use to do Save Permission for Company by Admin.>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveCompanyPermission]
	@CompanyId INT = NULL,
	@ModuleId INT = NULL,
	@PermissionId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Tbl_CompanyPermission](
		CompanyId,
		ModuleId,
		PermissionId,
		IsActive,
		IsDelete,
		CreatedOn,
		ModifyOn
	)
	VALUES(
		@CompanyId,
		@ModuleId,
		@PermissionId,
		1,
		0,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)
	SET @returnId = (SELECT MAX(CompanyPermissionId) FROM [dbo].[Tbl_CompanyPermission] WITH(NOLOCK))
	SELECT @returnId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveCompanyServiceRequestDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_SaveCompanyServiceRequestDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Insert new Company Service Request
-- USP_Admin_SaveCompanyServiceRequestDetails
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_SaveCompanyServiceRequestDetails]
	@SerialNumber NVARCHAR(MAX) = NULL,
	@ServiceId INT = NULL,
	@RequestedService NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@StatusId INT = NULL,
	@IsSalesPerson INT = NULL,
	@IsRMTeam INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @SerialCode INT = NULL,
	@CompanyName NVARCHAR(MAX) = NULL,
	@RequestedBy NVARCHAR(MAX) = NULL,
	@CreatedOn datetime2(7) = NULL,
	@Status NVARCHAR(MAX) = NULL,
	@SalesPerson NVARCHAR(MAX) = NULL

	SET @SerialCode =(SELECT CONVERT(INT,SUBSTRING(@SerialNumber,CHARINDEX('R',@SerialNumber)+1,LEN(@SerialNumber))))

	SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

	IF @IsSalesPerson = 1
	BEGIN
		SET @RequestedBy = (SELECT FirstName + ' ' + LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = @UserId) 
	END
	ELSE IF @IsRMTeam = 1
	BEGIN
		SET @RequestedBy = (SELECT FirstName + ' ' + LastName FROM [dbo].[Tbl_RMTeam] WHERE Id = @UserId) 
	END
	ELSE
	BEGIN
		SET @RequestedBy = (SELECT FirstName + ' ' + LastName FROM [dbo].[Tbl_User] WHERE Id = @UserId) 
	END

	SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

	SET @Status = (SELECT Status FROM [dbo].[Tbl_ServiceRequestStatus] WHERE DisplayId = @StatusId)

	SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					    WITH(NOLOCK)
					    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
	                    WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('')), 1, 1, ''))


	INSERT INTO [dbo].[Tbl_CompanyServiceRequests](
		SerialNumber,
		SerialCode,
		ServiceId,
		RequestedService,
		CompanyId,
		CompanyName,
		RequestedBy,
		CreatedOn,
		StatusId,
		Status,
		SalesPerson,
		IsActive,
		IsDelete,
		CreatedOnUtc
	)
	VALUES(
		@SerialNumber,
		@SerialCode,
		@ServiceId,
		@RequestedService,
		@CompanyId,
		@CompanyName,
		@RequestedBy,
		@CreatedOn,
		@StatusId,
		@Status,
		@SalesPerson,
		1,
		0,
		@CreatedOn
	)

END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveEmailDocuments]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveEmailDocuments]
	@EmailId INT = NULL,
	@FileName NVARCHAR(50) = NULL,
	@Extension NVARCHAR(50) = NULL,
	@DateBinary VARBINARY(MAX) = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Tbl_EmailDocument](
		EmailId,
		Filename,
		Extension,
		DataBinary,
		CreatedBy,
		CreatedOn,
		IsActive,
		IsDelete
	)
	VALUES(
		@EmailId,
		@FileName,
		@Extension,
		@DateBinary,
		@CreatedBy,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		1,
		0
	)


	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_EmailDocument] WITH(NOLOCK))
	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveEmailInfo]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveEmailInfo]
	@MailFrom NVARCHAR(MAX) = NULL,
	@Password NVARCHAR(MAX) = NULL,
	@MailTo NVARCHAR(MAX) = NULL,
	@Subject NVARCHAR(MAX) = NULL,
	@MailBody NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Tbl_Email](
		MailFrom,
		MailFromPassword,
		MailTo,
		Subject,
		MailBody,
		CompanyId,
		IsActive,
		IsDelete,
		CreatedBy,
		CreatedOn
	)
	VALUES(
		@MailFrom,
		@Password,
		@MailTo,
		@Subject,
		@MailBody,
		@CompanyId,
		1,
		0,
		@CreatedBy,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)

	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_Email] WITH(NOLOCK))
	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveEmployeeServiceRequestDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_SaveEmployeeServiceRequestDetails
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Insert new Company Service Request
-- USP_Admin_SaveEmployeeServiceRequestDetails
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_SaveEmployeeServiceRequestDetails]
	@SerialNumber NVARCHAR(MAX) = NULL,
	@ServiceId INT = NULL,
	@RequestedService NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@StatusId INT = NULL,
	@IsSalesPerson INT = NULL,
	@IsRMTeam INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @SerialCode INT = NULL,
	@CompanyName NVARCHAR(MAX) = NULL,
	@RequestedBy NVARCHAR(MAX) = NULL,
	@CreatedOn datetime2(7) = NULL,
	@Status NVARCHAR(MAX) = NULL,
	@SalesPerson NVARCHAR(MAX) = NULL

	SET @SerialCode =(SELECT CONVERT(INT,SUBSTRING(@SerialNumber,CHARINDEX('R',@SerialNumber)+1,LEN(@SerialNumber))))

	SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

	IF @IsSalesPerson = 1
	BEGIN
		SET @RequestedBy = (SELECT FirstName + ' ' + LastName FROM [dbo].[Tbl_SalesPersons] WHERE Id = @UserId) 
	END
	ELSE IF @IsRMTeam = 1
	BEGIN
		SET @RequestedBy = (SELECT FirstName + ' ' + LastName FROM [dbo].[Tbl_RMTeam] WHERE Id = @UserId) 
	END
	ELSE
	BEGIN
		SET @RequestedBy = (SELECT FirstName + ' ' + LastName FROM [dbo].[Tbl_User] WHERE Id = @UserId) 
	END

	SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')

	SET @Status = (SELECT Status FROM [dbo].[Tbl_ServiceRequestStatus] WHERE DisplayId = @StatusId)

	SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					    WITH(NOLOCK)
					    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
	                    WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('')), 1, 1, ''))


	INSERT INTO [dbo].[Tbl_EmployeeServiceRequests](
		SerialNumber,
		SerialCode,
		ServiceId,
		RequestedService,
		CompanyId,
		CompanyName,
		RequestedBy,
		CreatedOn,
		StatusId,
		Status,
		SalesPerson,
		IsActive,
		IsDelete,
		CreatedOnUtc
	)
	VALUES(
		@SerialNumber,
		@SerialCode,
		@ServiceId,
		@RequestedService,
		@CompanyId,
		@CompanyName,
		@RequestedBy,
		@CreatedOn,
		@StatusId,
		@Status,
		@SalesPerson,
		1,
		0,
		@CreatedOn
	)

END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveMessageTemplate]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveMessageTemplate]
	@Id INT = NULL,
	@Name NVARCHAR(MAX) = NULL,
	@Subject NVARCHAR(MAX) = NULL,
	@MailFrom NVARCHAR(MAX) = NULL,
	@Body NVARCHAR(MAX) = NULL,
	@IsActive BIT = NULL,
	@UserId INT = NULL,
	@IsDelete INT = NULL,
	@returnId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Id IS NULL OR @Id = 0 
	BEGIN
		INSERT INTO [dbo].[Tbl_MessageTemplate](
			Name,
			Subject,
			MailFrom,
			Body,
			IsActive,
			IsDelete,
			CreatedOn,
			CreatedBy
		)
		VALUES(
			@Name,
			@Subject,
			@MailFrom,
			@Body,
			@IsActive,
			0,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			@UserId
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_MessageTemplate]);
		SELECT @returnId
	END
	ELSE IF @Id IS NOT NULL OR @Id <> 0
	BEGIN
		UPDATE [dbo].[Tbl_MessageTemplate]
		SET
			Name = @Name,
			Subject = @Subject,
			MailFrom = @MailFrom,
			Body = @Body,
			IsActive = @IsActive,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			ModifyBy = @UserId
		WHERE Id = @Id

		SELECT @Id
	END
	--ELSE IF @IsDelete IS NOT NULL AND (@Id IS NOT NULL OR @Id <> 0)
	--BEGIN
	--	UPDATE [dbo].[Tbl_MessageTemplate]
	--	SET
	--		IsDelete = 1
	--	WHERE Id = @Id
	--END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveNewCompanyInvoiceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <02-07-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description : Save Details of Invoice for Company which is not Created in DIBN System.
-- <USP_Admin_SaveNewCompanyInvoiceDetails>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_SaveNewCompanyInvoiceDetails]
	@Id INT = NULL,
	@CompanyName NVARCHAR(MAX) = NULL,
	@CompanyAddress NVARCHAR(MAX) = NULL,
	@CompanyCity NVARCHAR(MAX) = NULL,
	@CompanyCountry NVARCHAR(MAX) = NULL,
	@ContactNumber  NVARCHAR(50) = NULL,
	@ProductName NVARCHAR(MAX) = NULL,
	@Quantity INT = NULL,
	@Amount DECIMAL(18,2) = NULL,
	@TotalAmount DECIMAL(18,2) = NULL,
	@GrandTotal DECIMAL(18,2) = NULL,
	@InvoiceNumber NVARCHAR(MAX) = NULL,
	@InvoiceDate NVARCHAR(MAX) = NULL,
	@Vat DECIMAL(18,2) = NULL,
	@VatAmount DECIMAL(18,2) = NULL,
	@CreatedBy INT = NULL,
	@Service NVARCHAR(MAX) = NULL,
	@Currency NVARCHAR(50) = NULL,
	@returnId NVARCHAR(50) = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @InvoiceGrandTotal DECIMAL(18,2) = NULL

	IF @InvoiceNumber IS NULL
	BEGIN
		DECLARE @NewInvoice INT = NULL;
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WITH(NOLOCK))
		BEGIN
			SET @NewInvoice = ((SELECT MAX(CONVERT(INT,SUBSTRING(InvoiceNumber,CHARINDEX('I',InvoiceNumber)+1,LEN(InvoiceNumber)))) 
							FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WITH(NOLOCK))
								)
			SET @NewInvoice = @NewInvoice + 1
			SET  @InvoiceNumber ='PI'+ CONVERT(NVARCHAR(100),@NewInvoice);
		END
		ELSE 
		BEGIN
			SET  @InvoiceNumber ='PI101';
		END
	END

	INSERT INTO [dbo].[Tbl_NewCompanyInvoiceDetails](
		CompanyName,
		Address,
		City,
		Country,
		ContactNumber,
		ProductName,
		Quantity,
		Amount,
		TotalAmount,
		GrandTotal,
		Vat,
		VatAmount,
		Service,
		InvoiceNumber,
		InvoiceCreationDate,
		Currency,
		CreatedOn,
		CreatedBy,
		IsActive,
		IsDelete
	)
	VALUES(
		@CompanyName,
		@CompanyAddress,
		@CompanyCity,
		@CompanyCountry,
		@ContactNumber,
		@ProductName,
		@Quantity,
		@Amount,
		@TotalAmount,
		@GrandTotal,
		@Vat,
		@VatAmount,
		@Service,
		@InvoiceNumber,
		@InvoiceDate,
		@Currency,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		@CreatedBy,
		1,
		0
	)	

	SET @InvoiceGrandTotal = (SELECT (SUM(TotalAmount) + SUM(VatAmount)) AS GrandTotal FROM [dbo].[Tbl_NewCompanyInvoiceDetails]
	WHERE InvoiceNumber = @InvoiceNumber AND IsDelete <> 1)

	UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
	SET
		GrandTotal = @InvoiceGrandTotal
	WHERE InvoiceNumber LIKE @InvoiceNumber

	--IF @GrandTotal IS NOT NULL AND EXISTS(SELECT Id FROM [dbo].[Tbl_NewCompanyInvoiceDetails] WHERE InvoiceNumber LIKE @InvoiceNumber)
	--BEGIN
	--	UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
	--	SET
	--		GrandTotal = @GrandTotal
	--	WHERE InvoiceNumber LIKE @InvoiceNumber
	--END

	IF @Currency IS NULL AND EXISTS(SELECT Id FROM [dbo].[Tbl_CompanyInvoiceDetail] WHERE InvoiceNumber LIKE @InvoiceNumber)
	BEGIN
		SET @Currency = (SELECT TOP 1 Currency FROM [dbo].[Tbl_CompanyInvoiceDetail] WHERE InvoiceNumber LIKE @InvoiceNumber)

		UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
		SET
			Currency = @Currency
		WHERE InvoiceNumber LIKE @InvoiceNumber
	END

	SET @returnId = @InvoiceNumber;

	SELECT @returnId AS InvoiceNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SavePaymentReceipt]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SavePaymentReceipt]
	@CompanyId INT = NULL,
	@PaymentId INT = NULL,
	@PaymentThrough NVARCHAR(MAX) = NULL,
	@OnAccount NVARCHAR(MAX) =NULL,
	@UserId INT = NULL,
	@CreatedOn NVARCHAR(MAX) = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;


	DECLARE @SerialNumber INT = NULL,@NewSerialNumber NVARCHAR(100) = NULL;
	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK))
	BEGIN
		SET @SerialNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(SerialNumber,CHARINDEX('B',SerialNumber)+1,LEN(SerialNumber)))) 
							FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK));
		SET @SerialNumber = @SerialNumber + 1
		SET  @NewSerialNumber ='RECDB'+ CONVERT(NVARCHAR(100),@SerialNumber);
	END
	ELSE
	BEGIN
		SET  @NewSerialNumber = 'RECDB101';
	END


	IF @CreatedOn IS NULL
	BEGIN
		SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	END
	
	IF @CompanyId IS NOT NULL
	BEGIN

		INSERT INTO [dbo].[Tbl_PaymentReceipt](
			CompanyId,
			PaymentId,
			SerialNumber,
			Through,
			OnAccount,
			CreatedOn,
			CreatedBy,
			IsDelete
		)
		VALUES(
			@CompanyId,
			@PaymentId,
			@NewSerialNumber,
			@PaymentThrough,
			@OnAccount,
			@CreatedOn,
			@UserId,
			0
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_PaymentReceipt] WITH(NOLOCK))

		SELECT @returnId
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveRequestNotifications]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <14-June-2022>
-- Modify By : <name,>
-- Modify date : <date,>
-- Description:	To store all response , reply , created request and assign request details of service/support ticket for notification.
-- SP_Admin_SaveRequestNotifications
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveRequestNotifications]
	@Type NVARCHAR(50) = NULL,
	@RequestCreatedOn NVARCHAR(50) = NULL,
	@AssignedUserId INT = NULL,
	@AssignedOn NVARCHAR(50) = NULL,
	@AssignedBy	INT = NULL,
	@SerialNumber NVARCHAR(100) = NULL,
	@TrackingNumber NVARCHAR(100) = NULL,
	@EnquiryNumber NVARCHAR(100) = NULL,
	@ServiceCreatedBy INT = NULL,
	@SupportTicketCreatedBy INT = NULL,
	@ServiceCreatedBySales INT = NULL,
	@SupportTicketCreatedBySales INT = NULL,
	@Title NVARCHAR(MAX) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@ResponseType NVARCHAR(50) = NULL,
	@ResponseCreatedBy INT = NULL,
	@CompanyId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	IF @SerialNumber IS NOT NULL
	BEGIN
		--IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RequestNotification] WHERE SerialNumber LIKE @SerialNumber)
		--BEGIN
			INSERT INTO [dbo].[Tbl_RequestNotification](
				Type,
				RequestCreatedOn,
				AssignedUserId,
				AssignedOn,
				AssignedBy,
				SerialNumber,
				TrackingNumber,
				EnquiryNumber,
				MarkAsRead,
				ServiceCreatedBy,
				ServiceCreatedBySalesPerson,
				CompanyId,
				Title,
				Description,
				ResponseType,
				AssignedUserMarkAsRead,
				IsActive,
				IsDelete,
				CreatedOn
			)
			VALUES(
				@Type,
				@RequestCreatedOn,
				@AssignedUserId,
				@AssignedOn,
				@AssignedBy,
				@SerialNumber,
				@TrackingNumber,
				@EnquiryNumber,
				0,
				@ServiceCreatedBy,
				@ServiceCreatedBySales,
				@CompanyId,
				@Title,
				@Description,
				@ResponseType,
				0,
				1,
				0,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		--END
	END
	ELSE IF @TrackingNumber IS NOT NULL
	BEGIN
		--IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RequestNotification] WHERE TrackingNumber LIKE @TrackingNumber)
		--BEGIN
			INSERT INTO [dbo].[Tbl_RequestNotification](
				Type,
				RequestCreatedOn,
				AssignedUserId,
				AssignedOn,
				AssignedBy,
				SerialNumber,
				TrackingNumber,
				EnquiryNumber,
				MarkAsRead,
				SupportTicketCreatedBy,
				SupportTicketCreatedBySalesPerson,
				CompanyId,
				Title,
				Description,
				ResponseType,
				AssignedUserMarkAsRead,
				IsActive,
				IsDelete,
				CreatedOn
			)
			VALUES(
				@Type,
				@RequestCreatedOn,
				@AssignedUserId,
				@AssignedOn,
				@AssignedBy,
				@SerialNumber,
				@TrackingNumber,
				@EnquiryNumber,
				0,
				@SupportTicketCreatedBy,
				@SupportTicketCreatedBySales,
				@CompanyId,
				@Title,
				@Description,
				@ResponseType,
				0,
				1,
				0,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		--END
	END
	ELSE IF @EnquiryNumber IS NOT NULL
	BEGIN
		--IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_RequestNotification] WHERE SerialNumber LIKE @SerialNumber)
		--BEGIN
			INSERT INTO [dbo].[Tbl_RequestNotification](
				Type,
				RequestCreatedOn,
				AssignedUserId,
				AssignedOn,
				AssignedBy,
				SerialNumber,
				TrackingNumber,
				EnquiryNumber,
				MarkAsRead,
				ServiceCreatedBy,
				ResponseCreatedBy,
				CompanyId,
				Title,
				Description,
				ResponseType,
				AssignedUserMarkAsRead,
				IsActive,
				IsDelete,
				CreatedOn
			)
			VALUES(
				@Type,
				@RequestCreatedOn,
				@AssignedUserId,
				@AssignedOn,
				@AssignedBy,
				@SerialNumber,
				@TrackingNumber,
				@EnquiryNumber,
				0,
				@ServiceCreatedBy,
				@ResponseCreatedBy,
				@CompanyId,
				@Title,
				@Description,
				@ResponseType,
				0,
				1,
				0,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		--END
	END
	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_RequestNotification] WITH(NOLOCK))

	SELECT @returnId;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveRolePermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Use to do Save Permission for Role by Admin.>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveRolePermission]
	@RoleId INT = NULL,
	@ModuleId INT = NULL,
	@PermissionId INT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF NOT EXISTS(SELECT RoleID FROM [dbo].[Tbl_RolePermission] WHERE RoleID =  @RoleId AND ModuleId= @ModuleId AND PermissionId = @PermissionId AND IsDelete<>1)
	BEGIN
		INSERT INTO [dbo].[Tbl_RolePermission](
			RoleID,
			ModuleId,
			PermissionId,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOn
		)
		VALUES(
			@RoleId,
			@ModuleId,
			@PermissionId,
			1,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)
	END

	

	SET @returnId = (SELECT MAX(RolePermissionId) FROM [dbo].[Tbl_RolePermission] WITH(NOLOCK))
	SELECT @returnId
	
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveServiceForm]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveServiceForm]
	@Id INT = NULL,
	@FormName NVARCHAR(MAX) = NULL,
	@ServiceId INT = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_ServiceForms] WHERE FormName LIKE @FormName AND IsActive <> 0 AND IsDelete<> 0)
	BEGIN
		INSERT INTO [dbo].[Tbl_ServiceForms](
			FormName,
			ServiceId,
			IsActive,
			IsDelete,
			CreatedOn,
			CreatedBy
		)
		VALUES (
			@FormName,
			@ServiceId,
			1,
			0,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			@UserId
		)
	END

	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_ServiceForms] WITH(NOLOCK))

	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveServiceFormFieldValues]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveServiceFormFieldValues]
	@Id INT = NULL,
	@ServiceId INT = NULL,
	@FormId INT = NULL,
	@FieldId INT = NULL,
	@FieldValue NVARCHAR(MAX) = NULL,
	@FieldFileValue VARBINARY(MAX) = NULL,
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@SalesPerson INT = NULL,
	@RMTeamId INT = NULL,
	@FileName NVARCHAR(MAX) = NULL,
	@SerialNumber NVARCHAR(MAX) = NULL,
	@Last INT = NULL,
	@returnId NVARCHAR(50) = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	DECLARE @Title NVARCHAR(MAX) = NULL;

	DECLARE @NewSerialNumber NVARCHAR(100) = NULL;


	INSERT INTO [dbo].[Tbl_ServiceFormFieldValue](
		ServiceId,
		FormId,
		FieldId,
		FieldValue,
		FileName,
		FieldFileValue,
		CompanyId,
		UserId,
		SalesPersonId,
		RMTeamId,
		SerialNumber,
		IsActive,
		IsDelete,
		CreatedOn,
		CreatedBy
	)
	VALUES(
		@ServiceId,
		@FormId,
		@FieldId,
		@FieldValue,
		@FileName,
		@FieldFileValue,
		@CompanyId,
		@UserId,
		@SalesPerson,
		@RMTeamId,
		@SerialNumber,
		1,
		0,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		@UserId
	)

	IF @Last IS NOT NULL AND @Last <> 0
	BEGIN
		SET @Title = (SELECT FormName FROM [dbo].[Tbl_ServiceForms] WHERE Id=@FormId)
		INSERT INTO [dbo].[Tbl_ServiceRequest](
			SerialNumber,
			ServiceId,
			FormId,
			CompanyId,
			UserId,
			SalesPersonId,
			RMTeamId,
			Title,
			[Description],
			AssignedTo,
			[Status],
			StepId,
			CreatedBy,
			CreatedOn
		)
		VALUES (
			@SerialNumber,
			@ServiceId,
			@FormId,
			@CompanyId,
			@UserId,
			@SalesPerson,
			@RMTeamId,
			@Title,
			'',
			0,
			2,
			0,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)
	END


	SET @returnId = @SerialNumber
	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveServiceRequestDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveServiceRequestDocument]
	@ServiceResponseId INT = NULL,
	@ServiceId INT = NULL,
	@CompanyId INT = NULL,
	@FileName NVARCHAR(MAX) = NULL,
	@DataBinary VARBINARY(MAX) = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;

	INSERT INTO [dbo].[Tbl_ServiceRequestDocument](
		ServiceResponseId,
		ServiceId,
		CompanyId,
		FileName,
		DataBinary,
		CreatedBy,
		CreatedOnUtc
	)
	VALUES(
		@ServiceResponseId,
		@ServiceId,
		@CompanyId,
		@FileName,
		@DataBinary,
		@UserId,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)

	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequestDocument] WITH(NOLOCK))
	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveServiceRequestStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_SaveServiceRequestStatus]
	@SerialNumber NVARCHAR(MAX) = NULL,
	@ServiceId INT = NULL,
	@FormId INT = NULL,
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@Title NVARCHAR(MAX) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@AssignedTo INT = NULL,
	@Status INT = NULL,
	@StepId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET DEADLOCK_PRIORITY HIGH;

	INSERT INTO [dbo].[Tbl_ServiceRequest](
		SerialNumber,
		ServiceId,
		FormId,
		CompanyId,
		UserId,
		Title,
		[Description],
		AssignedTo,
		[Status],
		StepId,
		CreatedBy,
		CreatedOn
	)
	VALUES (
		@SerialNumber,
		@ServiceId,
		@FormId,
		@CompanyId,
		@UserId,
		@Title,
		@Description,
		@AssignedTo,
		@Status,
		@StepId,
		@UserId,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)

	SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequest] WITH(NOLOCK))
	SELECT @returnId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveTemporaryAccountManagementLog]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_SaveTemporaryAccountManagementLog
-- Author:			<Yashasvi Sharma>
-- Created date:	24/Aug/2023
-- Description:		Save Temporary Account Management Log
-- USP_Admin_SaveTemporaryAccountManagementLog
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveTemporaryAccountManagementLog]
	@Id INT = NULL,
	@CreatedBy INT = NULL,
	@ModifyBy INT = NULL,
	@ApprovedBy INT = NULL,
	@RejectedBy INT = NULL,
	@IsDelete BIT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @CreatedOn DATETIME2(7) = NULL,
			@ApprovedOn DATETIME2(7) = NULL,
			@ModifyOn DATETIME2(7) = NULL,
			@RejectedOn DATETIME2(7) = NULL,
			@IsApproved BIT = NULL,
			@IsRejected BIT = NULL


	IF @CreatedBy IS NOT NULL AND @CreatedBy <> 0
	BEGIN
		SET @CreatedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	END

	IF @ModifyBy IS NOT NULL AND @ModifyBy <> 0
	BEGIN
		SET @ModifyOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
	END

	IF @ApprovedBy IS NOT NULL AND @ApprovedBy <> 0
	BEGIN
		SET @ApprovedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
		SET @IsApproved = 1
	END

	IF @RejectedBy IS NOT NULL AND @RejectedBy <> 0
	BEGIN
		SET @RejectedOn = (SELECT SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time')
		SET @IsRejected = 1
	END

	INSERT INTO [dbo].[Tbl_TemporaryAccountManagementLog](
		TransactionId,
		TransactionDate,
		CompanyId,
		Description,
		EntryType,
		Amount,
		Quantity,
		TotalAmount,
		Vat,
		VatAmount,
		GrandTotal,
		CreatedBy,
		CreatedOn,
		ModifyBy,
		ModifyOn,
		IsApproved,
		ApprovedBy,
		ApprovedOn,
		IsRejected,
		RejectedBy,
		RejectedOn,
		IsDelete
	)
	SELECT
		tbl_tempAccountManagement.TransactionId,
		tbl_tempAccountManagement.TransactionDate,
		tbl_tempAccountManagement.CompanyId,
		tbl_tempAccountManagement.Description,
		tbl_tempAccountManagement.EntryType,
		tbl_tempAccountManagement.Amount,
		tbl_tempAccountManagement.Quantity,
		tbl_tempAccountManagement.TotalAmount,
		tbl_tempAccountManagement.Vat,
		tbl_tempAccountManagement.VatAmount,
		tbl_tempAccountManagement.GrandTotal,
		@CreatedBy,
		@CreatedOn,
		@ModifyBy,
		@ModifyOn,
		@IsApproved,
		@ApprovedBy,
		@ApprovedOn,
		@IsRejected,
		@RejectedBy,
		@RejectedOn,
		@IsDelete
	FROM [dbo].[Tbl_TempAccountManagement] tbl_tempAccountManagement
	WHERE tbl_tempAccountManagement.Id = @Id
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SaveUserPermission]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <25-Dec-2021>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Use to do Save Permission for User by Admin.>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SaveUserPermission]
	@UserId INT = NULL,
	@ModuleId INT = NULL,
	@PermissionId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Tbl_UserPermission](
		UserId,
		ModuleId,
		PermissionId,
		IsActive,
		IsDelete,
		CreatedBy,
		CreatedOn
	)
	VALUES(
		@UserId,
		@ModuleId,
		@PermissionId,
		1,
		0,
		@CreatedBy,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	)
	SET @returnId = (SELECT MAX(UserPermissionId) FROM [dbo].[Tbl_UserPermission] WITH(NOLOCK))
	SELECT @returnId
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SearchServices]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_SearchServices N'R'>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_SearchServices]
	@ServiceName NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_companyService.ServiceName AS ServiceName
	FROM [dbo].[Tbl_CompanyServices] tbl_companyService WITH(NOLOCK)
	WHERE tbl_companyService.ServiceName LIKE @ServiceName +'%' 
		AND tbl_companyService.ParentId <> 0 
		AND tbl_companyService.IsDelete <> 1
		AND tbl_companyService.IsActive <> 0


	SELECT 
		tbl_employeeService.ServiceName AS ServiceName
	FROM [dbo].[Tbl_EmployeeServices] tbl_employeeService WITH(NOLOCK)
	WHERE tbl_employeeService.ServiceName LIKE @ServiceName +'%'
		AND tbl_employeeService.ParentId <> 0 
		AND tbl_employeeService.IsDelete <> 1
		AND tbl_employeeService.IsActive <> 0

END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Select_GetAllCompanySubTypes]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_Select_GetAllCompanySubTypes
-- Author:			<Yashasvi Sharma>
-- Created date:	16/Oct/2024
-- Description:		Get all company sub types
-- USP_Admin_Select_GetAllCompanySubTypes 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Select_GetAllCompanySubTypes]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		tbl_company.Id AS Id,
		tbl_company.MainType AS CompanyType,
		tbl_company.SubType AS CompanySubType
	FROM [dbo].[Tbl_CompanySubType] tbl_company WITH(NOLOCK)
	WHERE tbl_company.IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Select_GetAssignedCompanyToRMTeam]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		USP_Admin_Select_GetAssignedCompanyToRMTeam
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description: get assigned company
-- USP_Admin_Select_GetAssignedCompanyToRMTeam 1
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Select_GetAssignedCompanyToRMTeam]
	@RmTeamId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		CompanyId AS CompanyId
	FROM [dbo].[Tbl_RMTeam_Company_Mapping] WITH(NOLOCK)
	WHERE RMTeamId = @RmTeamId
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Select_GetAssignedRMTeamToCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		USP_Admin_Select_GetAssignedRMTeamToCompany
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description: get assigned company
-- USP_Admin_Select_GetAssignedRMTeamToCompany 2764
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Select_GetAssignedRMTeamToCompany]
	@CompanyId int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		RMTeamId AS Id
	FROM [dbo].[Tbl_RMTeam_Company_Mapping] WITH(NOLOCK)
	WHERE CompanyId = @CompanyId
	AND IsDelete <> 1
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Select_GetCompanyTypeDetailById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_Select_GetCompanyTypeDetailById
-- Author:			<Yashasvi Sharma>
-- Created date:	16/Oct/2024
-- Description:		Get company sub type details
-- USP_Admin_Select_GetCompanyTypeDetailById 1
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Select_GetCompanyTypeDetailById]
	@Id int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT
		tbl_company.Id AS Id,
		tbl_company.MainType AS CompanyType,
		tbl_company.SubType AS CompanySubType
	FROM [dbo].[Tbl_CompanySubType] tbl_company WITH(NOLOCK)
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.Id = @Id
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Select_GetRMTeamDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<USP_Admin_Select_GetRMTeamDetails Sharma>
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	RM Team 
-- USP_Admin_Select_GetRMTeamDetails
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Select_GetRMTeamDetails]
	@Id int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_rmTeam.Id,0) AS Id,
		ISNULL(tbl_rmTeam.Firstname,'N/A') AS Firstname,
		ISNULL(tbl_rmTeam.Lastname,'N/A') AS Lastname,
		tbl_rmTeam.Password AS Password,
		ISNULL(tbl_rmTeam.EmailAddress,'N/A') AS EmailAddress,
		ISNULL(tbl_rmTeam.MobileCode,'N/A') AS MobileCode,
		ISNULL(tbl_rmTeam.MobileNumber,'N/A') AS MobileNumber,
		ISNULL(tbl_rmTeam.CountryofResidence,'N/A') AS CountryOfResidence,
		ISNULL(tbl_rmTeam.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(nvarchar(50),tbl_rmTeam.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		ISNULL(CONVERT(nvarchar(50),tbl_rmTeam.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_rmTeam.Designation,'N/A') AS Designation,
		ISNULL(tbl_rmTeam.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(nvarchar(50),tbl_rmTeam.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_rmTeam.IsLoginAllowed,0) AS IsLoginAllowed,
		ISNULL(tbl_rmTeam.IsActive,0) AS IsActive
	FROM [dbo].[Tbl_RMTeam] tbl_rmTeam WITH(NOLOCK)
	WHERE tbl_rmTeam.IsDelete <> 1
	AND tbl_rmTeam.Id = @Id
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_Select_GetRMTeamListWithPagination]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<USP_Admin_Select_GetRMTeamListWithPagination Sharma>
-- Create date: <10-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	RM Team With Pagiantion
-- USP_Admin_Select_GetRMTeamListWithPagination 10,0,N'',N'',N''
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_Select_GetRMTeamListWithPagination]
	@fetchRows  INT = NULL,
	@skipRows INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query nvarchar(max) = '',
		    @subQuery nvarchar(max) = '',
			@condition nvarchar(max) = '',
			@groupBy nvarchar(max) = '',
			@orderBy nvarchar(max) = '',
			@pagination nvarchar(max) ='',
			@selectQuery nvarchar(max) = '';


	SET @query = N'
					WITH
					tblRMTeam
					AS
					(
						SELECT DISTINCT
							ISNULL(tbl_rmTeam.Id,0) AS Id,
							ISNULL(tbl_rmTeam.Firstname + '''' + CASE WHEN ISNULL(tbl_rmTeam.Lastname,''N/A'') NOT LIKE ''N/A'' THEN +'' '' + tbl_rmTeam.Lastname END,''N/A'') AS [Name],
							ISNULL(tbl_rmTeam.EmailAddress,''N/A'') AS EmailAddress,
							ISNULL(tbl_rmTeam.MobileNumber,''N/A'') AS MobileNumber,
							ISNULL(STUFF(
							(SELECT '', '' + ISNULL(tbl_company.CompanyName,''N/A'') FROM [dbo].[Tbl_RMTeam] tbl_RMTeam
								LEFT JOIN [dbo].[Tbl_RMTeam_Company_Mapping] tbl_companyMapping ON tbl_companyMapping.RMTeamId = tbl_RMTeam.Id
								LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_companyMapping.CompanyId
								WHERE tbl_RMTeam.Id = tbl_rmTeam.Id AND tbl_companyMapping.IsDelete <> 1
							FOR XML PATH ('''')), 1, 1, ''''
							) ,''N/A'') AS Company,
							ISNULL(tbl_rmTeam.IsLoginAllowed,0) AS IsLoginAllowed,
							ISNULL(tbl_rmTeam.IsActive,0) AS IsActive
						FROM [dbo].[Tbl_RMTeam] tbl_rmTeam WITH(NOLOCK)
						WHERE tbl_rmTeam.IsDelete <> 1
					)
				 '
	SET @subQuery = N'
						SELECT 
							Id AS Id,
							[Name] AS [Name],
							EmailAddress AS EmailAddress,
							MobileNumber AS MobileNumber,
							Company AS Company,
							IsLoginAllowed AS IsLoginAllowed,
							IsActive AS IsActive
						FROM tblRMTeam 
					'
	SET @condition = ' WHERE 1 = 1 '

	IF @searchPrefix IS NOT NULL AND @searchPrefix <> ''
	BEGIN
		SET @condition = @condition + '
							AND(
								[Name] LIKE @searchPrefix +''%''
								OR EmailAddress LIKE @searchPrefix +''%''
								OR MobileNumber LIKE @searchPrefix +''%''
								OR Company LIKE @searchPrefix +''%''
							)
						'
	END

	SET @groupBy = N' GROUP BY Id,[Name],EmailAddress,MobileNumber,Company,IsLoginAllowed,IsActive '

	SET @orderBy = ' ORDER BY '

	IF @sortColumn = '' OR @sortColumn IS NULL
	BEGIN
		SET @orderBy = @orderBy + ' Id ASC '
	END

	IF @sortColumn = 'Name' AND @sortDirection = 'asc'
	BEGIN
		SET @orderBy = @orderBy + ' Name ASC '
	END
	IF @sortColumn = 'Name' AND @sortDirection = 'desc'
	BEGIN
		SET @orderBy = @orderBy + ' Name DESC '
	END

	IF @sortColumn = 'Email Address' AND @sortDirection = 'asc'
	BEGIN
		SET @orderBy = @orderBy + ' EmailAddress ASC '
	END
	IF @sortColumn = 'Email Address' AND @sortDirection = 'desc'
	BEGIN
		SET @orderBy = @orderBy + ' EmailAddress DESC '
	END

	IF @sortColumn = 'Mobile No.' AND @sortDirection = 'asc'
	BEGIN
		SET @orderBy = @orderBy + ' MobileNumber ASC '
	END
	IF @sortColumn = 'Mobile No.' AND @sortDirection = 'desc'
	BEGIN
		SET @orderBy = @orderBy + ' MobileNumber DESC '
	END

	IF @sortColumn = 'Company' AND @sortDirection = 'asc'
	BEGIN
		SET @orderBy = @orderBy + ' Company ASC '
	END
	IF @sortColumn = 'Company' AND @sortDirection = 'desc'
	BEGIN
		SET @orderBy = @orderBy + ' Company DESC '
	END

	SET @pagination = N' 
						OFFSET @skipRows ROWS
						FETCH NEXT @fetchRows ROWS ONLY 
					  '
	SET @selectQuery = @query + ' ' + @subQuery + ' ' + @condition + ' ' + @groupBy + ' ' + @orderBy + ' ' + @pagination

	EXEC sp_executesql @selectQuery,N'@searchPrefix nvarchar(max),@skipRows int,@fetchRows int',
	@searchPrefix,@skipRows,@fetchRows

	SET @subQuery = N'
						SELECT 
							COUNT(Id) AS TotalCount
						FROM tblRMTeam 
					'
	SET @selectQuery = @query + ' ' + @subQuery + ' ' + @condition 

	EXEC sp_executesql @selectQuery,N'@searchPrefix nvarchar(max)',
	@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ServiceRequestStatusOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_ServiceRequestStatusOperation]
	@Status INT = NULL,
	@Id INT = NULL,
	@Name NVARCHAR(50) = NULL,
	@UserId INT = NULL,
	@DisplayId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN	
	SET NOCOUNT ON;
	IF @Status = 1 AND @Id IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_ServiceRequestStatus](
			Status,
			DisplayId,
			IsActive,
			IsDelete,
			CreatedOn,
			CreatedBy
		)
		VALUES(
			@Name,
			@DisplayId,
			1,
			0,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			@UserId
		)

		SET @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_ServiceRequestStatus] WITH(NOLOCK))

		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @Id IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_ServiceRequestStatus]
		SET
			Status = @Name,
			DisplayId = @DisplayId,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			ModifyBy = @UserId
		WHERE Id = @Id

		SET @returnId = @Id

		SELECT @returnId
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT 
			ISNULL(tbl_serviceRequestStatus.Id,0) AS Id,
			ISNULL(tbl_serviceRequestStatus.DisplayId,0) AS DisplayId,
			ISNULL(tbl_serviceRequestStatus.Status,'N/A') AS Status,
			ISNULL(tbl_serviceRequestStatus.IsActive,0) AS IsActive,
			ISNULL(tbl_serviceRequestStatus.IsDelete,0) AS IsDelete,
			ISNULL(tbl_serviceRequestStatus.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_serviceRequestStatus.ModifyBy,0) AS ModifyBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequestStatus.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequestStatus.ModifyOn,105),'N/A') AS ModifyOn
		FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
		WHERE tbl_serviceRequestStatus.IsDelete <> 1 AND tbl_serviceRequestStatus.IsActive <> 0

	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_serviceRequestStatus.Id,0) AS Id,
			ISNULL(tbl_serviceRequestStatus.DisplayId,0) AS DisplayId,
			ISNULL(tbl_serviceRequestStatus.Status,'N/A') AS Status,
			ISNULL(tbl_serviceRequestStatus.IsActive,0) AS IsActive,
			ISNULL(tbl_serviceRequestStatus.IsDelete,0) AS IsDelete,
			ISNULL(tbl_serviceRequestStatus.CreatedBy,0) AS CreatedBy,
			ISNULL(tbl_serviceRequestStatus.ModifyBy,0) AS ModifyBy,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequestStatus.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(CONVERT(NVARCHAR(50),tbl_serviceRequestStatus.ModifyOn,105),'N/A') AS ModifyOn
		FROM [dbo].[Tbl_ServiceRequestStatus] tbl_serviceRequestStatus WITH(NOLOCK)
		WHERE tbl_serviceRequestStatus.IsDelete <> 1 AND tbl_serviceRequestStatus.IsActive <> 0
		AND tbl_serviceRequestStatus.Id = @Id
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_ServiceRequestStatus]
		SET
			IsDelete = 1,
			ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			ModifyBy = @UserId
		WHERE Id = @Id

		SET @returnId = @Id

		SELECT @returnId
	END
	ELSE IF @Status = 5
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_ServiceRequestStatus])
		BEGIN
			SELECT MAX(DisplayId) + 1 AS DisplayId FROM [dbo].[Tbl_ServiceRequestStatus] WITH(NOLOCK)
		END
		ELSE 
		BEGIN 
			SELECT 0 AS DisplayId
		END
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ShareholderDocumentsOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ===========================================================================
-- Author : <Yashasvi Sharma>
-- Create date: <01-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_ShareholderOrDirectorOperation 2>
-- ===========================================================================

CREATE PROCEDURE [dbo].[USP_Admin_ShareholderDocumentsOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@Title NVARCHAR(MAX) = NULL,
	@FileName NVARCHAR(100) = NULL,
	@Extension NVARCHAR(50) = NULL,
	@DataBinary VARBINARY(MAX) = NULL,
	@ShareholderId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		INSERT INTO [dbo].[Tbl_ShareholderDocuments](
			Title,
			FileName,
			Extension,
			DataBinary,
			ShareholderId,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@Title,
			@FileName,
			@Extension,
			@DataBinary,
			@ShareholderId,
			1,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SELECT MAX(ID) FROM [dbo].[Tbl_ShareholderDocuments]
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT	
			ISNULL(ID,0) AS ID,
			ISNULL(Title,'N/A') AS Title,
			ISNULL(FileName,'N/A') AS FileName,
			ISNULL(Extension,'N/A') AS Extension,
			DataBinary AS DataBinary,
			ISNULL(ShareholderId,0) AS ShareholderId,
			ISNULL(IsActive,0) AS IsActive,
			ISNULL(IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_ShareholderDocuments] WITH(NOLOCK)
		WHERE (ID = @ID OR @ID IS NULL) AND ShareholderId = @ShareholderId 
		AND IsDelete <> 1
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_ShareholderOrDirectorOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ===========================================================================
-- Author : <Yashasvi Sharma>
-- Create date: <01-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<SP_Admin_ShareholderOrDirectorOperation 2>
-- ===========================================================================

CREATE PROCEDURE [dbo].[USP_Admin_ShareholderOrDirectorOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@FirstName NVARCHAR(100) = NULL,
	@LastName NVARCHAR(100) = NULL,
	@Passport_Number NVARCHAR(MAX) = NULL,
	@PassportExpiryDate NVARCHAR(50) = NULL,
	@Nationality NVARCHAR(100) = NULL,
	@Designation NVARCHAR(100) = NULL,
	@VisaExpiryDate NVARCHAR(50) = NULL,
	@InsuranceCompany NVARCHAR(MAX) = NULL,
	@InsuranceExpiryDate NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@Share NVARCHAR(50) = NULL,
	@IsActive BIT = NULL,
	@CreatedBy INT = NULL,
	@ReturnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RemainingSharePercentage NVARCHAR(50) = NULL;
	IF @Status = 1 AND @ID IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_ShareholdersOrDirectors](
			FirstName,
			LastName,
			Passport_Number,
			PassportExpiryDate,
			Nationality,
			Designation,
			VisaExpiryDate,
			InsuranceCompany,
			InsuranceExpiryDate,
			CompanyId,
			SharePercentage,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUtc
		)
		VALUES(
			@FirstName,
			@LastName,
			@Passport_Number,
			@PassportExpiryDate,
			@Nationality,
			@Designation,
			@VisaExpiryDate,
			@InsuranceCompany,
			@InsuranceExpiryDate,
			@CompanyId,
			@Share,
			@IsActive,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)

		SET @ReturnId = (SELECT MAX(ID) FROM [dbo].[Tbl_ShareholdersOrDirectors] WITH(NOLOCK));
		SELECT @ReturnId
	END
	ELSE IF @Status = 1 AND @ID IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_ShareholdersOrDirectors]
		SET 
			FirstName = @FirstName,
			LastName = @LastName,
			Passport_Number = @Passport_Number,
			PassportExpiryDate = @PassportExpiryDate,
			Nationality = @Nationality,
			Designation = @Designation,
			VisaExpiryDate = @VisaExpiryDate,
			InsuranceCompany = @InsuranceCompany,
			InsuranceExpiryDate = @InsuranceExpiryDate,
			CompanyId = @CompanyId,
			SharePercentage = @Share,
			IsActive = @IsActive,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @ID

		SELECT @ID
	END
	ELSE IF @Status = 2 
	BEGIN
		SELECT 
			ISNULL(tbl_shareholder.ID,0) AS ID,
			ISNULL(tbl_shareholder.FirstName,'N/A') AS FirstName,
			ISNULL(tbl_shareholder.LastName,'N/A') AS LastName,
			ISNULL(tbl_shareholder.Passport_Number,'N/A') AS PassportNumber,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,23),'N/A') AS PassportExpiryDate, 
			ISNULL(tbl_shareholder.Nationality,'N/A') AS Nationality,
			ISNULL(tbl_shareholder.Designation,'N/A') AS Designation,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
			ISNULL(tbl_shareholder.InsuranceCompany,'N/A') AS InsuranceCompany,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
			ISNULL(tbl_shareholder.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_shareholder.SharePercentage,'N/A') AS SharePercentage,
			ISNULL(tbl_shareholder.IsActive,0) AS IsActive,
			ISNULL(tbl_shareholder.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_company] tbl_company ON tbl_shareholder.CompanyId = tbl_company.Id
		WHERE tbl_shareholder.IsDelete <> 1 AND (tbl_shareholder.CompanyId = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0)
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_shareholder.ID,0) AS ID,
			ISNULL(tbl_shareholder.FirstName,'N/A') AS FirstName,
			ISNULL(tbl_shareholder.LastName,'N/A') AS LastName,
			ISNULL(tbl_shareholder.Passport_Number,'N/A') PassportNumber,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
			ISNULL(tbl_shareholder.Nationality,'N/A') AS Nationality,
			ISNULL(tbl_shareholder.Designation,'N/A') AS Designation,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
			ISNULL(tbl_shareholder.InsuranceCompany,'N/A') AS InsuranceCompany,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
			ISNULL(tbl_shareholder.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_shareholder.SharePercentage,'N/A') AS SharePercentage,
			ISNULL(tbl_shareholder.IsActive,0) AS IsActive,
			ISNULL(tbl_shareholder.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_company] tbl_company ON tbl_shareholder.CompanyId = tbl_company.Id
		WHERE tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.ID = @ID AND (tbl_shareholder.CompanyId = @CompanyId OR @CompanyId IS NULL)
	END
	ELSE IF @Status = 4
	BEGIN
		UPDATE [dbo].[Tbl_ShareholdersOrDirectors]
		SET
			IsDelete = 1,
			ModifyBy = @CreatedBy,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID = @ID

		SELECT @ID
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SupportTicketDocuments]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <19-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Support Ticket>
-- SP_Admin_SupportTicketDocuments 2,6
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_SupportTicketDocuments]
	@Status INT = NULL,
	@ID INT = NULL,
	@FileName NVARCHAR(MAX) = NULL,
	@Extension NVARCHAR(MAX) = NULL,
	@DataBinary VARBINARY(MAX) = NULL,
	@TicketId NVARCHAR(MAX) = NULL,
	@CreatedBy INT = NULL,
	@ReplyId INT = NULL,
	@returnId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		INSERT INTO [dbo].[Tbl_SupportTicketDocument](
			[FileName],
			Extension,
			DataBinary,
			TicketId,
			IsActive,
			ReplyId,
			CreatedOn,
			CreatedBy
		)
		VALUES(
			@FileName,
			@Extension,
			@DataBinary,
			@TicketId,
			1,
			@ReplyId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			@CreatedBy
		)

		SET @returnId = (SELECT MAX(ID) FROM [dbo].[Tbl_SupportTicketDocument] WITH(NOLOCK))
		SELECT @returnId
	END
	ELSE IF @Status = 2 
	BEGIN
		SELECT 
			ISNULL(tbl_documents.ID,0) AS ID,
			ISNULL(tbl_documents.FileName,'N/A') AS FileName,
			ISNULL(tbl_documents.Extension,'N/A') AS Extension,
			ISNULL(tbl_documents.TicketId,'N/A') AS TicketId,
			tbl_documents.DataBinary AS DataBinary,
			ISNULL(tbl_documents.ReplyId,0) AS ReplyId,
			ISNULL(tbl_documents.IsActive,0) AS IsActive,
			ISNULL(tbl_documents.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_documents.CreatedOn,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_documents.ModifyOn,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_SupportTicketDocument] tbl_documents WITH(NOLOCK)
		WHERE (tbl_documents.ReplyId = @ReplyId OR ReplyId IS NULL)
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT 
			ISNULL(tbl_documents.ID,0) AS ID,
			ISNULL(tbl_documents.FileName,'N/A') AS FileName,
			ISNULL(tbl_documents.Extension,'N/A') AS Extension,
			ISNULL(tbl_documents.TicketId,'N/A') AS TicketId,
			ISNULL(tbl_documents.ReplyId,0) AS ReplyId,
			tbl_documents.DataBinary AS DataBinary,
			ISNULL(tbl_documents.IsActive,0) AS IsActive,
			ISNULL(tbl_documents.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_documents.CreatedOn,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_documents.ModifyOn,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_SupportTicketDocument] tbl_documents WITH(NOLOCK)
		WHERE tbl_documents.ID = @ID
	END
	ELSE IF @Status = 4
	BEGIN
		SELECT 
			ISNULL(tbl_documents.ID,0) AS ID,
			ISNULL(tbl_documents.FileName,'N/A') AS FileName,
			ISNULL(tbl_documents.Extension,'N/A') AS Extension,
			ISNULL(tbl_documents.TicketId,'N/A') AS TicketId,
			ISNULL(tbl_documents.ReplyId,0) AS ReplyId,
			ISNULL(tbl_documents.IsActive,0) AS IsActive,
			ISNULL(tbl_documents.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_documents.CreatedOn,105),'N/A') AS CreatedOnUtc,
			ISNULL(CONVERT(NVARCHAR(50),tbl_documents.ModifyOn,105),'N/A') AS ModifyOnUtc
		FROM [dbo].[Tbl_SupportTicketDocument] tbl_documents WITH(NOLOCK)
		WHERE (tbl_documents.ReplyId = @ReplyId OR ReplyId IS NULL)
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_SupportTicketOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <19-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<Support Ticket>
-- SP_Admin_SupportTicketOperation 2
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_SupportTicketOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@SalesPersonId INT = NULL,
	@TrackingNumber NVARCHAR(MAX) = NULL,
	@Title NVARCHAR(MAX) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@TicketStatus INT = NULL,
	@ParentId INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT 
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1 AND @ID IS NULL
	BEGIN
		IF @TrackingNumber IS NULL
		BEGIN
			DECLARE @SerialNumber INT = NULL;
			IF EXISTS(SELECT ID FROM [dbo].[Tbl_SupportTicket] WITH(NOLOCK) WHERE IsDelete <> 1)
			BEGIN
				SET @SerialNumber = ((SELECT MAX(CONVERT(INT,SUBSTRING(TrackingNumber,CHARINDEX('R',TrackingNumber)+1,LEN(TrackingNumber)))) 
									FROM [dbo].[Tbl_SupportTicket] WITH(NOLOCK))
									)
				SET @SerialNumber = @SerialNumber + 1
				SET  @TrackingNumber ='TR'+ CONVERT(NVARCHAR(100),@SerialNumber);
			END
			ELSE
			BEGIN
				SET  @TrackingNumber = 'TR101';
			END
		END
		INSERT INTO [dbo].[Tbl_SupportTicket](
			CompanyId,
			UserId,
			SalesPersonId,
			TrackingNumber,
			Title,
			[Description],
			TicketStatus,
			ParentId,
			IsActive,
			IsDelete,
			CreatedOn,
			CreatedBy
		)
		VALUES(
			@CompanyId,
			@UserId,
			@SalesPersonId,
			@TrackingNumber,
			@Title,
			@Description,
			@TicketStatus,
			@ParentId,
			1,
			0,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			@UserId
		)

		IF @TicketStatus = 2
		BEGIN
			DECLARE @RequestData INT = NULL;
			SET @RequestData = (SELECT MIN(ID) FROM [dbo].[Tbl_SupportTicket] WITH(NOLOCK) WHERE TicketStatus LIKE @TicketStatus)
			UPDATE [dbo].[Tbl_SupportTicket]
			SET
				TicketStatus = @TicketStatus,
				ModifyBy = @CreatedBy,
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE ID= @RequestData
		END

		IF EXISTS(SELECT ID FROM [dbo].[Tbl_SupportTicket] WITH(NOLOCK) WHERE TrackingNumber LIKE @TicketStatus AND IsDelete <> 1)
		BEGIN
			UPDATE [dbo].[Tbl_SupportTicket]
			SET
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
				ModifyBy = @UserId
			WHERE TrackingNumber LIKE @TicketStatus
		END

		SET @returnId = (SELECT MAX(ID) FROM [dbo].[Tbl_SupportTicket] WITH(NOLOCK))
		SELECT @returnId
	END
	ELSE IF @Status = 2 
	BEGIN
		SELECT DISTINCT
			tbl_supportTicket.TrackingNumber AS TrackingNumber,
			ISNULL(tbl_supportTicket.ID,0) AS ID,
			ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_supportTicket.UserId,0) AS UserId,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
			ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
			ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
			CASE WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 1 THEN 1
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 0 THEN 1
				 WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 2 THEN 2
			END AS TicketStatusId,
			CASE WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 1 THEN 'Open'
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 0 THEN 'Open'
				 WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 2 THEN 'Close'
			END AS TicketStatus,
			ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
			ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
			ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.ModifyOn,105),'N/A') AS ModifyOn,
			ISNULL(tbl_supportTicket.ModifyBy,0) AS ModifyBy,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
			 ISNULL(CONVERT(NVARCHAR(70),tbl_assigneduser.CreatedOn,105),'N/A') AS AssignedOn
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_assigneduser.TrackingNumber = tbl_supportTicket.TrackingNumber
		WHERE (tbl_company.Id = @CompanyId OR @CompanyId IS NULL OR @CompanyId = 0) 
		AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
		AND (tbl_assigneduser.UserId = @UserId OR @UserId IS NULL OR @UserId =0)
		AND tbl_supportTicket.ID IN (
			SELECT MIN(ID)
			FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
			WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
			AND (tbl_supportTicket1.IsDelete <> 1 OR tbl_supportTicket1.IsDelete IS NULL OR tbl_supportTicket1.IsDelete =0)
			GROUP BY TrackingNumber
		)
		AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
	END 
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_supportTicket.ID,0) AS ID,
			ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			CASE WHEN tbl_supportTicket.UserId <> 0 THEN ISNULL(tbl_supportTicket.UserId,0) ELSE 0 END AS UserId,
			CASE WHEN tbl_supportTicket.UserId <> 0 THEN ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') ELSE 'N/A' END AS Username,
			CASE WHEN tbl_supportTicket.SalesPersonId <> 0 THEN ISNULL(tbl_supportTicket.SalesPersonId,0) ELSE 0 END AS SalesPersonId,
			CASE WHEN tbl_supportTicket.SalesPersonId <> 0 THEN ISNULL(tbl_salesPerson.FirstName +' '+ tbl_salesPerson.LastName,'N/A') ELSE 'N/A' END AS SalesPersonName,
			ISNULL(tbl_supportTicket.TrackingNumber,'N/A') AS TrackingNumber,
			ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
			ISNULL(tbl_supportTicket.TicketStatus,0) AS TicketStatusId,
			ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
			CASE WHEN tbl_supportTicket.TicketStatus = 1 THEN 'Open'
				WHEN tbl_supportTicket.TicketStatus = 2 THEN 'Close'
			END AS TicketStatus,
			ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
			ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
			ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.ModifyOn,105),'N/A') AS ModifyOn,
			ISNULL(tbl_supportTicket.ModifyBy,0) AS ModifyBy
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
		LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_SalesPersons] tbl_salesPerson ON tbl_salesPerson.Id = tbl_supportTicket.SalesPersonId
		WHERE (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
		AND tbl_supportTicket.ParentId = @ParentId
	END
	ELSE IF @Status = 5
	BEGIN
		DECLARE @NewTrackingNumber INT = NULL;
		SET @NewTrackingNumber = (SELECT CAST(RAND() * 1000 AS INT));
		SET @TrackingNumber = N'TR'+CAST(@NewTrackingNumber AS nvarchar(MAX));

		IF EXISTS(SELECT Id FROM [dbo].[Tbl_ServiceFormFieldValue] WHERE SerialNumber LIKE @TrackingNumber)
		BEGIN
			SET @NewTrackingNumber = (SELECT CAST(RAND() * 1000 AS INT));

			SET @TrackingNumber = N'TR'+CAST(@NewTrackingNumber AS nvarchar(MAX));
		END;


		SELECT CASE WHEN ISNULL(MAX(TrackingNumber),'N/A') ='N/A' THEN 'TR1000'
					ELSE @TrackingNumber END AS TrackingNumber
		FROM [dbo].[Tbl_SupportTicket]
		WHERE IsDelete <> 1 OR IsDelete IS NULL
	END
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateApplicantNameForEmployeeServiceRequest]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_UpdateApplicantNameForEmployeeServiceRequest
-- Author:			<Yashasvi Sharma>
-- Created date:	30/Jan/2024
-- Description:		Update applicant name for employee service request
-- USP_Admin_UpdateApplicantNameForEmployeeServiceRequest 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateApplicantNameForEmployeeServiceRequest]
	@applicantName NVARCHAR(MAX) = NULL,
	@serialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	UPDATE [dbo].[Tbl_EmployeeServiceRequests] 
	SET 
		ApplicantName = @applicantName 
	WHERE SerialNumber = @serialNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateCompanyExpense]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <27-Jan-2022>
-- Modify By : <Yashasvi Sharma,Yashasvi Sharma>
-- Modify date : <28-Jan-2022,25-11-2022>
-- <USP_Admin_UpdateCompanyExpense>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_UpdateCompanyExpense]
	@Id INT = NULL,
	@CompanyId INT = NULL,
	@ExpenseTitle NVARCHAR(MAX) = NULL,
	@ExpenseAmount NVARCHAR(MAX) = NULL,
	@TotalAmount NVARCHAR(MAX) = NULL,
	@Vat NVARCHAR(10) = NULL,
	@VatAmount NVARCHAR(50) = NULL,
	@GrandTotal NVARCHAR(50) = NULL,
	@Quantity INT = NULL,
	@CreatedOn NVARCHAR(50)=NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @username NVARCHAR(MAX) = NULL,@modifyTime NVARCHAR(MAX) = NULL,@currentTransactionId NVARCHAR(MAX) = NULL

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND IsDelete <> 1)
	BEGIN
		DECLARE @PreviousAmount DECIMAL(18,2) = NULL,@PreviousCompanyId INT = NULL,
				@BalanceAmount DECIMAL(18,2)=NULL,@PreviousExpenseAmount NVARCHAR(MAX) = NULL;

		SET @PreviousCompanyId = (SELECT CompanyId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id=@Id);

		SET @PreviousAmount = (SELECT CONVERT(DECIMAL(18,2),BalanceAmount) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId=@CompanyId);

		SET @PreviousExpenseAmount =  (SELECT GrandTotal FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id=@Id);

		IF @PreviousCompanyId = @CompanyId
		BEGIN
			IF CONVERT(DECIMAL(18,2),@PreviousExpenseAmount) != @GrandTotal
			BEGIN
				IF CONVERT(DECIMAL(18,2),@PreviousExpenseAmount) > @GrandTotal
				BEGIN
					SET @BalanceAmount = CONVERT(DECIMAL(18,2),@PreviousExpenseAmount) - @GrandTotal;
					SET @PreviousAmount = @PreviousAmount + @BalanceAmount;
					UPDATE [dbo].[Tbl_PortalBalance]
					SET 
						BalanceAmount = @PreviousAmount,
						ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
						ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					WHERE CompanyId = @CompanyId
				END
				ELSE IF CONVERT(DECIMAL(18,2),@PreviousExpenseAmount) < @GrandTotal
				BEGIN
					SET @BalanceAmount = CONVERT(DECIMAL(18,2),@PreviousExpenseAmount) - @GrandTotal;
					SET @PreviousAmount = @PreviousAmount + @BalanceAmount;
					UPDATE [dbo].[Tbl_PortalBalance]
					SET 
						BalanceAmount = @PreviousAmount,
						ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
						ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					WHERE CompanyId = @CompanyId
				END
			END
		END
		ELSE
		BEGIN
			SET @PreviousAmount = (SELECT CONVERT(DECIMAL(18,2),BalanceAmount) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId=@PreviousCompanyId);
			SET @PreviousAmount = CONVERT(DECIMAL(18,2),@PreviousAmount) + CONVERT(DECIMAL(18,2),@PreviousExpenseAmount);
			UPDATE [dbo].[Tbl_PortalBalance]
			SET 
				BalanceAmount = CONVERT(nvarchar(MAX),@PreviousAmount),
				ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE CompanyId = @PreviousCompanyId

			SET @PreviousAmount = (SELECT CONVERT(DECIMAL(18,2),BalanceAmount) FROM [dbo].[Tbl_PortalBalance] WITH(NOLOCK) WHERE CompanyId=@CompanyId);
			SET @PreviousAmount = CONVERT(DECIMAL(18,2),@PreviousAmount) - CONVERT(DECIMAL(18,2), @GrandTotal);

			UPDATE [dbo].[Tbl_PortalBalance]
			SET 
				BalanceAmount = CONVERT(nvarchar(MAX),@PreviousAmount),
				ModifyBy = @UserId,										-- To Store By Which User Portal Balance of Any Company is Updated				Yashasvi [TBC] (25-11-2022)
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE CompanyId = @CompanyId
		END

		UPDATE [dbo].[Tbl_PortalBalanceExpenses]
		SET
			ExpensesTitle = @ExpenseTitle,
			ExpensesAmount = @ExpenseAmount,
			CompanyId = @CompanyId,
			Quantity = @Quantity,
			TotalAmount = @TotalAmount,
			Vat = @Vat,
			VatAmount = @VatAmount,
			GrandTotal = @GrandTotal,
			CreatedOnUtc= @CreatedOn,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @Id

		SET @username = (SELECT FirstName + ' ' + LastName +' (' + AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) WHERE tbl_user.Id = @UserId)

		SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK)
		WHERE Id = @Id AND CompanyId = @CompanyId)

		SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId AND (IsDelete <> 1 OR IsDelete IS NULL))

		SELECT @username As Username,@modifyTime AS ModifyTime, 1 AS ResponseData,@currentTransactionId AS TransactionId
	END
	ELSE
	BEGIN
		SET @username = (SELECT tbl_user.FirstName + ' ' + tbl_user.LastName +' (' + tbl_user.AccountNumber + ')' FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK) LEFT JOIN 
			[dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) ON tbl_portalExpense.ModifyBy = tbl_user.Id
			WHERE tbl_portalExpense.Id = @Id AND tbl_portalExpense.CompanyId = @CompanyId)

		SET @currentTransactionId = (SELECT TransactionId FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)

		SET @modifyTime = (SELECT CONVERT(nvarchar(50),tbl_portalExpense.ModifyOnUtc,120) FROM [dbo].[Tbl_PortalBalanceExpenses] tbl_portalExpense WITH(NOLOCK) WHERE Id = @Id AND CompanyId = @CompanyId)

		SELECT @username As Username,@modifyTime AS ModifyTime,-1 AS ResponseData,@currentTransactionId AS TransactionId
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateCompanyInvoiceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <26-11-2022>
-- <USP_Admin_UpdateCompanyInvoiceDetails>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_UpdateCompanyInvoiceDetails]
	@Id INT = NULL,
	@ProductName NVARCHAR(MAX) = NULL,
	@Quantity INT = NULL,
	@Amount DECIMAL(18,2) = NULL,
	@TotalAmount DECIMAL(18,2) = NULL,
	@GrandTotal DECIMAL(18,2) = NULL,
	@InvoiceNumber NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@Vat DECIMAL(18,2) = NULL,
	@VatAmount DECIMAL(18,2) = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @InvoiceGrandTotal decimal(18,2) = NULL

	UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
	SET
		ProductName = @ProductName,
		Quantity = @Quantity,
		Amount = @Amount,
		TotalAmount = @TotalAmount,
		GrandTotal = @GrandTotal,
		InvoiceNumber = @InvoiceNumber,
		CompanyId = @CompanyId,
		Vat = @Vat,
		VatAmount = @VatAmount,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id

	SET @InvoiceGrandTotal = (SELECT (SUM(TotalAmount) + SUM(VatAmount)) AS GrandTotal FROM [dbo].[Tbl_CompanyInvoiceDetail] WITH(NOLOCK)
	WHERE InvoiceNumber = @InvoiceNumber AND IsDelete <> 1)


	UPDATE [dbo].[Tbl_CompanyInvoiceDetail]
	SET
		GrandTotal = @InvoiceGrandTotal
	WHERE InvoiceNumber LIKE @InvoiceNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateCompanyServiceRequestAssignedUser]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_UpdateCompanyServiceRequestAssignedUser
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Update Assigned User to already added Company Service Request
-- USP_Admin_UpdateCompanyServiceRequestAssignedUser
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateCompanyServiceRequestAssignedUser]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE @CompanyName NVARCHAR(MAX) = NULL,@AssignUser NVARCHAR(MAX) = NULL,@CompanyId INT = NULL, @SalesPerson NVARCHAR(MAX) = NULL

	SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber = @SerialNumber)

	SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

	SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					    WITH(NOLOCK)
					    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
	                    WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('')), 1, 1, ''))

	SET @AssignUser = (
							SELECT STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
							FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
							WHERE tbl_assign1.SerialNumber = @SerialNumber FOR XML PATH ('')), 1, 1, '')
						)

	UPDATE [dbo].[Tbl_CompanyServiceRequests]
	SET
		CompanyName = @CompanyName,
		SalesPerson = @SalesPerson,
		AssignedUser = @AssignUser
	WHERE SerialNumber = @SerialNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateCompanyServiceRequestStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_UpdateCompanyServiceRequestStatus
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Update Status and Company Name to already added Company Service Request
-- USP_Admin_UpdateCompanyServiceRequestStatus
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateCompanyServiceRequestStatus]
	@Status INT = NULL,
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE @CompanyName NVARCHAR(MAX) = NULL,@CompanyId INT = NULL, @SalesPerson NVARCHAR(MAX) = NULL,@StatusName NVARCHAR(MAX) = NULL

	SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber = @SerialNumber)

	SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

	SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
					    WITH(NOLOCK)
					    LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
	                    WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
						FOR XML PATH ('')), 1, 1, ''))

	SET @StatusName = (SELECT Status FROM [dbo].[Tbl_ServiceRequestStatus] WHERE DisplayId = @Status)

	UPDATE [dbo].[Tbl_CompanyServiceRequests]
	SET
		StatusId = @Status,
		Status = @StatusName,
		CompanyName = @CompanyName,
		SalesPerson = @SalesPerson
	WHERE SerialNumber = @SerialNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateNewCompanyInvoiceDetails]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <17-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_SaveCompanyInvoiceDeatils>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_UpdateNewCompanyInvoiceDetails]
	@Id INT = NULL,
	@ProductName NVARCHAR(MAX) = NULL,
	@Quantity INT = NULL,
	@Amount DECIMAL(18,2) = NULL,
	@TotalAmount DECIMAL(18,2) = NULL,
	@GrandTotal DECIMAL(18,2) = NULL,
	@InvoiceNumber NVARCHAR(MAX) = NULL,
	@Vat DECIMAL(18,2) = NULL,
	@VatAmount DECIMAL(18,2) = NULL,
	@UserId INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @InvoiceGrandTotal decimal(18,2) = NULL

	UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
	SET
		ProductName = @ProductName,
		Quantity = @Quantity,
		Amount = @Amount,
		TotalAmount = @TotalAmount,
		GrandTotal = @GrandTotal,
		InvoiceNumber = @InvoiceNumber,
		Vat = @Vat,
		VatAmount = @VatAmount,
		ModifyBy = @UserId,
		ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
	WHERE Id = @Id

	SET @InvoiceGrandTotal = (SELECT (SUM(TotalAmount) + SUM(VatAmount)) AS GrandTotal FROM [dbo].[Tbl_NewCompanyInvoiceDetails]
	WHERE InvoiceNumber = @InvoiceNumber AND IsDelete <> 1)


	UPDATE [dbo].[Tbl_NewCompanyInvoiceDetails]
	SET
		GrandTotal = @InvoiceGrandTotal
	WHERE InvoiceNumber LIKE @InvoiceNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateNotification]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <21-Feb-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <SP_Admin_UpdateNotification>
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateNotification]
	@Status INT = NULL,
	@CompanyId INT = NULL,
	@ID INT = NULL,
	@UserId INT = NULL,
	@NotificationDays INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		UPDATE [dbo].[Tbl_Notifications]
		SET 
			MarkAsRead = 0,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID =@ID AND CompanyId = @CompanyId
	END
	IF @Status = 2
	BEGIN
		UPDATE [dbo].[Tbl_Notifications]
		SET 
			MarkAsRead = 1,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID =@ID AND CompanyId = @CompanyId
	END
	IF @Status = 3
	BEGIN
		UPDATE [dbo].[Tbl_Notifications]
		SET 
			SendNotificationAfter = @NotificationDays,
			ModifyBy = @UserId,
			ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE ID =@ID 
	END
	IF @Status = 4
	BEGIN
		DECLARE @CreatedDate nvarchar(50) = (SELECT CONVERT(nvarchar(50),CreatedOnUtc,23) FROM [dbo].[Tbl_Notifications] WHERE ID = @ID )
		
		IF @CreatedDate <> CONVERT(nvarchar(50),SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',23) 
		BEGIN
			UPDATE [dbo].[Tbl_Notifications]
			SET 
				LeftDayToExpire = @NotificationDays,
				ModifyBy = @UserId,
				ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE ID =@ID 
		END
	END
END

GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateReapatedTransactionIdNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name : USP_Admin_UpdateReapatedTransactionIdNumber
-- Author:		<Yashasvi Sharma>
-- Create date: <22-March-2024>
-- Modify By : <>
-- Modify date : <>
-- UPDATE repeated transaction numbers 
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateReapatedTransactionIdNumber]
	@Id INT = NULL,
	@TransactionId NVARCHAR(MAX) = NULL,
	@TransactionType NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	--DECLARE @PlanHandle VARBINARY(64);

	--SELECT  @PlanHandle = deps.plan_handle
	--FROM    sys.dm_exec_procedure_stats AS deps
	--WHERE   deps.object_id = OBJECT_ID('dbo.USP_Admin_UpdateReapatedTransactionIdNumber') AND deps.database_id = DB_ID();

	--IF @PlanHandle IS NOT NULL
	--BEGIN
	--    DBCC FREEPROCCACHE(@PlanHandle);
	--END

	DECLARE @TransactionCode NVARCHAR(50) = NULL,@PaymentTransactionId INT = NULL, @ExpenseTransactionId INT = NULL;

	SET @TransactionId = N'TRN'+@TransactionId

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionId)
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionId)
		BEGIN
			SET @ExpenseTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
						FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
						);

			SET @PaymentTransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) 
								);

			IF CONVERT(INT,@ExpenseTransactionId) > CONVERT(INT,@PaymentTransactionId)
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
							);

				SET @TransactionId = @TransactionId + 1

				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
			ELSE
			BEGIN
				SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
								);
			
				SET @TransactionId = @TransactionId + 1

				SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
			END
		END
		ELSE
		BEGIN
			SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
								FROM [dbo].[Tbl_PaymentTransection] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL)
								);

			SET @TransactionId = @TransactionId + 1

			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
	END
	ELSE
	BEGIN
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL) AND TransactionId LIKE @TransactionId)
		BEGIN
			SET @TransactionId = (SELECT MAX(CONVERT(INT,SUBSTRING(TransactionId,CHARINDEX('N',TransactionId)+1,LEN(TransactionId)))) 
							FROM [dbo].[Tbl_PortalBalanceExpenses] WITH(NOLOCK) WHERE (IsDelete<> 1 OR IsDelete IS NULL)
							);

			SET @TransactionId = @TransactionId + 1

			SET  @TransactionCode ='TRN'+ CONVERT(NVARCHAR(100),@TransactionId);
		END
	END

	IF @TransactionType = 'Credit'
	BEGIN
		UPDATE [dbo].[Tbl_PaymentTransection]
		SET 
			TransactionId = @TransactionCode
		WHERE Id = @Id
	END
	ELSE IF @TransactionType = 'Debit'
	BEGIN
		UPDATE [dbo].[Tbl_PaymentTransection]
		SET 
			TransactionId = @TransactionCode
		WHERE Id = @Id
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateServiceRequestAssignedUser]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_UpdateServiceRequestAssignedUser
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Update Assigned User to already added Company Service Request
-- USP_Admin_UpdateServiceRequestAssignedUser
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateServiceRequestAssignedUser]
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE @CompanyName NVARCHAR(MAX) = NULL,@AssignUser NVARCHAR(MAX) = NULL,@CompanyId INT = NULL, @SalesPerson NVARCHAR(MAX) = NULL

	IF EXISTS(
		SELECT Id FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber = @SerialNumber
	)
	BEGIN
		SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber = @SerialNumber)

		SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

		SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
							AND tbl_salesPersons1.IsDelete <> 1
							FOR XML PATH ('')), 1, 1, ''))

		SET @AssignUser = (
								SELECT STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
								FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
								WHERE tbl_assign1.SerialNumber = @SerialNumber FOR XML PATH ('')), 1, 1, '')
							)

		UPDATE [dbo].[Tbl_CompanyServiceRequests]
		SET
			CompanyName = @CompanyName,
			SalesPerson = @SalesPerson,
			AssignedUser = @AssignUser,
			AssignOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE SerialNumber = @SerialNumber
	END
	ELSE IF EXISTS(
		SELECT Id FROM [dbo].[Tbl_EmployeeServiceRequests] WHERE SerialNumber = @SerialNumber
	)
	BEGIN
		SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_EmployeeServiceRequests] WHERE SerialNumber = @SerialNumber)

		SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

		SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
							AND tbl_salesPersons1.IsDelete <> 1
							FOR XML PATH ('')), 1, 1, ''))

		SET @AssignUser = (
								SELECT STUFF((SELECT ', ' + ISNULL(tbl_assignUser1.FirstName +' '+tbl_assignUser1.LastName,'N/A') 
								FROM [dbo].[Tbl_AssignServiceRequest] tbl_assign1 WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User] tbl_assignUser1 WITH(NOLOCK) ON tbl_assignUser1.Id = tbl_assign1.UserId 
								WHERE tbl_assign1.SerialNumber = @SerialNumber FOR XML PATH ('')), 1, 1, '')
							)

		UPDATE [dbo].[Tbl_EmployeeServiceRequests]
		SET
			CompanyName = @CompanyName,
			SalesPerson = @SalesPerson,
			AssignedUser = @AssignUser,
			AssignOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE SerialNumber = @SerialNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UpdateServiceRequestStatus]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- SP Name:			USP_Admin_UpdateCompanyServiceRequestStatus
-- Author:			<Yashasvi Sharma>
-- Created date:	14/April/2023
-- Description:		Update Status and Company Name to already added Service Request
-- USP_Admin_UpdateServiceRequestStatus 0,N'SR1325'
-- =============================================

CREATE PROCEDURE [dbo].[USP_Admin_UpdateServiceRequestStatus]
	@Status INT = NULL,
	@SerialNumber NVARCHAR(MAX) = NULL
AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE @CompanyName NVARCHAR(MAX) = NULL,@CompanyId INT = NULL, @SalesPerson NVARCHAR(MAX) = NULL,@StatusName NVARCHAR(MAX) = NULL

	IF EXISTS(
		SELECT Id FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber = @SerialNumber
	)
	BEGIN
		SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_CompanyServiceRequests] WHERE SerialNumber = @SerialNumber)

		SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

		SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
							AND tbl_salesPersons1.IsDelete <> 1
							FOR XML PATH ('')), 1, 1, ''))

		SET @StatusName = (SELECT Status FROM [dbo].[Tbl_ServiceRequestStatus] WHERE DisplayId = @Status AND IsDelete <> 1)

		UPDATE [dbo].[Tbl_CompanyServiceRequests]
		SET
			StatusId = @Status,
			Status = @StatusName,
			CompanyName = @CompanyName,
			SalesPerson = @SalesPerson
		WHERE SerialNumber = @SerialNumber
	END
	ELSE IF EXISTS(
		SELECT Id FROM [dbo].[Tbl_EmployeeServiceRequests] WHERE SerialNumber = @SerialNumber
	)
	BEGIN
		SET @CompanyId = (SELECT CompanyId FROM [dbo].[Tbl_EmployeeServiceRequests] WHERE SerialNumber = @SerialNumber)

		SET @CompanyName = (SELECT CompanyName FROM [dbo].[Tbl_Company] WHERE Id = @CompanyId)

		SET @SalesPerson = (SELECT STUFF((SELECT ', ' + ISNULL(tbl_salesPersons1.FirstName +' '+ tbl_salesPersons1.LastName,'N/A') FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1  
							WITH(NOLOCK)
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = @CompanyId AND tbl_companyMapping.IsDelete <> 1 
							AND tbl_salesPersons1.IsDelete <> 1
							FOR XML PATH ('')), 1, 1, ''))

		SET @StatusName = (SELECT Status FROM [dbo].[Tbl_ServiceRequestStatus] WHERE DisplayId = @Status AND IsDelete <> 1)

		UPDATE [dbo].[Tbl_EmployeeServiceRequests]
		SET
			StatusId = @Status,
			Status = @StatusName,
			CompanyName = @CompanyName,
			SalesPerson = @SalesPerson
		WHERE SerialNumber = @SerialNumber
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UserListForCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <29-March-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- <USP_Admin_UserListForCompany 2,0,356>
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_UserListForCompany]
	@Status INT = NULL,
	@UserId INT = NULL,
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		SELECT tbl_user.Id AS Id,
			tbl_user.FirstName +' '+ tbl_user.LastName AS Username,
			tbl_user.AccountNumber AS AccountNumber
		FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
		WHERE tbl_role.RoleName LIKE 'Company Owner' AND tbl_user.Id NOT IN (
			SELECT tbl_companyMapping.UserId FROM [dbo].[Tbl_Company_User_Mapping] tbl_companyMapping WHERE IsDelete <> 1 AND CompanyId <> 0
		)
		AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0
		GROUP BY tbl_user.Id ,tbl_user.FirstName,tbl_user.LastName,tbl_user.AccountNumber,tbl_role.RoleName,tbl_user.IsDelete
		ORDER BY tbl_user.Id 
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT tbl_user.Id AS Id,
			tbl_user.FirstName +' '+ tbl_user.LastName AS Username,
			tbl_user.AccountNumber AS AccountNumber
		FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
		WHERE tbl_role.RoleName LIKE 'Company Owner' AND tbl_user.Id IN (
			SELECT tbl_companyMapping.UserId FROM [dbo].[Tbl_Company_User_Mapping] tbl_companyMapping WHERE IsDelete <> 1 AND CompanyId = @CompanyId
		)
		AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0
		GROUP BY tbl_user.Id ,tbl_user.FirstName,tbl_user.LastName,tbl_user.AccountNumber,tbl_role.RoleName,tbl_user.IsDelete
		ORDER BY tbl_user.Id 
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UserOperation]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <22-Dec-2021>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <04-02-2022>
-- Description:	<Use to do CURD operation on User Table by Admin.>
-- SP_Admin_UserOperation 3,32
-- =============================================


CREATE PROCEDURE [dbo].[USP_Admin_UserOperation]
	@Status INT = NULL,
	@ID INT = NULL,
	@RoleId INT = NULL,
	@CompanyId INT = NULL,
	@AccountNumber NVARCHAR(MAX) = NULL,
	@FirstName NVARCHAR(100) = NULL,
	@LastName NVARCHAR(100) = NULL,
	@CompanyName NVARCHAR(MAX) = NULL,
	@Password NVARCHAR(MAX) = NULL,
	@Nationality NVARCHAR(50) = NULL,
	@EmailID NVARCHAR(MAX) = NULL,
	@EmployeementCardExpiryDate NVARCHAR(MAX) = NULL,
	@MCode NVARCHAR(MAX) = NULL,
	@PhoneNumber NVARCHAR(30) = NULL,
	@CountryOfRecidence NVARCHAR(100) = NULL,
	@CompanyAddress NVARCHAR(1000) = NULL,
	@TelephoneNumber NVARCHAR(50) = NULL,
	@IsActive bit = NULL,
	@PassportNumber NVARCHAR(MAX) = NULL,
	@PassportExpiryDate NVARCHAR(50) = NULL,
	@Designation NVARCHAR(MAX)= NULL,
	@VisaExpiryDate NVARCHAR(MAX) = NULL,
	@InsuranceCompany NVARCHAR(MAX) = NULL,
	@InsuranceExpiryDate NVARCHAR(MAX) = NULL,
	@IsLogin BIT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT =NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	DECLARE @AccountNumberOfCompany NVARCHAR(MAX) = NULL;
	IF @Status = 1 AND @ID IS NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_User](
			AccountNumber,
			FirstName,
			LastName,
			Nationality,
			EmailID,
			MCode,
			PhoneNumber,
			CountryOfRecidence,
			TelephoneNumber,
			PassportNumber,
			PassportExpiryDate,
			Designation,
			VisaExpiryDate,
			InsuranceCompany,
			InsuranceExpiryDate,
			EmployeementCardExpiryDate,
			IsLogin,
			IsActive,
			IsDelete,
			CreatedBy,
			CreatedOnUTC
		)
		VALUES(
			@AccountNumber,
			@FirstName,
			@LastName,
			@Nationality,
			@EmailID,
			@MCode,
			@PhoneNumber,
			@CountryOfRecidence,
			@TelephoneNumber,
			@PassportNumber,
			@PassportExpiryDate,
			@Designation,
			@VisaExpiryDate,
			@InsuranceCompany,
			@InsuranceExpiryDate,
			@EmployeementCardExpiryDate,
			@IsLogin,
			@IsActive,
			0,
			@CreatedBy,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		)
		--SET  @returnId = (SELECT MAX(Id) FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE IsDelete <> 1)

		SET @returnId = (SELECT SCOPE_IDENTITY())
		
		SET @AccountNumberOfCompany = (SELECT ISNULL(DibnUserNumber,'N/A') FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE Id = @CompanyId AND IsDelete <> 1)

		IF @AccountNumberOfCompany = 'N/A'
		BEGIN
			UPDATE [dbo].[Tbl_Company]
			SET
				DibnUserNumber = @AccountNumber,
				ModifyBy = @CreatedBy,
				ModifyOn = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @CompanyId
		END

		DECLARE @CheckUser INT = NULL;
		IF @CompanyId IS NOT NULL AND @returnId >0
		BEGIN
			SET @CheckUser = (SELECT TOP(1) UserId FROM [dbo].[Tbl_Company_User_Mapping] WITH(NOLOCK) WHERE CompanyId = @CompanyId)
			IF @CheckUser = 0
			BEGIN
				UPDATE [dbo].[Tbl_Company_User_Mapping]
				SET 
					UserId = @returnId,
					IsDelete =0,
					ModifyBy = @CreatedBy,
					ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE CompanyId = @CompanyId AND UserId = 0
			END
			ELSE
			BEGIN
				INSERT INTO [dbo].[Tbl_Company_User_Mapping](
					CompanyId,
					UserId,
					IsDelete,
					CreatedBy,
					CreatedOnUtc
				)
				VALUES(
					@CompanyId,
					@returnId,
					0,
					@CreatedBy,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				)
			END
		END

		IF @RoleId IS NOT NULL AND @returnId > 0
		BEGIN
			INSERT INTO [dbo].[Tbl_User_Role_Mapping](
				RoleID,
				UserId,
				CreatedBy,
				CreatedOnUtc
			)VALUES(
				@RoleId,
				@returnId,
				@CreatedBy,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		END

		IF @Password IS NOT NULL AND @returnId > 0
		BEGIN
			INSERT INTO [dbo].[Tbl_Password](
				UserId,
				[Password]
			)
			VALUES(
				@returnId,
				@Password
			)
		END

		SELECT @returnId
	END
	ELSE IF @Status = 1 AND @ID IS NOT NULL
	BEGIN
		UPDATE [dbo].[Tbl_User]
		SET
			AccountNumber = @AccountNumber,
			FirstName = @FirstName,
			LastName = @LastName,
			Nationality = @Nationality,
			EmailID = @EmailID,
			MCode = @MCode,
			PhoneNumber = @PhoneNumber,
			CountryOfRecidence = @CountryOfRecidence,
			TelephoneNumber = @TelephoneNumber,
			PassportNumber = @PassportNumber,
			PassportExpiryDate = @PassportExpiryDate,
			Designation = @Designation,
			VisaExpiryDate = @VisaExpiryDate,
			InsuranceCompany = @InsuranceCompany,
			InsuranceExpiryDate = @InsuranceExpiryDate,
			EmployeementCardExpiryDate = @EmployeementCardExpiryDate,
			IsLogin = @IsLogin,
			IsActive = @IsActive,
			ModifyBy = @CreatedBy,
			ModifyOnUTC = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
		WHERE Id = @ID

		IF @Password IS NOT NULL AND @ID > 0
		BEGIN
			UPDATE [dbo].[Tbl_Password]
			SET 
				[Password] = @Password
			WHERE UserId = @ID
		END

			IF @RoleId IS NOT NULL
			BEGIN
				IF EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WITH(NOLOCK) WHERE UserId = @ID AND IsDelete <> 1)
				BEGIN
					UPDATE [dbo].[Tbl_User_Role_Mapping] 
					SET 
						RoleID = @RoleId,
						ModifyBy = @CreatedBy,
						ModifyOnUtc = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					WHERE UserId = @ID
				END
				ELSE
				BEGIN
					INSERT INTO [dbo].[Tbl_User_Role_Mapping](
						RoleID,
						UserId,
						CreatedBy,
						CreatedOnUtc
					)VALUES(
						@RoleId,
						@ID,
						@CreatedBy,
						SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
					)
				END
			END

		IF @CompanyId IS NOT NULL
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company_User_Mapping] WITH(NOLOCK) WHERE UserId = @ID)
			BEGIN
				UPDATE [dbo].[Tbl_Company_User_Mapping]
				SET 
					CompanyId = @CompanyId,
					ModifyBy = @CreatedBy,
					ModifyOnUTC = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				WHERE UserId = @ID
			END
			ELSE
			BEGIN
				INSERT INTO [dbo].[Tbl_Company_User_Mapping](
					CompanyId,
					UserId,
					CreatedBy,
					CreatedOnUtc
				)
				VALUES(
					@CompanyId,
					@ID,
					@CreatedBy,
					SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
				)
			END
		END

		SELECT @ID
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_user.Id,0) AS ID,
			ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
			ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
			ISNULL(tbl_user.LastName,'N/A') AS LastName,
			ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
			ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
			ISNULL(tbl_user.MCode,'N/A') AS MCode,
			ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
			ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
			ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
			ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
			STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS Designation,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
			ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
			ISNULL(tbl_user.IsActive,0) AS IsActive,
			ISNULL(tbl_user.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUTC,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUTC,
			ISNULL(tbl_user.IsLogin,0) AS IsLogin
		FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
		WHERE tbl_user.IsDelete <> 1  AND tbl_user_role_mapping.IsDelete <> 1
	END
	ELSE IF @Status = 3
	BEGIN
		SELECT DISTINCT
			ISNULL(tbl_user.Id,0) AS ID,
			ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
			ISNULL(tbl_password.Password,'N/A') AS Password,
			ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
			ISNULL(tbl_user.LastName,'N/A') AS LastName,
			ISNULL(tbl_company.Id,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS Company,
			ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
			ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
			ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
			ISNULL(tbl_user.MCode,'N/A') AS MCode,
			ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
			ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
			ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
			ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
			STUFF((SELECT DISTINCT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1 WITH(NOLOCK)
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS RoleName,
			ISNULL(tbl_user.Designation,'N/A') AS Designation,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
			ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,23),'N/A') AS EmployeementCardExpiryDate,
			ISNULL(tbl_user.IsActive,0) AS IsActive,
			ISNULL(tbl_user.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUTC,
			ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUTC,
			ISNULL(tbl_user.IsLogin,0) AS IsLogin
		FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Password] tbl_password WITH(NOLOCK) ON tbl_password.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON (tbl_user.Id = tbl_company_user_mapping.UserId AND tbl_company_user_mapping.CompanyId <> 0)
		LEFT JOIN [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) ON tbl_company.Id = tbl_company_user_mapping.CompanyId
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping WITH(NOLOCK) ON tbl_user_role_mapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
		WHERE tbl_user.Id = @ID  AND tbl_user.IsDelete <> 1 AND tbl_user_role_mapping.IsDelete <> 1 
	END
	ELSE IF @Status = 4
	BEGIN
			UPDATE [dbo].[Tbl_User]
			SET
				IsDelete = 1,
				ModifyBy = @CreatedBy,
				ModifyOnUTC = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE Id = @ID

			UPDATE [dbo].[Tbl_User_Role_Mapping]
			SET		
				IsDelete = 1,
				ModifyBy = @CreatedBy,
				ModifyOnUTC = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE UserId = @ID

			UPDATE [dbo].[Tbl_Company_User_Mapping]
			SET		
				IsDelete = 1,
				ModifyBy = @CreatedBy,
				ModifyOnUTC = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE UserId = @ID

			UPDATE [dbo].[Tbl_Notifications]
			SET		
				IsDelete = 1,
				ModifyBy = @CreatedBy,
				ModifyOnUTC = SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			WHERE UserId = @ID

			DELETE FROM [dbo].[Tbl_Password]
			WHERE UserId = @ID

			SELECT 1
	END
	ELSE IF @Status = 5
	BEGIN
		DECLARE @accountNumbers INT = NULL,@CompanyCode NVARCHAR(MAX) = NULL
		IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE (IsDelete <> 1 OR IsDelete IS NULL))
		BEGIN
			SET @accountNumbers = 
							(SELECT TOP (1) SUBSTRING(AccountNumber, PATINDEX('%[0-9]%', AccountNumber), LEN(AccountNumber)) 
							FROM [dbo].[Tbl_User] WITH(NOLOCK)
							WHERE (IsDelete <> 1 OR IsDelete IS NULL)
							ORDER BY Id DESC)

			SET @CompanyCode = 
			(SELECT TOP (1) SUBSTRING(AccountNumber, PATINDEX('[a-z][A-Z]', AccountNumber), LEN(AccountNumber)) 
							FROM [dbo].[Tbl_User] WITH(NOLOCK)
							WHERE (IsDelete <> 1 OR IsDelete IS NULL)
							ORDER BY Id DESC)

			SET  @CompanyCode =@CompanyCode+ CONVERT(NVARCHAR(100),@accountNumbers);

			SELECT @CompanyCode AS AccountNumber
		END
		ELSE
		BEGIN
			SELECT 'DIBN100' AS AccountNumber	
		END;
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UserRole]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Admin_UserRole]
	@Status INT = NULL,
	@UserId INT = NULL,
	@RoleID INT = NULL,
	@CreatedBy INT = NULL,
	@returnId INT = NULL OUTPUT
AS
BEGIN
	SET NOCOUNT ON;
	SET ARITHABORT ON;  
	SET DEADLOCK_PRIORITY HIGH;

	IF @Status = 1
	BEGIN
		IF @RoleId IS NOT NULL
		BEGIN
			INSERT INTO [dbo].[Tbl_User_Role_Mapping](
				RoleID,
				UserId,
				CreatedBy,
				CreatedOnUtc
			)VALUES(
				@RoleID,
				@UserId,
				@CreatedBy,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
			SELECT @UserId
		END
	END
	ELSE IF @Status = 2
	BEGIN
		SELECT 
			tbl_usermapping.RoleID AS RoleId
		FROM [dbo].[Tbl_User_Role_Mapping] tbl_usermapping WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_role.RoleID = tbl_usermapping.RoleID
		LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_user.Id = tbl_usermapping.UserId
		WHERE tbl_user.Id = @UserId AND tbl_usermapping.IsDelete <> 1
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Admin_UsersListForCompany]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		USP_Admin_UsersListForCompany
-- Create date: <29-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get users
-- USP_Admin_UsersListForCompany 'c'
-- =============================================
CREATE PROCEDURE [dbo].[USP_Admin_UsersListForCompany]
	@prefix nvarchar(max) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	WITH
	tblUsers
	AS
	(
		SELECT 
			tbl_user.Id AS Id,
			tbl_user.FirstName +''+ CASE WHEN ISNULL(tbl_user.LastName,'N/A') <> 'N/A' THEN ' ' + tbl_user.LastName ELSE '' END AS Username
		FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_user.Id
		LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_roleMapping.RoleID
		WHERE 
		tbl_role.RoleName LIKE 'Company Owner'
		AND tbl_user.Id NOT IN (
			SELECT tbl_companyMapping.UserId FROM [dbo].[Tbl_Company_User_Mapping] tbl_companyMapping WHERE IsDelete <> 1 AND CompanyId <> 0
		)
		AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0
		GROUP BY tbl_user.Id ,tbl_user.FirstName,tbl_user.LastName,tbl_user.AccountNumber,tbl_role.RoleName,tbl_user.IsDelete
	)

	SELECT 
		Id AS Id,
		Username AS Username
	FROM tblUsers
	WHERE (Username LIKE @prefix + '%' OR @prefix IS NULL)
	GROUP BY Id,Username
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_CheckMainCompanyUsers]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- SP_CheckMainCompanyUsers
CREATE PROCEDURE [dbo].[USP_CheckMainCompanyUsers]
AS
BEGIN
	SET NOCOUNT ON;

	-- Chetan Pandey
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 1 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			1,
			1,
			0
		)
	END

	-- Info DIBN
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 5 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			1,
			5,
			0
		)
	END

	-- Chirag Patel
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 64 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			64,
			0
		)
	END

	-- Rutul Shukla
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 65 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			65,
			0
		)
	END

	-- Bhavik Shah
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 291 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			291,
			0
		)
	END

	-- Jash Mehta
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 361 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			361,
			0
		)
	END

	-- Princy Patel
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 317 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			1,
			317,
			0
		)
	END

	-- Rahul Rakholiya
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 322 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			322,
			0
		)
	END

	-- Aqeel John
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 323 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			323,
			0
		)
	END
	-- Rohit Ahmedabad
	IF NOT EXISTS(SELECT Id FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = 310 AND IsDelete <> 1)
	BEGIN
		INSERT INTO [dbo].[Tbl_User_Role_Mapping](
			RoleID,
			UserId,
			IsDelete
		)
		VALUES(
			3,
			310,
			0
		)
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Cmp_GetAllSupportTicket]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_Cmp_GetAllSupportTicket]
	@CompanyId INT = NULL,
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
			tbl_supportTicket.TrackingNumber AS TrackingNumber,
			ISNULL(tbl_supportTicket.ID,0) AS ID,
			ISNULL(tbl_supportTicket.CompanyId,0) AS CompanyId,
			ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
			ISNULL(tbl_supportTicket.UserId,0) AS UserId,
			ISNULL(tbl_user.FirstName +' '+ tbl_user.LastName,'N/A') AS Username,
			ISNULL(tbl_supportTicket.Title,'N/A') AS Title,
			ISNULL(tbl_supportTicket.Description,'N/A') AS [Description],
			CASE WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 1 THEN 1
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 0 THEN 1
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc) = 2 THEN 2
			END AS TicketStatusId,
			CASE WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 1 THEN 'Open'
			WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 0 THEN 'Open'
					WHEN (SELECT TOP(1) TicketStatus FROM [dbo].[Tbl_SupportTicket] b WHERE b.TrackingNumber LIKE tbl_supportTicket.TrackingNumber
			AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0) ORDER BY Id Desc)= 2 THEN 'Close'
			END AS TicketStatus,
			ISNULL(tbl_supportTicket.ParentId,0) AS ParentId,
			ISNULL(tbl_supportTicket.IsActive,0) AS IsActive,
			ISNULL(tbl_supportTicket.IsDelete,0) AS IsDelete,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.CreatedOn,105),'N/A') AS CreatedOn,
			ISNULL(tbl_supportTicket.CreatedBy,0) AS CreatedBy,
			ISNULL(CONVERT(NVARCHAR(70),tbl_supportTicket.ModifyOn,105),'N/A') AS ModifyOn,
			ISNULL(tbl_supportTicket.ModifyBy,0) AS ModifyBy,
			ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignSupportTicket] tbl_assign
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.TrackingNumber = tbl_supportTicket.TrackingNumber
				FOR XML PATH ('')), 1, 1, ''
				) ,'N/A') AS AssignedUser
	FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_supportTicket.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_supportTicket.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_AssignSupportTicket] tbl_assigneduser ON tbl_assigneduser.TrackingNumber = tbl_supportTicket.TrackingNumber
	WHERE (tbl_company.Id = @CompanyId) 
	AND (tbl_supportTicket.IsDelete <> 1 OR tbl_supportTicket.IsDelete IS NULL OR tbl_supportTicket.IsDelete =0)
	AND (tbl_assigneduser.UserId = @UserId OR @UserId IS NULL OR @UserId =0)
	AND tbl_supportTicket.ID IN (
		SELECT MIN(ID)
		FROM [dbo].[Tbl_SupportTicket] tbl_supportTicket1
		WHERE tbl_supportTicket1.TrackingNumber = tbl_supportTicket.TrackingNumber
		AND (tbl_supportTicket1.ParentId IS NULL OR tbl_supportTicket1.ParentId = 0) 
		AND (tbl_supportTicket1.IsDelete <> 1 OR tbl_supportTicket1.IsDelete IS NULL OR tbl_supportTicket1.IsDelete =0)
		GROUP BY TrackingNumber
	)
	AND (tbl_supportTicket.ParentId IS NULL OR tbl_supportTicket.ParentId = 0) 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Company_GetAllShareholderByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ===========================================================================
-- Author : <Yashasvi Sharma>
-- Create date: <15-11-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<USP_Company_GetAllShareholderByCompanyId 2>
-- ===========================================================================
CREATE PROCEDURE [dbo].[USP_Company_GetAllShareholderByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_shareholder.ID,0) AS ID,
		ISNULL(tbl_shareholder.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_shareholder.LastName,'N/A') AS LastName,
		ISNULL(tbl_shareholder.Passport_Number,'N/A') PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		ISNULL(tbl_shareholder.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_shareholder.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_shareholder.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_shareholder.CompanyId,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_shareholder.SharePercentage,'N/A') AS SharePercentage,
		ISNULL(tbl_shareholder.IsActive,0) AS IsActive,
		ISNULL(tbl_shareholder.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_shareholder.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_ShareholdersOrDirectors] tbl_shareholder WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_company] tbl_company ON tbl_shareholder.CompanyId = tbl_company.Id
	WHERE tbl_shareholder.IsDelete <> 1 AND tbl_shareholder.CompanyId = @CompanyId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetActiveBanners]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <05-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<>>
-- <SP_GetActiveBanners>
-- =============================================
CREATE PROCEDURE [dbo].[USP_GetActiveBanners]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(tbl_banner.Id,0) AS Id,
		ISNULL(tbl_banner.FileName,'N/A') AS [FileName],
		ISNULL(tbl_banner.Extension,'N/A') AS Extension,
		tbl_banner.PictureBinary AS PictureBinary,
		ISNULL(tbl_banner.Path,'N/A') AS [Path],
		ISNULL(tbl_banner.IsActive,0) AS IsActive,
		ISNULL(tbl_banner.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_banner.CreatedOnUtc,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_banner.ModifyOnUtc,105),'N/A') AS ModifyOnUtc
	FROM [dbo].[Tbl_Banner] tbl_banner WITH(NOLOCK)
	WHERE tbl_banner.IsDelete <> 1 AND tbl_banner.IsActive<>0
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetActiveEmployeeByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <04-02-2022,08-02-2022>
-- Description:	<Get all active employees whoes IsActive is one>
-- <SP_GetActiveEmployeeByCompanyId 46>
-- =============================================
CREATE PROCEDURE [dbo].[USP_GetActiveEmployeeByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS RoleName,
		ISNULL(tbl_user.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),'N/A') AS EmployeementCardExpiryDate,
		ISNULL(tbl_company.Id,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_company_mapping ON tbl_user_company_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_user_company_mapping.CompanyId
	WHERE (tbl_company.Id = @CompanyId OR @CompanyId IS NULL OR @CompanyId =0) 
	AND tbl_user.IsActive = 1  
	AND tbl_user.IsDelete <> 1 
	AND tbl_user_company_mapping.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN' 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_GetActiveEmployeeByCompanyId_Cmp]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <04-02-2022,08-02-2022>
-- Description:	<Get all active employees whoes IsActive is one>
-- <USP_GetActiveEmployeeByCompanyId_Cmp 46>
-- =============================================
CREATE PROCEDURE [dbo].[USP_GetActiveEmployeeByCompanyId_Cmp]
	@CompanyId INT = NULL
AS
BEGIN	
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS RoleName,
		ISNULL(tbl_user.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),'N/A') AS EmployeementCardExpiryDate,
		ISNULL(tbl_company.Id,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_company_mapping ON tbl_user_company_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_user_company_mapping.CompanyId
	WHERE tbl_company.Id = @CompanyId
	AND tbl_user.IsActive = 1  
	AND tbl_user.IsDelete <> 1 
	AND tbl_user_company_mapping.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN' 
END
GO
/****** Object:  StoredProcedure [dbo].[USP_GetAssignedEnquiryFormDetailOfWeb]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_GetAssignedEnquiryFormDetailOfWeb]
	@UserId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		ISNULL(enquiryForm.Id,0) AS Id,
		ISNULL(enquiryForm.EnquiryNumber,'N/A') AS EnquiryNumber,
		ISNULL(enquiryForm.Name,'N/A') AS Name,
		ISNULL(enquiryForm.FromEmail,'N/A') AS FromEmail,
		ISNULL(enquiryForm.ToEmail,'N/A') AS ToEmail,
		ISNULL(enquiryForm.ContactNumber,'N/A') AS ContactNumber,
		ISNULL(enquiryForm.Description,'N/A') AS Description,
		ISNULL(enquiryForm.EnquiryFor,'N/A') AS EnquiryFor,
		ISNULL(CONVERT(NVARCHAR(50),enquiryForm.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(enquiryForm.Status,'N/A') AS [Status],
		ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignEnquiryRequests] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.RequestId = enquiryForm.Id
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
		ISNULL(
		(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignEnquiryRequests] tbl_assign WITH(NOLOCK)
		WHERE tbl_assign.RequestId = enquiryForm.Id
		) ,'N/A') AS AssignOn
	FROM [dbo].[Tbl_EnquiryFormDetails] enquiryForm
	LEFT JOIN [dbo].[Tbl_AssignEnquiryRequests] tbl_assignUser ON tbl_assignUser.RequestId = enquiryForm.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assignUser.UserId
	WHERE enquiryForm.IsDelete <> 1 AND tbl_assignUser.UserId = @UserId
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetCompaniesForAccountSummary]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-10-2022>
-- Modify By : <Modify By>
-- Modify date : <Modify On>
-- Description:	Get Company Details With Current Portal Balance of that Company
-- USP_GetCompaniesForAccountSummary 0,350,N'rutul',N'Portal Balance','desc'
-- =============================================

CREATE PROCEDURE [dbo].[USP_GetCompaniesForAccountSummary]
	@skipRows  INT = NULL,
	@RowsOfPage INT = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL,
	@sortColumn NVARCHAR(MAX) = NULL,
	@sortDirection NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	

	SET @query = N'SELECT 
						tbl_company.AccountNumber AS AccountNumber,
						ISNULL(tbl_company.Id,0) AS Id,
						ISNULL(tbl_company.CompanyName,''N/A'') AS CompanyName,
						ISNULL(tbl_company.EmailID,''N/A'') AS EmailID,
						ISNULL(tbl_portalBalance.BalanceAmount,''0'') AS PortalBalance,
						ISNULL(STUFF( 
							(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
							FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
							LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
							WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
							FOR XML PATH ('''')), 1, 1, '''') ,''N/A'') AS SalesPerson
						FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) 
						LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company.Id = tbl_company_user_mapping.CompanyId 
						LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id 
						LEFT JOIN [dbo].[Tbl_PortalBalance] tbl_portalBalance WITH(NOLOCK) ON tbl_portalBalance.CompanyId = tbl_company.Id 
						LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
						LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
				'

	SET @conditions = N' WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName NOT LIKE N''DIBN'' '

	--IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	--BEGIN
	--	SET @conditions = @conditions + ' AND (
	--								@searchPrefix IS NULL 
	--								OR tbl_company.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
	--								OR (tbl_companySales.FirstName LIKE (SELECT TOP 1 FirstName 
	--									FROM [dbo].[Tbl_SalesPersons] tbl_sales 
	--									LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id 
	--									WHERE (tbl_sales.FirstName LIKE ''%'+@searchPrefix+'%'' AND tbl_mapping.CompanyId = 
	--									tbl_company.Id AND tbl_mapping.SalesPersonId = tbl_sales.Id)))
	--								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
	--								OR tbl_company.EmailID LIKE ''%'+@searchPrefix+'%'' 
	--								OR tbl_portalBalance.BalanceAmount LIKE ''%'+@searchPrefix+'%'' 
	--								OR (
	--										SELECT STUFF( 
	--										(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
	--										FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
	--										LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
	--										WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
	--										FOR XML PATH ('''')), 1, 1, '''')
	--									) LIKE '''+@searchPrefix+''' 
	--							) '

	--END

	-- OR tbl_company.EmailID LIKE ''%'+@searchPrefix+'%'' 
	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		SET @conditions = @conditions + ' AND (
									@searchPrefix IS NULL 
									OR tbl_company.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_portalBalance.BalanceAmount LIKE ''%'+@searchPrefix+'%'' 
									OR (
											SELECT STUFF( 
											(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
											FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
											LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
											WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
											FOR XML PATH ('''')), 1, 1, '''')
										) LIKE ''%'+@searchPrefix+'%'' 
								) '

	END

	SET @groupByClause = N' GROUP BY tbl_company.AccountNumber,tbl_company.Id,tbl_company.CompanyName,tbl_company.EmailID,tbl_portalBalance.BalanceAmount '

	SET @orderByClause = N' ORDER BY '
		
		IF @sortColumn = '' OR @sortColumn IS NULL
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_company.AccountNumber, PATINDEX(''%[0-9]%'',tbl_company.AccountNumber), LEN(tbl_company.AccountNumber)))) '
								+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_company.AccountNumber, PATINDEX(''%[0-9]%'',tbl_company.AccountNumber), LEN(tbl_company.AccountNumber)))) '
								+ ' ASC '
		END

		IF @sortColumn = 'DIBN No.' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' (SELECT CONVERT(INT,SUBSTRING(tbl_company.AccountNumber, PATINDEX(''%[0-9]%'',tbl_company.AccountNumber), LEN(tbl_company.AccountNumber)))) '
								+ ' DESC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' tbl_company.CompanyName '
								+ ' ASC '
		END

		IF @sortColumn = 'Company' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' tbl_company.CompanyName '
								+ ' DESC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' tbl_company.EmailID '
								+ ' ASC '
		END

		IF @sortColumn = 'Email' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' tbl_company.EmailID '
								+ ' DESC '
		END

		IF @sortColumn = 'Portal Balance' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' ISNULL(CONVERT(DECIMAL(18,2),tbl_portalBalance.BalanceAmount),0) '
								+ ' ASC '
		END

		IF @sortColumn = 'Portal Balance' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
								+ ' ISNULL(CONVERT(DECIMAL(18,2),tbl_portalBalance.BalanceAmount),0) '
								+ ' DESC '
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'asc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF( 
					(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
					FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+' ASC '
		END

		IF @sortColumn = 'Sales Person' AND @sortDirection = 'desc'
		BEGIN
			SET @orderByClause = @orderByClause 
			+ ' (
					SELECT STUFF( 
					(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
					FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
					WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
					FOR XML PATH ('''')), 1, 1, '''')
				) '
			+ ' DESC '
		END

	SET @pagination = ' OFFSET @skipRows ROWS 
					    FETCH NEXT @RowsOfPage ROWS ONLY'

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause +' '+@orderByClause +' '+@pagination

	EXEC SP_EXECUTESQL @selectQuery,N'@skipRows INT,@RowsOfPage INT,@searchPrefix NVARCHAR(MAX)',@skipRows,@RowsOfPage,@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetCompaniesForAccountSummaryCount]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <11-10-2022>
-- Modify By : <Modify By>
-- Modify date : <Modify On>
-- Description:	Get Company Details With Current Portal Balance of that Company
-- USP_GetCompaniesForAccountSummaryCount NULL,NULL
-- =============================================

CREATE PROCEDURE [dbo].[USP_GetCompaniesForAccountSummaryCount]
	@searchBy NVARCHAR(MAX) = NULL,
	@searchPrefix NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @query AS NVARCHAR(MAX) = '' ,
		@conditions AS NVARCHAR(MAX) ='',
		@groupByClause AS NVARCHAR(MAX) ='',
		@selectQuery AS NVARCHAR(MAX) ='',
		@orderByClause AS NVARCHAR(MAX) ='',
		@pagination AS NVARCHAR(MAX) ='',
		@countingQuery AS NVARCHAR(MAX) =''
	

	SET @query = N'SELECT 
						tbl_company.AccountNumber AS AccountNumber
					FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK) 
					LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company.Id = tbl_company_user_mapping.CompanyId 
					LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id 
					LEFT JOIN [dbo].[Tbl_PortalBalance] tbl_portalBalance WITH(NOLOCK) ON tbl_portalBalance.CompanyId = tbl_company.Id 
					LEFT OUTER JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMappings WITH(NOLOCK) ON tbl_companyMappings.CompanyId = tbl_company.Id
					LEFT OUTER JOIN [dbo].[Tbl_SalesPersons] tbl_companySales WITH(NOLOCK) ON tbl_companyMappings.SalesPersonId = tbl_companySales.Id 
				'

	SET @conditions = N' WHERE tbl_company.IsDelete <> 1 AND tbl_company.CompanyName NOT LIKE N''DIBN'' '

	--IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	--BEGIN
	--	SET @conditions = @conditions + ' AND (
	--								@searchPrefix IS NULL 
	--								OR tbl_company.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
	--								OR (tbl_companySales.FirstName LIKE (SELECT TOP 1 FirstName 
	--									FROM [dbo].[Tbl_SalesPersons] tbl_sales 
	--									LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.CompanyId = tbl_company.Id 
	--									WHERE (tbl_sales.FirstName LIKE ''%'+@searchPrefix+'%'' AND tbl_mapping.CompanyId = 
	--									tbl_company.Id AND tbl_mapping.SalesPersonId = tbl_sales.Id)))
	--								OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
	--								OR tbl_company.EmailID LIKE ''%'+@searchPrefix+'%'' 
	--								OR tbl_portalBalance.BalanceAmount LIKE ''%'+@searchPrefix+'%'' 
	--								OR (
	--										SELECT STUFF( 
	--										(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
	--										FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
	--										LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
	--										WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
	--										FOR XML PATH ('''')), 1, 1, '''')
	--									) LIKE '''+@searchPrefix+''' 
	--							) '

	--END

	-- OR tbl_company.EmailID LIKE ''%'+@searchPrefix+'%'' 
	IF @searchPrefix IS NOT NULL AND @searchPrefix != ''
	BEGIN
		SET @conditions = @conditions + ' AND (
									@searchPrefix IS NULL 
									OR tbl_company.AccountNumber LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_company.CompanyName LIKE ''%'+@searchPrefix+'%'' 
									OR tbl_portalBalance.BalanceAmount LIKE ''%'+@searchPrefix+'%'' 
									OR (
											SELECT STUFF( 
											(SELECT '', '' + ISNULL(tbl_salesPersons1.FirstName +'' ''+ tbl_salesPersons1.LastName,''N/A'') 
											FROM [dbo].[Tbl_SalesPersons] tbl_salesPersons1 WITH(NOLOCK) 
											LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_companyMapping WITH(NOLOCK) ON tbl_companyMapping.SalesPersonId = tbl_salesPersons1.Id 
											WHERE tbl_companyMapping.CompanyId = tbl_company.Id AND tbl_companyMapping.IsDelete <> 1 
											FOR XML PATH ('''')), 1, 1, '''')
										) LIKE ''%'+@searchPrefix+'%'' 
								) '

	END

	SET @groupByClause = N' GROUP BY tbl_company.AccountNumber,tbl_company.Id,tbl_company.CompanyName,tbl_company.EmailID,tbl_portalBalance.BalanceAmount '

	SET @selectQuery = @query +' '+ @conditions +' '+ @groupByClause

	EXEC SP_EXECUTESQL @selectQuery,N'@searchPrefix NVARCHAR(MAX)',@searchPrefix
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetEmployeesCountForCharting]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- SP_GetEmployeesCountForCharting 1

CREATE PROCEDURE [dbo].[USP_GetEmployeesCountForCharting]
	@Status INT =NULL
AS
BEGIN
	SET NOCOUNT ON;

	IF @Status = 1
	BEGIN
		SELECT 
			(
				SELECT COUNT(*) AS [CountOfUsers]
				FROM [dbo].[Tbl_User] 
				WHERE IsDelete <> 1 AND YEAR(CreatedOnUtc) <= YEAR(CURRENT_TIMESTAMP) 
				GROUP BY YEAR(CreatedOnUtc)
			) AS [CountOfUsers],

			(
				SELECT YEAR(CreatedOnUtc)
				FROM [dbo].[Tbl_User] 
				WHERE IsDelete <> 1 AND YEAR(CreatedOnUtc) <= YEAR(CURRENT_TIMESTAMP) 
				GROUP BY YEAR(CreatedOnUtc)
			) AS [UserYear],


			(
				SELECT COUNT(*) AS [CountOfSalesPersons]
				FROM [dbo].[Tbl_SalesPersons] 
				WHERE IsDelete <> 1 AND YEAR(CreatedOn) <= YEAR(CURRENT_TIMESTAMP) 
				GROUP BY YEAR(CreatedOn)
			) AS [CountOfSalesPersons],

			(
				SELECT YEAR(CreatedOn)
				FROM [dbo].[Tbl_SalesPersons] 
				WHERE IsDelete <> 1 AND YEAR(CreatedOn) <= YEAR(CURRENT_TIMESTAMP) 
				GROUP BY YEAR(CreatedOn)
			) AS [SalesPersonYear]

	END
	ELSE IF @Status = 2
	BEGIN
		SELECT COUNT(*) AS [CountOfUsers],
			   DATENAME(MONTH,CreatedOnUTC) AS [Month]
		FROM [dbo].[Tbl_User] 
		WHERE IsDelete <> 1 AND YEAR(CreatedOnUTC) <= YEAR(CURRENT_TIMESTAMP)  AND  MONTH(CreatedOnUTC) <= MONTH(CURRENT_TIMESTAMP) 
		GROUP BY DATENAME(MONTH,CreatedOnUTC)

		SELECT COUNT(*) AS [CountOfSalesPersons],
			   DATENAME(MONTH,CreatedOn) AS [Month]
		FROM [dbo].[Tbl_SalesPersons] 
		WHERE IsDelete <> 1 AND YEAR(CreatedOn) <= YEAR(CURRENT_TIMESTAMP)  AND  MONTH(CreatedOn) <= MONTH(CURRENT_TIMESTAMP) 
		GROUP BY DATENAME(MONTH,CreatedOn)
	END
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetEnquiryFormDetailOfWeb]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_GetEnquiryFormDetailOfWeb]
	@StartDate NVARCHAR(50) = NULL,
	@EndDate NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(enquiryForm.Id,0) AS Id,
		ISNULL(enquiryForm.EnquiryNumber,'N/A') AS EnquiryNumber,
		ISNULL(enquiryForm.ClientEnquiryNumber,'N/A') AS ClientEnquiryNumber,
		ISNULL(enquiryForm.Name,'N/A') AS Name,
		ISNULL(enquiryForm.FromEmail,'N/A') AS FromEmail,
		ISNULL(enquiryForm.ToEmail,'N/A') AS ToEmail,
		ISNULL(enquiryForm.ContactNumber,'N/A') AS ContactNumber,
		ISNULL(enquiryForm.Description,'N/A') AS Description,
		ISNULL(enquiryForm.EnquiryFor,'N/A') AS EnquiryFor,
		ISNULL(CONVERT(NVARCHAR(50),enquiryForm.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(enquiryForm.Status,'N/A') AS [Status],
		ISNULL(STUFF(
				(SELECT ', ' + ISNULL(tbl_user.FirstName +' '+tbl_user.LastName,'N/A') FROM [dbo].[Tbl_AssignEnquiryRequests] tbl_assign WITH(NOLOCK)
				LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assign.UserId
				WHERE tbl_assign.RequestId = enquiryForm.Id
				FOR XML PATH ('')), 1, 1, ''
			 ) ,'N/A') AS AssignedUser,
		ISNULL(
		(SELECT TOP(1) ISNULL(CONVERT(NVARCHAR(50),tbl_assign.CreatedOn,105),'N/A') FROM [dbo].[Tbl_AssignEnquiryRequests] tbl_assign WITH(NOLOCK)
		WHERE tbl_assign.RequestId = enquiryForm.Id
		) ,'N/A') AS AssignOn
	FROM [dbo].[Tbl_EnquiryFormDetails] enquiryForm
	LEFT JOIN [dbo].[Tbl_AssignEnquiryRequests] tbl_assignUser ON tbl_assignUser.RequestId = enquiryForm.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assignUser.UserId
	WHERE enquiryForm.IsDelete <> 1
	AND ((CONVERT(date,enquiryForm.CreatedOn) >= CONVERT(date,@StartDate) OR @StartDate IS NULL) AND (CONVERT(date,enquiryForm.CreatedOn) <= CONVERT(date,@EndDate) OR @EndDate IS NULL))
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetEnquiryFormDetailOfWebByEnquiryNumber]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_GetEnquiryFormDetailOfWebByEnquiryNumber]
	@EnquiryNumber NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(enquiryForm.Id,0) AS Id,
		ISNULL(enquiryForm.ClientEnquiryNumber,'N/A') AS EnquiryNumber,
		ISNULL(enquiryForm.Name,'N/A') AS [Name],
		ISNULL(enquiryForm.EnquiryFor,'N/A') AS EnquiryFor,
		ISNULL(CONVERT(NVARCHAR(50),enquiryForm.CreatedOn,105),'N/A') AS CreatedOn,
		ISNULL(enquiryForm.Status,'N/A') AS [Status]
	FROM [dbo].[Tbl_EnquiryFormDetails] enquiryForm
	LEFT JOIN [dbo].[Tbl_AssignEnquiryRequests] tbl_assignUser ON tbl_assignUser.RequestId = enquiryForm.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_assignUser.UserId
	WHERE enquiryForm.IsDelete <> 1
	AND enquiryForm.ClientEnquiryNumber LIKE @EnquiryNumber
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetInActiveEmployeeByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <08-02-2022>
-- Description:	<Get all in-active employees whoes IsActive is zero>
-- <SP_GetInActiveEmployeeByCompanyId>
-- =============================================
CREATE PROCEDURE [dbo].[USP_GetInActiveEmployeeByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS RoleName,
		ISNULL(tbl_user.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),'N/A') AS EmployeementCardExpiryDate,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUtc,
		ISNULL(tbl_company.Id,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_company_mapping ON tbl_user_company_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_user_company_mapping.CompanyId
	WHERE tbl_user.IsActive = 0 AND tbl_user.IsDelete <> 1 AND (tbl_company.Id = @CompanyId OR @CompanyId IS NULL)
	AND tbl_company.CompanyName NOT LIKE 'DIBN'
END
GO
/****** Object:  StoredProcedure [dbo].[USP_GetInActiveEmployeeByCompanyId_Cmp]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <12-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <08-02-2022>
-- Description:	<Get all in-active employees whoes IsActive is zero>
-- <USP_GetInActiveEmployeeByCompanyId_Cmp>
-- =============================================
CREATE PROCEDURE [dbo].[USP_GetInActiveEmployeeByCompanyId_Cmp]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS RoleName,
		ISNULL(tbl_user.Designation,'N/A') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.EmployeementCardExpiryDate,105),'N/A') AS EmployeementCardExpiryDate,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUtc,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUtc,
		ISNULL(tbl_company.Id,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_user_company_mapping ON tbl_user_company_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_user_company_mapping.CompanyId
	WHERE tbl_user.IsActive <> 1 AND tbl_user.IsDelete <> 1 AND tbl_company.Id = @CompanyId
	AND tbl_user_company_mapping.IsDelete <> 1
	AND tbl_company.CompanyName NOT LIKE 'DIBN'
END
GO
/****** Object:  StoredProcedure [dbo].[USP_GetMainCompanyEmployeesByCompanyId]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <03-Jan-2022>
-- Modify By : <Yashasvi Sharma>
-- Modify date : <08-02-2022>
-- Description:	<SP_GetMainCompanyEmployeesByCompanyId 1>
-- =============================================

CREATE PROCEDURE [dbo].[USP_GetMainCompanyEmployeesByCompanyId]
	@CompanyId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_user.Id,0) AS Id,
		ISNULL(tbl_user.FirstName,'N/A') AS FirstName,
		ISNULL(tbl_user.LastName,'N/A') AS LastName,
		ISNULL(tbl_user.AccountNumber,'N/A') AS AccountNumber,
		ISNULL(tbl_user.Nationality,'N/A') AS Nationality,
		ISNULL(tbl_user.EmailID,'N/A') AS EmailID,
		ISNULL(tbl_user.PhoneNumber,'N/A') AS PhoneNumber,
		ISNULL(tbl_user.CountryOfRecidence,'N/A') AS CountryOfRecidence,
		ISNULL(tbl_user.TelephoneNumber,'N/A') AS TelephoneNumber,
		ISNULL(tbl_user.PassportNumber,'N/A') AS PassportNumber,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.PassportExpiryDate,23),'N/A') AS PassportExpiryDate,
		STUFF((SELECT DISTINCT ', ' + tbl_role.RoleName 
			FROM [dbo].[Tbl_User] tbl_user1
			LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user1.Id
			LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
			WHERE tbl_user1.Id = tbl_user.Id AND tbl_user_role_mapping.IsDelete <> 1
			FOR XML PATH('')),1,1,'') AS Designation,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.VisaExpiryDate,23),'N/A') AS VisaExpiryDate,
		ISNULL(tbl_user.InsuranceCompany,'N/A') AS InsuranceCompany,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.InsuranceExpiryDate,23),'N/A') AS InsuranceExpiryDate,
		ISNULL(tbl_company.Id,0) AS CompanyId,
		ISNULL(tbl_company.CompanyName,'N/A') AS Company,
		ISNULL(tbl_user.IsActive,0) AS IsActive,
		ISNULL(tbl_user.IsDelete,0) AS IsDelete,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.CreatedOnUTC,105),'N/A') AS CreatedOnUTC,
		ISNULL(CONVERT(NVARCHAR(50),tbl_user.ModifyOnUTC,105),'N/A') AS ModifyOnUTC,
		ISNULL(tbl_user.IsLogin,0) AS IsLogin
	FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_user_role_mapping ON tbl_user_role_mapping.UserId = tbl_user.Id
	LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_role.RoleID = tbl_user_role_mapping.RoleID
	WHERE tbl_company.Id = @CompanyId AND tbl_user.IsDelete <> 1 AND tbl_user_role_mapping.IsDelete <> 1
	--AND tbl_user.Id <> 51
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_GetUploadedServiceRequestDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- USP_GetUploadedServiceRequestDocument N'SR109',215,N'1.18 - J B D Information technology.pdf' 
CREATE PROCEDURE [dbo].[USP_GetUploadedServiceRequestDocument]
	@SerialNumber NVARCHAR(MAX) = NULL,
	@CompanyId INT = NULL,
	@FileName NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_serviceFormFieldValue.FileName,'N/A') AS FileName,
		tbl_serviceFormFieldValue.FieldFileValue AS FieldFileValue
	FROM [dbo].[Tbl_ServiceFormFieldValue] tbl_serviceFormFieldValue WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_ServiceFormDataField] tbl_serviceFormDataField ON tbl_serviceFormFieldValue.FieldId = tbl_serviceFormDataField.Id
	LEFT JOIN [dbo].[Tbl_ServiceForms] tbl_serviceForm ON tbl_serviceForm.Id = tbl_serviceFormFieldValue.FormId
	LEFT JOIN [dbo].[Tbl_Service] tbl_service ON tbl_service.Id = tbl_serviceFormFieldValue.ServiceId
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_serviceFormFieldValue.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_serviceFormFieldValue.UserId
	LEFT JOIN [dbo].[Tbl_ServiceRequest] tbl_serviceRequest ON tbl_serviceRequest.ServiceId = tbl_serviceFormFieldValue.ServiceId
	WHERE (tbl_serviceFormFieldValue.SerialNumber LIKE @SerialNumber AND tbl_serviceFormFieldValue.SerialNumber IS NOT NULL)
	AND tbl_serviceFormFieldValue.FileName = @FileName
	AND tbl_serviceFormFieldValue.CompanyId = @CompanyId
	AND tbl_serviceRequest.StepId = 0 AND tbl_serviceFormFieldValue.IsDelete <> 1 AND tbl_serviceRequest.IsDelete <> 1
END
GO
/****** Object:  StoredProcedure [dbo].[USP_Login]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- USP_Login NULL,N'TBC01',N'rxPCiD7SNs5GaZ93qUasMqqvwBxN0OsNWK4xyk/+vsk='
CREATE PROCEDURE [dbo].[USP_Login]
	@EmailId NVARCHAR(MAX) = NULL,
	@AccountNumber NVARCHAR(MAX) =NULL,
	@Password NVARCHAR(MAX) = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @UserId INT = NULL,@RoleId INT = NULL,@SalesPersonId INT = NULL,@CompanyId INT = NULL,@countOfUser INT = NULL,@CountOfPermission INT = NULL;
	IF @AccountNumber IS NOT NULL
	BEGIN
		SET @UserId = (SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <> 0)

		SET @CompanyId = (
							SELECT TOP 1 tbl_company_user_mapping.CompanyId FROM [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping 
							LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
							WHERE tbl_company_user_mapping.UserId = @UserId
							AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsLogin <> 0
							ORDER BY tbl_company_user_mapping.Id DESC
						)
		IF @CompanyId  = 1
		BEGIN
			IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1)
			BEGIN
				SET @UserId = (SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <> 0)
				--SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = @UserId)
				IF EXISTS(SELECT ID FROM [dbo].[Tbl_Password] WITH(NOLOCK) WHERE UserId =@UserId)
				BEGIN
					IF EXISTS(SELECT Id FROM [dbo].[Tbl_Password] WITH(NOLOCK) WHERE UserId =@UserId AND [Password]=@Password)
					BEGIN 
						IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <> 0)
						BEGIN
							DECLARE @UserCompanyId INT = NULL
						
							SET @UserCompanyId = (SELECT TOP 1 tbl_company_user_mapping.CompanyId FROM [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping 
										LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
										WHERE tbl_company_user_mapping.UserId = @UserId
										AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsLogin <> 0
										ORDER BY tbl_company_user_mapping.Id DESC)

							IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_company WHERE tbl_company.Id = @UserCompanyId AND tbl_company.IsActive <> 0 AND tbl_company.IsDelete <> 1)
							BEGIN
								SELECT DISTINCT
									tbl_role.RoleName,tbl_company_user_mapping.CompanyId AS CompanyId,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
								FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_usermapping ON tbl_user.Id = tbl_usermapping.UserId
								LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_usermapping.RoleID = tbl_role.RoleID
								LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
								LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
								LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_company_user_mapping.CompanyId 
								WHERE tbl_user.Id = @UserId AND tbl_usermapping.IsDelete <> 1 AND tbl_company_user_mapping.CompanyId <> 0
								AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsLogin <> 0
								GROUP BY tbl_usermapping.RoleID,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_company_user_mapping.CompanyId
							END
							ELSE
							BEGIN
								SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
							END
						END
						ELSE
						BEGIN
							SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
						END
					END
					ELSE
					BEGIN
						SELECT '-1' AS RoleName, '-1' AS CompanyId ,'0' AS CountOfPermission
					END
				END
				ELSE
				BEGIN
					SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
				END
				END
				ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 )
				BEGIN
					IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND Cmp_Pass LIKE @Password AND IsDelete <> 1 AND IsActive <> 0)
					BEGIN
						SET @CompanyId = (SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND Cmp_Pass LIKE @Password AND IsDelete <> 1)
						SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WITH(NOLOCK) WHERE RoleName LIKE 'Company Owner')
						SET @countOfUser = (SELECT COUNT(tbl_userMapping.Id) FROM [dbo].[Tbl_Company_User_Mapping] tbl_userMapping WITH(NOLOCK)
						LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_userMapping.UserId
						WHERE tbl_userMapping.CompanyId = @CompanyId AND tbl_userMapping.IsDelete <> 1 AND tbl_roleMapping.RoleID = @RoleId)
						IF @countOfUser > 0
						BEGIN 
							SET @UserId = (SELECT TOP(1) tbl_mapping.UserId FROM [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK)
								LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_mapping.UserId
								WHERE tbl_roleMapping.RoleID = @RoleId AND tbl_mapping.IsDelete <> 1 AND tbl_roleMapping.IsDelete <> 1
							)

							SET @CountOfPermission = (SELECT COUNT(RolePermissionId) FROM [dbo].[Tbl_RolePermission] WITH(NOLOCK) WHERE RoleID = @RoleId)
							SELECT 'Company Owner' AS RoleName, @CompanyId AS CompanyId,@CountOfPermission AS CountOfPermission
						END
						ELSE 
						BEGIN
							SET @CountOfPermission = (SELECT COUNT(RolePermissionId) FROM [dbo].[Tbl_RolePermission] WITH(NOLOCK)
							WHERE RoleID = @RoleId)
							SELECT 'Company Owner' AS RoleName, @CompanyId AS CompanyId,@CountOfPermission AS CountOfPermission
						END
					END
					ELSE 
					BEGIN
						SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
					END
				END
			ELSE 
			BEGIN 
				SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
			END
		END
		ELSE 
		BEGIN 
			SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
		END
	END
	ELSE 
	BEGIN 
		SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
	END
END

-- USP_Login NULL,N'SUC04',N'l0kf6SUMjlDVzdVV2wHiRw=='
--ALTER PROCEDURE [dbo].[USP_Login]
--	@EmailId NVARCHAR(MAX) = NULL,
--	@AccountNumber NVARCHAR(MAX) =NULL,
--	@Password NVARCHAR(MAX) = NULL
--AS
--BEGIN
--	SET NOCOUNT ON;

--	DECLARE @UserId INT = NULL,@RoleId INT = NULL,@SalesPersonId INT = NULL,@CompanyId INT = NULL,@countOfUser INT = NULL,@CountOfPermission INT = NULL;
--	IF @AccountNumber IS NOT NULL
--	BEGIN
--		IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1)
--		BEGIN
--			SET @UserId = (SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <> 0)
--			--SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_User_Role_Mapping] WHERE UserId = @UserId)
--			IF EXISTS(SELECT ID FROM [dbo].[Tbl_Password] WITH(NOLOCK) WHERE UserId =@UserId)
--			BEGIN
--				IF EXISTS(SELECT Id FROM [dbo].[Tbl_Password] WITH(NOLOCK) WHERE UserId =@UserId AND [Password]=@Password)
--				BEGIN 
--					IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <> 0)
--					BEGIN
--						DECLARE @UserCompanyId INT = NULL
						
--						SET @UserCompanyId = (SELECT TOP 1 tbl_company_user_mapping.CompanyId FROM [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping 
--									LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_mapping.UserId
--									WHERE tbl_company_user_mapping.UserId = @UserId
--									AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsLogin <> 0
--									ORDER BY tbl_company_user_mapping.Id DESC)

--						IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] tbl_company WHERE tbl_company.Id = @UserCompanyId AND tbl_company.IsActive <> 0 AND tbl_company.IsDelete <> 1)
--						BEGIN
--							SELECT DISTINCT
--								tbl_role.RoleName,tbl_company_user_mapping.CompanyId AS CompanyId,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
--							FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
--							LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_usermapping ON tbl_user.Id = tbl_usermapping.UserId
--							LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_usermapping.RoleID = tbl_role.RoleID
--							LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
--							LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
--							LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_company_user_mapping.CompanyId 
--							WHERE tbl_user.Id = @UserId AND tbl_usermapping.IsDelete <> 1 AND tbl_company_user_mapping.CompanyId <> 0
--							AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsLogin <> 0
--							GROUP BY tbl_usermapping.RoleID,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_company_user_mapping.CompanyId
--						END
--						ELSE
--						BEGIN
--							SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--						END
--					END
--					ELSE
--					BEGIN
--						SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--					END
--				END
--				ELSE
--				BEGIN
--					SELECT '-1' AS RoleName, '-1' AS CompanyId ,'0' AS CountOfPermission
--				END
--			END
--			ELSE
--			BEGIN
--				SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--			END
--		END
--		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND IsDelete <> 1 )
--		BEGIN
--			IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND Cmp_Pass LIKE @Password AND IsDelete <> 1 AND IsActive <> 0)
--			BEGIN
--				SET @CompanyId = (SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE AccountNumber LIKE @AccountNumber AND Cmp_Pass LIKE @Password AND IsDelete <> 1)
--				SET @RoleId = (SELECT RoleID FROM [dbo].[Tbl_Role] WITH(NOLOCK) WHERE RoleName LIKE 'Company Owner')
--				SET @countOfUser = (SELECT COUNT(tbl_userMapping.Id) FROM [dbo].[Tbl_Company_User_Mapping] tbl_userMapping WITH(NOLOCK)
--				LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_userMapping.UserId
--				WHERE tbl_userMapping.CompanyId = @CompanyId AND tbl_userMapping.IsDelete <> 1 AND tbl_roleMapping.RoleID = @RoleId)
--				IF @countOfUser > 0
--				BEGIN 
--					SET @UserId = (SELECT TOP(1) tbl_mapping.UserId FROM [dbo].[Tbl_Company_User_Mapping] tbl_mapping WITH(NOLOCK)
--						LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping ON tbl_roleMapping.UserId = tbl_mapping.UserId
--						WHERE tbl_roleMapping.RoleID = @RoleId AND tbl_mapping.IsDelete <> 1 AND tbl_roleMapping.IsDelete <> 1
--					)

--					SET @CountOfPermission = (SELECT COUNT(RolePermissionId) FROM [dbo].[Tbl_RolePermission] WITH(NOLOCK) WHERE RoleID = @RoleId)
--					SELECT 'Company Owner' AS RoleName, @CompanyId AS CompanyId,@CountOfPermission AS CountOfPermission
--				END
--				ELSE 
--				BEGIN
--					SET @CountOfPermission = (SELECT COUNT(RolePermissionId) FROM [dbo].[Tbl_RolePermission] WITH(NOLOCK)
--					WHERE RoleID = @RoleId)
--					SELECT 'Company Owner' AS RoleName, @CompanyId AS CompanyId,@CountOfPermission AS CountOfPermission
--				END
--			END
--			ELSE 
--			BEGIN
--				SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--			END
--		END
--		ELSE 
--		BEGIN 
--			SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--		END
--	END
--	ELSE IF @EmailId IS NOT NULL
--	BEGIN
--		IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE EmailID LIKE @EmailId AND IsDelete <> 1)
--		BEGIN
--			SET @UserId = (SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE EmailID LIKE @EmailId AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <> 0)
--			IF EXISTS(SELECT ID FROM [dbo].[Tbl_Password] WITH(NOLOCK) WHERE UserId =@UserId)
--			BEGIN
--				IF EXISTS(SELECT ID FROM [dbo].[Tbl_Password] WITH(NOLOCK) WHERE UserId =@UserId AND [Password]=@Password)
--				BEGIN
--					IF EXISTS(SELECT Id FROM [dbo].[Tbl_User] WITH(NOLOCK) WHERE EmailID LIKE @EmailId AND IsDelete <> 1 AND IsActive <> 0 AND IsLogin <>0)
--					BEGIN
--						SELECT DISTINCT
--							tbl_role.RoleName,tbl_company_user_mapping.CompanyId AS CompanyId,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
--						FROM [dbo].[Tbl_User] tbl_user WITH(NOLOCK)
--						LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_usermapping ON tbl_user.Id = tbl_usermapping.UserId
--						LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_usermapping.RoleID = tbl_role.RoleID
--						LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
--						LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping ON tbl_company_user_mapping.UserId = tbl_user.Id
--						LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_company_user_mapping.CompanyId 
--						WHERE tbl_user.Id = @UserId AND tbl_usermapping.IsDelete <> 1 AND tbl_company_user_mapping.CompanyId <> 0
--						AND tbl_user.IsDelete <> 1 AND tbl_user.IsActive <> 0 AND tbl_user.IsLogin <> 0
--						GROUP BY tbl_usermapping.RoleID,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_company_user_mapping.CompanyId
--					END
--					ELSE
--					BEGIN
--						SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--					END
--				END
--				ELSE
--				BEGIN
--					SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--				END
--			END
--			ELSE
--			BEGIN
--				SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--			END
--		END
--		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE (EmailID = @EmailId OR SecondEmailID = @EmailId) AND IsDelete <> 1 )
--		BEGIN
--			IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company]WITH(NOLOCK)  WHERE (EmailID = @EmailId OR SecondEmailID = @EmailId) AND IsDelete <> 1 AND Cmp_Pass = @Password)
--			BEGIN
--				IF EXISTS(SELECT Id FROM [dbo].[Tbl_Company]WITH(NOLOCK)  WHERE (EmailID = @EmailId OR SecondEmailID = @EmailId) AND Cmp_Pass = @Password AND IsActive <> 0)
--				BEGIN
--					SET @CompanyId =(SELECT Id FROM [dbo].[Tbl_Company] WITH(NOLOCK) WHERE (EmailID = @EmailId OR SecondEmailID = @EmailId) AND Cmp_Pass = @Password)

--					SELECT 'Company Owner' AS RoleName , @CompanyId AS CompanyId,'0' AS CountOfPermission
--				END
--				ELSE
--				BEGIN
--					SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--				END
--			END
--			ELSE
--			BEGIN
--				SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--			END
--		END
--		ELSE IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId = @EmailId  AND IsDelete <> 1 )
--		BEGIN
--			IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId = @EmailId  AND IsLogin <> 0 AND IsActive <> 0)
--			BEGIN
--				IF EXISTS(SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId = @EmailId  AND IsActive <> 0)
--				BEGIN
--					SET @SalesPersonId = (SELECT Id FROM [dbo].[Tbl_SalesPersons] WITH(NOLOCK) WHERE EmailId LIKE @EmailId AND IsDelete <> 1)
--					IF EXISTS(SELECT Id FROM [dbo].[Tbl_Password] WHERE SalesPersonId =@SalesPersonId AND [Password]=@Password)
--					BEGIN
--						SELECT DISTINCT
--							tbl_role.RoleName,MAX(tbl_mapping.CompanyId) AS CompanyId,COUNT(tbl_rolepermission.RolePermissionId) AS CountOfPermission
--						FROM [dbo].[Tbl_SalesPersons] tbl_salesPerson WITH(NOLOCK)
--						LEFT JOIN [dbo].[Tbl_Role] tbl_role ON tbl_salesPerson.Designation = tbl_role.RoleID
--						LEFT JOIN [dbo].[Tbl_RolePermission] tbl_rolepermission ON tbl_rolepermission.RoleID = tbl_role.RoleID
--						LEFT JOIN [dbo].[Tbl_SalesPerson_Company_Mapping] tbl_mapping ON tbl_mapping.SalesPersonId = tbl_salesPerson.Id
--						LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id =tbl_mapping.CompanyId 
--						WHERE tbl_salesPerson.Id = @SalesPersonId AND tbl_salesPerson.IsDelete <> 1 AND tbl_mapping.CompanyId = 
--						(SELECT MAX(CompanyId) FROM [dbo].[Tbl_SalesPerson_Company_Mapping] WHERE SalesPersonId = tbl_mapping.SalesPersonId AND IsDelete <> 1)
--						GROUP BY tbl_salesPerson.Designation,tbl_role.RoleName,tbl_rolepermission.PermissionId,tbl_mapping.CompanyId
--					END
--					ELSE 
--					BEGIN
--						SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--					END
--				END
--				ELSE
--				BEGIN
--					SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--				END
--			END
--			ELSE
--			BEGIN
--				SELECT '-2' AS RoleName, '-2' AS CompanyId,'0' AS CountOfPermission
--			END
--		END
--		ELSE
--		BEGIN
--			SELECT '-1' AS RoleName, '-1' AS CompanyId,'0' AS CountOfPermission
--		END
--	END
--END

GO
/****** Object:  StoredProcedure [dbo].[USP_RemoveLogs]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_RemoveLogs]
AS
BEGIN
	SET NOCOUNT ON;
	DELETE FROM [dbo].[Tbl_Log]
	WHERE CONVERT(varchar,CONVERT(datetime2,TimeStamp),23) < CONVERT(varchar,GETUTCDATE(),23)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_SaveEnquiryFormDetailsOfWeb]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_SaveEnquiryFormDetailsOfWeb]
	@FromEmail NVARCHAR(200) = NULL,
	@ToEmail NVARCHAR(200) = NULL,
	@Name NVARCHAR(100) = NULL,
	@ContactNumber NVARCHAR(50)= NULL,
	@Description NVARCHAR(MAX) = NULL,
	@EnquiryFor NVARCHAR(100) = NULL,
	@Status NVARCHAR(50) = NULL
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @EnquiryNumber NVARCHAR(100) = NULL,
	@ClientEnquiryNumber NVARCHAR(100) = NULL,@ClientLastEnquiryNumber NVARCHAR(100) = NULL,@LastEnquiryNumber INT = NULL;

	IF EXISTS(SELECT Id FROM [dbo].[Tbl_EnquiryFormDetails] WITH(NOLOCK))
	BEGIN
		SET @LastEnquiryNumber = (SELECT MAX(CONVERT(INT,SUBSTRING(EnquiryNumber,CHARINDEX('y',EnquiryNumber)+1,LEN(EnquiryNumber))))
								FROM [dbo].[Tbl_EnquiryFormDetails] WITH(NOLOCK))

		SET @LastEnquiryNumber = CONVERT(INT,@LastEnquiryNumber) + 1;

		SET @EnquiryNumber = 'Enquiry' + CONVERT(NVARCHAR(50),@LastEnquiryNumber)
	END
	ELSE 
	BEGIN
		SET @EnquiryNumber = 'Enquiry101'
	END

	SET @ClientLastEnquiryNumber = (SELECT SUBSTRING(CONVERT(varchar(40), NEWID()),0,4));

	SET @ClientEnquiryNumber = (SELECT 'Enquiry-' + @ClientLastEnquiryNumber)

	WHILE EXISTS(SELECT Id FROM [dbo].[Tbl_EnquiryFormDetails] WHERE ClientEnquiryNumber LIKE @ClientEnquiryNumber)
	BEGIN
		SET @ClientLastEnquiryNumber = (SELECT SUBSTRING(CONVERT(varchar(40), NEWID()),0,4));

		SET @ClientEnquiryNumber = (SELECT 'Enquiry-' + @ClientLastEnquiryNumber)
	END

	INSERT INTO [dbo].[Tbl_EnquiryFormDetails](
		EnquiryNumber,
		ClientEnquiryNumber,
		FromEmail,
		ToEmail,
		Name,
		ContactNumber,
		Description,
		EnquiryFor,
		Status,
		CreatedOn,
		IsDelete
	)
	VALUES(
		@EnquiryNumber,
		@ClientEnquiryNumber,
		@FromEmail,
		@ToEmail,
		@Name,
		@ContactNumber,
		@Description,
		@EnquiryFor,
		@Status,
		SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
		0
	)

	SELECT @ClientEnquiryNumber AS ClientEnquiryNumber ,@EnquiryNumber AS EnquiryNumber;
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_SaveLogs]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[USP_SaveLogs]
AS
BEGIN
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Tbl_Log]( -- [DIBN_Log].
			Message,
			MessageTemplate,
			Level,
			TimeStamp,
			Exception,
			Properties,
			LogEvent,
			Username,
			IP,
			IsActive,
			IsDelete
		)
	SELECT 
		tbl_log.Message,
		tbl_log.MessageTemplate,
		tbl_log.Level,
		tbl_log.TimeStamp,
		tbl_log.Exception,
		tbl_log.Properties,
		tbl_log.LogEvent,
		tbl_log.Username,
		tbl_log.IP,
		tbl_log.IsActive,
		tbl_log.IsDelete
	FROM [dbo].[Tbl_Log] tbl_log --[DevotionPortal_DB].
	WHERE CONVERT(varchar,CONVERT(datetime2,TimeStamp),23) = CONVERT(varchar,GETUTCDATE(),23)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_Select_GetCompanyDetailsById]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		USP_Select_GetCompanyDetailsById
-- Create date: <29-Oct-2024>
-- Modify By : <>
-- Modify date : <>
-- Description:	Get company Detail by id
-- USP_Select_GetCompanyDetailsById 2764
-- =============================================

CREATE PROCEDURE [dbo].[USP_Select_GetCompanyDetailsById]
	@Id int = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT
		ISNULL(tbl_company.Id,0) AS Id,
		ISNULL(tbl_company.CompanyName,'N/A') AS CompanyName,
		ISNULL(tbl_company.CompanyType,'N/A') AS CompanyType,
		ISNULL(tbl_company.AccountNumber,'N/A') AS CompanyCode,
		ISNULL(tbl_company.MCountryCode,'N/A') AS MainContactNumberCountry,
		ISNULL(tbl_company.MobileNumber,'N/A') AS MobileNumber,
		ISNULL(tbl_company.EmailID,'N/A') AS EmailID,
		ISNULL(FORMAT(tbl_company.CompanyStartingDate,'yyyy-MM-dd'),'N/A') AS CompanyStartingDate,
		ISNULL(tbl_company.City,'N/A') AS City,
		ISNULL(tbl_company.Country,'N/A') AS Country,
		ISNULL(tbl_company.IsTRN,0) AS IsTRN,
		ISNULL(tbl_company.TRN,'N/A') AS TRN,
		ISNULL(FORMAT(tbl_company.CompanyStartingDate,'yyyy-MM-dd'),'N/A') AS TRNCreationDate,
		ISNULL(tbl_company.IsCorportaeText,0) AS IsCorporateText,
		ISNULL(tbl_company.CorporateText,'N/A') AS CorporateText,
		ISNULL(tbl_company.IsActive,0) AS IsActive,
		ISNULL(tbl_user.FirstName + '' + CASE WHEN ISNULL(tbl_user.LastName,'N/A') <> 'N/A' THEN ' ' + tbl_user.LastName ELSE '' END,'N/A') AS Ownername,
		ISNULL(tbl_user.Id,0) AS OwnerId
	FROM [dbo].[Tbl_Company] tbl_company WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Mapping] tbl_company_user_mapping WITH(NOLOCK) ON tbl_company_user_mapping.CompanyId = tbl_company.Id
	LEFT JOIN [dbo].[Tbl_User] tbl_user WITH(NOLOCK) ON tbl_company_user_mapping.UserId = tbl_user.Id
	WHERE tbl_company.IsDelete <> 1
	AND tbl_company.Id = @Id
	AND (tbl_user.Id = (
		SELECT TOP 1 tbl_companyMapping.UserId FROM [dbo].[Tbl_Company_User_Mapping] tbl_companyMapping WITH(NOLOCK) 
		LEFT JOIN [dbo].[Tbl_User_Role_Mapping] tbl_roleMapping WITH(NOLOCK) ON tbl_companyMapping.UserId = tbl_roleMapping.UserId
		LEFT JOIN [dbo].[Tbl_Role] tbl_role WITH(NOLOCK) ON tbl_roleMapping.RoleId = tbl_role.RoleID
		WHERE tbl_companyMapping.IsDelete <> 1 AND tbl_companyMapping.CompanyId = @Id
		AND tbl_role.RoleName = 'Company Owner'
		AND tbl_roleMapping.IsDelete <> 1
	) OR tbl_user.Id IS NULL)
END;
GO
/****** Object:  StoredProcedure [dbo].[USP_User_DownloadDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <13-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<SP_User_DownloadDocument 1,50>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_User_DownloadDocument]
	@CompanyId INT = NULL,
	@Id INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_documents.Id AS Id,
		tbl_company.DibnUserNumber+'_'+tbl_documents.FileName AS [FileName],
		tbl_documents.Extension AS Extension,
		tbl_documents.DataBinary AS DataBinary,
		tbl_documents.Title AS Title,
		tbl_documents.Description AS [Description],
		tbl_company.Id AS CompanyId,
		tbl_company_user_document_mapping.UserId AS UserId
	FROM [dbo].[Tbl_Documents] tbl_documents WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Document_Mapping] tbl_company_user_document_mapping ON tbl_company_user_document_mapping.DocumentId = tbl_documents.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_document_mapping.CompanyId
	LEFT JOIN [dbo].[Tbl_User] tbl_user ON tbl_user.Id = tbl_company_user_document_mapping.UserId
	WHERE tbl_company_user_document_mapping.CompanyId = @CompanyId AND tbl_user.IsDelete <>1 AND (tbl_documents.Id = @Id OR @Id IS NULL OR @Id=0)
END
GO
/****** Object:  StoredProcedure [dbo].[USP_User_GetDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <04-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<SP_User_GetDocument 50,42 >>
-- =============================================
CREATE PROCEDURE [dbo].[USP_User_GetDocument]
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@Id INT = NULL,
	@SelectedDocumentType INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_documents.Id AS Id,
		tbl_company.DibnUserNumber+'_'+tbl_documents.FileName AS [FileName],
		tbl_documents.Extension AS Extension,
		tbl_documents.DataBinary AS DataBinary,
		tbl_documents.Title AS Title,
		tbl_documents.Description AS [Description],
		tbl_company.Id AS CompanyId,
		tbl_company_user_document_mapping.UserId AS UserId,
		tbl_documents.DocumentTypeId AS DocumentTypeId
	FROM [dbo].[Tbl_Documents] tbl_documents WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Document_Mapping] tbl_company_user_document_mapping ON tbl_company_user_document_mapping.DocumentId = tbl_documents.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_document_mapping.CompanyId
	WHERE tbl_company_user_document_mapping.CompanyId = @CompanyId
	AND (tbl_documents.IsDelete <> 1) 
	AND (tbl_documents.Id = @Id OR @Id IS NULL)
	AND(tbl_company_user_document_mapping.UserId = @UserId OR @UserId IS NULL OR @UserId = 0)
	OR tbl_documents.DocumentTypeId = @SelectedDocumentType  
END
GO
/****** Object:  StoredProcedure [dbo].[USP_User_GetDocumentOfEmployee]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <13-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<SP_User_GetDocumentOfEmployee>>
-- =============================================
CREATE PROCEDURE [dbo].[USP_User_GetDocumentOfEmployee]
	@CompanyId INT = NULL,
	@UserId INT = NULL,
	@Id INT = NULL,
	@SelectedDocumentType INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	SELECT 
		tbl_documents.Id AS Id,
		tbl_company.DibnUserNumber+'_'+tbl_documents.FileName AS [FileName],
		tbl_documents.Extension AS Extension,
		tbl_documents.DataBinary AS DataBinary,
		tbl_documents.Title AS Title,
		tbl_documents.Description AS [Description],
		tbl_company.Id AS CompanyId,
		tbl_company_user_document_mapping.UserId AS UserId
	FROM [dbo].[Tbl_Documents] tbl_documents WITH(NOLOCK)
	LEFT JOIN [dbo].[Tbl_Company_User_Document_Mapping] tbl_company_user_document_mapping ON tbl_company_user_document_mapping.DocumentId = tbl_documents.Id
	LEFT JOIN [dbo].[Tbl_Company] tbl_company ON tbl_company.Id = tbl_company_user_document_mapping.CompanyId
	WHERE tbl_company_user_document_mapping.CompanyId = @CompanyId AND tbl_documents.DocumentTypeId = @SelectedDocumentType  AND (tbl_documents.Id = @Id OR @Id IS NULL)
	AND tbl_company_user_document_mapping.UserId = @UserId 
	AND (tbl_documents.IsDelete <> 1 AND tbl_documents.IsDelete IS NULL)
END
GO
/****** Object:  StoredProcedure [dbo].[USP_User_SaveDocument]    Script Date: 30-10-2024 15:06:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Yashasvi Sharma>
-- Create date: <04-Jan-2022>
-- Modify By : <Name,,>
-- Modify date : <Modify Date>
-- Description:	<<SP_User_SaveDocument>>
-- =============================================

CREATE PROCEDURE [dbo].[USP_User_SaveDocument]
	@FileName NVARCHAR(MAX) = NULL,
	@Extension NVARCHAR(50) = NULL,
	@DataBinary VARBINARY(MAX) = NULL,
	@CompanyId INT = NULL,
	@Title NVARCHAR(MAX) = NULL,
	@Description NVARCHAR(MAX) = NULL,
	@EmployeeId INT = NULL,
	@UserId INT = NULL,
	@SelectedDocumentId INT = NULL
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @DocumentId INT = NULL;

	IF @CompanyId IS NOT NULL
	BEGIN
		INSERT INTO [dbo].[Tbl_Documents](
			FileName,
			Extension,
			Title,
			Description,
			DataBinary,
			CreatedBy,
			CreatedOnUtc,
			IsDelete,
			DocumentTypeId
		)
		VALUES(
			@FileName,
			@Extension,
			@Title,
			@Description,
			@DataBinary,
			@UserId,
			SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time',
			0,
			@SelectedDocumentId
		)

		SET @DocumentId = (SELECT MAX(Id) FROM [dbo].[Tbl_Documents])

		IF @DocumentId > 0
		BEGIN
			INSERT INTO [dbo].[Tbl_Company_User_Document_Mapping](
				DocumentId,
				CompanyId,
				UserId,
				CreatedBy,
				CreatedOnUtc
			)
			VALUES(
				@DocumentId,
				@CompanyId,
				@EmployeeId,
				@UserId,
				SYSDATETIMEOFFSET() AT TIME ZONE 'Arabian Standard Time'
			)
		END

		SELECT @DocumentId
	END
	ELSE 
	BEGIN
		SELECT -1
	END
END;
GO
USE [master]
GO
ALTER DATABASE [DIBN_Staging_DB] SET  READ_WRITE 
GO
